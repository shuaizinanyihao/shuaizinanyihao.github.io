<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç¾å›½â€œè“å¤©ä½¿â€é£è¡Œè¡¨æ¼”é˜Ÿ</title>
    <url>/post/4ed7ff9d.html</url>
    <content><![CDATA[<blockquote><p>âœˆï¸ <strong>ç¾å›½æµ·å†›â€œè“å¤©ä½¿â€é£è¡Œè¡¨æ¼”é˜Ÿ ~</strong></p></blockquote><a id="more"></a><p><strong>â€œè“å¤©ä½¿â€é£è¡Œè¡¨æ¼”é˜Ÿæ˜¯ç›®å‰ä¸–ç•Œä¸Šå”¯ä¸€ä¸€æ”¯å±äºæµ·å†›èˆªç©ºå…µçš„é£è¡Œè¡¨æ¼”é˜Ÿã€‚</strong><br>å®ƒæˆç«‹äº 1946 å¹´ 4 æœˆï¼Œæ­£å€¼ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ç»“æŸåä¸€å¹´ï¼Œæ€»éƒ¨è®¾åœ¨ä½›ç½—é‡Œè¾¾å·çš„æ°å…‹é€Šç»´å°”æµ·å†›èˆªç©ºå…µè®­ç»ƒåŸºåœ°ã€‚æ¯”ç¾å›½ç©ºå†›çš„â€œé›·é¸Ÿâ€æ—© 7 å¹´ç»„å»ºï¼Œæ˜¯ä¸–ç•Œä¸Šå†å²æœ€æ‚ ä¹…çš„ç‰¹æŠ€é£è¡Œè¡¨æ¼”é˜Ÿä¹‹ä¸€ã€‚</p><h2 id="ğŸ’™-è¶…çº§å–œæ¬¢"><a href="#ğŸ’™-è¶…çº§å–œæ¬¢" class="headerlink" title="ğŸ’™ è¶…çº§å–œæ¬¢"></a>ğŸ’™ è¶…çº§å–œæ¬¢</h2><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712112935.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712112948.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712112953.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712112957.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712113001.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712113014.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712113005.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712113008.jpeg" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210712113011.jpeg" alt=""></p><hr><h2 id="ğŸ“¸-é«˜æ¸…å›¾åº“"><a href="#ğŸ“¸-é«˜æ¸…å›¾åº“" class="headerlink" title="ğŸ“¸ é«˜æ¸…å›¾åº“"></a>ğŸ“¸ é«˜æ¸…å›¾åº“</h2><p><a href="https://tieba.baidu.com/p/2182796655?pid=29768437816&red_tag=0907330958#29768437816" target="_blank" rel="noopener">ç¾å›½æµ·å†›â€œè“å¤©ä½¿â€ç³»åˆ—é«˜æ¸…å›¾ â… </a><br><a href="https://zhuanlan.zhihu.com/p/32574065" target="_blank" rel="noopener">ç¾å›½æµ·å†›â€œè“å¤©ä½¿â€ç³»åˆ—é«˜æ¸…å›¾ â…¡</a></p><hr><blockquote><p>ğŸ’« <em>è‡ªç”±ã€å‹‡æ°”ä¸å®Œç¾çš„è±¡å¾ â€”â€” è¿™å°±æ˜¯â€œè“å¤©ä½¿â€ï¼</em></p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è“å¤©ä½¿</category>
      </categories>
      <tags>
        <tag>è“å¤©ä½¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€æºæ¨è</title>
    <url>/post/6662203c.html</url>
    <content><![CDATA[<blockquote><p>ğŸ’¬ <strong>æ‡‚å¾—åˆ†äº«ï¼Œæ‰ä¼šæˆåŠŸï¼ŒåŠ æ²¹ï¼</strong></p></blockquote><a id="more"></a><h2 id="ğŸ’¡-å¼€æºæŠ€æœ¯æ¨è"><a href="#ğŸ’¡-å¼€æºæŠ€æœ¯æ¨è" class="headerlink" title="ğŸ’¡ å¼€æºæŠ€æœ¯æ¨è"></a>ğŸ’¡ å¼€æºæŠ€æœ¯æ¨è</h2><blockquote><p>ğŸš€ é«˜è´¨é‡çš„ Spring Boot ä¸å¾®æœåŠ¡é¡¹ç›®é›†åˆï¼ŒåŠ©ä½ å¿«é€Ÿæ„å»ºä¼ä¸šçº§ç³»ç»Ÿã€‚</p></blockquote><ol><li><a href="https://github.com/chillzhuang/SpringBlade" target="_blank" rel="noopener"><strong>SpringBlade</strong></a> - å®Œæ•´çš„çº¿ä¸Šè§£å†³æ–¹æ¡ˆï¼ˆä¼ä¸šå¼€å‘å¿…å¤‡ï¼‰</li><li><a href="https://github.com/pigxcloud/pig" target="_blank" rel="noopener"><strong>Pig</strong></a> - å®‡å®™æœ€å¼ºå¾®æœåŠ¡è®¤è¯æˆæƒè„šæ‰‹æ¶ï¼ˆæ¶æ„å¸ˆå¿…å¤‡ï¼‰</li><li><a href="https://github.com/lyb-geek/springboot-learning" target="_blank" rel="noopener"><strong>lyb-geek</strong></a> - SpringBoot å­¦ä¹ é¡¹ç›®</li><li><a href="https://github.com/xkcoding/spring-boot-demo" target="_blank" rel="noopener"><strong>spring-boot-demo</strong></a> - æ·±åº¦å­¦ä¹ ä¸å®æˆ˜é¡¹ç›®</li><li><a href="https://gitee.com/cicadasmile" target="_blank" rel="noopener"><strong>çŸ¥äº†ä¸€ç¬‘</strong></a> - Gitee ä¼˜ç§€å¼€æºé¡¹ç›®åˆé›†</li><li><a href="https://gitee.com/owenwangwen/open-capacity-platform" target="_blank" rel="noopener"><strong>OCP&amp;cp</strong></a> - å¼€æ”¾èƒ½åŠ›å¹³å°</li><li><a href="https://gitee.com/bdj/SpringBoot_v2" target="_blank" rel="noopener"><strong>SpringBoot_v2</strong></a> - æè‡´ç»†è…»çš„ SpringBoot è„šæ‰‹æ¶</li><li><a href="https://gitee.com/52itstyle/spring-boot-seckill" target="_blank" rel="noopener"><strong>spring-boot-seckill</strong></a> - ç§’æ€æ¶æ„å®è·µä¸æ€»ç»“</li><li><a href="https://gitee.com/zhengqingya/java-workspace.git" target="_blank" rel="noopener"><strong>zhengqingya-SpringBootæ•´åˆæ¡ˆä¾‹</strong></a> - SpringBoot ç»¼åˆæ¡ˆä¾‹</li><li><a href="https://gitee.com/stylefeng" target="_blank" rel="noopener"><strong>Stylefeng</strong></a> - åå°ç®¡ç†ç³»ç»Ÿæ•´åˆæ¡ˆä¾‹</li><li><a href="https://gitee.com/geek_qi/cloud-platform" target="_blank" rel="noopener"><strong>cloud-platform</strong></a> - å¾®æœåŠ¡åŒ–å¼€å‘å¹³å°</li><li><a href="https://gitee.com/moxi159753/mogu_blog_v2" target="_blank" rel="noopener"><strong>mogu_blog_v2</strong></a> - è˜‘è‡åšå®¢ç³»ç»Ÿ</li></ol><hr><h2 id="ğŸ“„-é¢è¯•ä¸å­¦ä¹ æ–‡æ¡£"><a href="#ğŸ“„-é¢è¯•ä¸å­¦ä¹ æ–‡æ¡£" class="headerlink" title="ğŸ“„ é¢è¯•ä¸å­¦ä¹ æ–‡æ¡£"></a>ğŸ“„ é¢è¯•ä¸å­¦ä¹ æ–‡æ¡£</h2><blockquote><p>ğŸ§  æ¶µç›–åç«¯ã€ç®—æ³•ã€ç³»ç»Ÿè®¾è®¡ç­‰é¢è¯•å¿…å¤‡èµ„æ–™ã€‚</p></blockquote><ol><li><a href="https://github.com/frank-lam/fullstack-tutorial" target="_blank" rel="noopener"><strong>fullstack-tutorial</strong></a> - å„ç±»é¢è¯•æ–‡æ¡£å¤§å…¨</li><li><a href="https://github.com/P-P-X/awesome-collector" target="_blank" rel="noopener"><strong>Awesome-Collector</strong></a> - é¢è¯•èµ„æ–™åˆé›†</li><li><a href="https://gitee.com/moxi159753/LearningNotes" target="_blank" rel="noopener"><strong>LearningNotes</strong></a> - é™Œæºªå­¦ä¹ ç¬”è®°</li><li><a href="https://github.com/CyC2018/CS-Notes" target="_blank" rel="noopener"><strong>CS-Notes</strong></a> - æŠ€æœ¯é¢è¯•åŸºç¡€çŸ¥è¯†</li><li><a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener"><strong>advanced-java</strong></a> - Java å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†</li><li><a href="https://github.com/geekxh/hello-algorithm" target="_blank" rel="noopener"><strong>hello-algorithm</strong></a> - å°æµ©ç®—æ³•ï¼ˆç®—æ³•å…¥é—¨ä½“ç³»ï¼‰</li><li><a href="https://github.com/qiurunze123/miaosha" target="_blank" rel="noopener"><strong>miaosha</strong></a> - ç§’æ€ç³»ç»Ÿè®¾è®¡ä¸å®ç°</li><li><a href="https://github.com/AobingJava/JavaFamily" target="_blank" rel="noopener"><strong>JavaFamily</strong></a> - Java é¢è¯•çŸ¥è¯†ç‚¹</li></ol><hr><h2 id="ğŸ’³-æ”¯ä»˜ç³»ç»Ÿç›¸å…³"><a href="#ğŸ’³-æ”¯ä»˜ç³»ç»Ÿç›¸å…³" class="headerlink" title="ğŸ’³ æ”¯ä»˜ç³»ç»Ÿç›¸å…³"></a>ğŸ’³ æ”¯ä»˜ç³»ç»Ÿç›¸å…³</h2><blockquote><p>ğŸ’° å¸¸ç”¨æ”¯ä»˜ç³»ç»Ÿä¸ SDK å¼€æºé¡¹ç›®ã€‚</p></blockquote><ol><li><a href="https://gitee.com/javen205/IJPay" target="_blank" rel="noopener"><strong>IJPay</strong></a> - æ”¯ä»˜ SDK è®©æ”¯ä»˜è§¦æ‰‹å¯åŠ</li><li><a href="https://gitee.com/52itstyle/spring-boot-pay" target="_blank" rel="noopener"><strong>spring-boot-pay</strong></a> - è½»é‡æ”¯ä»˜ SDK</li><li><a href="https://gitee.com/jeequan/jeepay" target="_blank" rel="noopener"><strong>Jeepay</strong></a> - å®Œæ•´æ”¯ä»˜ç³»ç»Ÿæ–¹æ¡ˆ</li></ol><hr><h2 id="ğŸ”‘-ç™»å½•ä¸æˆæƒ"><a href="#ğŸ”‘-ç™»å½•ä¸æˆæƒ" class="headerlink" title="ğŸ”‘ ç™»å½•ä¸æˆæƒ"></a>ğŸ”‘ ç™»å½•ä¸æˆæƒ</h2><blockquote><p>ğŸ” ç¬¬ä¸‰æ–¹ç™»å½•æ•´åˆé¡¹ç›®ã€‚</p></blockquote><ol><li><a href="https://gitee.com/yadong.zhang/JustAuth" target="_blank" rel="noopener"><strong>JustAuth</strong></a> - å²ä¸Šæœ€å…¨çš„ç¬¬ä¸‰æ–¹ç™»å½•å¼€æºåº“</li></ol><hr><h2 id="ğŸ—ï¸-æ¡†æ¶ä¸å¾®æœåŠ¡"><a href="#ğŸ—ï¸-æ¡†æ¶ä¸å¾®æœåŠ¡" class="headerlink" title="ğŸ—ï¸ æ¡†æ¶ä¸å¾®æœåŠ¡"></a>ğŸ—ï¸ æ¡†æ¶ä¸å¾®æœåŠ¡</h2><blockquote><p>ğŸ§© å¿«é€Ÿæ­å»ºä¼ä¸šçº§æ¡†æ¶ä½“ç³»çš„ä¼˜ç§€é¡¹ç›®ã€‚</p></blockquote><ol><li><a href="https://gitee.com/596392912/mica" target="_blank" rel="noopener"><strong>Mica</strong></a> - é«˜æ•ˆå¾®æœåŠ¡å¼€å‘å·¥å…·é›†</li><li><a href="https://gitee.com/zlt2000/microservices-platform" target="_blank" rel="noopener"><strong>microservices-platform</strong></a> - å¾®æœåŠ¡å¹³å°æ¡†æ¶</li><li><a href="https://gitee.com/smallc/SpringBlade" target="_blank" rel="noopener"><strong>SpringBlade (Giteeç‰ˆ)</strong></a> - é«˜åº¦é›†æˆåŒ–çš„å¾®æœåŠ¡å¹³å°</li><li><a href="https://gitee.com/matevip/matecloud" target="_blank" rel="noopener"><strong>MateCloud</strong></a> - ç°ä»£åŒ–äº‘åŸç”Ÿå¼€å‘å¹³å°</li><li><a href="https://github.com/jeecgboot/jeecg-boot" target="_blank" rel="noopener"><strong>jeecg-boot</strong></a> - ä¼ä¸šçº§ä½ä»£ç å¼€å‘å¹³å°</li><li><a href="http://icyfenix.cn/" target="_blank" rel="noopener"><strong>å‡¤å‡°æ¶æ„</strong></a> - æ¶æ„æ€æƒ³ä¸å®è·µæ€»ç»“</li><li><a href="https://github.com/Linyuzai/concept.git" target="_blank" rel="noopener"><strong>Concept</strong></a> -ï¼ˆ<a href="https://linyuzai.github.io/" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼‰</li></ol><hr><h2 id="ğŸ“š-ä¼˜è´¨ç”µå­ä¹¦èµ„æº"><a href="#ğŸ“š-ä¼˜è´¨ç”µå­ä¹¦èµ„æº" class="headerlink" title="ğŸ“š ä¼˜è´¨ç”µå­ä¹¦èµ„æº"></a>ğŸ“š ä¼˜è´¨ç”µå­ä¹¦èµ„æº</h2><ol><li><a href="https://github.com/itdevbooks/pdf" target="_blank" rel="noopener"><strong>Itdevbooks</strong></a> - IT å¼€å‘è€…ç”µå­ä¹¦å¤§å…¨</li></ol><hr><h2 id="ğŸ› ï¸-å¼€å‘å°å·¥å…·æ¨è"><a href="#ğŸ› ï¸-å¼€å‘å°å·¥å…·æ¨è" class="headerlink" title="ğŸ› ï¸ å¼€å‘å°å·¥å…·æ¨è"></a>ğŸ› ï¸ å¼€å‘å°å·¥å…·æ¨è</h2><ol><li><a href="https://www.baidufe.com/fehelper/index/index.html" target="_blank" rel="noopener"><strong>Webå¼€å‘è€…åŠ©æ‰‹ FeHelper</strong></a> - Web å¼€å‘åˆ©å™¨</li></ol><hr><blockquote><p>â¤ï¸ <strong>æŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿æ”¶è—ä¸ Starï¼</strong></p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>OpenSource</category>
      </categories>
      <tags>
        <tag>OpenSource</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ¥å£ä»£ç†è·³è½¬</title>
    <url>/post/58f53a54.html</url>
    <content><![CDATA[<blockquote><p>æ¥å£ä»£ç†è·³è½¬ ~</p></blockquote><a id="more"></a><h2 id="ä¸€ã€RestTemplateConfigé…ç½®"><a href="#ä¸€ã€RestTemplateConfigé…ç½®" class="headerlink" title="ä¸€ã€RestTemplateConfigé…ç½®"></a>ä¸€ã€RestTemplateConfigé…ç½®</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hc.client5.http.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.hc.client5.http.impl.classic.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.hc.client5.http.impl.classic.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.hc.client5.http.impl.io.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.hc.core5.util.Timeout;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.BufferingClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StreamUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_TOTAL_CONNECTIONS = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_PER_ROUTE = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_LOG_BODY_LENGTH = <span class="number">512</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONNECT_TIMEOUT_MS = <span class="number">5000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESPONSE_TIMEOUT_MS = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿æ¥æ± é…ç½®</span></span><br><span class="line">        PoolingHttpClientConnectionManager connectionManager = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</span><br><span class="line">        connectionManager.setMaxTotal(MAX_TOTAL_CONNECTIONS);</span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(MAX_PER_ROUTE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯·æ±‚é…ç½®</span></span><br><span class="line">        RequestConfig requestConfig =</span><br><span class="line">            RequestConfig.custom().setConnectionRequestTimeout(Timeout.of(CONNECT_TIMEOUT_MS, TimeUnit.MILLISECONDS))</span><br><span class="line">                .setResponseTimeout(Timeout.of(RESPONSE_TIMEOUT_MS, TimeUnit.MILLISECONDS)).build();</span><br><span class="line">        CloseableHttpClient httpClient =</span><br><span class="line">            HttpClients.custom().setConnectionManager(connectionManager).setDefaultRequestConfig(requestConfig).build();</span><br><span class="line">        HttpComponentsClientHttpRequestFactory factory = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient);</span><br><span class="line">        <span class="keyword">return</span> getRestTemplate(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">(HttpComponentsClientHttpRequestFactory factory)</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(<span class="keyword">new</span> BufferingClientHttpRequestFactory(factory));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æ‹¦æˆªå™¨ï¼ˆæ‰“å°å…¥å‚å‡ºå‚ï¼‰</span></span><br><span class="line">        restTemplate.setInterceptors(Collections.singletonList((request, body, execution) -&gt; &#123;</span><br><span class="line">            <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰“å°è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line">                log.info(<span class="string">"â¡ï¸ è¯·æ±‚å¼€å§‹ [&#123;&#125;] &#123;&#125;"</span>, request.getMethod(), request.getURI());</span><br><span class="line">                log.info(<span class="string">"è¯·æ±‚Headers: &#123;&#125;"</span>, request.getHeaders());</span><br><span class="line">                <span class="keyword">if</span> (body.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    String reqBody = <span class="keyword">new</span> String(body, StandardCharsets.UTF_8);</span><br><span class="line">                    log.info(<span class="string">"è¯·æ±‚Body: &#123;&#125;"</span>, abbreviate(reqBody, MAX_LOG_BODY_LENGTH));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line">                ClientHttpResponse response = execution.execute(request, body);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¯»å–å“åº”ä¿¡æ¯</span></span><br><span class="line">                String respBody = StreamUtils.copyToString(response.getBody(), StandardCharsets.UTF_8);</span><br><span class="line">                <span class="keyword">long</span> duration = System.currentTimeMillis() - start;</span><br><span class="line"></span><br><span class="line">                log.info(<span class="string">"â¬…ï¸ å“åº”çŠ¶æ€: &#123;&#125;, è€—æ—¶: &#123;&#125; ms"</span>, response.getStatusCode(), duration);</span><br><span class="line">                log.info(<span class="string">"å“åº”Headers: &#123;&#125;"</span>, response.getHeaders());</span><br><span class="line">                log.info(<span class="string">"å“åº”Body: &#123;&#125;"</span>, abbreviate(respBody, MAX_LOG_BODY_LENGTH));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.error(<span class="string">"âŒ è¯·æ±‚å¼‚å¸¸ [&#123;&#125;] &#123;&#125;: &#123;&#125;"</span>, request.getMethod(), request.getURI(), e.getMessage(), e);</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆªæ–­è¿‡é•¿æ—¥å¿—å†…å®¹ï¼Œé¿å…æ‰“å°è¿‡å¤šæ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">abbreviate</span><span class="params">(String text, <span class="keyword">int</span> maxLength)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (text == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (text.length() &lt;= maxLength)</span><br><span class="line">            <span class="keyword">return</span> text;</span><br><span class="line">        <span class="keyword">return</span> text.substring(<span class="number">0</span>, maxLength) + <span class="string">"...(å·²æˆªæ–­)"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒã€ProxyControlleræ¥å£"><a href="#äºŒã€ProxyControlleræ¥å£" class="headerlink" title="äºŒã€ProxyControlleræ¥å£"></a>äºŒã€ProxyControlleræ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/proxy"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›®æ ‡æœåŠ¡å™¨åŸºç¡€URL</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TARGET_SERVER = <span class="string">"http://127.0.0.1:8080/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyController</span><span class="params">(RestTemplate restTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/**"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">proxyRequest</span><span class="params">(HttpServletRequest request, @RequestBody(required = <span class="keyword">false</span>)</span> String body) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// todo è¯·æ±‚æ£€æŸ¥ï¼Œ éœ€è¦å¯ä»¥è‡ªå®šä¹‰ç›¸å…³é€»è¾‘å¹¶è¿›è¡Œæ–¹æ³•è°ƒç”¨</span></span><br><span class="line">            <span class="comment">/*boolean valid = validateRequest(request);</span></span><br><span class="line"><span class="comment">            if(!valid)&#123;</span></span><br><span class="line"><span class="comment">                throw new IllegalArgumentException("bad param");</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line"></span><br><span class="line">            String requestUri = request.getRequestURI();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!requestUri.startsWith(<span class="string">"/proxy"</span>)) &#123;</span><br><span class="line">                log.debug(<span class="string">"éæ³•è·¯å¾„è¯·æ±‚è¢«å¿½ç•¥: &#123;&#125;"</span>, requestUri);</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND)</span><br><span class="line">                        .body(<span class="string">"è¯¥è·¯å¾„æœªè¢«å¤„ç†"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String proxyPath = requestUri.substring(<span class="string">"/proxy"</span>.length());</span><br><span class="line">            String queryString = request.getQueryString();</span><br><span class="line"></span><br><span class="line">            StringBuilder targetUrl = <span class="keyword">new</span> StringBuilder(TARGET_SERVER);</span><br><span class="line">            targetUrl.append(proxyPath);</span><br><span class="line">            <span class="keyword">if</span> (queryString != <span class="keyword">null</span>) &#123;</span><br><span class="line">                targetUrl.append(<span class="string">"?"</span>).append(queryString);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤åˆ¶è¯·æ±‚å¤´</span></span><br><span class="line">            HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">            Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br><span class="line">            <span class="keyword">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class="line">                String headerName = headerNames.nextElement();</span><br><span class="line">                <span class="comment">// æ’é™¤ä¸€äº›ä¸éœ€è¦è½¬å‘çš„å¤´éƒ¨</span></span><br><span class="line">                <span class="keyword">if</span> (!headerName.equalsIgnoreCase(<span class="string">"host"</span>)) &#123;</span><br><span class="line">                    headers.set(headerName, request.getHeader(headerName));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åˆ›å»ºè¯·æ±‚å®ä½“</span></span><br><span class="line">            HttpEntity&lt;String&gt; httpEntity = <span class="keyword">new</span> HttpEntity&lt;&gt;(body, headers);</span><br><span class="line">            <span class="comment">// ç¡®å®šHTTPæ–¹æ³•</span></span><br><span class="line">            HttpMethod httpMethod = HttpMethod.valueOf(request.getMethod());</span><br><span class="line">            <span class="comment">// å‘é€è¯·æ±‚å¹¶è·å–å“åº”</span></span><br><span class="line">            <span class="keyword">return</span> restTemplate.exchange(targetUrl.toString(), httpMethod, httpEntity, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"ä»£ç†è¯·æ±‚å¤±è´¥: &#123;&#125;"</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(<span class="string">"ä»£ç†è¯·æ±‚å¤±è´¥: "</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/upload/**"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; proxyUpload(HttpServletRequest request,</span><br><span class="line">        MultipartHttpServletRequest multipartRequest) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶éƒ¨åˆ†</span></span><br><span class="line">            MultiValueMap&lt;String, Object&gt; parts = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">            multipartRequest.getFileMap().forEach((name, file) -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ByteArrayResource resource = <span class="keyword">new</span> ByteArrayResource(file.getBytes()) &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> String <span class="title">getFilename</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> file.getOriginalFilename();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    parts.add(name, resource);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å…¶ä»–è¡¨å•å‚æ•°</span></span><br><span class="line">            multipartRequest.getParameterMap().forEach((name, values) -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">                    parts.add(name, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ„å»ºURL</span></span><br><span class="line">            String requestUri = request.getRequestURI();</span><br><span class="line">            String proxyPath = requestUri.substring(<span class="string">"/proxy/upload"</span>.length());</span><br><span class="line">            String targetUrl = TARGET_SERVER + <span class="string">"/upload"</span> + proxyPath;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">            HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">            headers.setContentType(MediaType.MULTIPART_FORM_DATA);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">            HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; requestEntity = <span class="keyword">new</span> HttpEntity&lt;&gt;(parts, headers);</span><br><span class="line">            ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; response = restTemplate.exchange(</span><br><span class="line">                    targetUrl, HttpMethod.POST, requestEntity, <span class="keyword">byte</span>[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"æ–‡ä»¶ä¸Šä¼ ä»£ç†è¯·æ±‚å¤±è´¥: &#123;&#125;"</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¤ºä¾‹ï¼šè¯·æ±‚éªŒè¯</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validateRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°éªŒè¯é€»è¾‘ï¼Œä¾‹å¦‚æ£€æŸ¥è®¤è¯ä¿¡æ¯ã€IPç™½åå•ç­‰</span></span><br><span class="line">        String authToken = request.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="comment">// return authToken != null &amp;&amp; authService.isValidToken(authToken);</span></span><br><span class="line">        <span class="keyword">return</span> authToken != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å»¶è¿Ÿä»»åŠ¡å®ç°æ–¹å¼æ±‡æ€»</title>
    <url>/post/374ea0e6.html</url>
    <content><![CDATA[<blockquote><p>åœ¨ç°ä»£ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå»¶è¿Ÿä»»åŠ¡å‡ ä¹æ— å¤„ä¸åœ¨ï¼šè®¢å• 30 åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆã€ç”¨æˆ·é¢„çº¦å‰æé†’ã€ç¼“å­˜è¿‡æœŸåˆ·æ–°ã€èµ„æºå›æ”¶ç­‰ã€‚<br>ä¼ ç»Ÿæ–¹æ¡ˆå¦‚ <code>Timer</code> æˆ– <code>ScheduledThreadPoolExecutor</code> è™½ç„¶å®ç°ç®€å•ï¼Œä½†åœ¨é«˜å¹¶å‘ã€å¤§é‡ä»»åŠ¡åœºæ™¯ä¸‹å¸¸ä¼šå‡ºç°æ€§èƒ½ç“¶é¢ˆå’Œå†…å­˜å‹åŠ›ã€‚</p></blockquote><a id="more"></a><h2 id="ä¸€ã€å»¶æ—¶ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€å»¶æ—¶ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€å»¶æ—¶ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€å»¶æ—¶ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å»¶æ—¶ä»»åŠ¡ï¼ˆDelayed Taskï¼‰ï¼ŒæŒ‡çš„æ˜¯<strong>åœ¨æŒ‡å®šå»¶è¿Ÿæ—¶é—´å</strong>æˆ–<strong>æœªæ¥æŸä¸ªæ—¶åˆ»</strong>æ‰§è¡Œçš„ä»»åŠ¡ã€‚<br>å®ƒæ˜¯å®šæ—¶ä»»åŠ¡ï¼ˆScheduled Taskï¼‰çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œæ›´ä¾§é‡äºâ€œ<strong>å»¶è¿Ÿæ‰§è¡Œä¸€æ¬¡</strong>â€è€Œéâ€œ<strong>å‘¨æœŸæ€§æ‰§è¡Œ</strong>â€ã€‚</p><p>å…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>ç”µå•†ï¼šè®¢å•æœªæ”¯ä»˜è¶…æ—¶è‡ªåŠ¨å…³é—­</li><li>ç¤¾äº¤ï¼šæ¶ˆæ¯æ’¤å›å€’è®¡æ—¶</li><li>è¿ç»´ï¼šå»¶è¿Ÿè§¦å‘æŸé¡¹è‡ªåŠ¨åŒ–ä»»åŠ¡</li></ul><hr><h2 id="äºŒã€ä¸»æµå®ç°æ–¹æ¡ˆæ¦‚è§ˆ"><a href="#äºŒã€ä¸»æµå®ç°æ–¹æ¡ˆæ¦‚è§ˆ" class="headerlink" title="äºŒã€ä¸»æµå®ç°æ–¹æ¡ˆæ¦‚è§ˆ"></a>äºŒã€ä¸»æµå®ç°æ–¹æ¡ˆæ¦‚è§ˆ</h2><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/202510311502610.png" alt=""></p><table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ScheduledThreadPoolExecutor</th><th align="left">æ¶ˆæ¯é˜Ÿåˆ— (MQ)</th><th align="left">Redis ZSET</th><th align="left">Quartz</th><th align="left"><strong>æ—¶é—´è½® (HashedWheelTimer)</strong></th></tr></thead><tbody><tr><td align="left">å®ç°å¤æ‚åº¦</td><td align="left">ç®€å•</td><td align="left">ä¸­ç­‰</td><td align="left">ç®€å•</td><td align="left">å¤æ‚</td><td align="left"><strong>ç®€å•</strong></td></tr><tr><td align="left">æ€§èƒ½</td><td align="left">ä¸­ç­‰</td><td align="left">é«˜</td><td align="left">è¾ƒé«˜</td><td align="left">ä¸­ç­‰</td><td align="left"><strong>æé«˜</strong></td></tr><tr><td align="left">å†…å­˜æ¶ˆè€—</td><td align="left">é«˜ï¼ˆä»»åŠ¡å¤šæ—¶ï¼‰</td><td align="left">ä½ï¼ˆä¾èµ– Brokerï¼‰</td><td align="left">ä½ï¼ˆä¾èµ– Redisï¼‰</td><td align="left">ä¸­ç­‰ï¼ˆä¾èµ– DBï¼‰</td><td align="left"><strong>æä½</strong></td></tr><tr><td align="left">ç²¾åº¦</td><td align="left">é«˜</td><td align="left">ä¸­/ä½</td><td align="left">ä¸­ï¼ˆå—è½®è¯¢é—´éš”å½±å“ï¼‰</td><td align="left">é«˜</td><td align="left"><strong>ä¸­ï¼ˆå¯è°ƒï¼‰</strong></td></tr><tr><td align="left">åˆ†å¸ƒå¼/é«˜å¯ç”¨</td><td align="left">ä¸æ”¯æŒ</td><td align="left">æ”¯æŒ</td><td align="left">éœ€è‡ªè¡Œå®ç°</td><td align="left">æ”¯æŒ</td><td align="left"><strong>å•æœºä½¿ç”¨</strong></td></tr><tr><td align="left">æŒä¹…åŒ–</td><td align="left">ä¸æ”¯æŒ</td><td align="left">æ”¯æŒ</td><td align="left">æ”¯æŒ</td><td align="left">æ”¯æŒ</td><td align="left">ä¸æ”¯æŒï¼ˆå†…å­˜ï¼‰</td></tr><tr><td align="left">é€‚ç”¨åœºæ™¯</td><td align="left">å•æœºã€ä»»åŠ¡é‡å°</td><td align="left">å¼‚æ­¥è§£è€¦ã€é«˜å¯é </td><td align="left">è½»é‡åˆ†å¸ƒå¼</td><td align="left">ä¼ä¸šçº§è°ƒåº¦</td><td align="left"><strong>å•æœºã€é«˜æ€§èƒ½</strong></td></tr></tbody></table><p>ä»å¯¹æ¯”ä¸­å¯è§ï¼Œ<code>HashedWheelTimer</code> åœ¨<strong>å•æœºæµ·é‡ä»»åŠ¡</strong>åœºæ™¯ä¸‹å…·æœ‰æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ç‡ä¼˜åŠ¿ã€‚</p><hr><h2 id="ä¸‰ã€æ—¶é—´è½®ç®—æ³•åŸç†è§£æ"><a href="#ä¸‰ã€æ—¶é—´è½®ç®—æ³•åŸç†è§£æ" class="headerlink" title="ä¸‰ã€æ—¶é—´è½®ç®—æ³•åŸç†è§£æ"></a>ä¸‰ã€æ—¶é—´è½®ç®—æ³•åŸç†è§£æ</h2><p>æ—¶é—´è½®ï¼ˆTime Wheelï¼‰æ˜¯ä¸€ç§<strong>é«˜æ•ˆã€ä½å¼€é”€</strong>çš„å»¶æ—¶ä»»åŠ¡è°ƒåº¦æ¨¡å‹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ—¶é—´â€œç¦»æ•£åŒ–â€ï¼Œç”¨<strong>ç¯å½¢æ•°ç»„</strong>ï¼ˆç±»ä¼¼æ—¶é’Ÿè¡¨ç›˜ï¼‰ç®¡ç†ä»»åŠ¡ã€‚</p><h3 id="ğŸ”§-åŸºæœ¬æ„æˆ"><a href="#ğŸ”§-åŸºæœ¬æ„æˆ" class="headerlink" title="ğŸ”§ åŸºæœ¬æ„æˆ"></a>ğŸ”§ åŸºæœ¬æ„æˆ</h3><ul><li><strong>ç¯å½¢æ•°ç»„ï¼ˆTicksï¼‰</strong>ï¼šç±»ä¼¼é’Ÿè¡¨è¡¨ç›˜ï¼Œåˆ’åˆ†ä¸ºå›ºå®šæ ¼æ•°ï¼ˆå¦‚ 512 æ ¼ï¼‰ï¼Œæ¯ä¸€æ ¼æ˜¯ä¸€ä¸ªâ€œæ—¶é—´æ§½ï¼ˆslotï¼‰â€ã€‚</li><li><strong>æŒ‡é’ˆï¼ˆCursorï¼‰</strong>ï¼šç›¸å½“äºç§’é’ˆï¼Œæ¯éš” <code>tickDuration</code>ï¼ˆå¦‚ 100msï¼‰ç§»åŠ¨ä¸€æ ¼ã€‚</li><li><strong>ä»»åŠ¡åˆ—è¡¨</strong>ï¼šæ¯ä¸ª slot å­˜æ”¾éœ€è¦åœ¨è¯¥æ—¶åˆ»è§¦å‘çš„ä»»åŠ¡é“¾è¡¨ã€‚</li></ul><h3 id="ğŸŒ€-å·¥ä½œæœºåˆ¶"><a href="#ğŸŒ€-å·¥ä½œæœºåˆ¶" class="headerlink" title="ğŸŒ€ å·¥ä½œæœºåˆ¶"></a>ğŸŒ€ å·¥ä½œæœºåˆ¶</h3><ol><li><strong>ä»»åŠ¡æ·»åŠ </strong><br>ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œæ ¹æ® <code>delay</code> è®¡ç®—å®ƒåº”æ”¾å…¥å“ªä¸ª slotï¼š<br><code>slotIndex = (currentTime + delay) / tickDuration % wheelSize</code></li><li><strong>æŒ‡é’ˆè½®è½¬</strong><br>æ¯éš” <code>tickDuration</code>ï¼ŒæŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€æ ¼ã€‚</li><li><strong>ä»»åŠ¡è§¦å‘</strong><br>æŒ‡é’ˆç§»åŠ¨åˆ°çš„ slot å†…æ‰€æœ‰ä»»åŠ¡è¢«ä¾æ¬¡æ‰§è¡Œï¼ˆé€šå¸¸æäº¤åˆ°ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡ï¼‰ã€‚</li></ol><h3 id="âš¡-æ€§èƒ½ä¼˜åŠ¿"><a href="#âš¡-æ€§èƒ½ä¼˜åŠ¿" class="headerlink" title="âš¡ æ€§èƒ½ä¼˜åŠ¿"></a>âš¡ æ€§èƒ½ä¼˜åŠ¿</h3><ul><li>æ’å…¥ä¸åˆ é™¤ä»»åŠ¡å¤æ‚åº¦å‡ä¸º <strong>O(1)</strong></li><li>æŒ‡é’ˆè½®è½¬æˆæœ¬å›ºå®šï¼Œä¸ä»»åŠ¡æ•°é‡æ— å…³</li><li>åœ¨ç™¾ä¸‡çº§ä»»åŠ¡åœºæ™¯ä¸‹ä¾ç„¶ä¿æŒ<strong>æé«˜æ€§èƒ½ä¸ä½å†…å­˜æ¶ˆè€—</strong></li></ul><hr><h2 id="å››ã€Spring-Boot-é›†æˆ-Netty-æ—¶é—´è½®"><a href="#å››ã€Spring-Boot-é›†æˆ-Netty-æ—¶é—´è½®" class="headerlink" title="å››ã€Spring Boot é›†æˆ Netty æ—¶é—´è½®"></a>å››ã€Spring Boot é›†æˆ Netty æ—¶é—´è½®</h2><p>Netty å†…ç½®çš„ <code>HashedWheelTimer</code> æ˜¯è¯¥æ¨¡å‹çš„é«˜æ•ˆå®ç°ï¼Œå¯ç›´æ¥é›†æˆäº Spring Boot åº”ç”¨ä¸­ã€‚</p><h3 id="1ï¸âƒ£-å¼•å…¥ä¾èµ–"><a href="#1ï¸âƒ£-å¼•å…¥ä¾èµ–" class="headerlink" title="1ï¸âƒ£ å¼•å…¥ä¾èµ–"></a>1ï¸âƒ£ å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.94.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ï¸âƒ£-å°è£…æ—¶é—´è½®è°ƒåº¦å™¨"><a href="#2ï¸âƒ£-å°è£…æ—¶é—´è½®è°ƒåº¦å™¨" class="headerlink" title="2ï¸âƒ£ å°è£…æ—¶é—´è½®è°ƒåº¦å™¨"></a>2ï¸âƒ£ å°è£…æ—¶é—´è½®è°ƒåº¦å™¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.scheduler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.util.HashedWheelTimer;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.Timeout;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.TimerTask;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.PreDestroy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashedWheelScheduler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashedWheelTimer timer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashedWheelScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timer = <span class="keyword">new</span> HashedWheelTimer(</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="number">100</span>, <span class="comment">// tickDuration: æ¯100msè½¬ä¸€æ ¼</span></span><br><span class="line">                TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="number">512</span>  <span class="comment">// è½®ç›˜å¤§å°</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æäº¤ä¸€æ¬¡æ€§å»¶è¿Ÿä»»åŠ¡ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Timeout <span class="title">schedule</span><span class="params">(Runnable task, <span class="keyword">long</span> delay, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> timer.newTimeout(timeout -&gt; task.run(), delay, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æäº¤å‘¨æœŸæ€§ä»»åŠ¡ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleAtFixedRate</span><span class="params">(Runnable task, <span class="keyword">long</span> initialDelay, <span class="keyword">long</span> period, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        timer.newTimeout(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Timeout timeout)</span> </span>&#123;</span><br><span class="line">                task.run();</span><br><span class="line">                timer.newTimeout(<span class="keyword">this</span>, period, unit); <span class="comment">// å†æ¬¡æäº¤è‡ªèº«</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, initialDelay, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        timer.stop(); <span class="comment">// ä¼˜é›…å…³é—­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ï¸âƒ£-ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•è¶…æ—¶å…³å•"><a href="#3ï¸âƒ£-ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•è¶…æ—¶å…³å•" class="headerlink" title="3ï¸âƒ£ ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•è¶…æ—¶å…³å•"></a>3ï¸âƒ£ ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•è¶…æ—¶å…³å•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.icoderoad.scheduler.HashedWheelScheduler;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.Timeout;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(OrderService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashedWheelScheduler scheduler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Long, Timeout&gt; timeoutMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderService</span><span class="params">(HashedWheelScheduler scheduler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scheduler = scheduler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** åˆ›å»ºè®¢å•æ—¶ï¼Œæ³¨å†Œ30åˆ†é’Ÿè¶…æ—¶ä»»åŠ¡ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"åˆ›å»ºè®¢å•: &#123;&#125;, æ³¨å†Œ30åˆ†é’Ÿåè‡ªåŠ¨å–æ¶ˆä»»åŠ¡"</span>, order.getId());</span><br><span class="line">        Timeout timeout = scheduler.schedule(</span><br><span class="line">                () -&gt; cancelUnpaidOrder(order.getId()),</span><br><span class="line">                <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">        timeoutMap.put(order.getId(), timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æ”¯ä»˜æˆåŠŸåå–æ¶ˆè¶…æ—¶ä»»åŠ¡ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPaid</span><span class="params">(Long orderId)</span> </span>&#123;</span><br><span class="line">        Timeout timeout = timeoutMap.remove(orderId);</span><br><span class="line">        <span class="keyword">if</span> (timeout != <span class="keyword">null</span> &amp;&amp; !timeout.isCancelled()) &#123;</span><br><span class="line">            timeout.cancel();</span><br><span class="line">            log.info(<span class="string">"è®¢å•: &#123;&#125; å·²æ”¯ä»˜ï¼Œå–æ¶ˆè‡ªåŠ¨å…³å•ä»»åŠ¡"</span>, orderId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cancelUnpaidOrder</span><span class="params">(Long orderId)</span> </span>&#123;</span><br><span class="line">        timeoutMap.remove(orderId);</span><br><span class="line">        log.info(<span class="string">"æ‰§è¡Œè‡ªåŠ¨å…³å•ä»»åŠ¡ï¼Œè®¢å•ID: &#123;&#125;"</span>, orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="äº”ã€æ€»ç»“ä¸é€‰å‹å»ºè®®"><a href="#äº”ã€æ€»ç»“ä¸é€‰å‹å»ºè®®" class="headerlink" title="äº”ã€æ€»ç»“ä¸é€‰å‹å»ºè®®"></a>äº”ã€æ€»ç»“ä¸é€‰å‹å»ºè®®</h2><table><thead><tr><th align="left">éœ€æ±‚</th><th align="left">æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td align="left">å¤æ‚è°ƒåº¦ã€å¯è§†åŒ–ç®¡ç†</td><td align="left"><strong>Quartz</strong></td></tr><tr><td align="left">åˆ†å¸ƒå¼ã€è§£è€¦ã€é«˜å¯é </td><td align="left"><strong>MQä¸­é—´ä»¶ å»¶è¿Ÿé˜Ÿåˆ—</strong></td></tr><tr><td align="left">è½»é‡åˆ†å¸ƒå¼ã€é«˜å¹¶å‘</td><td align="left"><strong>Redis ZSET</strong></td></tr><tr><td align="left">å•æœºæµ·é‡ã€é«˜æ€§èƒ½åœºæ™¯ï¼ˆæ¸¸æˆã€ç‰©è”ç½‘ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰</td><td align="left"><strong>HashedWheelTimer</strong></td></tr></tbody></table><p><code>HashedWheelTimer</code> å¹¶éä¸‡èƒ½ï¼Œä½†åœ¨è¿½æ±‚<strong>æè‡´æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ç‡</strong>çš„å•æœºå»¶æ—¶è°ƒåº¦åœºæ™¯ä¸­ï¼Œå®ƒçš„è¡¨ç°å ªç§°å®Œç¾ã€‚</p><hr><p>ğŸ“š <strong>å»¶ä¼¸é˜…è¯»ï¼š</strong></p><ul><li><a href="https://mp.weixin.qq.com/s/Q78Kgrg6DIO6MuRaUdefvA" target="_blank" rel="noopener">SpringBoot æ—¶é—´è½®å®ç°å»¶æ—¶ä»»åŠ¡</a></li><li><a href="https://www.51cto.com/article/791842.html" target="_blank" rel="noopener">ç›˜ç‚¹ 11 ç§å»¶è¿Ÿä»»åŠ¡å®ç°æ–¹å¼</a></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>Java</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title>Java æšä¸¾å®ç°å•ä¾‹æ¨¡å¼è¯¦è§£</title>
    <url>/post/1425b3d7.html</url>
    <content><![CDATA[<blockquote><p>å¼•è¨€ä»‹ç»ï¼šåœ¨æ‰€æœ‰å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼ä¸­ï¼Œæšä¸¾å•ä¾‹è¢«è®¤ä¸ºæ˜¯åŠŸèƒ½æœ€å®Œå–„ã€ä½¿ç”¨æœ€ç®€æ´ã€å®‰å…¨æ€§æœ€é«˜çš„å®ç°æ–¹å¼ã€‚æœ¬æ–‡å°†è¯¦ç»†æ¢è®¨ä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤å¤‡å—æ¨å´‡ã€‚</p></blockquote><a id="more"></a><h2 id="ğŸ“˜-ä¸€ã€ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ğŸ“˜-ä¸€ã€ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ğŸ“˜ ä¸€ã€ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ğŸ“˜ ä¸€ã€ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äº<strong>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¿™ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚</p><p>åœ¨ Java ä¸­ï¼Œå¸¸è§çš„å•ä¾‹å®ç°æ–¹å¼åŒ…æ‹¬ï¼š</p><ul><li>é¥¿æ±‰å¼</li><li>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨åŒé‡æ£€æŸ¥é”ï¼‰</li><li>é™æ€å†…éƒ¨ç±»</li><li><strong>æšä¸¾å®ç°å•ä¾‹ï¼ˆæ¨èï¼‰</strong></li></ul><hr><h2 id="ğŸ§­-äºŒã€ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨æšä¸¾å®ç°å•ä¾‹"><a href="#ğŸ§­-äºŒã€ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨æšä¸¾å®ç°å•ä¾‹" class="headerlink" title="ğŸ§­ äºŒã€ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨æšä¸¾å®ç°å•ä¾‹"></a>ğŸ§­ äºŒã€ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨æšä¸¾å®ç°å•ä¾‹</h2><p>ä» JDK 1.5 å¼€å§‹ï¼ŒJava å¼•å…¥äº† <code>enum</code> å…³é”®å­—ã€‚é€šè¿‡æšä¸¾å®ç°å•ä¾‹æ˜¯ <strong>æœ€ç®€æ´ã€å®‰å…¨ã€ä¼˜é›…</strong> çš„æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯ã€ŠEffective Javaã€‹ä½œè€… Josh Bloch æåŠ›æ¨èçš„æ–¹å¼ã€‚</p><h3 id="âœ…-ä¼˜ç‚¹ï¼š"><a href="#âœ…-ä¼˜ç‚¹ï¼š" class="headerlink" title="âœ… ä¼˜ç‚¹ï¼š"></a>âœ… ä¼˜ç‚¹ï¼š</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>JVM åœ¨ç±»åŠ è½½æ—¶å°±å®Œæˆæšä¸¾å®ä¾‹çš„åˆå§‹åŒ–ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</td></tr><tr><td><strong>é˜²åå°„æ”»å‡»</strong></td><td>åå°„æœºåˆ¶æ˜ç¡®ç¦æ­¢é€šè¿‡åå°„åˆ›å»ºæšä¸¾å®ä¾‹ã€‚</td></tr><tr><td><strong>é˜²ååºåˆ—åŒ–æ”»å‡»</strong></td><td>Java çš„åºåˆ—åŒ–æœºåˆ¶åœ¨å¤„ç†æšä¸¾æ—¶ï¼Œä¼šè¿”å›ç°æœ‰çš„æšä¸¾å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å¯¹è±¡ã€‚</td></tr><tr><td><strong>ä»£ç ç®€æ´</strong></td><td>å®ç°éå¸¸ç®€å•ï¼Œä»£ç å¯è¯»æ€§é«˜ã€‚</td></tr></tbody></table><hr><h2 id="ğŸ’¡-ä¸‰ã€æ ‡å‡†æšä¸¾å•ä¾‹å†™æ³•"><a href="#ğŸ’¡-ä¸‰ã€æ ‡å‡†æšä¸¾å•ä¾‹å†™æ³•" class="headerlink" title="ğŸ’¡ ä¸‰ã€æ ‡å‡†æšä¸¾å•ä¾‹å†™æ³•"></a>ğŸ’¡ ä¸‰ã€æ ‡å‡†æšä¸¾å•ä¾‹å†™æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line">    INSTANCE; <span class="comment">// å”¯ä¸€çš„æšä¸¾å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¤ºä¾‹å­—æ®µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¤ºä¾‹æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        counter++;</span><br><span class="line">        System.out.println(<span class="string">"æ‰§è¡Œæ“ä½œï¼Œå½“å‰æ¬¡æ•°ï¼š"</span> + counter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCounter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸ¤”-å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#ğŸ¤”-å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="ğŸ¤” å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>ğŸ¤” å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3><p>ç›´æ¥é€šè¿‡æšä¸¾åå’Œå®ä¾‹åå³å¯è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Singleton singleton = Singleton.INSTANCE;</span><br><span class="line">        singleton.doSomething(); <span class="comment">// è¾“å‡ºï¼šæ‰§è¡Œæ“ä½œï¼Œå½“å‰æ¬¡æ•°ï¼š1</span></span><br><span class="line"></span><br><span class="line">        Singleton anotherSingleton = Singleton.INSTANCE;</span><br><span class="line">        anotherSingleton.doSomething(); <span class="comment">// è¾“å‡ºï¼šæ‰§è¡Œæ“ä½œï¼Œå½“å‰æ¬¡æ•°ï¼š2</span></span><br><span class="line"></span><br><span class="line">        System.out.println(singleton == anotherSingleton); <span class="comment">// è¾“å‡ºï¼štrue</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ”-å››ã€ä¸ºä»€ä¹ˆå®ƒèƒ½é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ”»å‡»ï¼Ÿ"><a href="#ğŸ”-å››ã€ä¸ºä»€ä¹ˆå®ƒèƒ½é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ”»å‡»ï¼Ÿ" class="headerlink" title="ğŸ” å››ã€ä¸ºä»€ä¹ˆå®ƒèƒ½é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ”»å‡»ï¼Ÿ"></a>ğŸ” å››ã€ä¸ºä»€ä¹ˆå®ƒèƒ½é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ”»å‡»ï¼Ÿ</h2><h3 id="1-é˜²æ­¢åå°„æ”»å‡»"><a href="#1-é˜²æ­¢åå°„æ”»å‡»" class="headerlink" title="1. é˜²æ­¢åå°„æ”»å‡»"></a>1. é˜²æ­¢åå°„æ”»å‡»</h3><p>Java çš„åå°„æœºåˆ¶æä¾›äº†ä¸€ç§åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›ã€‚å¯¹äºä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ <code>Constructor.setAccessible(true)</code> æ¥è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°ï¼Œä»è€Œåˆ›å»ºæ–°çš„å®ä¾‹ï¼Œç ´åå•ä¾‹ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºæšä¸¾ç±»å‹ï¼Œ<code>java.lang.reflect.Constructor</code> çš„æºç å®ç°ä¸­æ˜ç¡®ç¦æ­¢äº†é€šè¿‡åå°„åˆ›å»ºæšä¸¾å®ä¾‹ã€‚å½“å°è¯•è¿™æ ·åšæ—¶ï¼Œä¼šæŠ›å‡º <code>IllegalArgumentException</code> å¼‚å¸¸ï¼Œå¹¶æç¤º â€œCannot reflectively create enum objectsâ€ã€‚</p><h3 id="2-é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»"><a href="#2-é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»" class="headerlink" title="2. é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»"></a>2. é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»</h3><p>å½“ä¸€ä¸ªå®ç°äº† <code>Serializable</code> æ¥å£çš„å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼ŒJava ä¼šé€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚å¯¹äºä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼ï¼Œå¦‚æœä¸åšç‰¹æ®Šå¤„ç†ï¼ˆä¾‹å¦‚å®ç° <code>readResolve()</code> æ–¹æ³•ï¼‰ï¼Œååºåˆ—åŒ–å°±ä¼šç ´åå•ä¾‹ã€‚</p><p>è€Œ Java çš„åºåˆ—åŒ–æœºåˆ¶å¯¹æšä¸¾ç±»å‹åšäº†ç‰¹æ®Šå¤„ç†ã€‚åœ¨ååºåˆ—åŒ–æšä¸¾æ—¶ï¼Œ<code>ObjectInputStream</code> ä¼šè°ƒç”¨ <code>Enum.valueOf()</code> æ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®æšä¸¾çš„åç§°è¿”å›å·²å­˜åœ¨çš„æšä¸¾å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚è¿™ä»æ ¹æœ¬ä¸Šæœç»äº†ååºåˆ—åŒ–æ”»å‡»ã€‚</p><hr><h2 id="ğŸ”„-äº”ã€ä¸å…¶ä»–å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”"><a href="#ğŸ”„-äº”ã€ä¸å…¶ä»–å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”" class="headerlink" title="ğŸ”„ äº”ã€ä¸å…¶ä»–å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”"></a>ğŸ”„ äº”ã€ä¸å…¶ä»–å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”</h2><table><thead><tr><th align="left">å®ç°æ–¹å¼</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th></tr></thead><tbody><tr><td align="left"><strong>æšä¸¾å•ä¾‹</strong></td><td align="left"><strong>å®ç°ç®€å•ã€çº¿ç¨‹å®‰å…¨ã€å¤©ç„¶é˜²åå°„å’Œååºåˆ—åŒ–æ”»å‡»</strong></td><td align="left"><strong>éæ‡’åŠ è½½</strong></td></tr><tr><td align="left">é¥¿æ±‰å¼</td><td align="left">å®ç°ç®€å•ã€çº¿ç¨‹å®‰å…¨</td><td align="left">éæ‡’åŠ è½½ã€å¯èƒ½é€ æˆèµ„æºæµªè´¹</td></tr><tr><td align="left">æ‡’æ±‰å¼ï¼ˆDCLï¼‰</td><td align="left">æ‡’åŠ è½½ã€æ€§èƒ½è¾ƒé«˜</td><td align="left">å®ç°å¤æ‚ã€å¯è¢«åå°„æ”»å‡»</td></tr><tr><td align="left">é™æ€å†…éƒ¨ç±»</td><td align="left">æ‡’åŠ è½½ã€çº¿ç¨‹å®‰å…¨ã€å®ç°ç®€å•</td><td align="left">å¯è¢«åå°„æ”»å‡»</td></tr></tbody></table><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æšä¸¾å•ä¾‹æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³é€‰æ‹©ã€‚å®ƒä¸ä»…ä»£ç ç®€æ´ï¼Œè€Œä¸”ä»æ ¹æœ¬ä¸Šè§£å†³äº†çº¿ç¨‹å®‰å…¨ã€åå°„æ”»å‡»å’Œååºåˆ—åŒ–æ”»å‡»ç­‰é—®é¢˜ã€‚é™¤éæœ‰æ˜ç¡®çš„æ‡’åŠ è½½éœ€æ±‚ï¼Œå¦åˆ™åœ¨ä»»ä½•éœ€è¦å•ä¾‹çš„åœºæ™¯ä¸‹ï¼Œéƒ½åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æšä¸¾ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Springäº‹åŠ¡å›æ»šå°å¦™æ‹›</title>
    <url>/post/3d2f3823.html</url>
    <content><![CDATA[<blockquote><p>springäº‹åŠ¡æ§åˆ¶æ‰‹åŠ¨å›æ»š ~</p></blockquote><a id="more"></a><h3 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h3><ul><li>äº‹åŠ¡æ˜¯æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ï¼Œä¸ºäº†åœ¨ä¸šåŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼Œå›æ»šåˆ°åŸå§‹çŠ¶æ€ã€‚è€Œäº‹åŠ¡çš„å›æ»šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯é ç€ <strong>exception</strong>ï¼ˆå¼‚å¸¸ï¼‰æ¥è§¦å‘å›æ»šçš„ï¼Œå½“äº‹åŠ¡æœºåˆ¶æ•æ‰åˆ°å¼‚å¸¸ï¼Œå°±ä¼šå¼€å§‹å›æ»šã€‚</li><li>ä½†å¾€å¾€ä¹Ÿä¼šå‡ºç°<strong>æƒ…å†µ</strong>ï¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œéœ€è¦å¯¹å¼‚å¸¸å•ç‹¬è¿›è¡Œå¤„ç†ï¼Œå¼‚å¸¸ä¸ä¼šæŠ›å‡ºï¼Œä½†éœ€è¦äº‹åŠ¡å›æ»šçš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ‰‹åŠ¨è°ƒç”¨å›æ»š</li></ul><h3 id="2ã€-Transactional"><a href="#2ã€-Transactional" class="headerlink" title="2ã€@Transactional"></a>2ã€@Transactional</h3><p>@Transactional å£°æ˜å¼äº‹åŠ¡ï¼Œæ˜¯å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„å¼€å¯äº‹åŠ¡çš„æ–¹å¼ã€‚</p><p><strong>ä¼˜ç‚¹æ˜¯ï¼šä½¿ç”¨æ–¹ä¾¿ï¼Œè€Œä¸”å¯¹ä»£ç çš„ä¾µå…¥æ€§ä½</strong></p><ul><li>è¿™ç§æ–¹å¼ï¼Œé»˜è®¤æ˜¯é€šè¿‡ æ•è· <strong><code>RunTimeException</code></strong> æ¥è§¦å‘äº‹åŠ¡å›æ»šï¼Œåªè¦æ˜¯ <code>RuntimeException</code> ä»¥åŠ å®ƒçš„å­ç±»ï¼Œéƒ½å¯ä»¥è§¦å‘äº‹åŠ¡å›æ»šã€‚</li><li>ä¹Ÿå¯ä»¥ä¿®æ”¹ è§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸èŒƒå›´ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ @Transactional ä¸­çš„ <code>rollbackFor</code> å±æ€§ï¼Œä¿®æ”¹å¼‚å¸¸èŒƒå›´ã€‚æ¯”å¦‚ï¼š<br><code>@Transactional(rollbackFor = Exception.class)</code>ï¼Œä¿®æ”¹å®Œæˆåï¼Œåªè¦æ˜¯ Exception ç±»çš„å­ç±»ï¼Œéƒ½å¯ä»¥è§¦å‘äº‹åŠ¡å›æ»š</li></ul><p>å½“ç„¶ä¹Ÿä¼šæœ‰<strong>äº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ</strong>ï¼Œå¯ä»¥è¯¦ç»†å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« <a href="https://www.cnblogs.com/xiangningdeguang/p/16955161.html" target="_blank" rel="noopener">@Transactionalæ³¨è§£äº‹åŠ¡å¤±æ•ˆçš„å‡ ç§åœºæ™¯åŠåŸå› </a></p><h3 id="3ã€-Transactionalä¸é€‚ç”¨åœºæ™¯"><a href="#3ã€-Transactionalä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="3ã€@Transactionalä¸é€‚ç”¨åœºæ™¯"></a>3ã€@Transactionalä¸é€‚ç”¨åœºæ™¯</h3><p>å½“åœ¨ä¸šåŠ¡ä¸­ï¼Œéœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œç‰¹æ®Šå¤„ç†çš„æ—¶å€™ï¼Œå¼‚å¸¸æ— æ³•æŠ›å‡ºæ—¶ï¼Œå£°æ˜å¼äº‹åŠ¡å°±ä¸å¤ªé€‚ç”¨äº†ã€‚<br><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‡è®¾è¿™æ˜¯ä¸€ä¸ªserviceç±»çš„ç‰‡æ®µ</span></span><br><span class="line"><span class="keyword">try</span>&#123; </span><br><span class="line">    <span class="comment">//å‡ºç°å¼‚å¸¸</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// æ•è·å¼‚å¸¸ï¼Œæ‰“å°å¼‚å¸¸ï¼Œæˆ–å…¶ä»–å¤„ç†ã€‚ä½†ä¸æŠ›å‡ºæ–°çš„å¼‚å¸¸</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ­¤æ—¶returnè¯­å¥èƒ½å¤Ÿæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">return</span>  xxx;</span><br></pre></td></tr></table></figure><p>å½“ä¸æŠ›å‡ºæ–°å¼‚å¸¸æ—¶ï¼Œå°±æ— æ³•è§¦å‘ äº‹åŠ¡å›æ»šã€‚</p><p><strong>æ­¤å¤„ï¼Œä¹Ÿå¯ä»¥å°†æ•è·åçš„å¼‚å¸¸ï¼Œå°è£…ä¸ºæ–°çš„ä¸šåŠ¡å¼‚å¸¸æŠ›å‡º</strong></p><h3 id="4ã€springäº‹åŠ¡æ§åˆ¶æ‰‹åŠ¨å›æ»š"><a href="#4ã€springäº‹åŠ¡æ§åˆ¶æ‰‹åŠ¨å›æ»š" class="headerlink" title="4ã€springäº‹åŠ¡æ§åˆ¶æ‰‹åŠ¨å›æ»š"></a>4ã€springäº‹åŠ¡æ§åˆ¶æ‰‹åŠ¨å›æ»š</h3><p>å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ spring äº‹åŠ¡æ§åˆ¶çš„æ‰‹åŠ¨å›æ»šï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è°ƒç”¨å›æ»šè¯­å¥<br><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‡è®¾è¿™æ˜¯ä¸€ä¸ªserviceç±»çš„ç‰‡æ®µ</span></span><br><span class="line"><span class="keyword">try</span>&#123; </span><br><span class="line">    <span class="comment">//å‡ºç°å¼‚å¸¸</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// æ•è·å¼‚å¸¸ï¼Œæ‰“å°å¼‚å¸¸ï¼Œæˆ–å…¶ä»–å¤„ç†ã€‚ä½†ä¸æŠ›å‡ºæ–°çš„å¼‚å¸¸</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨å›æ»š</span></span><br><span class="line">    TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ­¤æ—¶returnè¯­å¥èƒ½å¤Ÿæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">return</span>  xxx;</span><br></pre></td></tr></table></figure><h3 id="5ã€springç¼–ç¨‹å¼äº‹åŠ¡"><a href="#5ã€springç¼–ç¨‹å¼äº‹åŠ¡" class="headerlink" title="5ã€springç¼–ç¨‹å¼äº‹åŠ¡"></a>5ã€springç¼–ç¨‹å¼äº‹åŠ¡</h3><p><code>TransactionTemplate</code> æ˜¯ Spring æä¾›çš„ <strong>ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å·¥å…·</strong>ï¼Œé€šè¿‡ä»£ç æ˜¾å¼æ§åˆ¶äº‹åŠ¡çš„å¼€å¯ã€æäº¤å’Œå›æ»šï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€æˆ–å¤æ‚äº‹åŠ¡é€»è¾‘çš„åœºæ™¯ã€‚</p><h4 id="ï¼ˆ1ï¼‰æ”¯æŒè¿”å›å€¼"><a href="#ï¼ˆ1ï¼‰æ”¯æŒè¿”å›å€¼" class="headerlink" title="ï¼ˆ1ï¼‰æ”¯æŒè¿”å›å€¼"></a>ï¼ˆ1ï¼‰æ”¯æŒè¿”å›å€¼</h4><p><strong><code>execute(TransactionCallback&lt;T&gt; action)</code></strong></p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šæ‰§è¡ŒåŒ…å«äº‹åŠ¡çš„ä»£ç å—ï¼Œæ”¯æŒè¿”å›å€¼ã€‚</p></li><li><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">User user = transactionTemplate.execute(status -&gt; &#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">     </span><br><span class="line">        User newUser = userDao.save(user); <span class="comment">// äº‹åŠ¡æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> newUser;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (DataAccessException e) &#123;</span><br><span class="line">        status.setRollbackOnly(); <span class="comment">// æ ‡è®°å›æ»š</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(<span class="string">"ä¿å­˜ç”¨æˆ·å¤±è´¥"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="ï¼ˆ2ï¼‰æ”¯æŒæ— è¿”å›å€¼"><a href="#ï¼ˆ2ï¼‰æ”¯æŒæ— è¿”å›å€¼" class="headerlink" title="ï¼ˆ2ï¼‰æ”¯æŒæ— è¿”å›å€¼"></a>ï¼ˆ2ï¼‰æ”¯æŒæ— è¿”å›å€¼</h4><p><strong><code>executeWithoutResult(Consumer&lt;TransactionStatus&gt; action)</code></strong></p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šæ‰§è¡Œæ— è¿”å›å€¼çš„äº‹åŠ¡æ“ä½œã€‚</p></li><li><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">transactionTemplate.executeWithoutResult(status -&gt; &#123;</span><br><span class="line">    userDao.updateBalance(userId, amount); <span class="comment">// æ‰£å‡ä½™é¢</span></span><br><span class="line">    orderDao.createOrder(order);           <span class="comment">// åˆ›å»ºè®¢å•</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>æ„å»ºè®¤çŸ¥æ³•åˆ™</title>
    <url>/post/b91c2b7f.html</url>
    <content><![CDATA[<blockquote><p>æ„å»ºè®¤çŸ¥ ~</p></blockquote><a id="more"></a><h3 id="é˜¿é‡Œå››çœ‹"><a href="#é˜¿é‡Œå››çœ‹" class="headerlink" title="é˜¿é‡Œå››çœ‹"></a>é˜¿é‡Œå››çœ‹</h3><ul><li><p><strong>çœ‹è¡Œä¸šä¸æ”¿ç­–</strong>ï¼šè¿™ä¸€éƒ¨åˆ†çš„æ ¸å¿ƒæ˜¯äº†è§£æˆ‘ä»¬æ‰€å¤„çš„è¡Œä¸šç°çŠ¶ä»¥åŠæœªæ¥çš„æ”¿ç­–è¶‹åŠ¿ã€‚è¡Œä¸šå’Œæ”¿ç­–çš„å˜åŒ–ä¼šç›´æ¥å½±å“å¸‚åœºæ ¼å±€å’Œä¸šåŠ¡æ–¹å‘ã€‚<em>ä¾‹å¦‚ï¼šè¡Œä¸šç›®å‰å¤„äºä»€ä¹ˆé˜¶æ®µï¼Ÿæ˜¯å¿«é€Ÿå¢é•¿æœŸã€æˆç†ŸæœŸè¿˜æ˜¯è¡°é€€æœŸï¼Ÿæ”¿åºœæˆ–ç›‘ç®¡æœºæ„å¯¹è¡Œä¸šæœ‰å“ªäº›æ”¿ç­–ï¼Ÿè¿™äº›æ”¿ç­–æ˜¯åˆ©å¥½è¿˜æ˜¯åˆ©ç©ºï¼Ÿè¡Œä¸šæœ‰å“ªäº›æ–°æŠ€æœ¯æ­£åœ¨å…´èµ·ï¼Ÿè¿™äº›æŠ€æœ¯ä¼šå¸¦æ¥å“ªäº›å˜é©ï¼Ÿ</em></p></li><li><p><strong>çœ‹å¸‚åœºä¸å®¢æˆ·</strong>ï¼šè¿™ä¸€éƒ¨åˆ†çš„æ ¸å¿ƒæ˜¯äº†è§£å¸‚åœºéœ€æ±‚å’Œå®¢æˆ·è¡Œä¸ºã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“å¸‚åœºä¸Šæœ‰å“ªäº›æœºä¼šï¼Œå®¢æˆ·çš„éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä»–ä»¬çš„ç—›ç‚¹åœ¨å“ªé‡Œã€‚<em>ä¾‹å¦‚ï¼šå¸‚åœºæœ‰å¤šå¤§ï¼Ÿå¢é•¿ç©ºé—´å¦‚ä½•ï¼Ÿå®¢æˆ·çš„æ ¸å¿ƒéœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿä»–ä»¬çš„ç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®¢æˆ·çš„ä½¿ç”¨ä¹ æƒ¯æ˜¯ä»€ä¹ˆï¼Ÿä»–ä»¬çš„å†³ç­–æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</em></p></li><li><p><strong>çœ‹è‡ªå·±</strong>ï¼šè¿™ä¸€éƒ¨åˆ†çš„æ ¸å¿ƒæ˜¯è¯„ä¼°è‡ªå·±çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚æˆ‘ä»¬éœ€è¦æ¸…æ¥šåœ°çŸ¥é“è‡ªå·±çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæœ‰å“ªäº›åœ°æ–¹éœ€è¦æ”¹è¿›ã€‚<em>ä¾‹å¦‚ï¼šæˆ‘ä»¬çš„äº§å“ã€å›¢é˜Ÿã€èµ„æºæœ‰å“ªäº›ä¼˜åŠ¿ã€åŠ£åŠ¿ï¼Ÿæˆ‘ä»¬æœ‰å“ªäº›èµ„æºå¯ä»¥è°ƒåŠ¨ï¼Ÿ</em></p></li><li><p><strong>çœ‹å‹å•†</strong>ï¼šè¿™ä¸€éƒ¨åˆ†çš„æ ¸å¿ƒæ˜¯ç ”ç©¶ç«äº‰å¯¹æ‰‹çš„ç­–ç•¥å’ŒåŠ¨æ€ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“ç«äº‰å¯¹æ‰‹åœ¨åšä»€ä¹ˆï¼Œä»–ä»¬çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä»–ä»¬çš„ç­–ç•¥å¯¹æˆ‘ä»¬çš„ä¸šåŠ¡æœ‰ä»€ä¹ˆå½±å“ã€‚<em>ä¾‹å¦‚ï¼šæˆ‘ä»¬çš„ç›´æ¥ç«äº‰å¯¹æ‰‹å’Œé—´æ¥ç«äº‰å¯¹æ‰‹æœ‰å“ªäº›ï¼Ÿä»–ä»¬çš„äº§å“ç­–ç•¥ã€å¸‚åœºç­–ç•¥ã€è¿è¥ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ</em></p></li></ul><h3 id="SWOTåˆ†ææ³•"><a href="#SWOTåˆ†ææ³•" class="headerlink" title="SWOTåˆ†ææ³•"></a>SWOTåˆ†ææ³•</h3><ul><li><strong>ä¼˜åŠ¿ï¼ˆStrengthsï¼‰</strong>ï¼šä¼˜åŠ¿æ˜¯æŒ‡æˆ‘ä»¬å†…éƒ¨çš„å¼ºé¡¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¯”ç«äº‰å¯¹æ‰‹åšå¾—æ›´å¥½çš„åœ°æ–¹ã€‚è¿™äº›ä¼˜åŠ¿å¯èƒ½æ˜¯èµ„æºã€èƒ½åŠ›ã€æŠ€æœ¯ã€å“ç‰Œã€å›¢é˜Ÿç­‰ã€‚</li><li><strong>åŠ£åŠ¿ï¼ˆWeaknessesï¼‰</strong>ï¼šåŠ£åŠ¿æ˜¯æŒ‡æˆ‘ä»¬å†…éƒ¨çš„ä¸è¶³ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¯”ç«äº‰å¯¹æ‰‹åšå¾—å·®çš„åœ°æ–¹ã€‚è¿™äº›åŠ£åŠ¿å¯èƒ½æ˜¯èµ„æºä¸è¶³ã€æŠ€æœ¯çŸ­æ¿ã€å›¢é˜Ÿèƒ½åŠ›æœ‰é™ç­‰ã€‚</li><li><strong>æœºä¼šï¼ˆOpportunitiesï¼‰</strong>ï¼šæœºä¼šæ˜¯æŒ‡å¤–éƒ¨çš„æœ‰åˆ©æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯å¸‚åœºä¸Šæˆ‘ä»¬å¯ä»¥æŠ“ä½çš„æœºä¼šã€‚è¿™äº›æœºä¼šå¯èƒ½æ˜¯å¸‚åœºè¶‹åŠ¿ã€æ”¿ç­–å˜åŒ–ã€æŠ€æœ¯é©æ–°ç­‰ã€‚</li><li><strong>å¨èƒï¼ˆThreatsï¼‰</strong>ï¼šå¨èƒæ˜¯æŒ‡å¤–éƒ¨çš„ä¸åˆ©æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯å¸‚åœºä¸Šå¯èƒ½å¯¹æˆ‘ä»¬é€ æˆå¨èƒçš„å› ç´ ã€‚è¿™äº›å¨èƒå¯èƒ½æ˜¯ç«äº‰å¯¹æ‰‹ã€æ”¿ç­–å˜åŒ–ã€å¸‚åœºé¥±å’Œç­‰ã€‚</li></ul><p>â€‹ é€šè¿‡ç»„åˆåˆ†æï¼ˆæ¯”å¦‚â€œæœºä¼š+ä¼˜åŠ¿â€æˆ–â€œå¨èƒ+åŠ£åŠ¿â€ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶å®šæ›´æœ‰é’ˆå¯¹æ€§çš„ç­–ç•¥ã€‚ä¸šåŠ¡çŸ¥è¯†æ˜¯äº§å“ç»ç†çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ã€‚åªæœ‰å¯¹è¡Œä¸šã€å¸‚åœºã€ç«äº‰å¯¹æ‰‹ã€ç”¨æˆ·æœ‰æ·±åˆ»çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬æ‰èƒ½åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ï¼Œè®¾è®¡å‡ºç¬¦åˆå¸‚åœºéœ€æ±‚çš„äº§å“ã€‚</p><h3 id="5WHYåˆ†ææ³•"><a href="#5WHYåˆ†ææ³•" class="headerlink" title="5WHYåˆ†ææ³•"></a>5WHYåˆ†ææ³•</h3><p><a href="https://blog.csdn.net/it_cgq/article/details/121042730" target="_blank" rel="noopener">ã€Š5WHYåˆ†ææ³•ã€‹</a></p><ul><li><p>ç¬¬ä¸€æ­¥ï¼šå‘ç°é—®é¢˜å¹¶åˆæ­¥æè¿°<br>åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œè¦é¦–å…ˆæ¸…æ™°åœ°äº†è§£æ‰€å‡ºç°çš„é—®é¢˜æˆ–æ•…éšœçš„è¯¦ç»†æƒ…å†µã€‚è¦æ±‚å…³æ³¨æ¯ä¸ªç»†èŠ‚å’Œé‡è¦ç‚¹ï¼Œäº†è§£é—®é¢˜å‘ç”Ÿçš„èƒŒæ™¯å’Œå½±å“èŒƒå›´ã€‚åªæœ‰å……åˆ†äº†è§£é—®é¢˜çš„å…·ä½“æƒ…å†µï¼Œæ‰èƒ½ä¸ºåç»­çš„æ·±å…¥åˆ†ææ‰“ä¸‹åŸºç¡€ã€‚</p></li><li><p>ç¬¬äºŒæ­¥ï¼šæå‡ºç¬¬ä¸€ä¸ªâ€œä¸ºä»€ä¹ˆâ€<br>åœ¨äº†è§£äº†é—®é¢˜çš„å¤§è‡´æƒ…å†µåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¯¹é—®é¢˜æå‡ºç¬¬ä¸€ä¸ªâ€œä¸ºä»€ä¹ˆâ€ã€‚ä¸»è¦é’ˆå¯¹é—®é¢˜äº§ç”Ÿçš„åŸå› æˆ–ç›¸å…³ç°è±¡è¿›è¡Œæ¢ç©¶ã€‚è¦æŒ–æ˜é—®é¢˜äº§ç”Ÿçš„èƒŒåé€»è¾‘ï¼Œå°½å¯èƒ½æ‰¾åˆ°å¯èƒ½å¯¼è‡´é—®é¢˜çš„å…³é”®å› ç´ ã€‚</p></li><li><p>ç¬¬ä¸‰æ­¥ï¼šå¯»æ‰¾å’Œç¡®å®šé—®é¢˜çš„ç›´æ¥åŸå› <br>åœ¨å¯¹é—®é¢˜è¿›è¡Œäº†ç¬¬ä¸€ä¸ªâ€œä¸ºä»€ä¹ˆâ€çš„æé—®åï¼Œæ¥ä¸‹æ¥å°±è¦æ ¹æ®å¾—åˆ°çš„ä¿¡æ¯å¯»æ‰¾é—®é¢˜çš„ç›´æ¥åŸå› ã€‚è¿™é‡Œå¯èƒ½éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æµ‹è¯•ã€æ•°æ®åˆ†æå’Œå®åœ°è°ƒæŸ¥ç­‰æ‰‹æ®µæ¥æ‰¾åˆ°æœ€å¯èƒ½çš„åŸå› ã€‚å¯¹äºè¿™ä¸€æ­¥çš„åˆ¤æ–­åº”å½“éå¸¸è°¨æ…ï¼Œè¦å°½å¯èƒ½é¿å…è‰ç‡å¾—å‡ºç»“è®ºã€‚</p></li><li><p>ç¬¬å››æ­¥ï¼šé’ˆå¯¹ç›´æ¥åŸå› è¿›ä¸€æ­¥è¯¢é—®â€œä¸ºä»€ä¹ˆâ€<br>å½“æˆ‘ä»¬æ‰¾åˆ°é—®é¢˜çš„ç›´æ¥åŸå› åï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤ä¾¿æ˜¯é€šè¿‡é—®è‡ªå·±æˆ–è€…ç›¸å…³å›¢é˜Ÿè¿›ä¸€æ­¥çš„â€œä¸ºä»€ä¹ˆâ€æ¥äº†è§£é€ æˆç›´æ¥åŸå› çš„æ›´æ·±å±‚æ¬¡åŸå› ã€‚è¿™ä¸€æ­¥çš„å…³é”®åœ¨äºæ·±å…¥æŒ–æ˜ï¼Œå¯»æ‰¾æ›´æ·±å±‚æ¬¡çš„é€»è¾‘å…³ç³»å’Œå› æœå…³ç³»ã€‚</p></li><li><p>ç¬¬äº”æ­¥ï¼šåˆ†æå¹¶è§£å†³é—®é¢˜<br>åœ¨ç»è¿‡å¤šå±‚æ¬¡çš„â€œä¸ºä»€ä¹ˆâ€æé—®å’Œæ¢å¯»åï¼Œæˆ‘ä»¬éœ€è¦æ€»ç»“æ‰€è·å¾—çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»æ ¹æºä¸Šåˆ†æé—®é¢˜çš„çœŸæ­£åŸå› ï¼Œç„¶åå¯»æ‰¾è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å‰å‡ æ­¥æ”¶é›†çš„ä¿¡æ¯å’Œå·²ç»å‘ç°çš„æ½œåœ¨è§„å¾‹è¿›è¡Œæ€»ç»“å’Œåˆ†æï¼Œå¾—å‡ºæœ€ç»ˆè§£å†³é—®é¢˜çš„ç­–ç•¥ã€‚</p></li><li><p>ç¬¬å…­æ­¥ï¼šé¢„é˜²å’Œæªæ–½çš„åˆ¶å®š<br>æœ€åä¸€æ­¥å¹¶ä¸æ­¢æ­¥äºé—®é¢˜çš„è§£å†³ï¼Œè€Œæ˜¯è¦è¿›ä¸€æ­¥æ€è€ƒå¦‚ä½•é¢„é˜²ç±»ä¼¼é—®é¢˜çš„å†æ¬¡å‘ç”Ÿã€‚è¿™éœ€è¦æˆ‘ä»¬æ ¹æ®è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­æ‰€ç§¯ç´¯çš„ç»éªŒå’Œæ•™è®­ï¼Œåˆ¶å®šå‡ºç›¸åº”çš„é¢„é˜²æªæ–½å’Œæ”¹è¿›æ–¹æ¡ˆï¼Œä»¥é¿å…åŒæ ·çš„é—®é¢˜å†æ¬¡å‡ºç°ã€‚åŒæ—¶ä¹Ÿè¦è¿›è¡Œå¿…è¦çš„è·Ÿè¸ªå’Œç›‘æ§ï¼Œç¡®ä¿æ–°çš„é¢„é˜²æªæ–½æœ‰æ•ˆæ‰§è¡Œã€‚</p></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è®¤çŸ¥æ³•åˆ™</category>
      </categories>
      <tags>
        <tag>è®¤çŸ¥æ³•åˆ™</tag>
      </tags>
  </entry>
  <entry>
    <title>MQç»å…¸ä½¿ç”¨åœºæ™¯</title>
    <url>/post/c6dafc2a.html</url>
    <content><![CDATA[<blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€æœ¯ ~</p></blockquote><a id="more"></a><h3 id="1-å¼‚æ­¥å¤„ç†ï¼šè®©ç³»ç»Ÿè½»æ¾ä¸€ç‚¹"><a href="#1-å¼‚æ­¥å¤„ç†ï¼šè®©ç³»ç»Ÿè½»æ¾ä¸€ç‚¹" class="headerlink" title="1.å¼‚æ­¥å¤„ç†ï¼šè®©ç³»ç»Ÿè½»æ¾ä¸€ç‚¹"></a>1.å¼‚æ­¥å¤„ç†ï¼šè®©ç³»ç»Ÿè½»æ¾ä¸€ç‚¹</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>å°ä¼™ä¼´ä»¬æ˜¯ä¸æ˜¯ç»å¸¸é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šç”¨æˆ·æäº¤ä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚ä¸‹å•ï¼Œç„¶åè¦å‘é€çŸ­ä¿¡é€šçŸ¥ã€‚</p><p>å¦‚æœç›´æ¥åœ¨ä¸»æµç¨‹é‡Œè°ƒç”¨çŸ­ä¿¡æ¥å£ï¼Œä¸€æ—¦çŸ­ä¿¡æœåŠ¡å“åº”æ…¢ï¼Œå°±ä¼šæ‹–ç´¯æ•´ä¸ªæ“ä½œã€‚</p><p>ç”¨æˆ·ç­‰å¾—ä¸è€çƒ¦ï¼Œå¿ƒæ€ç›´æ¥å´©äº†ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ç”¨MQï¼ŒæŠŠéå…³é”®æµç¨‹æŠ½å‡ºæ¥å¼‚æ­¥å¤„ç†ã€‚ä¸‹å•æ—¶ï¼Œç›´æ¥æŠŠâ€œå‘çŸ­ä¿¡â€è¿™ä»¶äº‹ä¸¢ç»™MQï¼Œè®¢å•æœåŠ¡å°±èƒ½ç«‹åˆ»å“åº”ç”¨æˆ·ï¼Œè€ŒçŸ­ä¿¡çš„äº‹æƒ…è®©MQå’Œæ¶ˆè´¹è€…å»æå®šã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Â è®¢å•æœåŠ¡ï¼šç”Ÿäº§è€…</span></span><br><span class="line">OrderÂ orderÂ =Â createOrder();Â <span class="comment">//Â è®¢å•ç”Ÿæˆé€»è¾‘</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"order_exchange"</span>,Â <span class="string">"order_key"</span>,Â order);</span><br><span class="line">System.out.println(<span class="string">"è®¢å•å·²ç”Ÿæˆï¼Œå‘çŸ­ä¿¡ä»»åŠ¡äº¤ç»™MQ"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â çŸ­ä¿¡æœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queuesÂ =Â <span class="string">"sms_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span>Â <span class="keyword">void</span>Â <span class="title">sendSms</span><span class="params">(OrderÂ order)</span>Â </span>&#123;</span><br><span class="line">Â Â Â Â System.out.println(<span class="string">"å‘é€çŸ­ä¿¡ï¼Œè®¢å•IDï¼š"</span>Â +Â order.getId());</span><br><span class="line">Â Â Â Â <span class="comment">//Â è°ƒç”¨çŸ­ä¿¡æœåŠ¡æ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ"><a href="#æ·±åº¦è§£æ" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h4><p>è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š<strong>ä¸»æµç¨‹è§£è€¦ï¼Œä¸å—æ…¢æœåŠ¡çš„æ‹–ç´¯</strong>ã€‚è®¢å•æœåŠ¡åªç®¡è‡ªå·±çš„äº‹ï¼ŒçŸ­ä¿¡æœåŠ¡æŒ‚äº†ä¹Ÿæ²¡å…³ç³»ï¼ŒMQä¼šæŠŠæ¶ˆæ¯æš‚å­˜ï¼Œç­‰çŸ­ä¿¡æœåŠ¡æ¢å¤åç»§ç»­å¤„ç†ã€‚</p><h3 id="2-æµé‡å‰Šå³°ï¼šç¨³ä½ç³»ç»Ÿåˆ«å´©"><a href="#2-æµé‡å‰Šå³°ï¼šç¨³ä½ç³»ç»Ÿåˆ«å´©" class="headerlink" title="2.æµé‡å‰Šå³°ï¼šç¨³ä½ç³»ç»Ÿåˆ«å´©"></a>2.æµé‡å‰Šå³°ï¼šç¨³ä½ç³»ç»Ÿåˆ«å´©</h3><h4 id="åœºæ™¯-1"><a href="#åœºæ™¯-1" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>æ¯å¹´çš„â€œåŒåä¸€â€ç”µå•†å¤§ä¿ƒï¼Œç”¨æˆ·ç§’æ€å•†å“æ—¶ä¸€çªèœ‚å†²è¿›æ¥ã€‚</p><p>çªç„¶æ¶Œå…¥çš„é«˜å¹¶å‘è¯·æ±‚ï¼Œä¸ä»…ä¼šå‹å®åº”ç”¨æœåŠ¡ï¼Œè¿˜ä¼šç›´æ¥è®©æ•°æ®åº“â€œè¶´çªâ€ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ç§’æ€è¯·æ±‚å…ˆå†™å…¥MQï¼Œåç«¯æœåŠ¡ä»¥ç¨³å®šçš„é€Ÿåº¦ä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¤„ç†è®¢å•ã€‚</p><p>è¿™æ ·æ—¢èƒ½é¿å…ç³»ç»Ÿè¢«ç¬æ—¶æµé‡å‹å®ï¼Œè¿˜èƒ½æå‡å¤„ç†çš„å¹³ç¨³æ€§ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -1"><a href="#ç¤ºä¾‹ä»£ç -1" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”¨æˆ·æäº¤ç§’æ€è¯·æ±‚ï¼šç”Ÿäº§è€…</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"seckill_exchange"</span>, <span class="string">"seckill_key"</span>, userRequest);</span><br><span class="line">System.out.println(<span class="string">"ç”¨æˆ·ç§’æ€è¯·æ±‚å·²è¿›å…¥é˜Ÿåˆ—"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§’æ€æœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"seckill_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processSeckill</span><span class="params">(UserRequest request)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¤„ç†ç§’æ€è¯·æ±‚ï¼Œç”¨æˆ·IDï¼š"</span> + request.getUserId());</span><br><span class="line">    <span class="comment">// æ‰§è¡Œç§’æ€é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-1"><a href="#æ·±åº¦è§£æ-1" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h4><p>MQåœ¨è¿™é‡Œç›¸å½“äºä¸€ä¸ªç¼“å†²æ± ï¼ŒæŠŠç¬æ—¶æµé‡å‡åŒ€åˆ†å¸ƒåˆ°ä¸€æ®µæ—¶é—´å†…å¤„ç†ã€‚<strong>ç³»ç»Ÿç¨³å®šæ€§æå‡ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½</strong>ã€‚</p><h3 id="3-æœåŠ¡è§£è€¦ï¼šå‡å°‘ç›¸äº’ç‰µåˆ¶"><a href="#3-æœåŠ¡è§£è€¦ï¼šå‡å°‘ç›¸äº’ç‰µåˆ¶" class="headerlink" title="3.æœåŠ¡è§£è€¦ï¼šå‡å°‘ç›¸äº’ç‰µåˆ¶"></a>3.æœåŠ¡è§£è€¦ï¼šå‡å°‘ç›¸äº’ç‰µåˆ¶</h3><h4 id="åœºæ™¯-2"><a href="#åœºæ™¯-2" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>æ¯”å¦‚ä¸€ä¸ªè®¢å•ç³»ç»Ÿéœ€è¦é€šçŸ¥åº“å­˜ç³»ç»Ÿæ‰£å‡åº“å­˜ï¼Œè¿˜è¦é€šçŸ¥æ”¯ä»˜ç³»ç»Ÿå®Œæˆæ‰£æ¬¾ã€‚</p><p>å¦‚æœç›´æ¥ç”¨åŒæ­¥æ¥å£è°ƒç”¨ï¼ŒæœåŠ¡é—´çš„ä¾èµ–æ€§å¾ˆå¼ºï¼Œä¸€ä¸ªæœåŠ¡æŒ‚äº†ï¼Œæ•´ä¸ªé“¾æ¡éƒ½ä¼šè¢«æ‹–å®ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>è®¢å•æœåŠ¡åªè´Ÿè´£æŠŠæ¶ˆæ¯ä¸¢åˆ°MQé‡Œï¼Œåº“å­˜æœåŠ¡å’Œæ”¯ä»˜æœåŠ¡å„è‡ªä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><p>è¿™æ ·è®¢å•æœåŠ¡ä¸éœ€è¦ç›´æ¥ä¾èµ–å®ƒä»¬ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -2"><a href="#ç¤ºä¾‹ä»£ç -2" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¢å•æœåŠ¡ï¼šç”Ÿäº§è€…</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"order_exchange"</span>, <span class="string">"order_key"</span>, order);</span><br><span class="line">System.out.println(<span class="string">"è®¢å•ç”Ÿæˆæ¶ˆæ¯å·²å‘é€"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"stock_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ‰£å‡åº“å­˜ï¼Œè®¢å•IDï¼š"</span> + order.getId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯ä»˜æœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"payment_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processPayment</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¤„ç†æ”¯ä»˜ï¼Œè®¢å•IDï¼š"</span> + order.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-2"><a href="#æ·±åº¦è§£æ-2" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h4><p>é€šè¿‡MQï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´å¯ä»¥å®ç°æ¾è€¦åˆã€‚</p><p>å³ä½¿åº“å­˜æœåŠ¡æŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå½±å“è®¢å•ç”Ÿæˆçš„æµç¨‹ï¼Œ<strong>å¤§å¹…æå‡ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›</strong>ã€‚</p><h3 id="4-åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§"><a href="#4-åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="4.åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§"></a>4.åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§</h3><h4 id="åœºæ™¯-3"><a href="#åœºæ™¯-3" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>è®¢å•æœåŠ¡éœ€è¦åŒæ—¶ç”Ÿæˆè®¢å•å’Œæ‰£å‡åº“å­˜ï¼Œè¿™æ¶‰åŠä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“æ“ä½œã€‚</p><p>å¦‚æœä¸€ä¸ªæˆåŠŸä¸€ä¸ªå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-3"><a href="#è§£å†³æ–¹æ¡ˆ-3" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>é€šè¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>è®¢å•æœåŠ¡ç”Ÿæˆè®¢å•åï¼Œå°†æ‰£å‡åº“å­˜çš„ä»»åŠ¡äº¤ç»™MQï¼Œæœ€ç»ˆå®ç°æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -3"><a href="#ç¤ºä¾‹ä»£ç -3" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¢å•æœåŠ¡ï¼šç”Ÿäº§è€…</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"order_exchange"</span>, <span class="string">"order_key"</span>, order);</span><br><span class="line">System.out.println(<span class="string">"è®¢å•åˆ›å»ºæ¶ˆæ¯å·²å‘é€"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"stock_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ›´æ–°åº“å­˜ï¼Œè®¢å•IDï¼š"</span> + order.getId());</span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ‰£å‡åº“å­˜é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-3"><a href="#æ·±åº¦è§£æ-3" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h4><p>é€šè¿‡â€œæœ€ç»ˆä¸€è‡´æ€§â€è§£å†³äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„éš¾é¢˜ï¼Œè™½ç„¶çŸ­æ—¶é—´å†…å¯èƒ½æœ‰æ•°æ®ä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆçŠ¶æ€ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚</p><h3 id="5-å¹¿æ’­é€šçŸ¥ï¼šä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å¤šä¸ªæœåŠ¡"><a href="#5-å¹¿æ’­é€šçŸ¥ï¼šä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å¤šä¸ªæœåŠ¡" class="headerlink" title="5.å¹¿æ’­é€šçŸ¥ï¼šä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å¤šä¸ªæœåŠ¡"></a>5.å¹¿æ’­é€šçŸ¥ï¼šä¸€æ¡æ¶ˆæ¯ï¼Œé€šçŸ¥å¤šä¸ªæœåŠ¡</h3><h4 id="åœºæ™¯-4"><a href="#åœºæ™¯-4" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>æ¯”å¦‚å•†å“ä»·æ ¼è°ƒæ•´ï¼Œåº“å­˜ã€æœç´¢ã€æ¨èæœåŠ¡éƒ½éœ€è¦åŒæ­¥æ›´æ–°ã€‚</p><p>å¦‚æœæ¯ä¸ªæœåŠ¡éƒ½è¦å•ç‹¬é€šçŸ¥ï¼Œå·¥ä½œé‡ä¼šå¾ˆå¤§ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-4"><a href="#è§£å†³æ–¹æ¡ˆ-4" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>MQçš„å¹¿æ’­æ¨¡å¼ï¼ˆFanoutï¼‰å¯ä»¥è®©å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€æ¡æ¶ˆæ¯ï¼Œå®ç°æ¶ˆæ¯çš„â€œä¸€å‘å¤šæ”¶â€ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -4"><a href="#ç¤ºä¾‹ä»£ç -4" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…ï¼šå¹¿æ’­æ¶ˆæ¯</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"price_update_exchange"</span>, <span class="string">""</span>, priceUpdate);</span><br><span class="line">System.out.println(<span class="string">"å•†å“ä»·æ ¼æ›´æ–°æ¶ˆæ¯å·²å¹¿æ’­"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…1ï¼šåº“å­˜æœåŠ¡</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"stock_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStockPrice</span><span class="params">(PriceUpdate priceUpdate)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"åº“å­˜ä»·æ ¼æ›´æ–°ï¼š"</span> + priceUpdate.getProductId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…2ï¼šæœç´¢æœåŠ¡</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"search_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSearchPrice</span><span class="params">(PriceUpdate priceUpdate)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æœç´¢ä»·æ ¼æ›´æ–°ï¼š"</span> + priceUpdate.getProductId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-4"><a href="#æ·±åº¦è§£æ-4" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h4><p>è¿™ç§æ¨¡å¼è®©å¤šä¸ªæœåŠ¡éƒ½èƒ½æ¥æ”¶åˆ°åŒä¸€æ¡æ¶ˆæ¯ï¼Œ<strong>æ‰©å±•æ€§éå¸¸å¼º</strong>ã€‚</p><h3 id="6-æ—¥å¿—æ”¶é›†ï¼šåˆ†å¸ƒå¼æ—¥å¿—é›†ä¸­åŒ–"><a href="#6-æ—¥å¿—æ”¶é›†ï¼šåˆ†å¸ƒå¼æ—¥å¿—é›†ä¸­åŒ–" class="headerlink" title="6.æ—¥å¿—æ”¶é›†ï¼šåˆ†å¸ƒå¼æ—¥å¿—é›†ä¸­åŒ–"></a>6.æ—¥å¿—æ”¶é›†ï¼šåˆ†å¸ƒå¼æ—¥å¿—é›†ä¸­åŒ–</h3><h4 id="åœºæ™¯-5"><a href="#åœºæ™¯-5" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>å¤šä¸ªæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—éœ€è¦ç»Ÿä¸€å­˜å‚¨å’Œåˆ†æã€‚</p><p>å¦‚æœç›´æ¥å†™æ•°æ®åº“ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-5"><a href="#è§£å†³æ–¹æ¡ˆ-5" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>å„æœåŠ¡å°†æ—¥å¿—å†™å…¥MQï¼Œæ—¥å¿—åˆ†æç³»ç»Ÿä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯å¹¶ç»Ÿä¸€å¤„ç†ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -5"><a href="#ç¤ºä¾‹ä»£ç -5" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯ï¼šç”Ÿäº§è€…</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"log_exchange"</span>, <span class="string">"log_key"</span>, logEntry);</span><br><span class="line">System.out.println(<span class="string">"æ—¥å¿—å·²å‘é€"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—åˆ†ææœåŠ¡ï¼šæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"log_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processLog</span><span class="params">(LogEntry log)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ—¥å¿—å¤„ç†ï¼š"</span> + log.getMessage());</span><br><span class="line">    <span class="comment">// å­˜å‚¨æˆ–åˆ†æé€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-å»¶è¿Ÿä»»åŠ¡ï¼šå®šæ—¶è§¦å‘æ“ä½œ"><a href="#7-å»¶è¿Ÿä»»åŠ¡ï¼šå®šæ—¶è§¦å‘æ“ä½œ" class="headerlink" title="7.å»¶è¿Ÿä»»åŠ¡ï¼šå®šæ—¶è§¦å‘æ“ä½œ"></a>7.å»¶è¿Ÿä»»åŠ¡ï¼šå®šæ—¶è§¦å‘æ“ä½œ</h3><h4 id="åœºæ™¯-6"><a href="#åœºæ™¯-6" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>ç”¨æˆ·ä¸‹å•åï¼Œå¦‚æœ30åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œéœ€è¦è‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-6"><a href="#è§£å†³æ–¹æ¡ˆ-6" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ä½¿ç”¨MQçš„å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ï¼Œè®¾ç½®æ¶ˆæ¯å»¶è¿Ÿæ¶ˆè´¹çš„æ—¶é—´ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -6"><a href="#ç¤ºä¾‹ä»£ç -6" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Â ç”Ÿäº§è€…ï¼šå‘é€å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"delay_exchange"</span>,Â <span class="string">"delay_key"</span>,Â order,Â messageÂ -&gt;Â &#123;</span><br><span class="line">Â Â Â Â message.getMessageProperties().setDelay(<span class="number">30</span>Â *Â <span class="number">60</span>Â *Â <span class="number">1000</span>);Â <span class="comment">//Â å»¶è¿Ÿ30åˆ†é’Ÿ</span></span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â message;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">"è®¢å•å–æ¶ˆä»»åŠ¡å·²è®¾ç½®"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Â æ¶ˆè´¹è€…ï¼šå¤„ç†å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queuesÂ =Â <span class="string">"delay_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span>Â <span class="keyword">void</span>Â <span class="title">cancelOrder</span><span class="params">(OrderÂ order)</span>Â </span>&#123;</span><br><span class="line">Â Â Â Â System.out.println(<span class="string">"å–æ¶ˆè®¢å•ï¼š"</span>Â +Â order.getId());</span><br><span class="line">Â Â Â Â <span class="comment">//Â å–æ¶ˆè®¢å•é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-æ•°æ®åŒæ­¥ï¼šè·¨ç³»ç»Ÿä¿æŒæ•°æ®ä¸€è‡´"><a href="#8-æ•°æ®åŒæ­¥ï¼šè·¨ç³»ç»Ÿä¿æŒæ•°æ®ä¸€è‡´" class="headerlink" title="8.æ•°æ®åŒæ­¥ï¼šè·¨ç³»ç»Ÿä¿æŒæ•°æ®ä¸€è‡´"></a>8.æ•°æ®åŒæ­¥ï¼šè·¨ç³»ç»Ÿä¿æŒæ•°æ®ä¸€è‡´</h3><h4 id="åœºæ™¯-7"><a href="#åœºæ™¯-7" class="headerlink" title="åœºæ™¯"></a><strong>åœºæ™¯</strong></h4><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæœåŠ¡ä¾èµ–åŒä¸€ä»½æ•°æ®æºã€‚</p><p>ä¾‹å¦‚ï¼Œç”µå•†å¹³å°çš„è®¢å•çŠ¶æ€æ›´æ–°åï¼Œéœ€è¦åŒæ­¥åˆ°ç¼“å­˜ç³»ç»Ÿå’Œæ¨èç³»ç»Ÿã€‚</p><p>å¦‚æœè®©æ¯ä¸ªæœåŠ¡ç›´æ¥ä»æ•°æ®åº“æ‹‰å–æ•°æ®ï¼Œä¼šå¢åŠ æ•°æ®åº“å‹åŠ›ï¼Œè¿˜å¯èƒ½å‡ºç°å»¶è¿Ÿæˆ–ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-7"><a href="#è§£å†³æ–¹æ¡ˆ-7" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><strong>è§£å†³æ–¹æ¡ˆ</strong></h4><p>åˆ©ç”¨MQè¿›è¡Œæ•°æ®åŒæ­¥ã€‚è®¢å•æœåŠ¡æ›´æ–°è®¢å•çŠ¶æ€åï¼Œå°†æ›´æ–°ä¿¡æ¯å‘é€åˆ°MQï¼Œç¼“å­˜æœåŠ¡å’Œæ¨èæœåŠ¡ä»MQä¸­æ¶ˆè´¹æ¶ˆæ¯å¹¶åŒæ­¥æ•°æ®ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -7"><a href="#ç¤ºä¾‹ä»£ç -7" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a><strong>ç¤ºä¾‹ä»£ç </strong></h4><p><strong>è®¢å•æœåŠ¡ï¼šç”Ÿäº§è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€åï¼Œå°†æ¶ˆæ¯å‘é€åˆ°MQ</span></span><br><span class="line">Order order = updateOrderStatus(orderId, <span class="string">"PAID"</span>); <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"order_exchange"</span>, <span class="string">"order_status_key"</span>, order);</span><br><span class="line">System.out.println(<span class="string">"è®¢å•çŠ¶æ€æ›´æ–°æ¶ˆæ¯å·²å‘é€ï¼š"</span> + order.getId());</span><br></pre></td></tr></table></figure><p><strong>ç¼“å­˜æœåŠ¡ï¼šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"cache_update_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCache</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ›´æ–°ç¼“å­˜ï¼Œè®¢å•IDï¼š"</span> + order.getId() + <span class="string">" çŠ¶æ€ï¼š"</span> + order.getStatus());</span><br><span class="line">    <span class="comment">// æ›´æ–°ç¼“å­˜é€»è¾‘</span></span><br><span class="line">    cacheService.update(order.getId(), order.getStatus());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¨èæœåŠ¡ï¼šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"recommendation_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateRecommendation</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ›´æ–°æ¨èç³»ç»Ÿï¼Œè®¢å•IDï¼š"</span> + order.getId() + <span class="string">" çŠ¶æ€ï¼š"</span> + order.getStatus());</span><br><span class="line">    <span class="comment">// æ›´æ–°æ¨èæœåŠ¡é€»è¾‘</span></span><br><span class="line">    recommendationService.updateOrderStatus(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-5"><a href="#æ·±åº¦è§£æ-5" class="headerlink" title="æ·±åº¦è§£æ"></a><strong>æ·±åº¦è§£æ</strong></h4><p>é€šè¿‡MQå®ç°æ•°æ®åŒæ­¥çš„å¥½å¤„æ˜¯ï¼š</p><ol><li><p><strong>å‡è½»æ•°æ®åº“å‹åŠ›</strong>ï¼šé¿å…å¤šä¸ªæœåŠ¡åŒæ—¶æŸ¥è¯¢æ•°æ®åº“ã€‚</p></li><li><p><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šå³ä½¿æŸä¸ªæœåŠ¡å¤„ç†å»¶è¿Ÿï¼ŒMQä¹Ÿèƒ½ä¿éšœæ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œæœ€ç»ˆæ‰€æœ‰æœåŠ¡çš„æ•°æ®çŠ¶æ€ä¸€è‡´ã€‚</p></li></ol><h3 id="9-åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦"><a href="#9-åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" class="headerlink" title="9.åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦"></a>9.åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</h3><h4 id="åœºæ™¯-8"><a href="#åœºæ™¯-8" class="headerlink" title="åœºæ™¯"></a><strong>åœºæ™¯</strong></h4><p>æœ‰äº›ä»»åŠ¡éœ€è¦å®šæ—¶æ‰§è¡Œï¼Œæ¯”å¦‚æ¯å¤©å‡Œæ™¨æ¸…ç†è¿‡æœŸè®¢å•ã€‚</p><p>è¿™äº›è®¢å•å¯èƒ½åˆ†å¸ƒåœ¨å¤šä¸ªæœåŠ¡ä¸­ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡ç‹¬ç«‹è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå¯èƒ½ä¼šå‡ºç°é‡å¤å¤„ç†æˆ–ä»»åŠ¡é—æ¼çš„é—®é¢˜ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-8"><a href="#è§£å†³æ–¹æ¡ˆ-8" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><strong>è§£å†³æ–¹æ¡ˆ</strong></h4><p>ä½¿ç”¨MQç»Ÿä¸€åˆ†å‘è°ƒåº¦ä»»åŠ¡ï¼Œæ¯ä¸ªæœåŠ¡æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä»MQä¸­æ¶ˆè´¹ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -8"><a href="#ç¤ºä¾‹ä»£ç -8" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a><strong>ç¤ºä¾‹ä»£ç </strong></h4><p><strong>ä»»åŠ¡è°ƒåº¦æœåŠ¡ï¼šç”Ÿäº§è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šæ—¶ä»»åŠ¡ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"0 0 0 * * ?"</span>) <span class="comment">// æ¯å¤©å‡Œæ™¨è§¦å‘</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateTasks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Task&gt; expiredTasks = taskService.getExpiredTasks();</span><br><span class="line">    <span class="keyword">for</span> (Task task : expiredTasks) &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"task_exchange"</span>, <span class="string">"task_routing_key"</span>, task);</span><br><span class="line">        System.out.println(<span class="string">"ä»»åŠ¡å·²å‘é€ï¼š"</span> + task.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¢å•æœåŠ¡ï¼šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"order_task_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processOrderTask</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¤„ç†è®¢å•ä»»åŠ¡ï¼š"</span> + task.getId());</span><br><span class="line">    <span class="comment">// æ‰§è¡Œè®¢å•æ¸…ç†é€»è¾‘</span></span><br><span class="line">    orderService.cleanExpiredOrder(task);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"stock_task_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processStockTask</span><span class="params">(Task task)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¤„ç†åº“å­˜ä»»åŠ¡ï¼š"</span> + task.getId());</span><br><span class="line">    <span class="comment">// æ‰§è¡Œåº“å­˜é‡Šæ”¾é€»è¾‘</span></span><br><span class="line">    stockService.releaseStock(task);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-6"><a href="#æ·±åº¦è§£æ-6" class="headerlink" title="æ·±åº¦è§£æ"></a><strong>æ·±åº¦è§£æ</strong></h4><p>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¯ä»¥è§£å†³ï¼š</p><ol><li><p><strong>é‡å¤æ‰§è¡Œ</strong>ï¼šæ¯ä¸ªæœåŠ¡åªå¤„ç†è‡ªå·±é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p></li><li><p><strong>ä»»åŠ¡é—æ¼</strong>ï¼šMQç¡®ä¿ä»»åŠ¡å¯é ä¼ é€’ï¼Œé˜²æ­¢ä»»åŠ¡ä¸¢å¤±ã€‚</p></li></ol><h3 id="10-æ–‡ä»¶å¤„ç†ï¼šå¼‚æ­¥æ‰§è¡Œå¤§æ–‡ä»¶ä»»åŠ¡"><a href="#10-æ–‡ä»¶å¤„ç†ï¼šå¼‚æ­¥æ‰§è¡Œå¤§æ–‡ä»¶ä»»åŠ¡" class="headerlink" title="10.æ–‡ä»¶å¤„ç†ï¼šå¼‚æ­¥æ‰§è¡Œå¤§æ–‡ä»¶ä»»åŠ¡"></a>10.æ–‡ä»¶å¤„ç†ï¼šå¼‚æ­¥æ‰§è¡Œå¤§æ–‡ä»¶ä»»åŠ¡</h3><h4 id="åœºæ™¯-9"><a href="#åœºæ™¯-9" class="headerlink" title="åœºæ™¯"></a><strong>åœºæ™¯</strong></h4><p>ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªå¤§æ–‡ä»¶åï¼Œéœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼ˆå¦‚æ ¼å¼è½¬æ¢ã€å‹ç¼©ç­‰ï¼‰å¹¶å­˜å‚¨ã€‚</p><p>å¦‚æœåŒæ­¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œå‰ç«¯é¡µé¢å¯èƒ½ä¼šä¸€ç›´åŠ è½½ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒå·®ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-9"><a href="#è§£å†³æ–¹æ¡ˆ-9" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><strong>è§£å†³æ–¹æ¡ˆ</strong></h4><p>ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åï¼Œç«‹å³å°†ä»»åŠ¡å†™å…¥MQï¼Œåå°å¼‚æ­¥å¤„ç†æ–‡ä»¶ï¼Œå¤„ç†å®Œæˆåé€šçŸ¥ç”¨æˆ·æˆ–æ›´æ–°çŠ¶æ€ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -9"><a href="#ç¤ºä¾‹ä»£ç -9" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a><strong>ç¤ºä¾‹ä»£ç </strong></h4><p><strong>ä¸Šä¼ æœåŠ¡ï¼šç”Ÿäº§è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸Šä¼ æ–‡ä»¶åï¼Œå°†ä»»åŠ¡å†™å…¥MQ</span></span><br><span class="line">FileTask fileTask = <span class="keyword">new</span> FileTask();</span><br><span class="line">fileTask.setFileId(fileId);</span><br><span class="line">fileTask.setOperation(<span class="string">"COMPRESS"</span>);</span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">"file_task_exchange"</span>, <span class="string">"file_task_key"</span>, fileTask);</span><br><span class="line">System.out.println(<span class="string">"æ–‡ä»¶å¤„ç†ä»»åŠ¡å·²å‘é€ï¼Œæ–‡ä»¶IDï¼š"</span> + fileId);</span><br></pre></td></tr></table></figure><p><strong>æ–‡ä»¶å¤„ç†æœåŠ¡ï¼šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"file_task_queue"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processFileTask</span><span class="params">(FileTask fileTask)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¤„ç†æ–‡ä»¶ä»»åŠ¡ï¼š"</span> + fileTask.getFileId() + <span class="string">" æ“ä½œï¼š"</span> + fileTask.getOperation());</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"COMPRESS"</span>.equals(fileTask.getOperation())) &#123;</span><br><span class="line">        fileService.compressFile(fileTask.getFileId());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"CONVERT"</span>.equals(fileTask.getOperation())) &#123;</span><br><span class="line">        fileService.convertFileFormat(fileTask.getFileId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ›´æ–°ä»»åŠ¡çŠ¶æ€</span></span><br><span class="line">    taskService.updateTaskStatus(fileTask.getFileId(), <span class="string">"COMPLETED"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‰ç«¯è½®è¯¢æˆ–å›è°ƒé€šçŸ¥</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰ç«¯è½®è¯¢æ–‡ä»¶å¤„ç†çŠ¶æ€</span></span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fetch(<span class="string">`/file/status?fileId=<span class="subst">$&#123;fileId&#125;</span>`</span>)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">        .then(<span class="function"><span class="params">status</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (status === <span class="string">"COMPLETED"</span>) &#123;</span><br><span class="line">                alert(<span class="string">"æ–‡ä»¶å¤„ç†å®Œæˆï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦è§£æ-7"><a href="#æ·±åº¦è§£æ-7" class="headerlink" title="æ·±åº¦è§£æ"></a><strong>æ·±åº¦è§£æ</strong></h4><p>å¼‚æ­¥æ–‡ä»¶å¤„ç†çš„ä¼˜åŠ¿ï¼š</p><ol><li><p><strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šä¸»çº¿ç¨‹è¿…é€Ÿè¿”å›ï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´ã€‚</p></li><li><p><strong>åå°ä»»åŠ¡çµæ´»æ‰©å±•</strong>ï¼šæ”¯æŒå¤šç§æ“ä½œé€»è¾‘ï¼Œé€‚åº”å¤æ‚æ–‡ä»¶å¤„ç†éœ€æ±‚ã€‚</p></li></ol><h3 id="11-æ€»ç»“"><a href="#11-æ€»ç»“" class="headerlink" title="11.æ€»ç»“"></a>11.æ€»ç»“</h3><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸åªæ˜¯ä¼ é€’æ¶ˆæ¯çš„å·¥å…·ï¼Œæ›´æ˜¯ç³»ç»Ÿè§£è€¦ã€æå‡ç¨³å®šæ€§å’Œæ‰©å±•æ€§çš„åˆ©å™¨ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>MQ</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„8ç§è®¾è®¡æ¨¡å¼</title>
    <url>/post/9c202ccf.html</url>
    <content><![CDATA[<blockquote><p>8ç§è®¾è®¡æ¨¡å¼ä»‹ç» ~</p></blockquote><a id="more"></a><h2 id="1-å•ä¾‹æ¨¡å¼"><a href="#1-å•ä¾‹æ¨¡å¼" class="headerlink" title="1. å•ä¾‹æ¨¡å¼"></a>1. å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé€šå¸¸ç”¨äºç®¡ç†å…±äº«èµ„æºï¼Œå¦‚é…ç½®ã€ç¼“å­˜ã€çº¿ç¨‹æ± ç­‰ã€‚</p><p><strong>ä»£ç å®ç°ï¼šåŒé‡æ£€æŸ¥é”</strong><br>è¿™æ˜¯å•ä¾‹æ¨¡å¼çš„æ ‡å‡†å†™æ³•ï¼Œæ—¢ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆé¿å…æ€§èƒ½æŸè€—ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.lang.Runtime.getRuntime()</code></li><li><code>java.util.logging.Logger</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong><br>Spring çš„ <code>Bean</code> é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ã€‚å¯ä»¥é€šè¿‡ <code>@Scope(&quot;prototype&quot;)</code> å°†å…¶æ”¹ä¸ºå¤šä¾‹ã€‚</p><h2 id="2-å·¥å‚æ¨¡å¼"><a href="#2-å·¥å‚æ¨¡å¼" class="headerlink" title="2. å·¥å‚æ¨¡å¼"></a>2. å·¥å‚æ¨¡å¼</h2><p>å·¥å‚æ¨¡å¼ç”¨äºå°è£…å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼Œç‰¹åˆ«æ˜¯å½“ç±»å®ä¾‹åŒ–è¿‡ç¨‹å¤æ‚æ—¶ï¼Œå¯ä»¥é™ä½è€¦åˆåº¦ã€‚</p><p><strong>ä»£ç å®ç°ï¼šç®€å•å·¥å‚</strong><br>ä»¥æ”¯ä»˜ç³»ç»Ÿä¸ºä¾‹ï¼Œä¸åŒæ”¯ä»˜æ–¹å¼éœ€è¦ä¸åŒçš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Payment <span class="title">createPayment</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"AliPay"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> AliPay();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"WeChatPay"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> WeChatPay();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown payment type"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.util.Calendar.getInstance()</code></li><li><code>javax.xml.parsers.DocumentBuilderFactory.newInstance()</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>BeanFactory</code> å’Œ <code>ApplicationContext</code> éƒ½æ˜¯å·¥å‚æ¨¡å¼çš„ä½“ç°ã€‚</li></ul><h2 id="3-ç­–ç•¥æ¨¡å¼"><a href="#3-ç­–ç•¥æ¨¡å¼" class="headerlink" title="3. ç­–ç•¥æ¨¡å¼"></a>3. ç­–ç•¥æ¨¡å¼</h2><p>ç­–ç•¥æ¨¡å¼å°†ä¸åŒç®—æ³•å°è£…ä¸ºç‹¬ç«‹ç±»ï¼Œå¹¶å…è®¸åœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„ç­–ç•¥ã€‚</p><p><strong>ä»£ç å®ç°ï¼šä¿ƒé”€ç­–ç•¥</strong><br>ä»¥ç”µå•†ä¿ƒé”€ä¸ºä¾‹ï¼Œæ”¯æŒæ»¡å‡ã€æ‰“æŠ˜ç­‰å¤šç§ç­–ç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PromotionStrategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">applyPromotion</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscountStrategy</span> <span class="keyword">implements</span> <span class="title">PromotionStrategy</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applyPromotion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Applying discount..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PromotionContext</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PromotionStrategy strategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PromotionContext</span><span class="params">(PromotionStrategy strategy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executePromotion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        strategy.applyPromotion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.util.Comparator</code> æ˜¯å…¸å‹çš„ç­–ç•¥æ¨¡å¼ã€‚</li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li>äº‹åŠ¡ç®¡ç†ï¼ˆ<code>TransactionManager</code>ï¼‰ï¼Œæ”¯æŒç¼–ç¨‹å¼å’Œå£°æ˜å¼äº‹åŠ¡ã€‚</li></ul><h2 id="4-ä»£ç†æ¨¡å¼"><a href="#4-ä»£ç†æ¨¡å¼" class="headerlink" title="4. ä»£ç†æ¨¡å¼"></a>4. ä»£ç†æ¨¡å¼</h2><p>ä»£ç†æ¨¡å¼é€šè¿‡ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¸¸ç”¨äºæƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰åœºæ™¯ã€‚</p><p><strong>ä»£ç å®ç°ï¼šé™æ€ä»£ç†</strong><br>æ¨¡æ‹Ÿå¯¹ä¸€ä¸ªæœåŠ¡çš„æƒé™æ§åˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealService</span> <span class="keyword">implements</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Executing real service..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceProxy</span> <span class="keyword">implements</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RealService realService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Checking permissions..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (realService == <span class="keyword">null</span>) &#123;</span><br><span class="line">            realService = <span class="keyword">new</span> RealService();</span><br><span class="line">        &#125;</span><br><span class="line">        realService.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li>åŠ¨æ€ä»£ç† <code>java.lang.reflect.Proxy</code></li><li>RMIï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰</li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å¹¿æ³›ä½¿ç”¨ä»£ç†æ¨¡å¼ã€‚</li></ul><h2 id="5-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#5-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="5. è§‚å¯Ÿè€…æ¨¡å¼"></a>5. è§‚å¯Ÿè€…æ¨¡å¼</h2><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰ä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ã€‚</p><p><strong>ä»£ç å®ç°ï¼šäº‹ä»¶é€šçŸ¥</strong><br>æ¨¡æ‹Ÿå¾®åšç”¨æˆ·çš„ç²‰ä¸é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(String message)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">" received message: "</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Weibo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">follow</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.util.Observer</code> å’Œ <code>java.util.Observable</code></li><li><code>javax.swing.event.ChangeListener</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>ApplicationEvent</code> å’Œ <code>ApplicationListener</code> æ˜¯å…¸å‹å®ç°ã€‚</li></ul><p>æœ€è¿‘å»ºäº†ä¸€äº›å·¥ä½œå†…æ¨ç¾¤ï¼Œæ”¶é›†äº†ä¸å°‘å·¥ä½œå²—ä½ï¼ŒåŠ æˆ‘å¾®ä¿¡ï¼šsu_san_javaï¼Œå¤‡æ³¨ï¼šåšå®¢å›­+æ‰€åœ¨åŸå¸‚ï¼Œå³å¯è¿›ç¾¤ã€‚</p><h2 id="6-è£…é¥°å™¨æ¨¡å¼"><a href="#6-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="6. è£…é¥°å™¨æ¨¡å¼"></a>6. è£…é¥°å™¨æ¨¡å¼</h2><p>è£…é¥°å™¨æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€æ‰©å±•å…¶åŠŸèƒ½ã€‚</p><p><strong>ä»£ç å®ç°ï¼šå’–å•¡åŠ æ–™</strong><br>æ¨¡æ‹Ÿä¸€ä¸ªå’–å•¡è®¢å•ç³»ç»Ÿï¼Œå¯ä»¥åŠ¨æ€åŠ æ–™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getCost</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleCoffee</span> <span class="keyword">implements</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Simple Coffee"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MilkDecorator</span> <span class="keyword">implements</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Coffee coffee;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MilkDecorator</span><span class="params">(Coffee coffee)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.coffee = coffee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getDescription() + <span class="string">", Milk"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.getCost() + <span class="number">1.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.io.BufferedInputStream</code> å’Œ <code>java.io.BufferedOutputStream</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>BeanPostProcessor</code> ç”¨äºåŠ¨æ€ä¿®æ”¹ Bean çš„è¡Œä¸ºã€‚</li></ul><h2 id="7-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#7-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="7. æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>7. æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼ŒæŠŠå…·ä½“çš„å®ç°ç•™ç»™å­ç±»ã€‚</p><p><strong>ä»£ç å®ç°ï¼šä»»åŠ¡æ‰§è¡Œæ¨¡æ¿</strong><br>æ¨¡æ‹Ÿå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        init();</span><br><span class="line">        doWork();</span><br><span class="line">        cleanup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Default cleanup..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataProcessingTask</span> <span class="keyword">extends</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Initializing data..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Processing data..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>java.util.AbstractList</code> å’Œ <code>java.util.AbstractMap</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>JdbcTemplate</code> å’Œ <code>RestTemplate</code></li></ul><h2 id="8-å»ºé€ è€…æ¨¡å¼"><a href="#8-å»ºé€ è€…æ¨¡å¼" class="headerlink" title="8. å»ºé€ è€…æ¨¡å¼"></a>8. å»ºé€ è€…æ¨¡å¼</h2><p>å»ºé€ è€…æ¨¡å¼ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯å½“å¯¹è±¡æœ‰å¤šä¸ªå¯é€‰å‚æ•°æ—¶ã€‚</p><p><strong>ä»£ç å®ç°ï¼šæ„å»º HTTP è¯·æ±‚</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpRequest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String body;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HttpRequest</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.method = builder.method;</span><br><span class="line">        <span class="keyword">this</span>.url = builder.url;</span><br><span class="line">        <span class="keyword">this</span>.body = builder.body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String method;</span><br><span class="line">        <span class="keyword">private</span> String url;</span><br><span class="line">        <span class="keyword">private</span> String body;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">method</span><span class="params">(String method)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.method = method;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">url</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.url = url;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">body</span><span class="params">(String body)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.body = body;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> HttpRequest <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HttpRequest(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JDK ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>StringBuilder</code></li><li><code>Stream.Builder</code></li></ul><p><strong>Spring ä¸­çš„åº”ç”¨ï¼š</strong></p><ul><li><code>UriComponentsBuilder</code> ç”¨äºæ„å»º URIã€‚</li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºServletRequestHandledEventçš„æ¥å£è°ƒç”¨è€—æ—¶è®°å½•</title>
    <url>/post/2d2dc8b5.html</url>
    <content><![CDATA[<blockquote><p>åŸºäºServletRequestHandledEventçš„æ¥å£è°ƒç”¨è€—æ—¶ ~</p></blockquote><a id="more"></a><p>åœ¨å¼€å‘ Web åº”ç”¨æ—¶ï¼Œç›‘æ§æ¥å£çš„æ€§èƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚é€šè¿‡è®°å½•æ¥å£çš„è°ƒç”¨è€—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ Spring Boot åº”ç”¨ä¸­ä½¿ç”¨ ServletRequestHandledEvent æ¥è®°å½•æ¥å£çš„è°ƒç”¨è€—æ—¶ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ServletRequestHandledEventï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-ServletRequestHandledEventï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ ServletRequestHandledEventï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ ServletRequestHandledEventï¼Ÿ</h3><p>ServletRequestHandledEvent æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒåœ¨æ¯æ¬¡ HTTP è¯·æ±‚å¤„ç†å®Œæˆåè¢«å‘å¸ƒã€‚è¿™ä¸ªäº‹ä»¶åŒ…å«äº†è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚ URLã€å¤„ç†æ—¶é—´ç­‰ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°è¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼Œä»è€Œè®°å½•æ¥å£çš„è°ƒç”¨è€—æ—¶ã€‚è¿™ç§æ–¹æ³•ä¸ä»…ç®€å•ï¼Œè€Œä¸”ä¸ä¼šå¯¹ç°æœ‰ä»£ç é€ æˆä¾µå…¥ã€‚</p><h3 id="åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨"><a href="#åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨"></a>åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨</h3><p>ä¸ºäº†å®ç°æ¥å£è°ƒç”¨è€—æ—¶çš„è®°å½•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥å¤„ç† ServletRequestHandledEvent äº‹ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestTimeEventListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ServletRequestHandledEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ServletRequestHandledEvent event)</span> </span>&#123;</span><br><span class="line">        Throwable failureCause = event.getFailureCause();</span><br><span class="line">        String failureMessage = failureCause == <span class="keyword">null</span> ? <span class="string">""</span> : failureCause.getMessage();</span><br><span class="line">        <span class="keyword">if</span> (failureCause != <span class="keyword">null</span>) &#123;</span><br><span class="line">            failureMessage = failureCause.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        String clientAddress = event.getClientAddress();</span><br><span class="line">        String requestUrl = event.getRequestUrl();</span><br><span class="line">        String method = event.getMethod();</span><br><span class="line">        <span class="keyword">long</span> processingTimeMillis = event.getProcessingTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isEmpty(failureMessage)) &#123;</span><br><span class="line">            log.info(<span class="string">"clientAddress = &#123;&#125; requestUrl = &#123;&#125; method = &#123;&#125; costTime = &#123;&#125;"</span>,clientAddress,requestUrl,method,processingTimeMillis);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">"clientAddress = &#123;&#125; requestUrl = &#123;&#125; method = &#123;&#125; costTime = &#123;&#125; error = &#123;&#125;"</span>,clientAddress,requestUrl,method,processingTimeMillis,failureMessage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç¨‹åºï¼Œè¯·æ±‚æ¥å£å¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2024</span>-<span class="number">11</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">26</span>:<span class="number">17.828</span>  INFO <span class="number">22300</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.s.k.j.config.RequestTimeEventListener  : clientAddress = <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">1</span> requestUrl = /job method = GET costTime = <span class="number">67</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ä½¿ç”¨ ServletRequestHandledEventï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è®°å½•æ¥å£çš„è°ƒç”¨è€—æ—¶ã€‚è¿™ç§æ–¹æ³•ä¸ä»…ç®€å•ï¼Œè€Œä¸”ä¸ä¼šå¯¹ç°æœ‰ä»£ç é€ æˆä¾µå…¥ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®å†·çƒ­åˆ†ç¦»</title>
    <url>/post/a6d03f4c.html</url>
    <content><![CDATA[<blockquote><p>æ•°æ®å†·çƒ­åˆ†ç¦» ~</p></blockquote><a id="more"></a><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸ºäº†ä¿è¯æœ‰ä¸€ä¸ªæ›´å¥åº·çš„èº«ä½“ï¼Œæ‰€ä»¥æ…¢æ…¢é™ä½äº†æ›´æ–°é¢‘ç‡ï¼Œåœ¨æœ‰äº†æ›´å¤šä¼‘æ¯æ—¶é—´çš„å‰æä¸‹ï¼Œæ€è€ƒäº†ä¸€ä¸‹æ¥ä¸‹æ¥å‡†å¤‡åˆ†äº«çš„ä¸€äº›å†…å®¹ã€‚</p><p>å†³å®šåœ¨æ›´æ–°ä¸€äº›æŠ€æœ¯å¹²è´§çš„åŒæ—¶ï¼Œä¼šç©¿æ’ä¸€äº›æ¶æ„çŸ¥è¯†ï¼Œæ”¾åœ¨å•ç‹¬çš„ä¸“æ é‡Œé¢ï¼Œå¸Œæœ›å¤§å®¶èƒ½å–œæ¬¢ï¼Œé‡Œé¢åŒ…å«äº†è¿™äº›å¹´å·¥ä½œä¸­é‡åˆ°çš„ä¸€äº›å†…å®¹ï¼Œä»¥åŠè‡ªå·±å……ç”µåæ€»ç»“çš„ä¸€äº›çŸ¥è¯†ï¼Œå¸Œæœ›å¤§å®¶ä¼šå–œæ¬¢ã€‚</p><p>æ ‡é¢˜åšäº†è¾ƒä¸ºè¯¦ç»†çš„åˆ’åˆ†ï¼Œå¤§å®¶ä¸å¿…ä¸€æ¬¡çœ‹å®Œï¼Œä»¥å…è§†è§‰ç–²åŠ³ã€‚</p><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>æœ¬ç¯‡åˆ†äº«ä»¥å‰åœ¨å¹¿å·ä¸€å®¶äº’è”ç½‘å…¬å¸å·¥ä½œæ—¶é‡åˆ°çš„çŠ¶å†µåŠè§£å†³æ–¹æ¡ˆï¼Œè¿™å®¶å…¬å¸æœ‰ä¸€ä¸ªé¡¹ç›®æ˜¯SOAçš„æ¶æ„ï¼Œè¿™ä¸ªæ¶æ„é‚£å‡ å¹´æ˜¯å¾ˆæµè¡Œçš„ï¼Œå“ªæ€•æ˜¯ç°åœ¨æˆ‘ä¾ç„¶è®¤ä¸ºè¿™ä¸ªç†å¿µåœ¨å½“æ—¶æ¯”è¾ƒå…ˆè¿›ã€‚</p><p>æˆ‘åœ¨è¿™å®¶å…¬å¸å¾…çš„æ—¶é—´ä¸é•¿ï¼Œä½†å› ä¸ºå¹³å°ä¸é”™ï¼Œç¡®å®å­¦ä¹ å’Œå®è·µäº†ä¸€ç‚¹ä¸œè¥¿ï¼Œæ‰€ä»¥æ•´ç†ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚</p><p>å½“æ—¶çš„é¡¹ç›®èƒŒæ™¯å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œè¿™å®¶å…¬å¸ç”¨çš„æ˜¯æŸè½¯æä¾›çš„æ–¹æ¡ˆï¼ˆè¿™å…¬å¸è´¼å–œæ¬¢æä¾›æ–¹æ¡ˆä¸”è¦é’±å¤šï¼Œå¿ä¸ä½åæ§½å“ˆï¼‰ï¼Œé¡¹ç›®å·²ç»è¿è¡Œ3å¹´å¤šï¼Œæ•´ä½“ç¨³å®šã€‚</p><blockquote><p>æ•°æ®åº“æ˜¯<code>MySQL</code>ï¼Œè®¢å•è¡¨çš„æ•°æ®é‡å·²ç»è¾¾åˆ°3000å¤šä¸‡æ¡è®°å½•ï¼Œå¹¶ä¸”éšç€é¡¹ç›®çš„æ¨å¹¿ï¼Œæœ€è¿‘é‚£ä¸€å¹´è®¢å•è¡¨æ•°æ®é‡ä¹Ÿåœ¨å¿«é€Ÿå¢é•¿ã€‚</p><p>ç»“æœå°±æ˜¯ï¼Œå®¢æˆ·æ–¹æŸ¥è¯¢è®¢å•ç›¸å…³çš„ä¸šåŠ¡æ—¶é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼ŒåæœŸä¸è®ºæ‰“å¼€è¿˜æ˜¯åˆ·æ–°éƒ½å·®ä¸å¤šè¦ä¸ƒå…«ç§’ã€‚</p></blockquote><p>å¯ä»¥è¯´å·²ç»ä¸¥é‡å½±å“äº†å®¢æˆ·ä½“éªŒï¼Œé™ä½äº†å¯¹æ–¹æ—¥å¸¸åŠäº‹çš„æ•ˆç‡ï¼Œè¦æ±‚æˆ‘ä»¬å°½å¿«è§£å†³ï¼Œä¸”æ•¦ä¿ƒæˆ‘ä»¬è¿™æ˜¯ä¸€ä»¶ä¼˜å…ˆçº§éå¸¸é«˜çš„äº‹æƒ…ã€‚</p><p>åœ¨å®¢æˆ·å’Œå…¬å¸é¢†å¯¼çš„åŒé‡å‹åŠ›ä¸‹ï¼Œå¦‚ä½•å¿«é€Ÿä¼˜åŒ–å‡ åƒä¸‡æ•°æ®çš„è®¢å•è¡¨ï¼Œå¯¹äºå½“æ—¶çš„å›¢é˜Ÿç€å®æ˜¯ä¸€ä¸ªéš¾é¢˜æ‘†åœ¨é¢å‰ã€‚</p><p>æˆ‘ä¾ç¨€è®°å¾—è‡ªå·±å½“æ—¶è¿˜æ¯”è¾ƒé’æ¶©ï¼Œæ›´å¤šçš„æ˜¯ä¸€ä¸ªå¬ä¼—ï¼Œä¸æ•¢å‚ä¸æ·±å…¥è®¨è®ºå“ˆå“ˆã€‚</p><h3 id="æ•´ä½“æ–¹æ¡ˆ"><a href="#æ•´ä½“æ–¹æ¡ˆ" class="headerlink" title="æ•´ä½“æ–¹æ¡ˆ"></a>æ•´ä½“æ–¹æ¡ˆ</h3><p>é¦–å…ˆå¸¸è§„æ–¹æ¡ˆèƒ½æƒ³åˆ°çš„æ— éæ˜¯è¿™äº›ï¼š<code>å¢åŠ åˆç†çš„æ•°æ®åº“ç´¢å¼•ã€ä¼˜åŒ–æ ¸å¿ƒSQLè¯­å¥ã€ä¼˜åŒ–ä»£ç ç­‰</code>ã€‚</p><p>æˆ‘è¿™é‡Œå¯ä»¥å‘Šè¯‰å¤§å®¶ï¼Œä¸€èˆ¬çš„ITå…¬å¸ï¼Œä½†å‡¡å›¢é˜ŸLeaderæ˜¯ä¸ªæœ‰ç»éªŒçš„äººï¼Œè¿™äº›åŸºç¡€æ–¹æ¡ˆéƒ½æ˜¯ä¼šæå‰åšçš„ï¼Œä¼šå¯¹é¡¹ç›®ä¸Šçº¿åå¯èƒ½é‡åˆ°çš„ç“¶é¢ˆæœ‰ä¸ªåŸºæœ¬çš„è¯„ä¼°ï¼Œå› ä¸ºçœŸæ­£è¿è¥å‘¨æœŸå˜é•¿ä»¥åï¼Œæ•°æ®é‡é€æ¸å¢å¤šï¼Œä¿®æ”¹ç”Ÿäº§åº“æ˜¯ä¸€ç§é£é™©æ“ä½œã€‚</p><blockquote><p>æˆ‘ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¿‡ç»™æŸä¸ªç”Ÿäº§åº“æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨æ·»åŠ å­—æ®µæˆ–ç´¢å¼•çš„ç»å†ï¼Œè€Œä¸”æ˜¯åœ¨ç™½å¤©ä¸Šç­æ“ä½œï¼Œæˆ–è€…è¯´ä½ è‡ªå·±è§è¿‡åˆ«äººè¿™ä¹ˆå¹²ï¼Œæˆ‘åªèƒ½è¯´â€¦â€¦è¿™äº›éƒ½æ˜¯ç‹ äººï¼Œè¦å¯¹å…¶å¸¸æ€€æ•¬ç•ä¹‹å¿ƒã€‚</p></blockquote><p>æˆ‘ç›®å‰æ‰€åœ¨çš„å…¬å¸å°±æ¯”è¾ƒè§„èŒƒï¼Œç ”å‘äººå‘˜å»ºè¡¨æ—¶ä¸€å®šè¦æäº¤ç”³è¯·èµ°æµç¨‹ï¼Œä¸”é™„å¸¦åˆç†çš„ç´¢å¼•ï¼Œä¸€èµ·æäº¤å®¡æ ¸ï¼Œæœ€ç»ˆé€šè¿‡äº†æ‰èƒ½ç”±ä¸»ç®¡å®¡æ ¸æ‰§è¡Œã€‚</p><p>è‡³äºè¿™ç§æµç¨‹æ€ä¹ˆèµ°ï¼Œå…¶å®å·¥å…·æŒºå¤šï¼Œæˆ‘è¿™é‡Œå°±æä¸€ä¸ªç”¨è¿‡çš„å¼€æºé¡¹ç›®ï¼š<code>Yearning</code>ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»äº†è§£ä¸‹ã€‚</p><blockquote><p>è¯é¢˜æ‰¯å›æ¥ï¼Œæ­£å› å‰é¢æ‰€è®²ï¼Œåœ¨å½“å‰çš„é—®é¢˜ä¸‹ï¼Œè¿™äº›åŸºç¡€æ–¹æ¡ˆå®é™…ä¸Šå·²ç»å­˜åœ¨ï¼Œåœ¨è¿™é‡Œæ˜¾ç„¶æ˜¯ç”¨ä¸ä¸Šäº†ï¼ŒåŠ ä¸Šç´§æ€¥é—®é¢˜ç´§æ€¥å¤„ç†ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šæ—¶é—´ç»™ä½ å»å¯¹æ—¢æœ‰æ¶æ„å¤§åŠ¨å¹²æˆˆã€‚</p></blockquote><p>å› æ­¤ï¼Œå½“æ—¶ç«‹é©¬èƒ½æƒ³åˆ°ä¸”æœ‰æ•ˆçš„ä¸´æ—¶æ€§æ–¹æ¡ˆè¿…é€Ÿåœ¨å›¢é˜Ÿè®¨è®ºä¸­ç‡å…ˆå†’å‡ºæ¥ï¼Œå°±æ˜¯<code>æ•°æ®åº“åˆ†åŒº</code>ã€‚</p><h4 id="1ã€æ•°æ®åº“åˆ†åŒº"><a href="#1ã€æ•°æ®åº“åˆ†åŒº" class="headerlink" title="1ã€æ•°æ®åº“åˆ†åŒº"></a>1ã€æ•°æ®åº“åˆ†åŒº</h4><p>ç†è§£æ•°æ®åº“åˆ†åŒºï¼Œåªéœ€è¦è®°ä½ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>æ•°æ®åº“åˆ†åŒºæ˜¯æŠŠä¸€å¼ è¡¨çš„æ•°æ®<code>åˆ†åœ¨äº†ä¸åŒçš„ç¡¬ç›˜</code>ä¸Šï¼Œä½†ä»æ˜¯ä¸€å¼ è¡¨ï¼Œè¯´ç¡¬ç›˜å¯èƒ½ä¸å®Œå…¨å‡†ç¡®ï¼Œä½†å°±è¿™æ ·ç†è§£æ˜¯æœ€å®¹æ˜“çš„ã€‚</li><li>ä¸è¦æŠŠæ•°æ®åº“åˆ†åŒºå’Œåˆ†åº“åˆ†è¡¨æ··æ·†ï¼Œä¸€ä¸ªæ˜¯<code>æ•°æ®åº“çº§åˆ«</code>çš„æ“ä½œï¼Œä¸€ä¸ªæ˜¯<code>ä»£ç†å·¥å…·</code>çš„æ“ä½œï¼Œå‰è€…é™åˆ¶è¾ƒå¤šï¼Œåè€…æ›´çµæ´»ã€‚</li></ul><p>çŸ¥é“è¿™ä¸¤ç‚¹å…¶å®å°±è¶³å¤Ÿäº†ï¼Œæ•°æ®åº“åˆ†åŒºå’Œåˆ†åº“åˆ†è¡¨ä¹Ÿæ˜¯é¢è¯•ä¸­å–œæ¬¢é—®çš„ï¼Œå› ä¸ºç¡®å®æœ‰ä¸€äº›ç±»ä¼¼çš„åœ°æ–¹ã€‚</p><p>å¥½äº†ï¼Œæœ‰äº†åŸºæœ¬è®¤è¯†ï¼Œé‚£æ¥ä¸‹æ¥å°±è¯´ä¸‹æ•°æ®åº“åˆ†åŒºå¦‚ä½•æ“ä½œçš„ï¼Œå…ˆçœ‹ä¸ªå›¾æœ‰ä¸ªç”»é¢ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20241127164201217.png" alt=""></p><p>æ¥ç€ä¸¾ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€å¼ è®¢å•è¡¨ï¼Œé‚£ä¹ˆå¯¹è¿™å¼ è®¢å•è¡¨<code>æŒ‰ç…§å¹´ä»½è¿›è¡Œåˆ†åŒº</code>çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè®¢å•è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_number <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    order_date <span class="built_in">DATE</span>,</span><br><span class="line">    customer_id <span class="built_in">INT</span>,</span><br><span class="line">    total_amount <span class="built_in">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŒ‰ç…§å¹´ä»½å¯¹è®¢å•è¡¨è¿›è¡Œåˆ†åŒº</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> orders</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(<span class="keyword">YEAR</span>(order_date)) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p2018 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2019</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2019 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2020</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2020 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2021</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2021 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2022</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2022 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2023</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2023 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2024</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œæ•°æ®åº“å°±ä¼šå°†è¿™å¼ è¡¨çš„æ•°æ®<code>æŒ‰ç…§YEAR(order_date)çš„å€¼åˆ†åˆ«å­˜åœ¨ p2018 ~ p2023 è¿™6ä¸ªåˆ†åŒºä¸­</code>ã€‚</p><p>å¦‚æœç»“åˆæœ¬ç¯‡çš„é—®é¢˜ï¼Œ3000å¤šä¸‡æ¡è®°å½•ï¼Œé‚£ä¹ˆæŒ‰ç…§å¹´ä»½åˆ†åŒºï¼Œå¤§æ¦‚ä¸€ä¸ªåˆ†åŒºæ˜¯1000ä¸‡è®°å½•å·¦å³ï¼Œç„¶åå¯ä»¥ä¼˜åŒ–æŸ¥è¯¢è¯­å¥åªå»æ‰«æç‰¹å®šçš„åˆ†åŒºï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å°±è½»æ¾äº†å¾ˆå¤šã€‚</p><p>å†æ·±å…¥ç‚¹ï¼ŒæŒ‰ç…§å¹´ä»½ä¸€ä¸ªåˆ†åŒº1000ä¸‡è¿˜æ˜¯æœ‰ç‚¹å¤šäº†ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ›´åˆç†çš„åˆ†åŒºå­—æ®µï¼Œè®©æ¯ä¸ªåˆ†åŒºçš„æ•°æ®æ›´å°‘å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±è¦<code>ç»“åˆå®é™…ä¸šåŠ¡</code>äº†ï¼Œæ²¡æœ‰çœŸæ­£çš„é€šç”¨æ–¹æ¡ˆã€‚</p><p>ä½ è¦å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œåšåˆ†åŒºçš„ç›®çš„ï¼Œæœ€ç»ˆæ˜¯ä¸ºäº†è®©æŸä¸ªä¸šåŠ¡ç¯èŠ‚çš„æŸ¥è¯¢æ›´å¿«ï¼Œå°±æ¯”å¦‚æœ¬ç¯‡è¿™é‡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©å®¢æˆ·æŸ¥è¯¢è®¢å•ç›¸å…³ä¸šåŠ¡æ›´å¿«ï¼Œé‚£ä¹ˆä½ å°±è¦å…ˆæŠŠè¿™å—çš„æŸ¥è¯¢è¯­å¥æ‘˜å–å‡ºæ¥ï¼Œ<code>åˆ†æä¸€ä¸‹é‡Œé¢çš„whereæ¡ä»¶æœ‰å“ªäº›</code>ã€‚</p><ul><li><p>æ¯”å¦‚ï¼Œå®¢æˆ·è¦æŸ¥è¯¢æŸä¸ªæˆ–æŸäº›çŠ¶æ€çš„è®¢å•ï¼Œå¯èƒ½ä¼šè¿™æ ·å†™ï¼šwhere order_status in (?)ï¼›</p></li><li><p>æ¯”å¦‚ï¼Œå®¢æˆ·è¦æŸ¥è¯¢æŸä¸ªç‰¹å®šç¾¤ä½“çš„è®¢å•ï¼Œå¯èƒ½ä¼šè¿™æ ·å†™ï¼šwhere user_flag_id = ?ï¼›</p></li><li><p>æ¯”å¦‚ï¼Œå®¢æˆ·è¦æŸ¥è¯¢æŸä¸ªæˆ–å¤šä¸ªä¸šåŠ¡ç±»å‹çš„è®¢å•ï¼Œå¯èƒ½ä¼šè¿™æ ·å†™ï¼šwhere order_type in (?)ï¼›</p></li></ul><p>ç”šè‡³ï¼Œè¿˜å¯èƒ½æœ‰å…¶ä»–çš„ç»„åˆæ¡ä»¶æºæ‚è¿›æ¥ï¼Œä½ åƒä¸‡åˆ«ä»¥ä¸ºä½ å»çš„æ¯ä¸ªå…¬å¸éƒ½æŠŠè¡¨è®¾è®¡çš„å¾ˆæ¼‚äº®å¾ˆåˆç†ï¼Œæˆ‘è¿™ä¹ˆå¤šå¹´å·¥ä½œä¸‹æ¥ï¼ŒçœŸè§è¿‡ä¸å°‘å¥‡è‘©è®¾è®¡ï¼Œè®¢å•è¡¨é‡Œé¢èƒ½ç»™ä½ å¡ä¸ŠopenIdæˆ–è€…æŸäº›å•çº¯ä¸ºäº†æ–¹ä¾¿è€ŒåŠ çš„å†—ä½™å­—æ®µï¼Œå®Œå…¨æŠŠè®¢å•è¡¨è‡ªèº«çš„åŠŸèƒ½æ€§æ‰“ç¢ã€‚</p><blockquote><p>è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœåˆ†åŒºå­—æ®µæœ¬èº«å­˜åœ¨ï¼Œä¸”åˆšå¥½èƒ½æŠŠåˆ†åŒºæ•°æ®åˆ†çš„å¾ˆåˆç†ï¼Œæœ‰åˆ©äºæŸ¥è¯¢ï¼Œæ¯”å¦‚å‰é¢æŒ‰ç…§å¹´ä»½åˆ’åˆ†ï¼Œæ¯ä¸ªåˆ†åŒºå¦‚æœåªæœ‰ä¸¤ä¸‰ç™¾ä¸‡è®°å½•ï¼Œå†ç»“åˆæœ¬èº«çš„ç´¢å¼•ï¼ŒæŸ¥è¯¢å°±ä¼šå¾ˆå¿«ï¼Œé‚£ä¹ˆä¸€åˆ‡å®‰å¥½ï¼Œæå®Œæ”¶å·¥ã€‚</p><p>ä½†å¦‚æœåˆ†åŒºå­—æ®µå¾ˆéš¾å®šä½ï¼Œå°±åƒä¸Šé¢è®²çš„ï¼Œä¸€äº›ä¸»è¦SQLè¯­å¥çš„whereæ¡ä»¶å¹¶ä¸åŒ…å«ç›¸åŒçš„å­—æ®µï¼Œé‚£å°±å¤´å¤§äº†ã€‚</p></blockquote><p>è€Œä¸”MySQLè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯å®ƒçš„åˆ†åŒºæœ¬èº«æ˜¯æœ‰é™åˆ¶çš„ã€‚</p><blockquote><p>MySQLåˆ†åŒºå­—æ®µå¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–èƒ½ç”¨çš„å”¯ä¸€ç´¢å¼•ï¼Œæˆ‘ä»¬åªèƒ½ç»“åˆä¸»é”®IDï¼Œå’Œåˆ†åŒºå­—æ®µç»„æˆ<code>å¤åˆä¸»é”®</code>æ‰è¡Œã€‚</p><p>è¿™å°±æ›´éš¾äº†ï¼Œçº¯ç²¹çœ‹è¿™è¡¨é•¿ä»€ä¹ˆæ ·äº†ã€‚</p><p>è¯åˆ°è¿™é‡Œï¼Œå…¶å®å¤§å®¶ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œæ•°æ®åº“åˆ†åŒºçš„ä¼˜ç¼ºç‚¹å¾ˆæ˜æ˜¾ã€‚</p><blockquote><p>ä¼˜ç‚¹ï¼šé‡åˆ°åˆé€‚çš„åœºæ™¯ï¼Œä¼˜åŒ–èµ·æ¥å°±æ˜¯ä¸€ä¸ªå‘½ä»¤çš„äº‹æƒ…ã€‚</p><p>ç¼ºç‚¹ï¼šé™åˆ¶å¤ªå¤šï¼Œç¨å¾®å¤æ‚ä¸€ç‚¹çš„åœºæ™¯ä½ å°±å¾ˆéš¾å®šä½åˆ†åŒºå­—æ®µã€‚</p></blockquote><p>é‚£ä¹ˆï¼ŒçœŸçš„å°±æ²¡æ³•åˆ†äº†å—ï¼Ÿå…¶å®è¿˜æœ‰ä¸€ä¸ªè¿‚å›çš„æ–¹æ¡ˆã€‚</p><h4 id="2ã€è¿‚å›æ–¹æ¡ˆ"><a href="#2ã€è¿‚å›æ–¹æ¡ˆ" class="headerlink" title="2ã€è¿‚å›æ–¹æ¡ˆ"></a>2ã€è¿‚å›æ–¹æ¡ˆ</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨è¡¨ä¸­æ–°å¢ä¸€ä¸ªä¸“é—¨ä¸ºäº†åˆ†åŒºè€Œé‡èº«å®šåšçš„å­—æ®µï¼Œæ¯”å¦‚archive_flagï¼Œè¡¨ç¤ºä¸€ç§æ•°æ®<code>å½’æ¡£çŠ¶æ€</code>ï¼Œå½“<code>å€¼ä¸º1æ—¶è¡¨ç¤ºå·²å½’æ¡£ï¼Œå€¼ä¸º0æ—¶è¡¨ç¤ºæœªå½’æ¡£</code>ã€‚</p><p>è¿™ä¸ªå­—æ®µå¯ä»¥æ²¡æœ‰ä¸šåŠ¡æ„ä¹‰ï¼Œä½†ä¸€å®šè¦æœ‰åˆ†åŒºæ„ä¹‰ã€‚</p><blockquote><p>æˆ‘ä»¬å¯ä»¥æŠŠåŠå¹´å†…çš„æ•°æ®åˆ·æˆ archive_flag=0ï¼ŒåŠå¹´ä»¥å¤–çš„æ•°æ®åˆ·æˆ archive_flag=1ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ç…§å½’æ¡£çŠ¶æ€è¿›è¡Œåˆ†åŒºå³å¯ï¼ŒåŠå¹´å†…çš„æ´»è·ƒæ•°æ®æ˜¯ä¸€ä¸ªåˆ†åŒºï¼Œå…¶ä»–éæ´»è·ƒæ•°æ®æ˜¯ä¸€ä¸ªåˆ†åŒºã€‚</p><p>æœ€åï¼Œåªéœ€è¦æŠŠæ ¸å¿ƒçš„æŸ¥è¯¢è¯­å¥whereæ¡ä»¶ä¸­éƒ½æ–°å¢ä¸€ä¸ª archive_flag=0 å°±å¯ä»¥äº†ï¼Œè¿™æ ·å°±ä¼šæ‰«æè¿™ä¸ªéå½’æ¡£çŠ¶æ€çš„åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯æ´»è·ƒæ•°æ®çš„åˆ†åŒºã€‚</p></blockquote><p>è¯•æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªåˆ†åŒºåªæœ‰åŠå¹´çš„è®°å½•ï¼ŒæŒ‰ç…§æœ¬ç¯‡çš„åœºæ™¯ï¼Œæœ€å¤šä¹Ÿå°±æ˜¯500ä¸‡äº†ï¼Œç»“åˆè‡ªèº«è¡¨ç´¢å¼•ï¼Œå·²ç»å®Œå…¨å¯ä»¥è§£å†³å½“å‰å­˜åœ¨çš„é—®é¢˜ã€‚</p><p>å¥½äº†ï¼Œè¿™ä¸ªè¿‚å›æ–¹æ¡ˆå…¶å®æŒºä¸é”™çš„ï¼Œä½†ä¸€å®šæœ‰äººä¼šæœ‰ç–‘é—®ã€‚</p><p>1ï¼‰ã€åŠ å­—æ®µçœŸçš„å¥½å—ï¼Ÿ</p><p>2ï¼‰ã€ä¸ºä»€ä¹ˆä¸€å®šè¦åŠå¹´å†…çš„æ•°æ®ï¼Ÿ</p><p>é¦–å…ˆè§£ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ä¸å¥½ï¼Œåœ¨æˆ‘è¿™é‡Œçš„è¯ç”šè‡³å¯ä»¥è¯´éå¸¸ä¸å¥½ï¼Œå‡ åƒä¸‡æ•°æ®é‡çš„è¡¨ï¼Œä¸ºäº†è§£å†³ä¸€ä¸ªæŸ¥è¯¢é—®é¢˜åˆ»æ„æ–°å¢ä¸€ä¸ªæ²¡æœ‰å®é™…æ„ä¹‰çš„å­—æ®µï¼Œæ˜¯èˆæœ¬é€æœ«çš„è¡Œä¸ºï¼Œ<code>å¦‚æœé™¤äº†è¿™å¼ è¡¨ï¼Œè¿˜æœ‰å…¶ä»–è¡¨ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œéš¾é“æ¯ä¸ªéƒ½è¦åŠ å­—æ®µå—ï¼Ÿæ˜¾ç„¶æ˜¯ä¸å¯è¡Œï¼Œä¹Ÿæ˜¯ä¸å®‰å…¨çš„</code>ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒåŠå¹´å†…çš„æ•°æ®å®Œå…¨å¯ä»¥ç»“åˆå®é™…ä¸šåŠ¡åšä¿®æ”¹ã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ å¦‚æœç»å¸¸é€›äº¬ä¸œå•†åŸè´­ç‰©ï¼Œä¸€å®šä¼šæ‰“å¼€æˆ‘çš„è®¢å•çœ‹çœ‹ï¼Œå®é™…ä¸Šç»™ä½ å±•ç¤ºçš„å°±æ˜¯è¿‘3ä¸ªæœˆçš„è®¢å•ï¼Œä½ å¯ä»¥ç†è§£æˆè¿™å°±æ˜¯éå½’æ¡£çš„æ´»è·ƒæ•°æ®ã€‚</p><p>å½“ä½ æƒ³æŸ¥è¯¢ä»¥å‰çš„è®°å½•æ—¶ï¼Œå°±ä¼šç»™ä½ ä¸€ä¸ªé“¾æ¥å«å†å²è®°å½•ï¼Œç‚¹å‡»åè·³è½¬åˆ°å†å²è®°å½•åˆ—è¡¨ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–æ–¹å¼å¦‚ä¸‹æ‹‰æ¡†ï¼Œè®©ä½ é€‰æ‹©å…¶ä»–æ›´æ—©æ—¶é—´çš„è®¢å•æ•°æ®ï¼Œè¿™ç§å…¶å®å°±æ˜¯å·²ç»å½’æ¡£çš„æ•°æ®ã€‚</p><p>è¿™äº›æ•°æ®ä¸€èˆ¬ä¸ä¼šç›´æ¥ä»ä¸šåŠ¡è¡¨é‡ŒæŸ¥å‡ºæ¥ï¼Œè€Œæ˜¯ä»å…¶ä»–å½’æ¡£è¡¨ï¼Œæˆ–è€…éå…³ç³»å‹æ•°æ®åº“å¦‚mongodbã€EasticSearchç­‰æŸ¥è¯¢å‡ºæ¥ã€‚</p><blockquote><p>è¿™ç§æ–¹å¼å°±ç±»ä¼¼åšäº†åˆ†åŒºï¼ŒæŠŠä½ ç»å¸¸è®¿é—®çš„æ•°æ®å’Œè®¿é—®é¢‘ç‡è¾ƒä½çš„æ•°æ®åˆ†å¸ƒå­˜å‚¨ï¼Œè¾¾åˆ°ä¸€ä¸ªæ•°æ®åˆ†ç¦»çš„ç›®çš„ã€‚</p></blockquote><p>è¿™æ ·ä½ å°±æ‡‚äº†ï¼Œæ•°æ®åˆ†åŒºå¤§ä½“å°±æ˜¯è¿™æ ·çš„æ€è€ƒæ–¹å¼ã€‚</p><p>ç°åœ¨å›è¿‡å¤´æ¥æƒ³æƒ³å‰é¢è¯´çš„ä¼˜ç¼ºç‚¹ï¼Œæ•°æ®åº“åˆ†åŒºçœŸçš„åˆé€‚å—ï¼Ÿ</p><blockquote><p>å®é™…æƒ…å†µä¸‹ï¼Œå¾ˆå°‘æœ‰æƒ…å†µåˆé€‚ï¼Œä¸»è¦åŸå› è¿˜æ˜¯å‰é¢è®²è¿‡çš„ï¼Œé™åˆ¶çœŸçš„å¤ªå¤šäº†ï¼Œè€Œä¸šåŠ¡å¾€å¾€åˆæ˜¯å¤æ‚çš„ã€‚</p><p>å¦å¤–ï¼Œæ•°æ®åº“åˆ†åŒºå¯¹äºå¾ˆå¤šç¨‹åºå‘˜æ¥è¯´ï¼Œå…¶å®æ˜¯é™Œç”Ÿçš„ï¼Œåœ¨ä¸­å°ä¼ä¸šæ›´æ˜¯å¦‚æ­¤ï¼Œæœ‰è¿™æ ·çš„ç°å®æ‘†åœ¨é¢å‰ï¼ŒåŠ ä¸ŠçŸ­æœŸå†…å°±è¦è§£å†³é—®é¢˜ï¼Œéšä¾¿ä½¿ç”¨çš„è¯å¯¹äºå›¢é˜Ÿæ¥è®²ä¹Ÿæ˜¯ä¸€ç§é£é™©ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œå¦ä¸€ç§æ›´åˆç†çš„æ–¹æ¡ˆä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œ<code>æ•°æ®çš„å†·çƒ­åˆ†ç¦»</code>ã€‚</p><h4 id="3ã€å†·çƒ­åˆ†ç¦»"><a href="#3ã€å†·çƒ­åˆ†ç¦»" class="headerlink" title="3ã€å†·çƒ­åˆ†ç¦»"></a>3ã€å†·çƒ­åˆ†ç¦»</h4><p>å‰é¢è®²äº†é‚£ä¹ˆå¤šï¼Œå…¶å®å°±æ˜¯ä¸ºäº†è¿‡æ¸¡åˆ°è¿™é‡Œæ¥ï¼Œä¸Šé¢çš„è¿‚å›æ–¹æ¡ˆæˆ–å¤šæˆ–å°‘å·²ç»æ‘¸åˆ°äº†å†·çƒ­åˆ†ç¦»çš„è¾¹ç¼˜ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©å¤§å®¶çŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><h5 id="1ï¼‰ã€åŸºæœ¬æ¦‚å¿µ"><a href="#1ï¼‰ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ï¼‰ã€åŸºæœ¬æ¦‚å¿µ"></a>1ï¼‰ã€åŸºæœ¬æ¦‚å¿µ</h5><p>å†·çƒ­åˆ†ç¦»å¬èµ·æ¥å¾ˆé«˜ç«¯ï¼Œå…¶å®æœ¬è´¨å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ<code>æ´»è·ƒæ•°æ®</code>å’Œ<code>éæ´»è·ƒæ•°æ®</code>åŒºåˆ†å¼€ï¼Œä¸€çƒ­ä¸€å†·ï¼Œé¢‘ç‡é«˜çš„æŸ¥è¯¢åªæ“ä½œçƒ­æ•°æ®ï¼Œé¢‘ç‡ä½çš„åªæ“ä½œå†·æ•°æ®ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20241127165112476.png" alt=""></p><h5 id="2ï¼‰ã€å­˜å‚¨æ–¹æ¡ˆ"><a href="#2ï¼‰ã€å­˜å‚¨æ–¹æ¡ˆ" class="headerlink" title="2ï¼‰ã€å­˜å‚¨æ–¹æ¡ˆ"></a>2ï¼‰ã€å­˜å‚¨æ–¹æ¡ˆ</h5><p>æ—¢ç„¶è¦åˆ†ç¦»ï¼Œå°±è¦è€ƒè™‘æ¸…æ¥šçƒ­æ•°æ®å’Œå†·æ•°æ®åˆ†åˆ«æ”¾åœ¨å“ªé‡Œã€‚</p><p>è¿™é‡Œæˆ‘æä¾›ä¸¤ç§é€‰æ‹©ï¼š</p><blockquote><p>ä¸­å°ä¼ä¸šï¼Œæˆ‘æ¨èä¾ç„¶ç”¨MySQLã€‚</p></blockquote><p>ä¸€æ¥æ˜¯ä¸éœ€è¦é¢å¤–æˆæœ¬ï¼ˆé™æœ¬å¢æ•ˆï¼Ÿå“ˆå“ˆï¼‰ï¼ŒäºŒæ¥æ˜¯ä¸­å°ä¼ä¸šç›¸å¯¹å¤§å‚ï¼Œä¸šåŠ¡å¤æ‚åº¦ä½ä¸€ç‚¹ä¸”æ•°æ®é‡å°å¾ˆå¤šï¼Œé‚£ä¹ˆæ­¤æ—¶å®Œå…¨å¯ä»¥ç”¨MySQLæ–°å¢ä¸€å¼ è¡¨æ¥å­˜å‚¨æŸä¸ªä¸šåŠ¡çš„å†·æ•°æ®ï¼Œæ¯”å¦‚è®¢å•ã€‚</p><p>å¦‚æœéœ€è¦å†·çƒ­åˆ†ç¦»çš„ä¸šåŠ¡è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥å»ºä¸€ä¸ªå•ç‹¬çš„å†·åº“ï¼Œæ¥ä¸“é—¨å­˜æ”¾å†·æ•°æ®ï¼Œä¸è¿‡è¿™ç§æˆ‘ä¹Ÿä¸å¤ªæ¨èï¼Œå› ä¸ºæ¶‰åŠåˆ°è·¨åº“æŸ¥è¯¢ï¼Œå¢åŠ äº†ç»´æŠ¤éš¾åº¦ï¼Œå’±ä»¬ç¨‹åºå‘˜å°½é‡å¯¹è‡ªå·±å¥½ä¸€ç‚¹å“ˆã€‚</p><p>ä¸€ä¸ªé¡¹ç›®é‡Œé¢ï¼Œå…¶å®ä¸¤ä¸‰å¼ å†·è¡¨çš„å‡ºç°å·²ç»å¯ä»¥å¤„ç†æ ¸å¿ƒä¸šåŠ¡æ•°æ®å†·çƒ­åˆ†ç¦»çš„é—®é¢˜äº†ï¼Œå¦‚æœçœŸæœ‰é‚£ä¹ˆå¤šå¤§æ•°æ®çš„è¡¨ï¼Œæˆ‘è§‰å¾—è¦ä»å…¶ä»–æ–¹é¢æ‰¾é—®é¢˜äº†ï¼ˆä¸€äº›è€é¡¹ç›®ï¼Œè®¾è®¡ä¸Šæœ¬èº«æœ‰é—®é¢˜ï¼Œé‚£æ˜¯çœŸçš„æ²¡å¥½åŠæ³•ï¼‰ã€‚</p><blockquote><p>å¤§å‚ï¼Œæ¨è<code>HBase</code>ã€‚</p></blockquote><p>å¤§å‚çš„èµ„æºè¾ƒå¤šï¼Œå¹³å°è¾ƒå¤§ï¼Œå†·çƒ­åˆ†ç¦»ä¸å•æ˜¯è§£å†³è¿™ç§é—®é¢˜çš„å”¯ä¸€æ–¹æ¡ˆï¼Œä½†å¤§å‚æ¯”è¾ƒæ¨èæ›´åˆé€‚çš„æ•°æ®åº“æ¥å­˜å‚¨è¿™æ ·çš„å†·æ•°æ®ã€‚</p><p>å…¶ä¸­HBaseæ˜¯æˆ‘ä»å„ç§èµ„æ–™ä¸­è§è¿‡çš„æœ€å¤šçš„ä¸€ç§ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–çš„ï¼Œä½†HBaseåº”è¯¥æ˜¯é‡Œé¢æœ€å—æ¬¢è¿çš„ä¸€ç±»ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä¸ªäººæ˜¯æ²¡æœ‰å¤§å‚ç»éªŒçš„ï¼Œæˆ‘åªèƒ½æŠŠæˆ‘æŒæ¡åˆ°çš„è®¯æ¯å‘Šè¯‰ä½ ä»¬ã€‚</p><p>å¦‚æœæœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å»å­¦ä¹ ä¸‹HBaseï¼Œå®ƒæ˜¯ä¸€ç§åœ¨ <code>Hadoop</code> ä¸Šæ„å»ºçš„åˆ†å¸ƒå¼ã€å¯æ‰©å±•çš„åˆ—å¼æ•°æ®åº“ã€‚</p><p>å®ƒæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯<code>å¿«é€Ÿè¯»å†™æµ·é‡æ•°æ®</code>ï¼Œä¸”å…·æœ‰<code>å¼ºä¸€è‡´æ€§</code>ã€‚</p><p>ä¸€èˆ¬å¤§å‚å¯¹äºå†·æ•°æ®çš„å¤„ç†ï¼Œå¾€å¾€éƒ½æ˜¯å› ä¸ºå†·æ•°æ®åœ¨ä¸šåŠ¡ä¸­ä¹Ÿæœ‰ç›¸å½“çš„æŸ¥è¯¢ä½“é‡ï¼Œå¦‚æœå¤ªæ…¢ä¹Ÿä¸ç¬¦åˆå¤§å‚ç»´æŠ¤é¡¹ç›®çš„æ ‡å‡†ï¼Œæ‰€ä»¥æœ‰å¿…è¦ä¸“é—¨ä¼˜åŒ–ã€‚</p><p>å¥½äº†ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥æåˆ°<code>HBase</code>ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‰©å……å¤§å®¶çš„çŸ¥è¯†é¢ï¼Œå…¶å®ä¸­å°ä¼ä¸šçš„å·¥ç¨‹å¸ˆä¹Ÿæ²¡å•¥å¿…è¦ç‰¹åœ°å»å­¦ï¼Œä¾é è‡ªèº«å…´è¶£é©±åŠ¨å³å¯ã€‚</p><h5 id="3ï¼‰ã€åŒºåˆ†å†·çƒ­æ•°æ®"><a href="#3ï¼‰ã€åŒºåˆ†å†·çƒ­æ•°æ®" class="headerlink" title="3ï¼‰ã€åŒºåˆ†å†·çƒ­æ•°æ®"></a>3ï¼‰ã€åŒºåˆ†å†·çƒ­æ•°æ®</h5><p>æ—¢ç„¶è¦å†·çƒ­åˆ†ç¦»ï¼Œé‚£ä¹ˆä¸€å¼ è¡¨ä¸­ï¼Œå¦‚ä½•åŒºåˆ†å“ªäº›æ˜¯çƒ­æ•°æ®ï¼Œå“ªäº›æ˜¯å†·æ•°æ®ï¼Ÿ</p><blockquote><p>è¦åˆ†æè¿™å¼ è¡¨çš„<code>å­—æ®µç‰¹å¾</code>ï¼Œæ‹¿è®¢å•è¡¨ä¸¾ä¾‹ï¼Œé©¬ä¸Šèƒ½æƒ³åˆ°çš„å°±æ˜¯ï¼šè®¢å•çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ã€‚</p></blockquote><p>è®¢å•çŠ¶æ€çš„è¯ï¼Œå…¶å®ä¹Ÿç±»ä¼¼äºå‰é¢æ•°æ®åº“åˆ†åŒºæè¿‡çš„å½’æ¡£çŠ¶æ€ï¼Œä½ å¯ä»¥å°†çŠ¶æ€æ˜¯<code>å·²å®Œæˆ</code>çš„æ•°æ®å½’ç±»ä¸ºå†·æ•°æ®ï¼Œè€Œ<code>å¾…å¤„ç†</code>ã€<code>å¤„ç†ä¸­</code>çš„éƒ½å½’ç±»ä¸ºçƒ­æ•°æ®ï¼Œè¿™ä¸ªè¦è§†ä½ ä»¬è‡ªå·±çš„ä¸šåŠ¡å†³å®šã€‚</p><p>åˆ›å»ºæ—¶é—´çš„è¯ï¼Œå°±æ¯”è¾ƒå¸¸è§äº†ï¼Œä¹Ÿæ˜¯æˆ‘æ¨èä¸­å°ä¼ä¸šä½¿ç”¨çš„æ–¹æ³•ï¼Œå› ä¸º<code>å‡ ä¹æ‰€æœ‰çš„æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼Œéƒ½ä¸€å®šä¼šæœ‰åˆ›å»ºæ—¶é—´è¿™ä¸ªå­—æ®µ</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæŸ¥è¯¢é¢‘ç¹çš„æ—¶é—´åŒºé—´çš„æ•°æ®å½’ç±»ä¸ºçƒ­æ•°æ®ï¼Œå…¶ä»–æ—¶é—´éƒ½å½’ç±»ä¸ºå†·æ•°æ®ã€‚</p><p>æ¯”å¦‚æœ¬ç¯‡æˆ‘è®²çš„æ¡ˆä¾‹ï¼Œå½“æ—¶æˆ‘ä»¬å…¬å¸å°±æ˜¯åŠå¹´å†…çš„æ•°æ®æ˜¯æŸ¥è¯¢éå¸¸é¢‘ç¹çš„ï¼Œå› æ­¤ç›´æ¥æŒ‰ç…§æœ€è¿‘åŠå¹´ä½œä¸ºåŒºåˆ†å†·çƒ­æ•°æ®çš„è§„åˆ™ã€‚</p><h5 id="4ï¼‰ã€å¦‚ä½•å†·çƒ­åˆ†ç¦»"><a href="#4ï¼‰ã€å¦‚ä½•å†·çƒ­åˆ†ç¦»" class="headerlink" title="4ï¼‰ã€å¦‚ä½•å†·çƒ­åˆ†ç¦»"></a>4ï¼‰ã€å¦‚ä½•å†·çƒ­åˆ†ç¦»</h5><p>è¿™é‡Œæœ‰å››ç§æ–¹æ¡ˆï¼š</p><ul><li>ä»£ç ä¸­å¤„ç†</li></ul><blockquote><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚è®¢å•è¡¨ä¸­ï¼Œå½“çŠ¶æ€ä»å¤„ç†ä¸­æ”¹ä¸ºå·²å®Œæˆæ—¶ï¼Œä½ å°±å¯ä»¥å°†è¿™æ¡è®°å½•å½’ç±»ä¸ºå†·æ•°æ®ï¼Œæ”¾åˆ°å†·è¡¨æˆ–å†·åº“ä¸­ã€‚</p><p>ä¼˜ç‚¹æ˜¯å¾ˆçµæ´»ï¼Œè€Œä¸”å®æ—¶æ€§é«˜ã€‚</p><p>ç¼ºç‚¹æ˜¯ç›¸å…³çš„ä»£ç ä½ç½®ä½ éƒ½è¦åšä¿®æ”¹ï¼Œå¦å¤–å¦‚æœæ˜¯æŒ‰ç…§æ—¶é—´åšå†·çƒ­åˆ†ç¦»ï¼Œè¿™ä¸ªæ–¹æ¡ˆåŸºæœ¬å°±ä¸å¯å–ã€‚</p><p>ä½ æƒ³æƒ³ï¼Œä½ æ€ä¹ˆåˆ¤æ–­å‘¢ï¼Ÿæˆ‘ä»¬æŒ‰ç…§åŠå¹´å†…çš„æ•°æ®ä½œä¸ºçƒ­æ•°æ®ï¼Œé‚£ä¹ˆä½ åœ¨å“ªä¸ªæ–¹æ³•å“ªä¸ªäº‹ä»¶è§¦å‘æ—¶å°†è¿™ç¬”è®¢å•å½’ç±»ä¸ºå†·æ•°æ®ï¼Ÿå¯ä»¥è¯´åšä¸åˆ°ã€‚</p></blockquote><ul><li>ä»»åŠ¡è°ƒåº¦å¤„ç†</li></ul><blockquote><p>è¿™ç§å°±æ˜¯å®šæ—¶ä»»åŠ¡å»æ‰«ææ•°æ®åº“ï¼Œæ¯”å¦‚xxl-jobï¼Œæ–°å»ºä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ï¼Œå®šæ—¶å»æ‰«ææ•°æ®åº“ï¼Œåˆ¤æ–­å“ªäº›æ˜¯å†·æ•°æ®ï¼Œç„¶åå½’æ¡£åˆ°å†·è¡¨æˆ–å†·åº“ä¸­å»ã€‚</p><p>è¿™ç§çš„ä¼˜ç‚¹ï¼Œä¸€æ¥æ˜¯ä¸ç”¨å¤§é‡ä¿®æ”¹ä»£ç ï¼ŒäºŒæ¥å°±æ˜¯éå¸¸é€‚åˆæŒ‰ç…§æ—¶é—´åˆ’åˆ†å†·çƒ­æ•°æ®çš„åœºæ™¯ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ç§å»¶è¿Ÿå¤„ç†æ–¹å¼ï¼Œä½ å¯ä»¥è®¾ç½®ä¸ºåŠå¤œå»è¿è¡Œã€‚</p><p>æ¯”å¦‚æˆ‘ä¹‹å‰çš„é‚£å®¶å…¬å¸ï¼Œå°±æ˜¯è®¾ç½®ä¸ºå‡Œæ™¨ä»¥åæ‰§è¡Œï¼Œå› ä¸ºé‚£ä¸ªæ—¶å€™å¾ˆå°‘æœ‰ç”¨æˆ·åœ¨ä½¿ç”¨äº†ï¼Œæ²¡æœ‰ä»€ä¹ˆæ–°çš„è®¢å•äº§ç”Ÿï¼Œå“ªæ€•æœ‰æ–°çš„è®¢å•ï¼Œä¹Ÿå±äºè¯¯å·®èŒƒå›´å†…ï¼Œå¯ä»¥æ¥å—ã€‚</p></blockquote><ul><li>ç›‘å¬binlog</li></ul><blockquote><p>è¿™ç§æ–¹æ¡ˆæˆ‘æ˜¯ä»ä¹¦æœ¬ä¸Šè·å–åˆ°çš„ï¼Œç»™æˆ‘æ¶¨äº†ç‚¹çŸ¥è¯†ã€‚</p><p>ç›‘å¬binlogçš„ç›®çš„è¯´ç™½äº†ï¼Œå°±æ˜¯åˆ¤æ–­è®¢å•çŠ¶æ€æ˜¯å¦å˜åŒ–ï¼Œå’Œä»£ç ä¸­å¤„ç†å¾ˆç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œ<code>å¦‚æœä½ ç»´æŠ¤çš„è¿™ä¸ªé¡¹ç›®åˆè€åˆå¤æ‚ï¼Œä»£ç å¾ˆéš¾æ”¹ä¹Ÿæ”¹ä¸å…¨</code>ï¼Œç›‘å¬binlogå°±æ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆäº†ï¼Œä½ å¯ä»¥ä¸æ”¹ä»£ç ï¼Œç›‘å¬æ•°æ®åº“å˜æ›´æ—¥å¿—ç„¶ååšç›¸åº”å¤„ç†å³å¯ã€‚</p><p>å½“ç„¶ï¼Œç¼ºç‚¹å’Œå‰é¢ä¸€æ ·ï¼Œå½“æŒ‰ç…§æ—¶é—´æ¥åˆ’åˆ†å†·çƒ­æ•°æ®æ—¶ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿä¸å¯å–ï¼Œå› ä¸ºä½ ä¸çŸ¥é“å¦‚ä½•ç›‘å¬ã€‚</p></blockquote><ul><li>äººå·¥è¿ç§»</li></ul><blockquote><p>å†·çƒ­åˆ†ç¦»æ“ä½œçš„æœ€ç»ˆè¿˜æ˜¯æ•°æ®ï¼Œåˆ†ç¦»å®è´¨ä¸Šä¹Ÿå°±æ˜¯ä¸€ç§æ•°æ®è¿ç§»ï¼Œå› æ­¤ï¼Œäººå·¥å¹²é¢„å…¶å®æ˜¯å¾ˆé è°±çš„é€‰æ‹©ã€‚</p><p>ä¸Šé¢æ¯ç§æ–¹æ¡ˆéƒ½æœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼Œä½†ä¹Ÿæœ‰å„è‡ªçš„å±€é™æ€§ã€‚</p><p>ä»£ç å¤„ç†ï¼Œä½ åªèƒ½å¤„ç†å‘å¸ƒä¸Šçº¿ä»¥åçš„æ–°æ•°æ®ã€‚</p><p>ä»»åŠ¡è°ƒåº¦ï¼Œå½“æ•°æ®é‡åºå¤§çš„æƒ…å†µä¸‹ï¼Œä½ ä¸€æ¬¡å¯èƒ½æ ¹æœ¬æ— æ³•å®Œæˆåˆ†ç¦»ï¼Œå¯¹äºç´§æ€¥çš„è¦å¿«é€Ÿä¼˜åŒ–çš„åœºæ™¯æ˜¾ç„¶ä¸é€‚åˆã€‚</p><p>ç›‘å¬binlogï¼Œé™¤äº†å‰é¢æåˆ°çš„ç¼ºç‚¹ï¼Œè¿˜éœ€è¦å·¥ç¨‹å¸ˆå¯¹å…¶æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¦åˆ™çŸ­æ—¶é—´å†…ä¸Šæ‰‹å®¹æ˜“å¸¦æ¥ä¸ç¡®å®šæ€§ã€‚</p><p>æ­¤æ—¶ï¼ŒDBAæˆ–é›†æˆå·¥ç¨‹å¸ˆ(ä¿—ç§°æ‰“æ‚å·¥ç¨‹å¸ˆ)çš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ï¼Œå¤‡ä»½åï¼ŒæŠ½æŸå¤©æ™šä¸Šï¼Œç›´æ¥æŠŠåŠå¹´ä»¥å¤–çš„æ•°æ®è¿ç§»åˆ°å†·åº“å³å¯ã€‚</p><p>è¿™æ ·ä¸ä»…ç®€å•ï¼Œä¹Ÿé¿å…äº†å…¶ä»–æŠ€æœ¯æ–¹æ¡ˆå¯èƒ½å­˜åœ¨çš„é—®é¢˜åŠé£é™©ã€‚ä¸“ä¸šçš„äººï¼Œåšä¸“ä¸šçš„äº‹ï¼Œæ‰æ˜¯æœ€é è°±çš„ã€‚</p></blockquote><h4 id="4ã€æœ€ç»ˆæ–¹æ¡ˆ"><a href="#4ã€æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="4ã€æœ€ç»ˆæ–¹æ¡ˆ"></a>4ã€æœ€ç»ˆæ–¹æ¡ˆ</h4><p>é€šè¿‡ä¸Šé¢ç®€è¿°çš„å‡ ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†è¾ƒä¸ºæ¸…æ™°çš„è®¤çŸ¥ã€‚</p><blockquote><p>ç°åœ¨æˆ‘å¯ä»¥å‘Šè¯‰å¤§å®¶ï¼Œå½“åˆçš„å…¬å¸æ‰€é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯å…¶ä¸­ä¸¤ç§æ–¹æ¡ˆçš„ç»“åˆï¼š<code>äººå·¥è¿ç§» + ä»»åŠ¡è°ƒåº¦</code>ã€‚</p></blockquote><p>äººå·¥è¿ç§»ç”¨äºä¸€æ¬¡è¿ç§»å®Œæˆå†·æ•°æ®åˆ°å†·åº“ï¼Œä»»åŠ¡è°ƒåº¦ç”¨äºå¯¹åç»­æ–°äº§ç”Ÿçš„æ•°æ®è¿›è¡Œè§£è€¦ä¸”å»¶è¿Ÿçš„å†·çƒ­åˆ†ç¦»ã€‚</p><p>æ€ç»´å¯¼å›¾å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20241127165241076.png" alt=""></p><p>åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>1ã€å®šä½å†·çƒ­åˆ†ç¦»çš„è§„åˆ™ï¼Œæ¯”å¦‚æœ¬ç¯‡ï¼Œå°±æ˜¯æŒ‰ç…§è®¢å•äº¤æ˜“å®Œæˆæ—¶é—´ï¼Œä»¥åŠå¹´å†…å’ŒåŠå¹´å¤–ä½œä¸ºåˆ†ç¦»çš„åŸºå‡†ï¼›</p></li><li><p>2ã€å†·æ•°æ®è¿ç§»ï¼Œç”±å…¬å¸çš„DBAæˆ–é›†æˆå·¥ç¨‹å¸ˆå¯¹æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œç„¶ååœ¨å‘å¸ƒå½“æ™šå°†å†·æ•°æ®è¿ç§»åˆ°å†·åº“ä¸­å»ï¼›</p></li><li><p>3ã€å¼€å‘äººå‘˜æ–°å»ºä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ï¼Œå¹¶å®ç°ä»»åŠ¡è°ƒç”¨çš„æ¥å£ï¼Œä¸“é—¨æ‰«ææ•°æ®åº“ï¼Œå°†è¶…è¿‡åŠå¹´çš„è®¢å•æ•°æ®é€šè¿‡ç¨‹åºé€»è¾‘è¿ç§»åˆ°å†·åº“ï¼Œä¿è¯çƒ­æ•°æ®ä¸€ç›´ç»´æŒåœ¨åŠå¹´å†…ï¼Œä»»åŠ¡å¯ä»¥æ¯å¤©å‡Œæ™¨æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–æ ¹æ®è‡ªèº«ä¸šåŠ¡å†³å®šè°ƒåº¦é¢‘ç‡ã€‚</p></li></ul><blockquote><p>è¿™æ ·ä¸€æ¥ï¼Œæ—¢è§£å†³äº†å†·çƒ­åˆ†ç¦»è§„åˆ™çš„é—®é¢˜ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆè§„åˆ™ï¼Œä½ æœ€ç»ˆéƒ½å¯ä»¥é€šè¿‡äººå·¥è¿ç§»æ•°æ®æ¥åšåˆ°åˆ†ç¦»ã€‚</p><p>ä¹Ÿè§£å†³äº†æ—¶é—´ä¸Šçš„ç´§è¿«æ€§ï¼Œä½ åªéœ€è¦å¼€å‘ä¸€ä¸ªç”¨äºè°ƒåº¦çš„æ¥å£ï¼Œä¸å†éœ€è¦è€ƒè™‘å…¶ä»–ä»»ä½•æŠ€æœ¯å±‚é¢çš„å½±å“ï¼Œæ—¶é—´æˆå€ç¼©çŸ­ã€‚</p></blockquote><p>è¿™åœ¨ä¸­å°ä¼ä¸šç®—æ˜¯æ¯”è¾ƒé€‚åˆçš„æ–¹æ¡ˆäº†ï¼Œå½“åˆæˆ‘ä»¬åœ¨ä¸€å‘¨å†…å°±ä¼˜åŒ–å®Œæˆäº†ï¼Œç ”å‘å·¥ç¨‹å¸ˆç”¨äº†<code>1å¤©å®Œæˆè°ƒåº¦æ¥å£çš„å®ç°</code>ï¼Œå‰©ä¸‹çš„æ—¶é—´éƒ½æ˜¯é›†æˆå·¥ç¨‹å¸ˆ<code>è¿›è¡Œæ•°æ®è¿ç§»çš„æ¼”ç»ƒ</code>ã€‚</p><p>æœ€ç»ˆå®¢æˆ·è¿˜æ˜¯å¾ˆæ»¡æ„çš„ï¼Œæ ¸å¿ƒä¸šåŠ¡çš„æŸ¥è¯¢é€Ÿåº¦ä¸€ä¸‹å°±<code>æå‡äº†è¿‘10å€</code>ã€‚</p><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>å¥½äº†ï¼Œä¸´è¿‘å°¾å£°ï¼Œæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹å†·çƒ­åˆ†ç¦»æ–¹æ¡ˆæ•´ä½“çš„ä¼˜ç¼ºç‚¹å§ã€‚</p><h4 id="1ã€ä¼˜ç‚¹"><a href="#1ã€ä¼˜ç‚¹" class="headerlink" title="1ã€ä¼˜ç‚¹"></a>1ã€ä¼˜ç‚¹</h4><p>ä¼˜ç‚¹æˆ‘å½’çº³äº†3ç‚¹ï¼š</p><h5 id="1ã€æé«˜æ€§èƒ½"><a href="#1ã€æé«˜æ€§èƒ½" class="headerlink" title="1ã€æé«˜æ€§èƒ½"></a>1ã€æé«˜æ€§èƒ½</h5><p>å¾ˆæ˜æ˜¾ï¼Œå†·çƒ­åˆ†ç¦»åï¼Œå°†æ›´å¤š<code>è®¡ç®—èµ„æºé›†ä¸­åœ¨äº†çƒ­æ•°æ®</code>ä¸Šï¼Œå°†æŸ¥è¯¢æ€§èƒ½æœ€å¤§åŒ–ã€‚</p><h5 id="2ã€é™ä½æˆæœ¬"><a href="#2ã€é™ä½æˆæœ¬" class="headerlink" title="2ã€é™ä½æˆæœ¬"></a>2ã€é™ä½æˆæœ¬</h5><p>å¯¹äºåƒä¸‡çº§çš„æ•°æ®è¡¨ï¼Œå†·çƒ­åˆ†ç¦»æ–¹æ¡ˆ<code>ä¸éœ€è¦é¢å¤–çš„ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</code>ï¼Œæå¤§åœ°èŠ‚çº¦äº†æˆæœ¬ã€‚å°¤å…¶æ˜¯åœ¨ä¸­å°å…¬å¸ï¼Œè€æ¿å¯¹æˆæœ¬è¿˜æ˜¯å¾ˆåœ¨æ„çš„ã€‚</p><h5 id="3ã€ç®€åŒ–ç»´æŠ¤"><a href="#3ã€ç®€åŒ–ç»´æŠ¤" class="headerlink" title="3ã€ç®€åŒ–ç»´æŠ¤"></a>3ã€ç®€åŒ–ç»´æŠ¤</h5><p>å†·çƒ­åˆ†ç¦»ä¹‹åï¼Œå¯¹äºæ•°æ®çš„<code>ç»´æŠ¤æ›´ç›´è§‚</code>ï¼Œå¯ä»¥æŠŠæ›´å¤šç²¾åŠ›æ”¾åœ¨çƒ­æ•°æ®çš„å¤„ç†ä¸Šã€‚</p><p>æ¯”å¦‚å¤‡ä»½ç­–ç•¥ï¼Œå†·çƒ­æ•°æ®å¯ä»¥åˆ†åˆ«é‡‡ç”¨ä¸åŒçš„ç­–ç•¥ç»´æŠ¤ï¼Œæ›´<code>å…³æ³¨çƒ­æ•°æ®</code>å¤‡ä»½ï¼Œ<code>ç®€åŒ–å†·æ•°æ®</code>å¤‡ä»½ã€‚</p><h4 id="2ã€ç¼ºç‚¹"><a href="#2ã€ç¼ºç‚¹" class="headerlink" title="2ã€ç¼ºç‚¹"></a>2ã€ç¼ºç‚¹</h4><p>ç¼ºç‚¹æˆ‘å½’çº³äº†2ç‚¹ï¼š</p><h5 id="1ã€åœºæ™¯é™åˆ¶å¤š"><a href="#1ã€åœºæ™¯é™åˆ¶å¤š" class="headerlink" title="1ã€åœºæ™¯é™åˆ¶å¤š"></a>1ã€åœºæ™¯é™åˆ¶å¤š</h5><p>å†·çƒ­åˆ†ç¦»å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä¸€å®šè¦æ ¹æ®ä¸šåŠ¡æ¥åˆ†æï¼ŒæŸ¥è¯¢çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œå¾ˆå¯èƒ½ä½ å†·çƒ­åˆ†ç¦»åï¼Œçƒ­æ•°æ®çš„æŸ¥è¯¢ä¾ç„¶æ²¡æœ‰å¾—åˆ°æ˜æ˜¾ä¼˜åŒ–ã€‚</p><blockquote><p>æ¯”å¦‚ä½ æœ‰ä¸€å¼ è¡¨ï¼ŒæŸ¥è¯¢çš„è¯­å¥å…³è”å¾ˆå¤šï¼Œè¡¨æ•°æ®é‡ä¹ŸæŒºå¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å†·çƒ­åˆ†ç¦»ä¸€ç‚¹ä½œç”¨éƒ½æ²¡æœ‰ï¼Œå› ä¸ºä½ åˆ†ç¦»å®Œäº†ï¼ŒæŸ¥è¯¢è¯­å¥è¿˜æ˜¯å…³è”é‚£ä¹ˆå¤šï¼Œé€Ÿåº¦ä¾ç„¶å¾ˆæ…¢ã€‚</p></blockquote><p>è¿™ä¸ªæ—¶å€™ï¼Œç±»ä¼¼çš„åœºæ™¯å°±æ— æ³•ä½¿ç”¨å†·çƒ­åˆ†ç¦»æ–¹æ¡ˆäº†ï¼Œè€Œæ˜¯è¦è€ƒè™‘å…¶ä»–æ–¹æ¡ˆï¼Œæ¯”å¦‚<code>è¯»å†™åˆ†ç¦»</code>ï¼Œæ¯”å¦‚<code>æŸ¥è¯¢åˆ†ç¦»</code>ï¼Œè¿™æ ·æ‰èƒ½ä»æ ¹æºä¸Šè§£å†³æŸ¥è¯¢æ…¢çš„é—®é¢˜ã€‚</p><h5 id="2ã€ç»Ÿè®¡æ•ˆç‡ä½"><a href="#2ã€ç»Ÿè®¡æ•ˆç‡ä½" class="headerlink" title="2ã€ç»Ÿè®¡æ•ˆç‡ä½"></a>2ã€ç»Ÿè®¡æ•ˆç‡ä½</h5><p>è¿™ç§ä¹Ÿæ˜¯å†·çƒ­åˆ†ç¦»æ–¹æ¡ˆæ¯”è¾ƒæ˜æ˜¾çš„ä¸€ä¸ªç¼ºç‚¹ï¼Œå½“ä½ ä»¬çš„ä¸šåŠ¡ä¸­ï¼Œéœ€è¦å¯¹æ•°æ®åšä¸€äº›å¤æ‚çš„ç»Ÿè®¡åˆ†æï¼Œç”šè‡³è¦æ±‚ä¸€å®šçš„å®æ—¶æ€§ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå› ä¸ºå·²ç»å†·çƒ­åˆ†ç¦»ï¼Œ<code>å†·æ•°æ®çš„ç»Ÿè®¡åˆ†ææ•ˆç‡ä¼šéå¸¸ä½</code>ï¼Œå¯¹äºå®¢æˆ·æå‡ºçš„ä¸€äº›äº”èŠ±å…«é—¨çš„ç»Ÿè®¡åˆ†æå°±éš¾ä»¥æ“ä½œäº†ã€‚</p><p>å› æ­¤ï¼Œåˆéœ€è¦å¼•å…¥å…¶ä»–æ–¹æ¡ˆæ¥é…åˆï¼Œæ¯”å¦‚<code>ElasticSearch</code>ï¼Œè¿™æ ·åˆå¢åŠ äº†é¢å¤–çš„æˆæœ¬ï¼Œä¸ä»…è¦è€ƒè™‘ESçš„èµ„æºæˆæœ¬ï¼Œè¿˜è¦è€ƒè™‘è¯¸å¦‚<code>éƒ¨ç½²æ–¹æ¡ˆ</code>ã€<code>ç»´æŠ¤æ–¹æ¡ˆ</code>ã€<code>å®‰å…¨æ€§é—®é¢˜</code>ç­‰ç­‰ã€‚</p><blockquote><p>ä»Šå¹´æˆ‘ä»¬å†…éƒ¨å°±å…¬å¸ƒäº†ä¸€ä¸ªå°é“æ¶ˆæ¯ï¼ŒæŸå®¶ä¸šå†…è¿˜æŒºä¸é”™çš„äº’è”ç½‘å…¬å¸å› ä¸ºElasticSearchçš„æœªæˆæƒæ¼æ´å¯¼è‡´åƒä¸‡ç”¨æˆ·æ•æ„Ÿä¿¡æ¯è¢«æ³„éœ²ï¼Œç›´æ¥è¢«è¡Œä¸šé™¤åäº†ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸­é—´ä»¶çš„å¼•å…¥æ˜¯ä¸ªéœ€è¦å®¡æ…è€ƒè™‘çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯ä½ æƒ³å½“ç„¶äº†å°±å¯ä»¥ä½¿ç”¨ã€‚</p><h3 id="ä¼˜ç§€æ–‡çŒ®"><a href="#ä¼˜ç§€æ–‡çŒ®" class="headerlink" title="ä¼˜ç§€æ–‡çŒ®"></a>ä¼˜ç§€æ–‡çŒ®</h3><p><a href="https://javaguide.cn/high-performance/data-cold-hot-separation.html" target="_blank" rel="noopener">ã€ŠJavaGuide æ•°æ®å†·çƒ­åˆ†ç¦»è¯¦è§£ã€‹</a><br><a href="https://mp.weixin.qq.com/s/ZKRkZP6rLHuTE1wvnqmAPQ" target="_blank" rel="noopener">ã€Šæµ·é‡æ•°æ®å†·çƒ­åˆ†ç¦»æ–¹æ¡ˆä¸å®è·µ - å­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿ - 2022ã€‹</a><br><a href="https://www.cnblogs.com/fulongyuanjushi/p/17910420.html" target="_blank" rel="noopener">ã€Šå¦‚ä½•å¿«é€Ÿä¼˜åŒ–å‡ åƒä¸‡æ•°æ®é‡çš„è®¢å•è¡¨ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨</title>
    <url>/post/e60e6d3f.html</url>
    <content><![CDATA[<blockquote><p>ShardingSphere ~</p></blockquote><a id="more"></a><h2 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h2><h3 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h3><p><code>Apache ShardingSphere</code> æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼çš„æ•°æ®åº“ç”Ÿæ€ç³»ç»Ÿï¼Œ å¯ä»¥å°†ä»»æ„æ•°æ®åº“è½¬æ¢ä¸ºåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¹¶é€šè¿‡æ•°æ®åˆ†ç‰‡ã€å¼¹æ€§ä¼¸ç¼©ã€åŠ å¯†ç­‰èƒ½åŠ›å¯¹åŸæœ‰æ•°æ®åº“è¿›è¡Œå¢å¼ºã€‚<code>ShardingSphere</code> é¡¹ç›®ï¼ˆåŒ…æ‹¬ <code>Sharding-JDBC</code>ã€<code>Sharding-Proxy</code> å’Œ <code>Sharding-Sidecar</code>ï¼‰æ˜¯å½“å½“æå…¥ Apache çš„ï¼Œç›®å‰ä¸»è¦ç”±äº¬ä¸œæ•°ç§‘çš„ä¸€äº›å·¨ä½¬ç»´æŠ¤ã€‚<code>ShardingSphere</code> ç»å¯¹å¯ä»¥è¯´æ˜¯å½“å‰åˆ†åº“åˆ†è¡¨çš„é¦–é€‰ï¼</p><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p><code>ShardingSphere</code> çš„åŠŸèƒ½å®Œå–„ï¼Œé™¤äº†æ”¯æŒè¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨ï¼Œè¿˜æä¾›åˆ†å¸ƒå¼äº‹åŠ¡ã€æ•°æ®åº“æ²»ç†ã€å½±å­åº“ã€æ•°æ®åŠ å¯†å’Œè„±æ•ç­‰åŠŸèƒ½ã€‚<code>ShardingSphere</code> çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼ˆæ‘˜è‡ª <a href="https://shardingsphere.apache.org/document/current/cn/overview/" target="_blank" rel="noopener">ShardingSphereå®˜æ–¹æ–‡æ¡£</a>ï¼‰</p><ul><li>æè‡´æ€§èƒ½ï¼šé©±åŠ¨ç¨‹åºç«¯å†ç»é•¿å¹´æ‰“ç£¨ï¼Œæ•ˆç‡æ¥è¿‘åŸç”Ÿ <code>JDBC</code>ï¼Œæ€§èƒ½æè‡´ã€‚</li><li>ç”Ÿæ€å…¼å®¹ï¼šä»£ç†ç«¯æ”¯æŒä»»ä½•é€šè¿‡ <code>MySQL/PostgreSQL</code> åè®®çš„åº”ç”¨è®¿é—®ï¼Œé©±åŠ¨ç¨‹åºç«¯å¯å¯¹æ¥ä»»æ„å®ç° <code>JDBC</code> è§„èŒƒçš„æ•°æ®åº“ã€‚</li><li>ä¸šåŠ¡é›¶ä¾µå…¥ï¼šé¢å¯¹æ•°æ®åº“æ›¿æ¢åœºæ™¯ï¼Œ<code>ShardingSphere</code> å¯æ»¡è¶³ä¸šåŠ¡æ— éœ€æ”¹é€ ï¼Œå®ç°å¹³æ»‘ä¸šåŠ¡è¿ç§»ã€‚</li><li>è¿ç»´ä½æˆæœ¬ï¼šåœ¨ä¿ç•™åŸæŠ€æœ¯æ ˆä¸å˜å‰æä¸‹ï¼Œå¯¹ DBA å­¦ä¹ ã€ç®¡ç†æˆæœ¬ä½ï¼Œäº¤äº’å‹å¥½ã€‚</li><li>å®‰å…¨ç¨³å®šï¼šåŸºäºæˆç†Ÿæ•°æ®åº“åº•åº§ä¹‹ä¸Šæä¾›å¢é‡èƒ½åŠ›ï¼Œå…¼é¡¾å®‰å…¨æ€§åŠç¨³å®šæ€§ã€‚</li><li>å¼¹æ€§æ‰©å±•ï¼šå…·å¤‡è®¡ç®—ã€å­˜å‚¨å¹³æ»‘åœ¨çº¿æ‰©å±•èƒ½åŠ›ï¼Œå¯æ»¡è¶³ä¸šåŠ¡å¤šå˜çš„éœ€æ±‚ã€‚</li><li>å¼€æ”¾ç”Ÿæ€ï¼šé€šè¿‡å¤šå±‚æ¬¡ï¼ˆå†…æ ¸ã€åŠŸèƒ½ã€ç”Ÿæ€ï¼‰æ’ä»¶åŒ–èƒ½åŠ›ï¼Œä¸ºç”¨æˆ·æä¾›å¯å®šåˆ¶æ»¡è¶³è‡ªèº«ç‰¹æ®Šéœ€æ±‚çš„ç‹¬æœ‰ç³»ç»Ÿã€‚</li></ul><p>å¦å¤–ï¼Œ<code>ShardingSphere</code> çš„ç”Ÿæ€ä½“ç³»å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ï¼Œæ›´æ–°å’Œå‘å¸ƒæ¯”è¾ƒé¢‘ç¹ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç°åœ¨å¾ˆå¤šå…¬å¸éƒ½æ˜¯ç”¨çš„ç±»ä¼¼äº <code>TiDB</code> è¿™ç§åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼ˆæ•°æ®åº“å±‚é¢å·²ç»å¸®æˆ‘ä»¬åšäº†ï¼‰ã€‚</p><p>ä¹Ÿä¸éœ€è¦è§£å†³æ‰‹åŠ¨åˆ†åº“åˆ†è¡¨å¼•å…¥çš„å„ç§é—®é¢˜ï¼Œç›´æ¥ä¸€æ­¥åˆ°ä½ï¼Œå†…ç½®å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼ˆå¦‚æ— æ„Ÿæ‰©å®¹å’Œç¼©å®¹ã€å†·çƒ­å­˜å‚¨åˆ†ç¦»ï¼‰ã€‚</p><p>å¦‚æœå…¬å¸æ¡ä»¶å…è®¸çš„è¯ï¼Œä¸ªäººä¹Ÿæ˜¯æ¯”è¾ƒæ¨èè¿™ç§æ–¹å¼ï¼</p><h2 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h2><h4 id="æ ¸å¿ƒæ­¥éª¤"><a href="#æ ¸å¿ƒæ­¥éª¤" class="headerlink" title="æ ¸å¿ƒæ­¥éª¤"></a>æ ¸å¿ƒæ­¥éª¤</h4><p>ä¸è®ºæ˜¯ä½¿ç”¨å“ªä¸€ç§è¯»å†™åˆ†ç¦»å…·ä½“çš„å®ç°æ–¹æ¡ˆï¼Œæƒ³è¦å®ç°è¯»å†™åˆ†ç¦»ä¸€èˆ¬åŒ…å«å¦‚ä¸‹å‡ æ­¥ï¼š</p><ol><li>éƒ¨ç½²å¤šå°æ•°æ®åº“ï¼Œé€‰æ‹©å…¶ä¸­çš„ä¸€å°ä½œä¸ºä¸»æ•°æ®åº“ï¼Œå…¶ä»–çš„ä¸€å°æˆ–è€…å¤šå°ä½œä¸ºä»æ•°æ®åº“ã€‚</li><li>ä¿è¯ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>ä¸»ä»å¤åˆ¶</strong>ã€‚</li><li>ç³»ç»Ÿå°†å†™è¯·æ±‚äº¤ç»™ä¸»æ•°æ®åº“å¤„ç†ï¼Œè¯»è¯·æ±‚äº¤ç»™ä»æ•°æ®åº“å¤„ç†ã€‚</li></ol><h4 id="å®é™…è½åœ°"><a href="#å®é™…è½åœ°" class="headerlink" title="å®é™…è½åœ°"></a>å®é™…è½åœ°</h4><h5 id="ä»£ç†æ–¹å¼"><a href="#ä»£ç†æ–¹å¼" class="headerlink" title="ä»£ç†æ–¹å¼"></a>ä»£ç†æ–¹å¼</h5><p>å¯ä»¥åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ•°æ®è¯·æ±‚éƒ½äº¤ç»™ä»£ç†å±‚å¤„ç†ï¼Œä»£ç†å±‚è´Ÿè´£åˆ†ç¦»è¯»å†™è¯·æ±‚ï¼Œå°†å®ƒä»¬è·¯ç”±åˆ°å¯¹åº”çš„æ•°æ®åº“ä¸­ã€‚æä¾›ç±»ä¼¼åŠŸèƒ½çš„ä¸­é—´ä»¶æœ‰ <strong>MySQL Router</strong>ï¼ˆå®˜æ–¹ï¼Œ MySQL Proxy çš„æ›¿ä»£æ–¹æ¡ˆï¼‰ã€<strong>Atlas</strong>ï¼ˆåŸºäº MySQL Proxyï¼‰ã€<strong>MaxScale</strong>ã€<strong>MyCat</strong>ã€‚</p><blockquote><p>å…³äº MySQL Router å¤šæä¸€ç‚¹ï¼šåœ¨ MySQL 8.2 çš„ç‰ˆæœ¬ä¸­ï¼ŒMySQL Router èƒ½è‡ªåŠ¨åˆ†è¾¨å¯¹æ•°æ®åº“è¯»å†™/æ“ä½œå¹¶æŠŠè¿™äº›æ“ä½œè·¯ç”±åˆ°æ­£ç¡®çš„å®ä¾‹ä¸Šã€‚è¿™æ˜¯ä¸€é¡¹æœ‰ä»·å€¼çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œè€Œæ— éœ€åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚å…·ä½“ä»‹ç»å¯ä»¥å‚è€ƒå®˜æ–¹åšå®¢ï¼š<a href="https://blogs.oracle.com/mysql/post/mysql-82-transparent-readwrite-splitting" target="_blank" rel="noopener">MySQL 8.2 â€“ transparent read/write splitting</a></p></blockquote><h5 id="ç»„ä»¶æ–¹å¼"><a href="#ç»„ä»¶æ–¹å¼" class="headerlink" title="ç»„ä»¶æ–¹å¼"></a>ç»„ä»¶æ–¹å¼</h5><p>é€šè¿‡å¼•å…¥ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥å¸®åŠ©æˆ‘ä»¬è¯»å†™è¯·æ±‚ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ä¸€ç§æ–¹å¼ã€‚è¿™ç§æ–¹å¼ç›®å‰åœ¨å„ç§äº’è”ç½‘å…¬å¸ä¸­ç”¨çš„æœ€å¤šçš„ï¼Œç›¸å…³çš„å®é™…çš„æ¡ˆä¾‹ä¹Ÿéå¸¸å¤šã€‚å¦‚æœä½ è¦é‡‡ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæ¨èä½¿ç”¨ <code>sharding-jdbc</code> ï¼Œç›´æ¥å¼•å…¥ jar åŒ…å³å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚åŒæ—¶ï¼Œä¹ŸèŠ‚çœäº†å¾ˆå¤šè¿ç»´çš„æˆæœ¬ã€‚ä½ å¯ä»¥åœ¨ shardingsphere å®˜æ–¹æ‰¾åˆ° <a href="https://shardingsphere.apache.org/document/legacy/3.x/document/cn/manual/sharding-jdbc/usage/read-write-splitting/" target="_blank" rel="noopener">sharding-jdbc å…³äºè¯»å†™åˆ†ç¦»çš„æ“ä½œ</a>ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¨‹åºå‘˜é‡åˆ°ç´§æ€¥ç”Ÿäº§äº‹ä»¶ï¼Œè¯¥æ€ä¹ˆåŠ?</title>
    <url>/post/d84e5a96.html</url>
    <content><![CDATA[<blockquote><p>ç¨‹åºå‘˜é‡åˆ°ç´§æ€¥ç”Ÿäº§äº‹ä»¶ï¼Œè¯¥æ€ä¹ˆåŠ~</p></blockquote><a id="more"></a><blockquote class="pullquote mindmap mindmap-lg"><ul><li>æ–¹æ³•è®º<ul><li>å¿ƒæ€<ul><li>æ²‰ç¨³</li><li>å†·é™</li><li>æ·¡å®š</li></ul></li><li>5WHYåˆ†ææ³•<ul><li>ç²¾é«“<ul><li>å¤šé—®å‡ æ¬¡ä¸ºä»€ä¹ˆï¼Œç›´è‡³æ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚</li></ul></li><li>æ­¥éª¤<ul><li>1 è¯´æ˜é—®é¢˜å¹¶æè¿°ç›¸å…³ä¿¡æ¯</li><li>2 é—®ä¸ºä»€ä¹ˆç›´åˆ°æ‰¾å‡ºæ ¹æœ¬åŸå› </li><li>3 åˆ¶å®šå¯¹ç­–å¹¶æ‰§è¡Œ</li><li>4 æ‰§è¡Œåï¼ŒéªŒè¯æœ‰æ•ˆæ€§</li></ul></li></ul></li><li>æ’æŸ¥æ€è·¯ä¸æ–¹æ³•<ul><li>1 ä»¥å…·ä½“å‘ç”Ÿé—®é¢˜çš„å¯¹è±¡ä¸ºåˆ‡å…¥ç‚¹</li><li>2 åˆ—å‡ºé—®é¢˜å‡ºç°çš„æ‰€æœ‰ç¯èŠ‚ï¼Œå¹¶é€ä¸ªæ£€æŸ¥<ul><li>1 ç”»å‡ºé—®é¢˜ç›¸å…³è”çš„æµç¨‹å›¾</li><li>2 æŸ¥çœ‹ä¾èµ–ä½¿ç”¨çš„ä¸­é—´ä»¶å„ç±»ç›‘æ§æŒ‡æ ‡ï¼ŒCPU\å†…å­˜\IO\ç½‘ç»œ\ç£ç›˜ç­‰<ul><li>a å…³ç³»å‹æ•°æ®åº“</li><li>b ç¼“å­˜å‹æ•°æ®åº“</li><li>c å„ç§ä¸­é—´ä»¶ï¼Œå¦‚ï¼šredisã€kafkaã€zookeeperã€mqç­‰</li></ul></li></ul></li><li>3 åˆ—å‡ºä¸é—®é¢˜ç›¸å…³çš„æ€€ç–‘ç‚¹ï¼Œå¹¶é€ä¸ªæ’æŸ¥</li><li>4 é‡‡ç”¨é—®é¢˜å¤ç°çš„æ–¹å¼ï¼Œé‡ç°é—®é¢˜</li></ul></li><li>è§£å†³æ€è·¯ä¸æ–¹æ³•<ul><li>äº‹å‰</li><li>äº‹ä¸­</li><li>äº‹å</li></ul></li></ul></li></ul></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€å•ç‰ˆæœ¬-åŠ¨æ€çº¿ç¨‹æ± </title>
    <url>/post/2a3700fd.html</url>
    <content><![CDATA[<blockquote><p>åŠ¨æ€çº¿ç¨‹æ±  ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€åŸºäºApolloå®ç°ç®€å•ç‰ˆæœ¬"><a href="#ä¸€ã€åŸºäºApolloå®ç°ç®€å•ç‰ˆæœ¬" class="headerlink" title="ä¸€ã€åŸºäºApolloå®ç°ç®€å•ç‰ˆæœ¬"></a>ä¸€ã€åŸºäºApolloå®ç°ç®€å•ç‰ˆæœ¬</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.Inet4Address;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.NetworkInterface;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.task.TaskExecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ctrip.framework.apollo.model.ConfigChange;</span><br><span class="line"><span class="keyword">import</span> com.ctrip.framework.apollo.model.ConfigChangeEvent;</span><br><span class="line"><span class="keyword">import</span> com.ctrip.framework.apollo.spring.annotation.ApolloConfigChangeListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ObjectUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€çº¿æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicThreadPool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXECUTOR_POOL = <span class="string">"calItemExecutor"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXECUTOR_POOL_MAX_SIZE = <span class="string">"task.thread.pool.max.size"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXECUTOR_POOL_CORE_SIZE = <span class="string">"task.thread.pool.core.size"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String serverIp = getIpAddress();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çº¿ç¨‹æ± map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConcurrentHashMap&lt;String, ThreadPoolTaskExecutor&gt; threadPoolMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡è®¡ç®—é¡¹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¸šåŠ¡è®¡ç®—é¡¹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"calItemExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskExecutor <span class="title">calItemExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor taskExecutor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        taskExecutor.setCorePoolSize(<span class="number">3</span>);</span><br><span class="line">        taskExecutor.setMaxPoolSize(<span class="number">15</span>);</span><br><span class="line">        taskExecutor.setQueueCapacity(<span class="number">2000</span>);</span><br><span class="line">        taskExecutor.setKeepAliveSeconds(<span class="number">0</span>);</span><br><span class="line">        taskExecutor.setThreadNamePrefix(<span class="string">"calItemExecutor--"</span>);</span><br><span class="line">        taskExecutor.setWaitForTasksToCompleteOnShutdown(<span class="keyword">true</span>);</span><br><span class="line">        taskExecutor.setAwaitTerminationSeconds(<span class="number">60</span>);</span><br><span class="line">        taskExecutor.initialize();</span><br><span class="line">        threadPoolMap.put(<span class="string">"calItemExecutor"</span>, taskExecutor);</span><br><span class="line">        <span class="keyword">return</span> taskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedRate = <span class="number">10000</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledFixedRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        threadPoolMap.forEach(</span><br><span class="line">            (k, threadPoolExecutor) -&gt; threadPoolStatus(threadPoolExecutor.getThreadPoolExecutor(), k, <span class="string">"å®šæ—¶ç›‘æ§"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. ç›‘å¬apolloä¸­applicationå‘½åç©ºé—´ä¸‹ï¼Œtask.thread.poolå‰ç¼€ç›¸å…³çš„çº¿ç¨‹æ± é…ç½®</span></span><br><span class="line"><span class="comment">     *  task.thread.pool.max.size = 5 task.thread.pool.core.size = 2</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  2. å®ç°çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°ä¿®æ”¹æ¥æ”¶ï¼Œè°ƒç”¨çº¿ç¨‹æ± å‚æ•°åŠ¨æ€ä¿®æ”¹æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> changeEvent é…ç½®æ–‡ä»¶å˜åŒ–äº‹ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApolloConfigChangeListener</span>(value = <span class="string">"application"</span>, interestedKeyPrefixes = <span class="string">"task.thread.pool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onChange</span><span class="params">(ConfigChangeEvent changeEvent)</span> </span>&#123;</span><br><span class="line">        changeCalItemThreadPool(changeEvent, EXECUTOR_POOL, EXECUTOR_POOL_MAX_SIZE, EXECUTOR_POOL_CORE_SIZE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeCalItemThreadPool</span><span class="params">(ConfigChangeEvent changeEvent, String threadPoolKey, String maxKey,</span></span></span><br><span class="line"><span class="function"><span class="params">        String coreKey)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; changedKeys = changeEvent.changedKeys();</span><br><span class="line">        <span class="keyword">if</span> (changedKeys.contains(maxKey) || changedKeys.contains(coreKey)) &#123;</span><br><span class="line">            ThreadPoolTaskExecutor threadPoolTaskExecutor = threadPoolMap.get(threadPoolKey);</span><br><span class="line">            <span class="keyword">boolean</span> flag = Boolean.FALSE;</span><br><span class="line">            <span class="keyword">int</span> max = threadPoolTaskExecutor.getMaxPoolSize();</span><br><span class="line">            <span class="keyword">int</span> core = threadPoolTaskExecutor.getCorePoolSize();</span><br><span class="line">            ConfigChange maxChange = changeEvent.getChange(maxKey);</span><br><span class="line">            Integer maxUpdate = update(maxChange);</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtil.isNotNull(maxUpdate)) &#123;</span><br><span class="line">                flag = Boolean.TRUE;</span><br><span class="line">                max = maxUpdate;</span><br><span class="line">            &#125;</span><br><span class="line">            ConfigChange coreChange = changeEvent.getChange(coreKey);</span><br><span class="line">            Integer coreUpdate = update(coreChange);</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtil.isNotNull(coreUpdate)) &#123;</span><br><span class="line">                flag = Boolean.TRUE;</span><br><span class="line">                core = coreUpdate;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (flag &amp;&amp; max &gt;= core) &#123;</span><br><span class="line">                dynamicModifyExecutor(core, max, threadPoolKey);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.info(<span class="string">"å½“å‰çº¿ç¨‹æ± è°ƒæ•´æœªç”Ÿæ•ˆ, è¯·æ£€æŸ¥é…ç½®!, ip:&#123;&#125;,threadNamePrefixï¼š&#123;&#125;"</span>, serverIp, threadPoolKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Integer <span class="title">update</span><span class="params">(ConfigChange coreChange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtil.isNotNull(coreChange)) &#123;</span><br><span class="line">            Integer newValue =</span><br><span class="line">                ObjectUtil.isNotNull(coreChange.getNewValue()) ? Integer.parseInt(coreChange.getNewValue()) : <span class="keyword">null</span>;</span><br><span class="line">            Integer oldValue =</span><br><span class="line">                ObjectUtil.isNotNull(coreChange.getOldValue()) ? Integer.parseInt(coreChange.getOldValue()) : <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (!ObjectUtil.equals(newValue, oldValue)) &#123;</span><br><span class="line">                <span class="keyword">return</span> newValue;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çº¿ç¨‹æ± å‚æ•°åŠ¨æ€ä¿®æ”¹</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maxPoolSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nameThreadFactoryPrefix</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dynamicModifyExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, <span class="keyword">int</span> maxPoolSize, String nameThreadFactoryPrefix)</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor threadPoolTaskExecutor = threadPoolMap.get(nameThreadFactoryPrefix);</span><br><span class="line">        ThreadPoolExecutor threadPoolExecutor = threadPoolTaskExecutor.getThreadPoolExecutor();</span><br><span class="line">        threadPoolStatus(threadPoolExecutor, nameThreadFactoryPrefix, <span class="string">"changer before"</span>);</span><br><span class="line">        threadPoolExecutor.setCorePoolSize(corePoolSize);</span><br><span class="line">        threadPoolExecutor.setMaximumPoolSize(maxPoolSize);</span><br><span class="line">        threadPoolExecutor.prestartAllCoreThreads();</span><br><span class="line">        threadPoolStatus(threadPoolExecutor, nameThreadFactoryPrefix, <span class="string">"changer after"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadPoolExecutor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadNamePrefix</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tag</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">threadPoolStatus</span><span class="params">(ThreadPoolExecutor threadPoolExecutor, String threadNamePrefix, String tag)</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor threadPoolTaskExecutor = threadPoolMap.get(threadNamePrefix);</span><br><span class="line">        <span class="keyword">if</span> (threadPoolTaskExecutor != <span class="keyword">null</span>) &#123;</span><br><span class="line">            threadPoolExecutor = threadPoolTaskExecutor.getThreadPoolExecutor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LinkedBlockingQueue queue = (LinkedBlockingQueue)threadPoolExecutor.getQueue();</span><br><span class="line">        log.info(</span><br><span class="line">            <span class="string">"ç»Ÿè®¡çº¿ç¨‹æ± çŠ¶æ€[&#123;&#125;], ip:&#123;&#125;,threadNamePrefixï¼š&#123;&#125;, æ ¸å¿ƒçº¿ç¨‹æ•°:&#123;&#125;, æœ€å¤§çº¿ç¨‹æ•°:&#123;&#125;, æ´»è·ƒçº¿ç¨‹æ•°ï¼š&#123;&#125;, æ’é˜Ÿçº¿ç¨‹æ•°ï¼š&#123;&#125;,é˜Ÿåˆ—å¤§å°ï¼š&#123;&#125;, getTaskCount:&#123;&#125;,getCompletedTaskCount:&#123;&#125;,getLargestPoolSize:&#123;&#125;"</span>,</span><br><span class="line">            tag, serverIp, threadNamePrefix, threadPoolExecutor.getCorePoolSize(),</span><br><span class="line">            threadPoolExecutor.getMaximumPoolSize(), threadPoolExecutor.getActiveCount(), queue.size(),</span><br><span class="line">            queue.size() + queue.remainingCapacity(), threadPoolExecutor.getTaskCount(),</span><br><span class="line">            threadPoolExecutor.getCompletedTaskCount(), threadPoolExecutor.getLargestPoolSize());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æœåŠ¡å™¨IPåœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ip</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getIpAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;NetworkInterface&gt; allNetInterfaces = NetworkInterface.getNetworkInterfaces();</span><br><span class="line">            InetAddress ip;</span><br><span class="line">            <span class="keyword">while</span> (allNetInterfaces.hasMoreElements()) &#123;</span><br><span class="line">                NetworkInterface netInterface = allNetInterfaces.nextElement();</span><br><span class="line">                <span class="keyword">if</span> (netInterface.isLoopback() || netInterface.isVirtual() || !netInterface.isUp()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Enumeration&lt;InetAddress&gt; addresses = netInterface.getInetAddresses();</span><br><span class="line">                    <span class="keyword">while</span> (addresses.hasMoreElements()) &#123;</span><br><span class="line">                        ip = addresses.nextElement();</span><br><span class="line">                        <span class="keyword">if</span> (ip <span class="keyword">instanceof</span> Inet4Address) &#123;</span><br><span class="line">                            <span class="keyword">return</span> ip.getHostAddress();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">"IPåœ°å€è·å–å¤±è´¥"</span> + e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€å¤§å‚ç‰ˆæœ¬"><a href="#äºŒã€å¤§å‚ç‰ˆæœ¬" class="headerlink" title="äºŒã€å¤§å‚ç‰ˆæœ¬"></a>äºŒã€å¤§å‚ç‰ˆæœ¬</h3><p><a href="https://hippo4j.cn/" target="_blank" rel="noopener">ã€Šhippo4jã€‹</a><br><a href="https://dynamictp.cn/" target="_blank" rel="noopener">ã€Šç¾å›¢ dynamictpã€‹</a><br><a href="https://blog.csdn.net/m0_57334678/article/details/131466456" target="_blank" rel="noopener">ã€Šç½‘å‹è‡ªå®šä¹‰ç®€å•ç‰ˆæœ¬çº¿ç¨‹æ± ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
  </entry>
  <entry>
    <title>Springäº‹åŠ¡ï¼šæäº¤äº‹åŠ¡ä¹‹åæ‰§è¡Œå…¶ä»–æ“ä½œ</title>
    <url>/post/f9b392b4.html</url>
    <content><![CDATA[<blockquote><p>Springæäº¤äº‹åŠ¡ä¹‹åæ‰§è¡Œå…¶ä»–æ“ä½œ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€åœºæ™¯è¯´æ˜"><a href="#ä¸€ã€åœºæ™¯è¯´æ˜" class="headerlink" title="ä¸€ã€åœºæ™¯è¯´æ˜"></a>ä¸€ã€åœºæ™¯è¯´æ˜</h3><p>åœ¨ <code>service1</code>ä¸­å¾€æ•°æ®åº“ä¸­æ–°æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶åœ¨è¿™ä¸ª <code>service1</code> ä¸­è°ƒç”¨äº†å¦å¤–ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥æ–¹æ³•ä¸­éœ€è¦æŸ¥è¯¢åˆšåˆš <code>service1</code>ä¸­æ–°æ’å…¥çš„æ•°æ®ï¼Œå‘ç°æŸ¥è¯¢ä¸åˆ°ã€‚</p><h3 id="äºŒã€è§£å†³æ€è·¯"><a href="#äºŒã€è§£å†³æ€è·¯" class="headerlink" title="äºŒã€è§£å†³æ€è·¯"></a>äºŒã€è§£å†³æ€è·¯</h3><p>è®©<code>service1</code>æ–¹æ³•äº‹åŠ¡æäº¤ä¹‹åï¼Œå†è°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼ˆäº‹åŠ¡æäº¤ä¹‹åæ‰§è¡Œå…¶ä»–æ“ä½œï¼‰</p><h3 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h3><h4 id="æ–¹å¼ä¸€ï¼ˆæ¨èä½¿ç”¨ï¼‰"><a href="#æ–¹å¼ä¸€ï¼ˆæ¨èä½¿ç”¨ï¼‰" class="headerlink" title="æ–¹å¼ä¸€ï¼ˆæ¨èä½¿ç”¨ï¼‰"></a>æ–¹å¼ä¸€ï¼ˆæ¨èä½¿ç”¨ï¼‰</h4><p>ä½¿ç”¨ <code>TransactionSynchronizationManager</code> æ³¨å†Œå›è°ƒSpring æä¾›çš„ <code>TransactionSynchronizationManager</code> å¯ä»¥å¸®åŠ©åœ¨äº‹åŠ¡æäº¤åæ‰§è¡ŒæŸä¸ªæ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œäº‹åŠ¡åŒæ­¥å›è°ƒï¼Œåœ¨äº‹åŠ¡æäº¤åå‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">if</span> (TransactionSynchronizationManager.isActualTransactionActive()) &#123;</span><br><span class="line">            TransactionSynchronizationManager.registerSynchronization(<span class="keyword">new</span> TransactionSynchronizationAdapter() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCommit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// äº‹åŠ¡æäº¤åæ‰§è¡Œå…¶ä»–æ“ä½œ</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œå®Œæˆå, å¯ä»¥æ˜¯æäº¤ ä¹Ÿå¯ä»¥æ˜¯å›æ»š</span></span><br><span class="line">                    <span class="keyword">if</span> (status == TransactionSynchronization.STATUS_ROLLED_BACK) &#123;</span><br><span class="line">                        log.info(<span class="string">"=============!å›æ»š==================="</span>);</span><br><span class="line">                        <span class="comment">// do</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº‹åŠ¡å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨äº‹åŠ¡æäº¤ååŒæ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> runnable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterCommitSyncExecute</span><span class="params">(Runnable runnable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TransactionSynchronizationManager.isSynchronizationActive()) &#123;</span><br><span class="line">            TransactionSynchronizationManager.registerSynchronization(<span class="keyword">new</span> TransactionSynchronizationAdapter() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCommit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    runnable.run();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            runnable.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨äº‹åŠ¡æäº¤åå¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(5,</span></span><br><span class="line"><span class="comment">     *         new ThreadFactoryBuilder().setDaemon(false).setNamePrefix("execApiCache").build());</span></span><br><span class="line"><span class="comment">     *         </span></span><br><span class="line"><span class="comment">     *  Psï¼šsetDaemon(false) æ³¨æ„è¿™é‡Œå®ˆæŠ¤çº¿ç¨‹æ ‡è®°å¿…é¡»è®¾ç½®ä¸º falseï¼Œå¦åˆ™ä¸»çº¿ç¨‹æ‰§è¡Œå®Œï¼Œå¼‚æ­¥çº¿ç¨‹æ²¡æ‰§è¡Œå®Œçš„è¯ï¼Œå¼‚æ­¥çº¿ç¨‹ä¼šé©¬ä¸Šè¢«ä¸­æ–­ã€å…³é—­ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½è®¾ç½®* æˆå®ˆæŠ¤ï¼ˆç”¨æˆ·ï¼‰çº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> runnable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterCommitAsyncExecute</span><span class="params">(Executor executor, Runnable runnable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TransactionSynchronizationManager.isSynchronizationActive()) &#123;</span><br><span class="line">            TransactionSynchronizationManager.registerSynchronization(<span class="keyword">new</span> TransactionSynchronizationAdapter() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCommit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    executor.execute(runnable);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            executor.execute(runnable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Service</span></span></span><br><span class="line"><span class="comment">     * public class UserService &#123;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     <span class="doctag">@Autowired</span></span></span><br><span class="line"><span class="comment">     *     private UserMapper userMapper;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     <span class="doctag">@Transactional</span>(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="comment">     *     public void add(User user)&#123;</span></span><br><span class="line"><span class="comment">     *         userMapper.insert(user);</span></span><br><span class="line"><span class="comment">     *         TransactionUtils.afterCommitSyncExecute(()-&gt;&#123;</span></span><br><span class="line"><span class="comment">     *             System.out.println("äº‹åŠ¡æäº¤åæ‰§è¡Œçš„æ–¹æ³•");</span></span><br><span class="line"><span class="comment">     *         &#125;);</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h4><p>ä½¿ç”¨ <code>@TransactionalEventListener</code> ç»“åˆ Springäº‹ä»¶ç›‘å¬æœºåˆ¶ï¼Œå°†å‘é€æ¶ˆæ¯çš„é€»è¾‘è§£è€¦ï¼Œå¹¶ç¡®ä¿äº‹ä»¶åªåœ¨äº‹åŠ¡æäº¤åè¢«å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸šåŠ¡Service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userDao.save(user);</span><br><span class="line">        <span class="comment">// æ³¨å†Œäº‹ä»¶</span></span><br><span class="line">        applicationEventPublisher.publishEvent(<span class="keyword">new</span> SavedUserEvent(user.getId()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------------------------------</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿å­˜ç”¨æˆ·äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedUserEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SavedUserEvent</span><span class="params">(<span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter and setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------------------</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº‹ä»¶ä¾¦å¬ï¼Œå¤„ç†å¯¹åº”äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">FooEventListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MailService mailService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TransactionalEventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">sendEmail</span><span class="params">(SavedUserEvent savedUserEvent)</span> </span>&#123;</span><br><span class="line">        User user = userDao.get(userId);</span><br><span class="line">        String email = user.getEmail();</span><br><span class="line">        mailService.send(email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ã€èµ„æ–™"><a href="#å››ã€èµ„æ–™" class="headerlink" title="å››ã€èµ„æ–™"></a>å››ã€èµ„æ–™</h3><p><a href="https://blog.csdn.net/weixin_43911286/article/details/118314291" target="_blank" rel="noopener">ã€ŠSpringäº‹åŠ¡æäº¤ä¹‹åï¼Œå†è¿›è¡Œå…¶ä»–æ“ä½œã€‹</a><br><a href="https://blog.csdn.net/Dream_Weave/article/details/109366633?utm_source=miniapp_weixin" target="_blank" rel="noopener">ã€ŠSpring - TransactionalEventListener è§£å†³äº‹åŠ¡æœªæäº¤è¯»å–ä¸åˆ°æ•°æ®é—®é¢˜ã€‹</a><br><a href="https://www.jyoryo.com/archives/155.html" target="_blank" rel="noopener">ã€ŠSpring äº‹åŠ¡äº‹ä»¶æ§åˆ¶ è§£å†³ä¸šåŠ¡å¼‚æ­¥æ“ä½œè§£è€¦ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis Lettuce å¤§å‘ï¼</title>
    <url>/post/1634bc5d.html</url>
    <content><![CDATA[<blockquote><p>Redis Lettuce å¤§å‘ï¼ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€é”™è¯¯æ—¥å¿—"><a href="#ä¸€ã€é”™è¯¯æ—¥å¿—" class="headerlink" title="ä¸€ã€é”™è¯¯æ—¥å¿—"></a>ä¸€ã€é”™è¯¯æ—¥å¿—</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.dao.QueryTimeoutException: Redis command timed out; nested exception is io.lettuce.core.RedisCommandTimeoutException: io.lettuce.core.RedisCommandTimeoutException: Command timed out after <span class="number">3</span> second(s)</span><br></pre></td></tr></table></figure><h3 id="äºŒã€åŸå› åˆ†æ"><a href="#äºŒã€åŸå› åˆ†æ" class="headerlink" title="äºŒã€åŸå› åˆ†æ"></a>äºŒã€åŸå› åˆ†æ</h3><p><code>spring boot2.x</code>ç‰ˆæœ¬é»˜è®¤<code>redis</code>è¿æ¥æ± ä¸ºlettuceï¼Œæ‹¿åˆ°ä¸€ä¸ªå·²ç»æ–­å¼€çš„<code>Redis</code>è¿æ¥ï¼Œæ‰€ä»¥ä¸€ç›´ä¼šè¶…æ—¶ï¼Œè€Œä¸” <strong>Lettuce</strong> ä¹Ÿæ²¡æœ‰è‡ªåŠ¨é‡è¿ã€‚è€Œä»¥å‰çš„<code>jedis</code>æ˜¯æ²¡æœ‰æ­¤é—®é¢˜çš„ã€‚</p><h3 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h3><h4 id="1-æ”¾å¼ƒä½¿ç”¨lettuceï¼Œä½¿ç”¨Jedisã€‚"><a href="#1-æ”¾å¼ƒä½¿ç”¨lettuceï¼Œä½¿ç”¨Jedisã€‚" class="headerlink" title="1.æ”¾å¼ƒä½¿ç”¨lettuceï¼Œä½¿ç”¨Jedisã€‚"></a>1.æ”¾å¼ƒä½¿ç”¨lettuceï¼Œä½¿ç”¨<code>Jedis</code>ã€‚</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jediså®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2ï¼Œä½¿ç”¨jediså¿…é¡»ä¾èµ–å®ƒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"> <span class="attr">redis:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">jedis:</span></span><br><span class="line">   <span class="attr">pool:</span></span><br><span class="line">    <span class="attr">max-active:</span> <span class="number">8</span> <span class="comment">#è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°ã€‚è®¾ä¸º0è¡¨ç¤ºæ— é™åˆ¶</span></span><br><span class="line">    <span class="attr">max-wait:</span> <span class="number">-1</span> <span class="comment">#æœ€å¤§å»ºç«‹è¿æ¥ç­‰å¾…æ—¶é—´ã€‚å¦‚æœè¶…è¿‡æ­¤æ—¶é—´å°†æ¥åˆ°å¼‚å¸¸ã€‚è®¾ä¸º-1è¡¨ç¤ºæ— é™åˆ¶ã€‚</span></span><br><span class="line">    <span class="attr">max-idle:</span> <span class="number">8</span> <span class="comment">#æœ€å¤§ç©ºé—²æ•°</span></span><br><span class="line">    <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment">#redis è¿æ¥è¶…æ—¶æ—¶é—´ms</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10000</span></span><br><span class="line">  <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">password:</span></span><br></pre></td></tr></table></figure><h4 id="2-åŠ å…¥å®šæ—¶å¿ƒè·³ï¼Œä¿æ´»ã€‚"><a href="#2-åŠ å…¥å®šæ—¶å¿ƒè·³ï¼Œä¿æ´»ã€‚" class="headerlink" title="2.åŠ å…¥å®šæ—¶å¿ƒè·³ï¼Œä¿æ´»ã€‚"></a>2.åŠ å…¥å®šæ—¶å¿ƒè·³ï¼Œä¿æ´»ã€‚</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionCommands;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisScheduleTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisScheduleTask</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 minutes</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedRate = <span class="number">60000</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(<span class="string">"ping redis"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        redisTemplate.execute(RedisConnectionCommands::ping);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Kafka â€”â€” Ackæœºåˆ¶å’Œæ‰‹åŠ¨æäº¤åˆ†ææ€»ç»“</title>
    <url>/post/fe9f8905.html</url>
    <content><![CDATA[<blockquote><p>spring-kafka AckModeæ¨¡å¼ï¼ŒåŠæ‰‹åŠ¨æäº¤offsetã€‚</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Acké…ç½®"><a href="#ä¸€ã€Acké…ç½®" class="headerlink" title="ä¸€ã€Acké…ç½®"></a>ä¸€ã€Acké…ç½®</h3><blockquote><p>spring for kafkaçš„consumeråœ¨spring.kafka.consumer.enable-auto-commitæ˜¯falseæƒ…å†µä¸‹ï¼ŒAckModeçš„é€‰é¡¹ï¼ŒåŠæ‰‹åŠ¨æäº¤offsetã€‚</p></blockquote><p>Kafka ç”Ÿäº§è€…çš„ ACK æœºåˆ¶æŒ‡çš„æ˜¯ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯åï¼Œå¯¹æ¶ˆæ¯å‰¯æœ¬çš„ç¡®è®¤æœºåˆ¶ã€‚ACK æœºåˆ¶å¯ä»¥å¸®åŠ©ç”Ÿäº§è€…ç¡®ä¿æ¶ˆæ¯è¢«æˆåŠŸå†™å…¥ Kafka é›†ç¾¤ä¸­çš„å¤šä¸ªå‰¯æœ¬ï¼Œå¹¶åœ¨éœ€è¦æ—¶è·å–ç¡®è®¤ä¿¡æ¯ã€‚</p><p>Kafka æä¾›äº†ä¸‰ç§ ACK æœºåˆ¶çš„é…ç½®é€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li><p>acks=0ï¼šç”Ÿäº§è€…åœ¨æˆåŠŸå°†æ¶ˆæ¯å‘é€åˆ°ç½‘ç»œç¼“å†²åŒºåå³è§†ä¸ºæ¶ˆæ¯å·²è¢«æäº¤ï¼Œä¸ç­‰å¾…ä»»ä½•æœåŠ¡å™¨å“åº”ã€‚è¿™ç§é…ç½®ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚</p></li><li><p>acks=1ï¼šç”Ÿäº§è€…åœ¨æˆåŠŸå°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜çš„åˆ†åŒº leader åå³è§†ä¸ºæ¶ˆæ¯å·²è¢«æäº¤ã€‚è¿™ç§é…ç½®ä¸‹ï¼Œç”Ÿäº§è€…ä¼šæ”¶åˆ°åˆ†åŒº leader<br>çš„ç¡®è®¤ï¼Œä½†ä»æœ‰å¯èƒ½å‡ºç°æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œä¾‹å¦‚å½“ leader å‡ºç°æ•…éšœï¼Œè€Œæ¶ˆæ¯å°šæœªå¤åˆ¶åˆ°å…¶ä»–å‰¯æœ¬æ—¶ã€‚</p></li><li><p>acks=all æˆ–acks=-1ï¼šç”Ÿäº§è€…éœ€è¦ç­‰å¾…æ‰€æœ‰åˆ†åŒºå‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯åæ‰è§†ä¸ºæ¶ˆæ¯å·²è¢«æäº¤ã€‚è¿™ç§é…ç½®ä¸‹ï¼Œç”Ÿäº§è€…ä¼šç­‰å¾…æ‰€æœ‰åˆ†åŒºå‰¯æœ¬çš„ç¡®è®¤ï¼Œç¡®ä¿æ¶ˆæ¯è¢«å¤åˆ¶åˆ°è¶³å¤Ÿæ•°é‡çš„å‰¯æœ¬åæ‰è¿”å›æäº¤ç¡®è®¤ã€‚è¿™æ˜¯æœ€å®‰å…¨çš„ç¡®è®¤æ–¹å¼ï¼Œä½†ä¹Ÿä¼šå¯¼è‡´è¾ƒé•¿çš„ç­‰å¾…æ—¶é—´ã€‚</p></li></ol><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ ¹æ®å¯¹æ¶ˆæ¯å¯é æ€§å’Œå»¶è¿Ÿçš„è¦æ±‚ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ ACKs çº§åˆ«ã€‚<strong>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå¯¹æ¶ˆæ¯çš„å¯é æ€§è¦æ±‚è¾ƒé«˜ï¼Œå¯ä»¥é€‰æ‹©è¾ƒé«˜çš„ ACKs çº§åˆ«ï¼Œä½†éœ€è¦è€ƒè™‘ç›¸åº”çš„å»¶è¿Ÿæˆæœ¬ã€‚</strong></p><h3 id="äºŒã€AckModeæ¨¡å¼"><a href="#äºŒã€AckModeæ¨¡å¼" class="headerlink" title="äºŒã€AckModeæ¨¡å¼"></a>äºŒã€AckModeæ¨¡å¼</h3><ol><li><p>RECORDï¼šå½“æ¯ä¸€æ¡è®°å½•è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åæäº¤<br>å½“ä½¿ç”¨ RECORD ç¡®è®¤æ¨¡å¼æ—¶ï¼Œæ¶ˆæ¯ç›‘å¬å®¹å™¨ä¼šåœ¨æ¯ä¸ªæ¶ˆæ¯è¢«å•ç‹¬å¤„ç†åè¿›è¡Œç¡®è®¤ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†ï¼Œå®ƒå°†ä½œä¸ºå•ç‹¬çš„è®°å½•è¿›è¡Œç¡®è®¤ï¼›å¦‚æœå¤„ç†å¤±è´¥ï¼Œä¹Ÿä¼šé’ˆå¯¹è¯¥æ¶ˆæ¯è¿›è¡Œé”™è¯¯è®°å½•ã€‚è¿™ç§ç¡®è®¤æ¨¡å¼é€‚ç”¨äºéœ€è¦ç²¾ç¡®å¤„ç†æ¯ä¸ªæ¶ˆæ¯çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ç¡®ä¿æ¯ä¸ªæ¶ˆæ¯éƒ½è¢«æ­£ç¡®å¤„ç†ã€‚</p></li><li><p>BATCHï¼šå½“æ¯ä¸€æ‰¹poll()çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åæäº¤<br>å½“ä½¿ç”¨ BATCH ç¡®è®¤æ¨¡å¼æ—¶ï¼Œæ¶ˆæ¯ç›‘å¬å®¹å™¨ä¼šåœ¨æ‰¹é‡å¤„ç†ä¸€ç»„æ¶ˆæ¯åè¿›è¡Œç¡®è®¤ã€‚è¿™æ„å‘³ç€ï¼Œæ¶ˆæ¯ç›‘å¬å®¹å™¨ä¼šå°†å¤šä¸ªæ¶ˆæ¯åˆå¹¶ä¸ºæ‰¹æ¬¡ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ã€‚åªæœ‰åœ¨æ•´ä¸ªæ‰¹æ¬¡éƒ½è¢«æˆåŠŸå¤„ç†åï¼Œè¯¥æ‰¹æ¬¡çš„æ‰€æœ‰æ¶ˆæ¯æ‰ä¼šè¢«ç¡®è®¤ã€‚è¿™ç§ç¡®è®¤æ¨¡å¼é€‚ç”¨äºéœ€è¦æé«˜å¤„ç†æ•ˆç‡çš„åœºæ™¯ï¼Œä¾‹å¦‚æ‰¹é‡å¤„ç†å¤§é‡æ¶ˆæ¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“å’Œç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</p></li><li><p>TIMEï¼šå½“æ¯ä¸€æ‰¹poll()çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè·ç¦»ä¸Šæ¬¡æäº¤æ—¶é—´å¤§äºTIMEæ—¶æäº¤</p></li><li><p>COUNTï¼šå½“æ¯ä¸€æ‰¹poll()çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè¢«å¤„ç†recordæ•°é‡å¤§äºç­‰äºCOUNTæ—¶æäº¤</p></li><li><p>COUNT_TIMEï¼šTIMEæˆ–COUNTâ€ƒæœ‰ä¸€ä¸ªæ¡ä»¶æ»¡è¶³æ—¶æäº¤</p></li><li><p>MANUALï¼šè¿™æ˜¯æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ Acknowledgment.acknowledge() æ–¹æ³•æ¥ç¡®è®¤æ¶ˆæ¯ã€‚åªæœ‰å½“æ¶ˆè´¹è€…è°ƒç”¨ acknowledge() æ–¹æ³•åï¼Œæ‰ä¼šå‘ Kafka æœåŠ¡å™¨å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§å’Œé¡ºåºæ€§ï¼Œä½†éœ€è¦æ¶ˆè´¹è€…æ˜¾å¼åœ°å¤„ç†ç¡®è®¤é€»è¾‘ã€‚</p></li><li><p>MANUAL_IMMEDIATEï¼šè¿™æ˜¯ç«‹å³æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œä¸ MANUAL æ¨¡å¼ç±»ä¼¼ï¼Œä½†æ¶ˆè´¹è€…åœ¨è°ƒç”¨ acknowledge() æ–¹æ³•æ—¶ï¼Œä¼šç«‹å³å‘ Kafka æœåŠ¡å™¨å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥æé«˜æ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦ï¼Œä½†å¯èƒ½ä¼šå¢åŠ é‡å¤æ¶ˆè´¹çš„é£é™©ã€‚</p></li></ol><blockquote><p>MANUALå’ŒMANUAL_IMMEDIATEçš„åŒºåˆ«ï¼Ÿ</p><ol><li><p>MANUAL å’Œ MANUAL_IMMEDIATE éƒ½æ˜¯ Kafka æ¶ˆè´¹è€…çš„æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºç¡®è®¤çš„æ—¶æœºä¸åŒã€‚</p></li><li><p>MANUAL æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ Acknowledgment.acknowledge() æ–¹æ³•æ¥ç¡®è®¤æ¶ˆæ¯ï¼Œåœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹åï¼Œæ¶ˆæ¯æ‰ä¼šè¢«æ ‡è®°ä¸ºå·²æ¶ˆè´¹ï¼Œå¹¶ä¸”ç¡®è®¤æ¶ˆæ¯ä¼šåœ¨ä¸‹æ¬¡ poll() æ—¶å‘é€åˆ° Kafka æœåŠ¡å™¨ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§å’Œé¡ºåºæ€§ï¼Œä½†éœ€è¦æ¶ˆè´¹è€…æ˜¾å¼åœ°å¤„ç†ç¡®è®¤é€»è¾‘ã€‚</p></li></ol><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMANUAL_IMMEDIATE æ¨¡å¼ä¸‹ï¼Œåœ¨æ¶ˆè´¹è€…è°ƒç”¨ Acknowledgment.acknowledge() æ–¹æ³•æ—¶ï¼Œä¼šç«‹å³å‘ Kafka æœåŠ¡å™¨å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥æé«˜æ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦ï¼Œä½†å¯èƒ½ä¼šå¢åŠ é‡å¤æ¶ˆè´¹çš„é£é™©ï¼Œå› ä¸ºå¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼ŒKafka ä¸ä¼šå†æ¬¡å‘é€è¯¥æ¶ˆæ¯ï¼Œè€Œæ˜¯è®¤ä¸ºè¯¥æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹äº†ã€‚</p></blockquote><p><strong>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚æ¥é€‰æ‹©åˆé€‚çš„ç¡®è®¤æ¨¡å¼ã€‚å¦‚æœè¦æ±‚æ¶ˆæ¯çš„å¯é æ€§å’Œé¡ºåºæ€§æ¯”è¾ƒé«˜ï¼Œå¯ä»¥é€‰æ‹© MANUAL æ¨¡å¼ï¼›å¦‚æœè¦æ±‚å¤„ç†é€Ÿåº¦æ¯”è¾ƒé«˜ï¼Œå¯ä»¥é€‰æ‹© MANUAL_IMMEDIATE æ¨¡å¼ã€‚</strong></p><h3 id="ä¸‰ã€æ‰‹åŠ¨æäº¤"><a href="#ä¸‰ã€æ‰‹åŠ¨æäº¤" class="headerlink" title="ä¸‰ã€æ‰‹åŠ¨æäº¤"></a>ä¸‰ã€æ‰‹åŠ¨æäº¤</h3><p>kafkaé»˜è®¤æ˜¯è‡ªåŠ¨æäº¤ackçš„ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨æäº¤ï¼Œè¿™å°±è¦è¿›è¡Œä»¥ä¸‹é…ç½®</p><p>1ã€è®¾ç½®enable-auto-commit=falseï¼Œç¦æ­¢è‡ªåŠ¨æäº¤<br>2ã€è®¾ç½®ack-modeä¸ºmanual_immediate</p><p>åœ¨é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.kafka.consumer.enable-auto-commit</span> = <span class="string">false</span></span><br><span class="line"><span class="meta">spring.kafka.listener.ack-mode</span> = <span class="string">manual_immediate</span></span><br></pre></td></tr></table></figure><p>3ã€ç›‘å¬æ–¹æ³•çš„å…¥å‚åŠ å…¥Acknowledgment ack å‚æ•°ï¼Œå¹¶åœ¨æ¶ˆè´¹å®Œæˆä¹‹åè°ƒç”¨acknowledgeæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@KafkaListener</span>(topics = <span class="string">"ä¸»é¢˜"</span>,groupId = <span class="string">"ç»„ID"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">receiveMessage2</span><span class="params">(String message, Acknowledgment ack)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">"æ¶ˆè´¹æ¶ˆæ¯ï¼š"</span> + message);</span><br><span class="line">    <span class="comment">//ackç¡®è®¤</span></span><br><span class="line">    ack.acknowledge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>MYSQL MyISAMæ’å…¥æ…¢é—®é¢˜è§£å†³</title>
    <url>/post/e4853862.html</url>
    <content><![CDATA[<blockquote><p><code>MySQL MyISAM</code>æ’å…¥æ…¢ ~</p></blockquote><a id="more"></a><h3 id="è§£å†³MySQL-MyISAMæ’å…¥æ…¢çš„é—®é¢˜"><a href="#è§£å†³MySQL-MyISAMæ’å…¥æ…¢çš„é—®é¢˜" class="headerlink" title="è§£å†³MySQL MyISAMæ’å…¥æ…¢çš„é—®é¢˜"></a>è§£å†³<code>MySQL MyISAM</code>æ’å…¥æ…¢çš„é—®é¢˜</h3><p>åœ¨ä½¿ç”¨<code>MySQL</code>æ•°æ®åº“æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æ’å…¥æ•°æ®è¿‡æ…¢çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“è¡¨ä½¿ç”¨<code>MyISAM</code>å¼•æ“æ—¶ã€‚MyISAMæ˜¯ä¸€ç§MySQLæ•°æ®åº“å¼•æ“ï¼Œè™½ç„¶åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½å¾ˆå¥½ï¼Œä½†åœ¨æ’å…¥å¤§é‡æ•°æ®æ—¶å¯èƒ½ä¼šå‡ºç°æ€§èƒ½ä¸‹é™çš„æƒ…å†µã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•è§£å†³<code>MySQL MyISAM</code>æ’å…¥æ…¢çš„é—®é¢˜ï¼Œå¹¶æä¾›ä¸€äº›ä»£ç ç¤ºä¾‹ã€‚</p><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><p><code>MySQL</code>çš„<code>MyISAM</code>å¼•æ“åœ¨æ’å…¥å¤§é‡æ•°æ®æ—¶ï¼Œä¼šå‡ºç°è¡¨é”å®šçš„æƒ…å†µï¼Œå¯¼è‡´æ’å…¥æ“ä½œå˜æ…¢ã€‚è¿™æ˜¯å› ä¸ºMyISAMå¼•æ“æ˜¯è¡¨çº§é”å®šçš„ï¼Œå³åœ¨æ’å…¥æ•°æ®æ—¶ä¼šé”å®šæ•´ä¸ªè¡¨ï¼Œå…¶ä»–æ“ä½œå¿…é¡»ç­‰å¾…æ’å…¥æ“ä½œå®Œæˆåæ‰èƒ½æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ol><li>ä½¿ç”¨<code>InnoDB</code>å¼•æ“<br>ä¸€ä¸ªè§£å†³<code>MySQL MyISAM</code>æ’å…¥æ…¢çš„æ–¹æ³•æ˜¯å°†è¡¨çš„å¼•æ“ä»<code>MyISAM</code>æ”¹ä¸º<code>InnoDB</code>ã€‚<code>InnoDB</code>æ˜¯<code>MySQL</code>çš„å¦ä¸€ç§å¼•æ“ï¼Œå®ƒæ”¯æŒè¡Œçº§é”å®šï¼Œèƒ½å¤Ÿæé«˜æ’å…¥æ•°æ®çš„æ€§èƒ½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å°†è¡¨çš„å¼•æ“ä»<code>MyISAM</code>æ”¹ä¸º<code>InnoDB</code>ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>æ‰¹é‡æ’å…¥æ•°æ®<br>å¦ä¸€ä¸ªè§£å†³<code>MySQL MyISAM</code>æ’å…¥æ…¢çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ‰¹é‡æ’å…¥æ•°æ®çš„æ–¹å¼ã€‚é€šè¿‡ä¸€æ¬¡æ€§æ’å…¥å¤šæ¡æ•°æ®ï¼Œå¯ä»¥å‡å°‘è¡¨çš„é”å®šæ—¶é—´ï¼Œæé«˜æ’å…¥æ•°æ®çš„æ•ˆç‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•æ‰¹é‡æ’å…¥æ•°æ®ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1, column2)</span><br><span class="line"><span class="keyword">VALUES</span> (value1, value2),</span><br><span class="line">       (value3, value4),</span><br><span class="line">       ...</span><br></pre></td></tr></table></figure><ol start="3"><li>å…³é—­è‡ªåŠ¨æäº¤<br>åœ¨æ’å…¥å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥è€ƒè™‘å…³é—­<code>MySQL</code>çš„è‡ªåŠ¨æäº¤åŠŸèƒ½ã€‚åœ¨æ¯æ¬¡æ’å…¥æ•°æ®åæ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œå¯ä»¥å‡å°‘äº‹åŠ¡æ—¥å¿—çš„å†™å…¥ï¼Œæé«˜æ’å…¥æ•°æ®çš„æ€§èƒ½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å…³é—­è‡ªåŠ¨æäº¤ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1, column2) <span class="keyword">VALUES</span> (value1, value2);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Sql</category>
      </categories>
      <tags>
        <tag>Sql</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡çš„å‡ ç§æ–¹å¼</title>
    <url>/post/18cb4f97.html</url>
    <content><![CDATA[<blockquote><p>å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡çš„å‡ ç§æ–¹å¼ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€çº¿ç¨‹-Thread"><a href="#ä¸€ã€çº¿ç¨‹-Thread" class="headerlink" title="ä¸€ã€çº¿ç¨‹ Thread"></a>ä¸€ã€çº¿ç¨‹ Thread</h3><ol><li><p>åˆ›å»ºç±»å¹¶ <strong>ç»§æ‰¿Thread</strong> æˆ–è€… <strong>å®ç° Runnable</strong> å†æˆ–è€… <strong>å®ç° Callable æ¥å£</strong> æ¥å£å®ç°ã€‚</p></li><li><p>é‡‡ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å°è£…åˆ°Runnableæˆ–Callableä¸­ï¼Œäº¤ç”±çº¿ç¨‹æ± æ¥æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ThreadFactory namedThreadFactory =</span><br><span class="line">        <span class="keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="string">"thread-call-runner-%d"</span>).build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService =</span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">10</span>, <span class="number">20</span>, <span class="number">200L</span>, TimeUnit.MILLISECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(), namedThreadFactory);</span><br><span class="line"><span class="comment">// å¼€å¯æ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">executorService.submit(() -&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure></li></ol><h3 id="äºŒã€ç»å…¸çš„Future"><a href="#äºŒã€ç»å…¸çš„Future" class="headerlink" title="äºŒã€ç»å…¸çš„Future"></a>äºŒã€ç»å…¸çš„Future</h3><p>Java ä»1.5ç‰ˆæœ¬å¼€å§‹ï¼Œæä¾›äº† Callable å’Œ Futureï¼Œå¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå¾—åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ä½†æ˜¯æœ‰ä¸è¶³ä¹‹å¤„ï¼š</p><ol><li><strong>æ— æ³•è¢«åŠ¨æ¥æ”¶å¼‚æ­¥ä»»åŠ¡çš„è®¡ç®—ç»“æœï¼š</strong>è™½ç„¶æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨å°†å¼‚æ­¥ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ¥æ‰§è¡Œï¼Œä½†æ˜¯å¾…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œä¸»çº¿ç¨‹æ— æ³•å¾—åˆ°ä»»åŠ¡å®Œæˆä¸å¦çš„é€šçŸ¥ï¼Œå®ƒéœ€è¦é€šè¿‡getæ–¹æ³•ä¸»åŠ¨è·å–ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚</li><li><strong>Futureä»¶å½¼æ­¤å­¤ç«‹ï¼š</strong>æœ‰æ—¶æŸä¸€ä¸ªè€—æ—¶å¾ˆé•¿çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œä½ æƒ³åˆ©ç”¨å®ƒè¿”å›çš„ç»“æœå†åšè¿›ä¸€æ­¥çš„è¿ç®—ï¼Œè¯¥è¿ç®—ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¸¤è€…ä¹‹é—´çš„å…³ç³»éœ€è¦ç¨‹åºå¼€å‘äººå‘˜æ‰‹åŠ¨è¿›è¡Œç»‘å®šèµ‹äºˆï¼ŒFutureå¹¶ä¸èƒ½å°†å…¶å½¢æˆä¸€ä¸ªä»»åŠ¡æµï¼ˆpipelineï¼‰ï¼Œæ¯ä¸€ä¸ªFutureéƒ½æ˜¯å½¼æ­¤ä¹‹é—´éƒ½æ˜¯å­¤ç«‹çš„ï¼Œæ‰€ä»¥æ‰æœ‰äº†åé¢çš„<code>CompletableFuture</code>ï¼Œ<code>CompletableFuture</code>å°±å¯ä»¥å°†å¤šä¸ªFutureä¸²è”èµ·æ¥å½¢æˆä»»åŠ¡æµã€‚</li><li><strong>Futrueæ²¡æœ‰å¾ˆå¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š</strong>æˆªæ­¢ç›®å‰ï¼Œå¦‚æœæŸä¸ªå¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œå‘çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè°ƒç”¨è€…æ— æ³•è¢«åŠ¨æ„ŸçŸ¥ï¼Œå¿…é¡»é€šè¿‡æ•è·getæ–¹æ³•çš„å¼‚å¸¸æ‰çŸ¥æ™“å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæ˜¯å¦å‡ºç°äº†é”™è¯¯ï¼Œä»è€Œåœ¨åšè¿›ä¸€æ­¥çš„åˆ¤æ–­å¤„ç†ã€‚</li></ol><h3 id="ä¸‰ã€CompletableFutureå®ç°å¼‚æ­¥"><a href="#ä¸‰ã€CompletableFutureå®ç°å¼‚æ­¥" class="headerlink" title="ä¸‰ã€CompletableFutureå®ç°å¼‚æ­¥"></a>ä¸‰ã€<code>CompletableFuture</code>å®ç°å¼‚æ­¥</h3><p>Java ä»1.8ç‰ˆæœ¬å¼€å§‹ï¼Œå¼€å§‹æ”¯æŒ<code>CompletableFuture</code>å®ç°å¼‚æ­¥ï¼Œå¯ä»¥è§£å†³<code>Future</code> çš„è¿™äº›ç¼ºé™·ã€‚<code>CompletableFuture</code> é™¤äº†æä¾›äº†æ›´ä¸ºå¥½ç”¨å’Œå¼ºå¤§çš„ <code>Future</code> ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜æä¾›äº†è¿è¡Œå¤šä¸ª <code>CompletableFuture</code>ã€å‡½æ•°å¼ç¼–ç¨‹ã€å¼‚æ­¥ä»»åŠ¡ç¼–æ’ç»„åˆï¼ˆå¯ä»¥å°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ä¸²è”èµ·æ¥ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„é“¾å¼è°ƒç”¨ï¼‰ç­‰èƒ½åŠ›ã€‚</p><h3 id="å››ã€Springçš„-Asyncå¼‚æ­¥"><a href="#å››ã€Springçš„-Asyncå¼‚æ­¥" class="headerlink" title="å››ã€Springçš„@Asyncå¼‚æ­¥"></a>å››ã€Springçš„<code>@Async</code>å¼‚æ­¥</h3><p><strong>ï¼ˆ1ï¼‰è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹æ± å‚æ•°é…ç½®ï¼Œå¤šä¸ªçº¿ç¨‹æ± å®ç°çº¿ç¨‹æ± éš”ç¦»ï¼Œ<span class="doctag">@Async</span>æ³¨è§£ï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå¯åœ¨é¡¹ç›®ä¸­è®¾ç½®å¤šä¸ªçº¿ç¨‹æ± ï¼Œåœ¨å¼‚æ­¥è°ƒç”¨çš„æ—¶å€™ï¼ŒæŒ‡æ˜éœ€è¦è°ƒç”¨çš„çº¿ç¨‹æ± åç§°ï¼Œæ¯”å¦‚ï¼š<span class="doctag">@Async</span>("taskName")</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskPoolConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">taskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è¿”å›å¯ç”¨å¤„ç†å™¨çš„Javaè™šæ‹Ÿæœºçš„æ•°é‡ 12</span></span><br><span class="line">        <span class="keyword">int</span> i = Runtime.getRuntime().availableProcessors();</span><br><span class="line">        System.out.println(<span class="string">"ç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•°  ï¼š"</span> + i);</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        <span class="comment">//æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">        executor.setCorePoolSize(<span class="number">16</span>);</span><br><span class="line">        <span class="comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">        executor.setMaxPoolSize(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">//é…ç½®é˜Ÿåˆ—å®¹é‡ï¼Œé»˜è®¤å€¼ä¸ºInteger.MAX_VALUE</span></span><br><span class="line">        executor.setQueueCapacity(<span class="number">99999</span>);</span><br><span class="line">        <span class="comment">//æ´»è·ƒæ—¶é—´</span></span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">        <span class="comment">//çº¿ç¨‹åå­—å‰ç¼€</span></span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">"asyncServiceExecutor -"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­¤æ‰§è¡Œç¨‹åºåº”è¯¥åœ¨å…³é—­æ—¶é˜»æ­¢çš„æœ€å¤§ç§’æ•°ï¼Œä»¥ä¾¿åœ¨å®¹å™¨çš„å…¶ä½™éƒ¨åˆ†ç»§ç»­å…³é—­ä¹‹å‰ç­‰å¾…å‰©ä½™çš„ä»»åŠ¡å®Œæˆä»–ä»¬çš„æ‰§è¡Œ</span></span><br><span class="line">        executor.setAwaitTerminationSeconds(<span class="number">60</span>);</span><br><span class="line">        <span class="comment">//ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡ç»“æŸåå†å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        executor.setWaitForTasksToCompleteOnShutdown(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰ <code>AsyncService</code></strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">    <span class="function">MessageResult <span class="title">sendSms</span><span class="params">(String callPrefix, String mobile, String actionType, String content)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncServiceImpl</span> <span class="keyword">implements</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IMessageHandler mesageHandler;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageResult <span class="title">sendSms</span><span class="params">(String callPrefix, String mobile, String actionType, String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            mesageHandler.sendSms(callPrefix, mobile, actionType, content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"å‘é€çŸ­ä¿¡å¼‚å¸¸ -&gt; "</span>, e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”ã€Spring-ApplicationEventäº‹ä»¶å®ç°å¼‚æ­¥"><a href="#äº”ã€Spring-ApplicationEventäº‹ä»¶å®ç°å¼‚æ­¥" class="headerlink" title="äº”ã€Spring ApplicationEventäº‹ä»¶å®ç°å¼‚æ­¥"></a>äº”ã€<code>Spring ApplicationEvent</code>äº‹ä»¶å®ç°å¼‚æ­¥</h3><p><strong>ï¼ˆ1ï¼‰å®šä¹‰äº‹ä»¶</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncSendEmailEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‚®ç®±</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸»é¢˜</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†…å®¹</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶è€…</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">private</span> String targetUserId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰å®šä¹‰äº‹ä»¶å¤„ç†å™¨</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncSendEmailEventHandler</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">AsyncSendEmailEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IMessageHandler mesageHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"taskExecutor"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(AsyncSendEmailEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String email = event.getEmail();</span><br><span class="line">        String subject = event.getSubject();</span><br><span class="line">        String content = event.getContent();</span><br><span class="line">        String targetUserId = event.getTargetUserId();</span><br><span class="line">        mesageHandler.sendsendEmailSms(email, subject, content, targerUserId);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…­ã€hutool-çš„ThreadUtilå¼‚æ­¥å·¥å…·ç±»"><a href="#å…­ã€hutool-çš„ThreadUtilå¼‚æ­¥å·¥å…·ç±»" class="headerlink" title="å…­ã€hutool çš„ThreadUtilå¼‚æ­¥å·¥å…·ç±»"></a>å…­ã€<code>hutool</code> çš„<code>ThreadUtil</code>å¼‚æ­¥å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            ThreadUtil.execAsync(() -&gt; &#123;</span><br><span class="line">                ThreadLocalRandom threadLocalRandom = ThreadLocalRandom.current();</span><br><span class="line">                <span class="keyword">int</span> number = threadLocalRandom.nextInt(<span class="number">20</span>) + <span class="number">1</span>;</span><br><span class="line">                System.out.println(number);</span><br><span class="line">            &#125;);</span><br><span class="line">            log.info(<span class="string">"å½“å‰ç¬¬ï¼š"</span> + i + <span class="string">"ä¸ªçº¿ç¨‹"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"task finish!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒã€Guavaå¼‚æ­¥"><a href="#ä¸ƒã€Guavaå¼‚æ­¥" class="headerlink" title="ä¸ƒã€Guavaå¼‚æ­¥"></a>ä¸ƒã€Guavaå¼‚æ­¥</h3><p>Guavaçš„ <code>ListenableFuture</code> é¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥ç›‘å¬çš„Futureï¼Œæ˜¯å¯¹javaåŸç”ŸFutureçš„æ‰©å±•å¢å¼ºã€‚æˆ‘ä»¬çŸ¥é“Futureè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—ä»»åŠ¡ï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶å¯ä»¥å¾—åˆ°è®¡ç®—ç»“æœã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€æ—¦è®¡ç®—å®Œæˆå°±æ‹¿åˆ°ç»“æœå±•ç¤ºç»™ç”¨æˆ·æˆ–è€…åšå¦å¤–çš„è®¡ç®—ï¼Œå°±å¿…é¡»ä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸æ–­çš„æŸ¥è¯¢è®¡ç®—çŠ¶æ€ã€‚è¿™æ ·åšï¼Œä»£ç å¤æ‚ï¼Œè€Œä¸”æ•ˆç‡ä½ä¸‹ã€‚ä½¿ç”¨ã€ŒGuava <code>ListenableFuture</code>ã€å¯ä»¥å¸®æˆ‘ä»¬æ£€æµ‹Futureæ˜¯å¦å®Œæˆäº†ï¼Œä¸éœ€è¦å†é€šè¿‡ get() æ–¹æ³•è‹¦è‹¦ç­‰å¾…å¼‚æ­¥çš„è®¡ç®—ç»“æœï¼Œå¦‚æœå®Œæˆå°±è‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¹¶å‘ç¨‹åºçš„å¤æ‚åº¦ã€‚</p><h4 id="åœºæ™¯ä¸€ï¼šç®€å•åˆ›å»º"><a href="#åœºæ™¯ä¸€ï¼šç®€å•åˆ›å»º" class="headerlink" title="åœºæ™¯ä¸€ï¼šç®€å•åˆ›å»º"></a>åœºæ™¯ä¸€ï¼šç®€å•åˆ›å»º</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ListeningExecutorService executorService = MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line">        <span class="keyword">final</span> ListenableFuture&lt;Integer&gt; listenableFuture = executorService.submit(<span class="keyword">new</span> Callable&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                log.info(<span class="string">"callable execute..."</span>)</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallback&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Integer result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æˆåŠŸæ‰§è¡Œ...</span></span><br><span class="line">        System.out.println(<span class="string">"Get listenable future's result with callback "</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¼‚å¸¸æƒ…å†µå¤„ç†...</span></span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, executorService);</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯äºŒï¼šç›‘å¬å™¨ç®¡ç†"><a href="#åœºæ™¯äºŒï¼šç›‘å¬å™¨ç®¡ç†" class="headerlink" title="åœºæ™¯äºŒï¼šç›‘å¬å™¨ç®¡ç†"></a>åœºæ™¯äºŒï¼šç›‘å¬å™¨ç®¡ç†</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenerManagement</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListeningExecutorService executor = </span><br><span class="line">        MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demonstrateListeners</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ListenableFutureTask&lt;String&gt; task = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"ä»»åŠ¡æ‰§è¡Œä¸­..."</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ä»»åŠ¡å®Œæˆ"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. æ·»åŠ ç®€å•ç›‘å¬å™¨</span></span><br><span class="line">        task.addListener(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"ç®€å•ç›‘å¬å™¨: ä»»åŠ¡çŠ¶æ€æ”¹å˜"</span>);</span><br><span class="line">        &#125;, executor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æ·»åŠ å¸¦ç»“æœå¤„ç†çš„å›è°ƒ</span></span><br><span class="line">        Futures.addCallback(task, <span class="keyword">new</span> FutureCallback&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"æˆåŠŸå›è°ƒ: "</span> + result);</span><br><span class="line">                processSuccess(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                System.err.println(<span class="string">"å¤±è´¥å›è°ƒ: "</span> + t.getMessage());</span><br><span class="line">                handleFailure(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, executor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æ·»åŠ å¤šä¸ªç›‘å¬å™¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> listenerId = i;</span><br><span class="line">            task.addListener(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"ç›‘å¬å™¨ "</span> + listenerId + <span class="string">" è¢«è§¦å‘"</span>);</span><br><span class="line">            &#125;, executor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executor.execute(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¤„ç†æˆåŠŸç»“æœ: "</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"å¤„ç†å¤±è´¥: "</span> + t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯ä¸‰ï¼šå¼‚æ­¥ä»»åŠ¡é“¾"><a href="#åœºæ™¯ä¸‰ï¼šå¼‚æ­¥ä»»åŠ¡é“¾" class="headerlink" title="åœºæ™¯ä¸‰ï¼šå¼‚æ­¥ä»»åŠ¡é“¾"></a>åœºæ™¯ä¸‰ï¼šå¼‚æ­¥ä»»åŠ¡é“¾</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTaskChain</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListeningExecutorService executor = </span><br><span class="line">        MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListenableFuture&lt;String&gt; <span class="title">executeTaskChain</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ­¥ï¼šæ•°æ®é¢„å¤„ç†</span></span><br><span class="line">        ListenableFutureTask&lt;String&gt; step1 = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ­¥éª¤1: é¢„å¤„ç†"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"preprocessed_"</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ­¥ï¼šä¸»è¦å¤„ç†ï¼ˆä¾èµ–ç¬¬ä¸€æ­¥ç»“æœï¼‰</span></span><br><span class="line">        ListenableFuture&lt;String&gt; step2 = Futures.transformAsync(step1, </span><br><span class="line">            step1Result -&gt; &#123;</span><br><span class="line">                ListenableFutureTask&lt;String&gt; task = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"æ­¥éª¤2: ä¸»è¦å¤„ç† "</span> + step1Result);</span><br><span class="line">                    Thread.sleep(<span class="number">1500</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"main_"</span> + step1Result;</span><br><span class="line">                &#125;);</span><br><span class="line">                executor.execute(task);</span><br><span class="line">                <span class="keyword">return</span> task;</span><br><span class="line">            &#125;, executor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¬¬ä¸‰æ­¥ï¼šåå¤„ç†ï¼ˆä¾èµ–ç¬¬äºŒæ­¥ç»“æœï¼‰</span></span><br><span class="line">        ListenableFuture&lt;String&gt; step3 = Futures.transformAsync(step2,</span><br><span class="line">            step2Result -&gt; &#123;</span><br><span class="line">                ListenableFutureTask&lt;String&gt; task = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"æ­¥éª¤3: åå¤„ç† "</span> + step2Result);</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"final_"</span> + step2Result;</span><br><span class="line">                &#125;);</span><br><span class="line">                executor.execute(task);</span><br><span class="line">                <span class="keyword">return</span> task;</span><br><span class="line">            &#125;, executor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ä»»åŠ¡é“¾</span></span><br><span class="line">        executor.execute(step1);</span><br><span class="line">        <span class="keyword">return</span> step3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯å››ï¼šç»„åˆæ¨¡å¼åº”ç”¨"><a href="#åœºæ™¯å››ï¼šç»„åˆæ¨¡å¼åº”ç”¨" class="headerlink" title="åœºæ™¯å››ï¼šç»„åˆæ¨¡å¼åº”ç”¨"></a>åœºæ™¯å››ï¼šç»„åˆæ¨¡å¼åº”ç”¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeTaskPattern</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListeningExecutorService executor = </span><br><span class="line">        MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListenableFuture&lt;String&gt; <span class="title">createCompositeTask</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¤šä¸ªå­ä»»åŠ¡</span></span><br><span class="line">        ListenableFutureTask&lt;String&gt; validationTask = createValidationTask(input);</span><br><span class="line">        ListenableFutureTask&lt;String&gt; processingTask = createProcessingTask(input);</span><br><span class="line">        ListenableFutureTask&lt;String&gt; enrichmentTask = createEnrichmentTask(input);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰å­ä»»åŠ¡</span></span><br><span class="line">        ListenableFuture&lt;List&lt;String&gt;&gt; allTasks = Futures.allAsList(</span><br><span class="line">            validationTask, processingTask, enrichmentTask);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Futures.transform(allTasks, <span class="keyword">this</span>::combineResults, executor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ListenableFutureTask&lt;String&gt; <span class="title">createValidationTask</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"validated_"</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ListenableFutureTask&lt;String&gt; <span class="title">createProcessingTask</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">300</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"processed_"</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ListenableFutureTask&lt;String&gt; <span class="title">createEnrichmentTask</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">250</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"enriched_"</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">combineResults</span><span class="params">(List&lt;String&gt; results)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">"|"</span>, results);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åœºæ™¯äº”ï¼šå¼‚å¸¸å¤„ç†ç­–ç•¥"><a href="#åœºæ™¯äº”ï¼šå¼‚å¸¸å¤„ç†ç­–ç•¥" class="headerlink" title="åœºæ™¯äº”ï¼šå¼‚å¸¸å¤„ç†ç­–ç•¥"></a>åœºæ™¯äº”ï¼šå¼‚å¸¸å¤„ç†ç­–ç•¥</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionHandlingStrategies</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListeningExecutorService executor = </span><br><span class="line">        MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListenableFuture&lt;String&gt; <span class="title">executeWithComprehensiveErrorHandling</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        ListenableFutureTask&lt;String&gt; task = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (input == <span class="keyword">null</span> || input.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"è¾“å…¥ä¸èƒ½ä¸ºç©º"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ç»“æœ: "</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ è¯¦ç»†çš„å¼‚å¸¸å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> Futures.catching(task, IllegalArgumentException<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">            <span class="title">e</span> -&gt; </span>&#123;</span><br><span class="line">                System.err.println(<span class="string">"è¾“å…¥éªŒè¯å¤±è´¥: "</span> + e.getMessage());</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"é»˜è®¤ç»“æœ"</span>;</span><br><span class="line">            &#125;, executor)</span><br><span class="line">        .catchingAsync(Exception<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">            <span class="title">e</span> -&gt; </span>&#123;</span><br><span class="line">                System.err.println(<span class="string">"ä»»åŠ¡æ‰§è¡Œå¤±è´¥: "</span> + e.getMessage());</span><br><span class="line">                <span class="keyword">return</span> executeFallbackTask(input);</span><br><span class="line">            &#125;, executor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ListenableFuture&lt;String&gt; <span class="title">executeFallbackTask</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        ListenableFutureTask&lt;String&gt; fallback = ListenableFutureTask.create(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ‰§è¡Œé™çº§ä»»åŠ¡"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"é™çº§ç»“æœ: "</span> + input;</span><br><span class="line">        &#125;);</span><br><span class="line">        executor.execute(fallback);</span><br><span class="line">        <span class="keyword">return</span> fallback;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…«ã€äº¬ä¸œasyncTool"><a href="#å…«ã€äº¬ä¸œasyncTool" class="headerlink" title="å…«ã€äº¬ä¸œasyncTool"></a>å…«ã€äº¬ä¸œ<code>asyncTool</code></h3><p>è§å®˜ç½‘ï¼š <a href="https://gitee.com/jd-platform-opensource/asyncTool" target="_blank" rel="noopener">asyncTool</a></p><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><ul><li><a href="https://tech.meituan.com/2022/05/12/principles-and-practices-of-completablefuture.html" target="_blank" rel="noopener">CompletableFuture åŸç†ä¸å®è·µ-å¤–å–å•†å®¶ç«¯ API çš„å¼‚æ­¥åŒ– - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/32Ak-WFLynQfpn0Cg0N-0A" target="_blank" rel="noopener">è¯» RocketMQ æºç ï¼Œå­¦ä¹ å¹¶å‘ç¼–ç¨‹ä¸‰å¤§ç¥å™¨ - å‹‡å“¥ java å®æˆ˜åˆ†äº«</a></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®è„±æ•</title>
    <url>/post/abac9caf.html</url>
    <content><![CDATA[<blockquote><p>æ•°æ®è„±æ•ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€SQLæ•°æ®è„±æ•å®ç°"><a href="#ä¸€ã€SQLæ•°æ®è„±æ•å®ç°" class="headerlink" title="ä¸€ã€SQLæ•°æ®è„±æ•å®ç°"></a>ä¸€ã€SQLæ•°æ®è„±æ•å®ç°</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CONCAT()ã€LEFT()å’ŒRIGHT()å­—ç¬¦ä¸²å‡½æ•°ç»„åˆä½¿ç”¨ï¼Œè¯·çœ‹ä¸‹é¢å…·ä½“å®ç°</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- CONCAT(str1,str2,â€¦)ï¼šè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">-- LEFT(str,len)ï¼šè¿”å›ä»å­—ç¬¦ä¸²str å¼€å§‹çš„len æœ€å·¦å­—ç¬¦</span></span><br><span class="line"><span class="comment">-- RIGHT(str,len)ï¼šä»å­—ç¬¦ä¸²str å¼€å§‹ï¼Œè¿”å›æœ€å³len å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- ç”µè¯å·ç è„±æ•sqlï¼š</span></span><br><span class="line"><span class="keyword">SELECT</span> mobilePhone <span class="keyword">AS</span> è„±æ•å‰ç”µè¯,<span class="keyword">CONCAT</span>(<span class="keyword">LEFT</span>(mobilePhone,<span class="number">3</span>), <span class="string">'********'</span> ) <span class="keyword">AS</span> è„±æ•åç”µè¯ <span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- èº«ä»½è¯å·ç è„±æ•sql:</span></span><br><span class="line"><span class="keyword">SELECT</span> idcard <span class="keyword">AS</span> æœªè„±æ•èº«ä»½è¯, <span class="keyword">CONCAT</span>(<span class="keyword">LEFT</span>(idcard,<span class="number">3</span>), <span class="string">'****'</span> ,<span class="keyword">RIGHT</span>(idcard,<span class="number">4</span>)) <span class="keyword">AS</span> è„±æ•åèº«ä»½è¯å· <span class="keyword">FROM</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure><h3 id="äºŒã€JAVAæ•°æ®è„±æ•å®ç°"><a href="#äºŒã€JAVAæ•°æ®è„±æ•å®ç°" class="headerlink" title="äºŒã€JAVAæ•°æ®è„±æ•å®ç°"></a>äºŒã€JAVAæ•°æ®è„±æ•å®ç°</h3><p>å¯å‚è€ƒï¼šæµ·å¼º / sensitive-plus</p><blockquote><p><a href="https://gitee.com/strong_sea/sensitive-plus" target="_blank" rel="noopener">https://gitee.com/strong_sea/sensitive-plus</a></p></blockquote><p>æ•°æ®è„±æ•æ’ä»¶ï¼Œç›®å‰æ”¯æŒåœ°å€è„±æ•ã€é“¶è¡Œå¡å·è„±æ•ã€ä¸­æ–‡å§“åè„±æ•ã€å›ºè¯è„±æ•ã€èº«ä»½è¯å·è„±æ•ã€æ‰‹æœºå·è„±æ•ã€å¯†ç è„±æ• ä¸€ä¸ªæ˜¯æ­£åˆ™è„±æ•ã€å¦å¤–ä¸€ä¸ªæ ¹æ®æ˜¾ç¤ºé•¿åº¦è„±æ•ï¼Œé»˜è®¤æ˜¯æ­£åˆ™è„±æ•ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é…ç½®è‡ªå·±çš„è§„åˆ™ã€‚</p><h3 id="ä¸‰ã€mybatis-mate-sensitive-jackson"><a href="#ä¸‰ã€mybatis-mate-sensitive-jackson" class="headerlink" title="ä¸‰ã€mybatis-mate-sensitive-jackson"></a>ä¸‰ã€mybatis-mate-sensitive-jackson</h3><p>mybatisplus çš„æ–°ä½œï¼Œå¯ä»¥æµ‹è¯•ä½¿ç”¨ï¼Œç”Ÿäº§éœ€è¦æ”¶è´¹ã€‚æ ¹æ®å®šä¹‰çš„ç­–ç•¥ç±»å‹ï¼Œå¯¹æ•°æ®è¿›è¡Œè„±æ•ï¼Œå½“ç„¶ç­–ç•¥å¯ä»¥è‡ªå®šä¹‰ã€‚</p><p><a href="https://gitee.com/baomidou/mybatis-mate-examples/tree/master/mybatis-mate-sensitive-jackson" target="_blank" rel="noopener">mybatis-mate-sensitive-jackson</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatisæ‰¹é‡æ’å…¥ä¼˜åŒ–</title>
    <url>/post/53b6cfac.html</url>
    <content><![CDATA[<blockquote><p>æ‰¹é‡æ’å…¥ä¼˜åŒ– ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æ™®é€šæ’å…¥"><a href="#ä¸€ã€æ™®é€šæ’å…¥" class="headerlink" title="ä¸€ã€æ™®é€šæ’å…¥"></a>ä¸€ã€æ™®é€šæ’å…¥</h3><p>éå† insert è¯­å¥ï¼Œå•æ¡æ‰§è¡Œï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå¦‚æœå¤§æ‰¹é‡æ•°æ®ç´¯ç§¯æ’å…¥ï¼Œæ€§èƒ½è‚¯å®šä¼šæœ‰é—®é¢˜ã€‚</p><h3 id="äºŒã€Foreach-ä¼˜åŒ–æ’å…¥"><a href="#äºŒã€Foreach-ä¼˜åŒ–æ’å…¥" class="headerlink" title="äºŒã€Foreach  ä¼˜åŒ–æ’å…¥"></a>äºŒã€Foreach ä¼˜åŒ–æ’å…¥</h3><p>å¦‚æœè¦ä¼˜åŒ–æ’å…¥é€Ÿåº¦æ—¶ï¼Œå¯ä»¥å°†è®¸å¤šå°å‹æ“ä½œç»„åˆåˆ°ä¸€ä¸ªå¤§å‹æ“ä½œä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"batchInsert"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span>&gt;</span></span><br><span class="line">    insert into table1 (field1, field2) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"t"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span> </span><br><span class="line">        (#&#123;t.field1&#125;, #&#123;t.field2&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å®é™…æ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`table1`</span> (<span class="string">`field1`</span>, <span class="string">`field2`</span>) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">"data1"</span>, <span class="string">"data2"</span>),</span><br><span class="line">(<span class="string">"data1"</span>, <span class="string">"data2"</span>),</span><br><span class="line">(<span class="string">"data1"</span>, <span class="string">"data2"</span>),</span><br><span class="line">(<span class="string">"data1"</span>, <span class="string">"data2"</span>),</span><br><span class="line">(<span class="string">"data1"</span>, <span class="string">"data2"</span>);</span><br></pre></td></tr></table></figure><p><strong>Foreach é‡åˆ°æ•°é‡å¤§ï¼Œæ€§èƒ½ç“¶é¢ˆ</strong></p><p>é¡¹ç›®å®è·µå‘ç°ï¼Œå½“è¡¨çš„åˆ—æ•°è¾ƒå¤šï¼ˆè¶…è¿‡20ï¼‰ï¼Œä»¥åŠä¸€æ¬¡æ€§æ’å…¥çš„è¡Œæ•°è¾ƒå¤šï¼ˆä¸Šä¸‡æ¡ï¼‰æ—¶ï¼Œæ’å…¥æ€§èƒ½éå¸¸å·®ï¼Œé€šå¸¸éœ€è¦20åˆ†é’Ÿä»¥ä¸Šã€‚</p><p><strong>å¦‚æœéœ€è¦ä½¿ç”¨ <code>foreach</code>æ¥ä¼˜åŒ–æ•°æ®æ’å…¥çš„è¯ï¼Œéœ€è¦å°†æ¯æ¬¡æ’å…¥çš„è®°å½•æ§åˆ¶åœ¨ 10-100 å·¦å³æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå»ºè®®æ¯æ¬¡100æ¥åˆ†å‰²æ•°æ®ï¼Œä¹Ÿå°±æ˜¯<code>åˆ†è€Œæ²»ä¹‹</code>æ€æƒ³ã€‚</strong></p><h3 id="ä¸‰ã€Mybatis-plus-æ‰¹é‡æ’å…¥"><a href="#ä¸‰ã€Mybatis-plus-æ‰¹é‡æ’å…¥" class="headerlink" title="ä¸‰ã€Mybatis-plus æ‰¹é‡æ’å…¥"></a>ä¸‰ã€Mybatis-plus æ‰¹é‡æ’å…¥</h3><p>Mybatis-Plus<code>ä¸ºserviceå±‚æä¾›äº†</code>ServiceImpl<code>çš„å®ç°ç±»ï¼Œå¯ä»¥ç›´æ¥</code>extends ServiceImpl&lt;mapper,object&gt;è¿›è¡Œè°ƒç”¨</p><p>é‡Œé¢æœ‰å°è£…å¥½çš„æ‰¹é‡æ’å…¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="keyword">int</span> batchSize)</span> </span>&#123;</span><br><span class="line">  String sqlStatement = <span class="keyword">this</span>.getSqlStatement(SqlMethod.INSERT_ONE);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.executeBatch(entityList, batchSize, (sqlSession, entity) -&gt; &#123;</span><br><span class="line">  sqlSession.insert(sqlStatement, entity);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> &lt;E&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">executeBatch</span><span class="params">(Collection&lt;E&gt; list, <span class="keyword">int</span> batchSize, BiConsumer&lt;SqlSession, E&gt; consumer)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> SqlHelper.executeBatch(<span class="keyword">this</span>.entityClass, <span class="keyword">this</span>.log, list, batchSize, consumer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SqlHelper.executeBatch</code>çš„å…·ä½“çš„å®ç°å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">executeBatch</span><span class="params">(Class&lt;?&gt; entityClass, Log log, Collection&lt;E&gt; list, <span class="keyword">int</span> batchSize, BiConsumer&lt;SqlSession, E&gt; consumer)</span> </span>&#123;</span><br><span class="line">        Assert.isFalse(batchSize &lt; <span class="number">1</span>, <span class="string">"batchSize must not be less than one"</span>, <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> !CollectionUtils.isEmpty(list) &amp;&amp; executeBatch(entityClass, log, (sqlSession) -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> size = list.size();</span><br><span class="line">            <span class="keyword">int</span> idxLimit = Math.min(batchSize, size);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(Iterator var7 = list.iterator(); var7.hasNext(); ++i) &#123;</span><br><span class="line">                E element = var7.next();</span><br><span class="line">                consumer.accept(sqlSession, element);</span><br><span class="line">                <span class="keyword">if</span> (i == idxLimit) &#123;</span><br><span class="line">                    sqlSession.flushStatements();</span><br><span class="line">                    idxLimit = Math.min(idxLimit + batchSize, size);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">executeBatch</span><span class="params">(Class&lt;?&gt; entityClass, Log log, Consumer&lt;SqlSession&gt; consumer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSessionFactory sqlSessionFactory = sqlSessionFactory(entityClass);</span><br><span class="line">            SqlSessionHolder sqlSessionHolder = (SqlSessionHolder)TransactionSynchronizationManager.getResource(sqlSessionFactory);</span><br><span class="line">            <span class="keyword">boolean</span> transaction = TransactionSynchronizationManager.isSynchronizationActive();</span><br><span class="line">            SqlSession sqlSession;</span><br><span class="line">            <span class="keyword">if</span> (sqlSessionHolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                sqlSession = sqlSessionHolder.getSqlSession();</span><br><span class="line">                sqlSession.commit(!transaction);</span><br><span class="line">            &#125;</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">            <span class="keyword">if</span> (!transaction) &#123;</span><br><span class="line">                log.warn(<span class="string">"SqlSession ["</span> + sqlSession + <span class="string">"] Transaction not enabled"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">boolean</span> var7;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                consumer.accept(sqlSession);</span><br><span class="line">                sqlSession.commit(!transaction);</span><br><span class="line">                var7 = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var15) &#123;</span><br><span class="line">                sqlSession.rollback();</span><br><span class="line">                Throwable unwrapped = ExceptionUtil.unwrapThrowable(var15);</span><br><span class="line">                <span class="keyword">if</span> (unwrapped <span class="keyword">instanceof</span> PersistenceException) &#123;</span><br><span class="line">                    MyBatisExceptionTranslator myBatisExceptionTranslator = <span class="keyword">new</span> MyBatisExceptionTranslator(sqlSessionFactory.getConfiguration().getEnvironment().getDataSource(), <span class="keyword">true</span>);</span><br><span class="line">                    Throwable throwable = myBatisExceptionTranslator.translateExceptionIfPossible((PersistenceException)unwrapped);</span><br><span class="line">                    <span class="keyword">if</span> (throwable != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> throwable;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> ExceptionUtils.mpe(unwrapped);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                sqlSession.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> var7;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var17) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var17;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€å¯ ExecutorType.BATCH æ¨¡å¼ï¼Œç»è¿‡è¯•éªŒï¼Œä½¿ç”¨äº† ExecutorType.BATCH çš„æ’å…¥æ–¹å¼ï¼Œæ€§èƒ½æ˜¾è‘—æå‡ï¼Œä¸åˆ° 2s ä¾¿èƒ½å…¨éƒ¨æ’å…¥å®Œæˆã€‚</p><h3 id="å››ã€mybatis-è®¾ç½®-executorType-ä¸º-batchæ¨¡å¼"><a href="#å››ã€mybatis-è®¾ç½®-executorType-ä¸º-batchæ¨¡å¼" class="headerlink" title="å››ã€mybatis è®¾ç½® executorType ä¸º batchæ¨¡å¼"></a>å››ã€mybatis è®¾ç½® executorType ä¸º batchæ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">protected</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">(Order t)</span> </span>&#123;</span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">	OrderMapper orderMapper = sqlSession.getMapper(OrderMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		orderMapper.save(t);</span><br><span class="line">		sqlSession.commit();</span><br><span class="line">	&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		logger.error(<span class="string">"æ‰¹é‡å¯¼å…¥æ•°æ®å¼‚å¸¸ï¼Œäº‹åŠ¡å›æ»š"</span>, e);</span><br><span class="line">		sqlSession.rollback();</span><br><span class="line">	&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (sqlSession != <span class="keyword">null</span>) &#123;</span><br><span class="line">	  		sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”ã€springboot-ä¸‹å¼€å¯-batchæ¨¡å¼"><a href="#äº”ã€springboot-ä¸‹å¼€å¯-batchæ¨¡å¼" class="headerlink" title="äº”ã€springboot ä¸‹å¼€å¯ batchæ¨¡å¼"></a>äº”ã€springboot ä¸‹å¼€å¯ batchæ¨¡å¼</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">executor-type:</span> <span class="string">batch</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        ExecutorType executorType = <span class="keyword">this</span>.properties.getExecutorType();</span><br><span class="line">        <span class="keyword">if</span> (executorType != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory, executorType);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MyBatisPlus</category>
      </categories>
      <tags>
        <tag>MyBatisPlus</tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¶é—´æˆ³æ‰¹æ¬¡è®¡ç®—ç®—æ³•</title>
    <url>/post/f3a01f01.html</url>
    <content><![CDATA[<blockquote><p>æ—¶é—´æˆ³æ‰¹æ¬¡è®¡ç®—ç®—æ³• ~</p></blockquote><a id="more"></a><blockquote class="pullquote mindmap mindmap-lg"><ul><li>æ—¶é—´æˆ³æ‰¹æ¬¡è®¡ç®—ç®—æ³•<ul><li>å…¬å¼<ul><li>æ•°æ®ä¸ŠæŠ¥æ—¶é—´æ‰¹æ¬¡å· = æ—¶é—´æˆ³ / å­˜å‚¨å‘¨æœŸ</li></ul></li><li>ç†è§£<ul><li>æ—¶é—´æˆ³å’Œå­˜å‚¨å‘¨æœŸéƒ½æ˜¯ä»¥ç§’ä¸ºå•ä½ï¼Œé‚£ä¹ˆâ€æ•°æ®ä¸ŠæŠ¥æ—¶é—´æ‰¹æ¬¡å·â€çš„å€¼è¡¨ç¤ºè¯¥æ•°æ®ä¸ŠæŠ¥å±äºæ—¶é—´åˆ’åˆ†åçš„å“ªä¸ªæ—¶é—´æ®µã€‚</li></ul></li><li>ä¸¾ä¾‹<ul><li>â‘  å‡å¦‚æ—¶é—´æˆ³ä¸ºï¼š1705483754ï¼ˆ2024-01-17 17:29:14ï¼‰ï¼Œå­˜å‚¨å‘¨æœŸä¸º300ç§’ï¼Œé‚£ä¹ˆæ•°æ®ä¸ŠæŠ¥æ—¶é—´æ‰¹æ¬¡å· 1705483754/300 å¤§çº¦ç­‰äº 5684946ã€‚è¿™ä¸ªç»“æœè¡¨ç¤ºè¯¥æ•°æ®ä¸ŠæŠ¥å±äºç¬¬ 5684946ä¸ª 300ç§’ çš„æ—¶é—´æ®µã€‚</li><li>â‘¡ å‡å¦‚æ—¶é—´æˆ³ä¸ºï¼š1705483874ï¼ˆ2024-01-17 17:31:14ï¼‰ï¼Œå­˜å‚¨å‘¨æœŸä¸º300ç§’ï¼Œé‚£ä¹ˆæ•°æ®ä¸ŠæŠ¥æ—¶é—´æ‰¹æ¬¡å· 1705483874/300 å¤§çº¦ç­‰äº 5684946ã€‚è¿™ä¸ªç»“æœè¡¨ç¤ºè¯¥æ•°æ®ä¸ŠæŠ¥å±äºç¬¬ 5684946ä¸ª 300ç§’ çš„æ—¶é—´æ®µã€‚</li><li>â‘¢ å‡å¦‚æ—¶é—´æˆ³ä¸ºï¼š1705484085ï¼ˆ2024-01-17 17:34:45ï¼‰ï¼Œå­˜å‚¨å‘¨æœŸä¸º300ç§’ï¼Œé‚£ä¹ˆæ•°æ®ä¸ŠæŠ¥æ—¶é—´æ‰¹æ¬¡å· 1705484085/300 å¤§çº¦ç­‰äº 5684947ã€‚è¿™ä¸ªç»“æœè¡¨ç¤ºè¯¥æ•°æ®ä¸ŠæŠ¥å±äºç¬¬ 5684947ä¸ª 300ç§’ çš„æ—¶é—´æ®µã€‚</li></ul></li><li>ç»“æœ<ul><li>ç­‰åˆ°ç¬¬â‘¡æ­¥çš„æ—¶å€™ï¼Œè¡¨ç¤ºåœ¨åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œé¢ã€‚ç­‰åˆ°ç¬¬â‘¢æ­¥çš„æ—¶å€™ï¼Œè¡¨ç¤ºä¸åœ¨åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œé¢ã€‚</li></ul></li></ul></li></ul></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Cacheè·å–æ‰€æœ‰ç¼“å­˜æ•°æ®</title>
    <url>/post/8a8dfd6b.html</url>
    <content><![CDATA[<blockquote><p>å¦‚ä½•æŸ¥è¯¢æœ¬åœ°ç¼“å­˜çš„å†…å®¹è¯¦æƒ… ~</p></blockquote><a id="more"></a><p>ç®€å•ç²—æš´ï¼Œç›´æ¥ä¸Šä»£ç ~</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Log</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CacheManager cacheManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CacheController</span><span class="params">(CacheManager cacheManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cacheManager = cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"clearAllCaches"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">clearAllCaches</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String cacheName : cacheManager.getCacheNames()) &#123;</span><br><span class="line">            Objects.requireNonNull(cacheManager.getCache(cacheName)).clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getCacheValues"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;CacheEntry&gt;&gt; getCacheValues() &#123;</span><br><span class="line">        List&lt;CacheEntry&gt; cacheEntries = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String cacheName : cacheManager.getCacheNames()) &#123;</span><br><span class="line">            Cache cache = cacheManager.getCache(cacheName);</span><br><span class="line">            <span class="keyword">if</span> (cache != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Map&lt;String, Object&gt; cacheMap = cacheToMap(cache);</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : cacheMap.entrySet()) &#123;</span><br><span class="line">                    Object key = entry.getKey();</span><br><span class="line">                    Object value = entry.getValue();</span><br><span class="line">                    cacheEntries.add(<span class="keyword">new</span> CacheEntry(cacheName, key, value));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(cacheEntries);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">cacheToMap</span><span class="params">(Cache cache)</span> </span>&#123;</span><br><span class="line">        Object obj = cache.getNativeCache();</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Field[] fields = obj.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                map.put(field.getName(), field.get(obj));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"ObjToMap exp"</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–Cache.mapä¸­çš„cache</span></span><br><span class="line">        <span class="keyword">return</span> (Map&lt;String, Object&gt;)map.get(<span class="string">"cache"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheEntry</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String cacheName;</span><br><span class="line">        <span class="keyword">private</span> Object key;</span><br><span class="line">        <span class="keyword">private</span> Object value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CacheEntry</span><span class="params">(String cacheName, Object key, Object value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cacheName = cacheName;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Cache</category>
      </categories>
      <tags>
        <tag>Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>offsetå’Œlimitåˆ†é¡µï¼Œæ€§èƒ½å¤ªå·®ï¼</title>
    <url>/post/ca74cc7d.html</url>
    <content><![CDATA[<blockquote><p>offsetå’Œlimitåˆ†é¡µï¼Œæ€§èƒ½å¤ªå·®ï¼</p></blockquote><a id="more"></a><p>å¦‚ä½•å®ç°é«˜æ€§èƒ½åˆ†é¡µï¼Ÿ</p><h3 id="1ã€OFFSET-å’Œ-LIMIT-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#1ã€OFFSET-å’Œ-LIMIT-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="1ã€OFFSET å’Œ LIMIT æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>1ã€OFFSET å’Œ LIMIT æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>OFFSET å’Œ LIMIT å¯¹äºæ•°æ®é‡å°‘çš„é¡¹ç›®æ¥è¯´æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p><strong>ä½†æ˜¯ï¼Œå½“æ•°æ®åº“é‡Œçš„æ•°æ®é‡è¶…è¿‡æœåŠ¡å™¨å†…å­˜èƒ½å¤Ÿå­˜å‚¨çš„èƒ½åŠ›ï¼Œå¹¶ä¸”éœ€è¦å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œåˆ†é¡µï¼Œé—®é¢˜å°±ä¼šå‡ºç°ã€‚</strong></p><p>ä¸ºäº†å®ç°åˆ†é¡µï¼Œæ¯æ¬¡æ”¶åˆ°åˆ†é¡µè¯·æ±‚æ—¶ï¼Œæ•°æ®åº“éƒ½éœ€è¦è¿›è¡Œä½æ•ˆçš„å…¨è¡¨æ‰«æã€‚</p><p><strong>ä»€ä¹ˆæ˜¯å…¨è¡¨æ‰«æï¼Ÿ</strong></p><p>å…¨è¡¨æ‰«æ (åˆç§°é¡ºåºæ‰«æ) å°±æ˜¯åœ¨æ•°æ®åº“ä¸­è¿›è¡Œé€è¡Œæ‰«æï¼Œé¡ºåºè¯»å–è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•ï¼Œç„¶åæ£€æŸ¥å„ä¸ªåˆ—æ˜¯å¦ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ã€‚è¿™ç§æ‰«ææ˜¯å·²çŸ¥æœ€æ…¢çš„ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œå¤§é‡çš„ç£ç›˜ I/Oï¼Œè€Œä¸”ä»ç£ç›˜åˆ°å†…å­˜çš„ä¼ è¾“å¼€é”€ä¹Ÿå¾ˆå¤§ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æœ‰ 1 äº¿ä¸ªç”¨æˆ·ï¼ŒOFFSET æ˜¯ 5 åƒä¸‡ï¼Œé‚£ä¹ˆå®ƒéœ€è¦è·å–æ‰€æœ‰è¿™äº›è®°å½• (åŒ…æ‹¬é‚£ä¹ˆå¤šæ ¹æœ¬ä¸éœ€è¦çš„æ•°æ®)ï¼Œå°†å®ƒä»¬æ”¾å…¥å†…å­˜ï¼Œç„¶åè·å– LIMIT æŒ‡å®šçš„ 20 æ¡ç»“æœã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†è·å–ä¸€é¡µçš„æ•°æ®ï¼š</p><p>10ä¸‡è¡Œä¸­çš„ç¬¬5ä¸‡è¡Œåˆ°ç¬¬5ä¸‡é›¶20è¡Œ</p><p>éœ€è¦å…ˆè·å– 5 ä¸‡è¡Œã€‚è¿™ä¹ˆåšæ˜¯å¤šä¹ˆä½æ•ˆï¼Ÿ</p><p>è¿™èƒŒåéƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼šOFFSET è¶Šé«˜ï¼ŒæŸ¥è¯¢æ—¶é—´å°±è¶Šé•¿ã€‚</p><h3 id="2ã€ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#2ã€ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="2ã€ä¼˜åŒ–æ–¹æ¡ˆ"></a>2ã€ä¼˜åŒ–æ–¹æ¡ˆ</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> limit_test <span class="keyword">WHERE</span> <span class="keyword">id</span>&gt;<span class="number">10</span> <span class="keyword">limit</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ç§åŸºäºæŒ‡é’ˆçš„åˆ†é¡µã€‚</p><p>ä½ è¦åœ¨æœ¬åœ°ä¿å­˜ä¸Šä¸€æ¬¡æ¥æ”¶åˆ°çš„ä¸»é”® (é€šå¸¸æ˜¯ä¸€ä¸ª ID) å’Œ LIMITï¼Œè€Œä¸æ˜¯ OFFSET å’Œ LIMITï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡çš„æŸ¥è¯¢å¯èƒ½éƒ½ä¸æ­¤ç±»ä¼¼ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºé€šè¿‡æ˜¾å¼å‘ŠçŸ¥æ•°æ®åº“æœ€æ–°è¡Œï¼Œæ•°æ®åº“å°±ç¡®åˆ‡åœ°çŸ¥é“ä»å“ªé‡Œå¼€å§‹æœç´¢ï¼ˆåŸºäºæœ‰æ•ˆçš„ç´¢å¼•ï¼‰ï¼Œè€Œä¸éœ€è¦è€ƒè™‘ç›®æ ‡èŒƒå›´ä¹‹å¤–çš„è®°å½•ã€‚</p><p>è¦ä½¿ç”¨è¿™ç§åŸºäºæ¸¸æ ‡çš„åˆ†é¡µï¼Œéœ€è¦æœ‰ä¸€ä¸ªæƒŸä¸€çš„åºåˆ—å­—æ®µ (æˆ–å¤šä¸ª)ï¼Œæ¯”å¦‚æƒŸä¸€çš„æ•´æ•° ID æˆ–æ—¶é—´æˆ³ï¼Œä½†åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½æ— æ³•æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚</p><h4 id="å†ä¼˜åŒ–"><a href="#å†ä¼˜åŒ–" class="headerlink" title="å†ä¼˜åŒ–"></a>å†ä¼˜åŒ–</h4><p>ç±»ä¼¼äºæŸ¥è¯¢ <code>SELECT * FROM table_name WHERE id &gt; 3400000 LIMIT 20;</code> è¿™æ ·çš„æ•ˆç‡éå¸¸å¿«ï¼Œå› ä¸ºä¸»é”®ä¸Šæ˜¯æœ‰ç´¢å¼•çš„ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯<strong>IDå¿…é¡»æ˜¯è¿ç»­çš„</strong>ï¼Œå¹¶ä¸”æŸ¥è¯¢ä¸èƒ½æœ‰WHEREè¯­å¥ï¼Œå› ä¸ºWHEREè¯­å¥ä¼šé€ æˆè¿‡æ»¤æ•°æ®ã€‚é‚£ä½¿ç”¨åœºæ™¯å°±éå¸¸çš„å±€é™äº†ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p><p><strong>ä½¿ç”¨è¦†ç›–ç´¢å¼•ä¼˜åŒ–</strong></p><p>MySQLçš„æŸ¥è¯¢å®Œå…¨å‘½ä¸­ç´¢å¼•çš„æ—¶å€™ï¼Œç§°ä¸ºè¦†ç›–ç´¢å¼•,æ˜¯éå¸¸å¿«çš„ï¼Œå› ä¸ºæŸ¥è¯¢åªéœ€è¦åœ¨ç´¢å¼•ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹‹åå¯ä»¥ç›´æ¥è¿”å›ï¼Œè€Œä¸ç”¨å†å›æ•°æ®è¡¨æ‹¿æ•°æ®ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆæŸ¥å‡ºç´¢å¼•çš„ IDï¼Œç„¶åæ ¹æ® Id æ‹¿æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> table_name <span class="keyword">LIMIT</span> <span class="number">3400000</span>,<span class="number">20</span>) a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table_name b <span class="keyword">ON</span> a.id = b.id;</span><br><span class="line"><span class="comment">#æˆ–è€…æ˜¯</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name a <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> table_name <span class="keyword">LIMIT</span> <span class="number">3400000</span>,<span class="number">20</span>) b <span class="keyword">USING</span> (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure><h3 id="3ã€æ€»ç»“"><a href="#3ã€æ€»ç»“" class="headerlink" title="3ã€æ€»ç»“"></a>3ã€æ€»ç»“</h3><ul><li>æ•°æ®é‡å¤§çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨OFFSET/LIMITæ¥è¿›è¡Œåˆ†é¡µï¼Œå› ä¸ºOFFSETè¶Šå¤§ï¼ŒæŸ¥è¯¢æ—¶é—´è¶Šä¹…ã€‚åŸºäºå¤§é‡æ•°æ®åšæŸ¥è¯¢æ“ä½œï¼ŒRick James çš„æ–‡ç« æä¾›äº†æ›´æ·±å…¥çš„æŒ‡å¯¼ã€‚ <a href="http://mysql.rjweb.org/doc.php/lists" target="_blank" rel="noopener">http://mysql.rjweb.org/doc.php/lists</a></li><li>å½“ç„¶ä¸èƒ½è¯´æ‰€æœ‰çš„åˆ†é¡µéƒ½ä¸å¯ä»¥ï¼Œå¦‚æœä½ çš„æ•°æ®å°±é‚£ä¹ˆå‡ åƒã€å‡ ä¸‡æ¡ï¼Œé‚£å°±å¾ˆæ— æ‰€è°“ï¼Œéšä¾¿ä½¿ç”¨ã€‚</li><li>å¦‚æœæˆ‘ä»¬çš„è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæ¯”å¦‚æ˜¯å…·æœ‰å¤šå¯¹å¤šå…³ç³»çš„è¡¨ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ä¼ ç»Ÿçš„ OFFSET/LIMIT æ–¹å¼ã€‚</li><li>è¿™ç§æ–¹æ³•é€‚ç”¨äºè¦æ±‚IDä¸ºæ•°å€¼ç±»å‹ï¼Œå¹¶ä¸”æŸ¥å‡ºçš„æ•°æ®IDè¿ç»­çš„åœºæ™¯ä¸”ä¸èƒ½æœ‰å…¶ä»–å­—æ®µçš„æ’åºã€‚</li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸ƒéš†è¿‡æ»¤å™¨</title>
    <url>/post/9a0369ec.html</url>
    <content><![CDATA[<blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€åŸç†"><a href="#ä¸€ã€åŸç†" class="headerlink" title="ä¸€ã€åŸç†"></a>ä¸€ã€åŸç†</h3><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½Bitæ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼ï¼š</span><br><span class="line">1.çº¿æ€§æ¢æµ‹ï¼Œå†²çªåå†æ¬¡å¯»æ‰¾ç©ºä½ç½®ï¼›</span><br><span class="line">2.å¤šé‡æ•£åˆ—ï¼Œå¤šæ¬¡å“ˆå¸Œå‡½æ•°è®¡ç®—ï¼›ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨çš„è¿™ç§ï¼‰</span><br><span class="line">3.é“¾è¡¨æ³•ï¼ŒHsahMapï¼›</span><br></pre></td></tr></table></figure><blockquote><p>PSï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„åº•å±‚å°±æ˜¯åŸºäº BitMap æ•°æ®ç»“æ„å®ç°çš„ã€‚</p></blockquote><p>åˆå§‹bitæ•°ç»„éƒ½ä¸º0ï¼ŒåªåŠ è½½ä¸¤ä¸ªæ•°æ®ä¸ºï¼šäººç”Ÿå’ŒäººåŠ›ã€‚å°†ä½ç½®3ï¼Œ10ï¼Œ12ï¼Œ15ï¼Œ20ç½®ä¸º1ï¼Œå·²ç»åŠ è½½çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨çš„æ•°æ®å°±ä¼šè¿”å›trueï¼Œä¸å­˜åœ¨çš„è¿”å›falseã€‚</p><p><strong>ä½†æ˜¯å½“æ•°æ®é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œä¼šæœ‰è¯¯æŠ¥æ¦‚ç‡ã€‚</strong><br>å°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µã€‚æœªåŠ è½½çš„æ•°æ®ï¼šäººç”Ÿå¥½ã€‚åœ¨å“ˆå¸Œåä¹Ÿæ‰“åœ¨äº†3,12,20ä¸Šï¼Œä¹Ÿè¿”å›äº†trueã€‚</p><p><strong>è¿™ä¹Ÿå°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬åŸç†ï¼šå­˜åœ¨ä¸æ˜¯ä¸€å®šå­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ä¸€å®šä¸å­˜åœ¨ã€‚</strong></p><p><strong>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´ä¸€ä¸ªå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¸åœ¨è¿™ä¸ªé›†åˆä¸­ï¼›ä½†å¦‚æœå®ƒè¯´ä¸€ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ä¸å­˜åœ¨çš„ï¼ˆå­˜åœ¨è¯¯å·®ï¼‰ã€‚</strong></p><p>å®ƒå°±å¯ä»¥å¾ˆå¥½çš„ç”¨åœ¨é»‘åå•è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œ<strong>å¦‚æœä¸åœ¨é»‘åå•ä¸­å°±ä¸€å®šä¸åœ¨ï¼Œç›¸å¯¹çš„å¦‚æœåœ¨çš„è¯ä¸æ˜¯ä¸€å®šåœ¨ï¼Œè€Œå¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯ä¸åœ¨çš„ï¼Œé»‘åå•ä¸­çš„æ¯•ç«Ÿåªæ˜¯å°‘é‡æ•°æ®ã€‚å¦‚æœå†é€šè¿‡å…·ä½“ä¸šåŠ¡æ•°æ®éªŒè¯ã€‚è¿™æ ·è°ƒç”¨é‡å°±å¤§å¤§é™ä½ã€‚</strong></p><p>é™¤äº†ç”¨åœ¨é»‘åå•ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¼“å­˜ç©¿é€çš„åœºæ™¯ä¸­ä¹Ÿå¯ä»¥é€‚ç”¨ã€‚</p><p><code>ç¼“å­˜ç©¿é€æ˜¯å¤§é‡ä¸å­˜åœ¨çš„keyç»•è¿‡redisï¼Œè¿›å…¥DBä¸­ï¼Œå¯¼è‡´ç³»ç»Ÿå‹åŠ›è¿‡å¤§ã€‚</code></p><h3 id="äºŒã€ä»£ç "><a href="#äºŒã€ä»£ç " class="headerlink" title="äºŒã€ä»£ç "></a>äºŒã€ä»£ç </h3><h4 id="1-æœ¬åœ°å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Googleçš„guava"><a href="#1-æœ¬åœ°å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Googleçš„guava" class="headerlink" title="1. æœ¬åœ°å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Googleçš„guava"></a>1. æœ¬åœ°å¸ƒéš†è¿‡æ»¤å™¨ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Googleçš„guava</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>32.1.2-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilterDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªé¢„æœŸæ’å…¥æ•°é‡ä¸º1000ï¼Œè¯¯æŠ¥æ¦‚ç‡ä¸º0.01çš„å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="keyword">int</span> insertions = <span class="number">1000</span>;</span><br><span class="line">        BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(Funnels.stringFunnel(Charset.defaultCharset()), insertions &lt;&lt; <span class="number">1</span>, <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            bloomFilter.put(<span class="string">"string"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ˜¯å¦å¯èƒ½åŒ…å«æŸä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">int</span> falsePositiveCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1001</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (bloomFilter.mightContain(<span class="string">"string"</span> + i)) &#123;</span><br><span class="line">                falsePositiveCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"é¢„æœŸè¯¯æŠ¥æ¦‚ç‡: 0.01"</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®é™…è¯¯æŠ¥æ¦‚ç‡: "</span> + (<span class="keyword">double</span>) falsePositiveCount / <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œå°†é¢„æœŸæ’å…¥æ•°é‡è®¾ç½®å¾—æ¯”å®é™…æ’å…¥æ•°é‡ç¨å¤§ä¸€äº›æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥åœ¨ä¿æŒè¾ƒä½è¯¯æŠ¥ç‡çš„åŒæ—¶ï¼Œä¸ä¼šè¿‡å¤šåœ°å¢åŠ å­˜å‚¨ç©ºé—´éœ€æ±‚ã€‚</p><h4 id="2-Redisçš„å¸ƒéš†è¿‡æ»¤å™¨"><a href="#2-Redisçš„å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="2.Redisçš„å¸ƒéš†è¿‡æ»¤å™¨"></a>2.Redisçš„å¸ƒéš†è¿‡æ»¤å™¨</h4><p>éœ€è¦<code>RedisæœåŠ¡</code>å®‰è£…<code>RedisBloom</code>ï¼Œæ‰èƒ½æ”¯æŒã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.RedisBloom<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>JRedisBloom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisBloomFilterDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªJedisè¿æ¥æ± </span></span><br><span class="line">        JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(poolConfig, <span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªRedisBloomå®¢æˆ·ç«¯</span></span><br><span class="line">        Client client = <span class="keyword">new</span> Client(jedisPool);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰å¸ƒéš†è¿‡æ»¤å™¨çš„åç§°</span></span><br><span class="line">        String bloomFilterName = <span class="string">"myBloomFilter"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨RedisBloomå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ï¼Œé¢„æœŸæ’å…¥æ•°é‡ä¸º1000ï¼Œè¯¯æŠ¥æ¦‚ç‡ä¸º0.01</span></span><br><span class="line">        client.createFilter(bloomFilterName, <span class="number">1000</span>, <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            client.add(bloomFilterName, <span class="string">"string"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ˜¯å¦å¯èƒ½åŒ…å«æŸä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">int</span> falsePositiveCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1001</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (client.exists(bloomFilterName, <span class="string">"string"</span> + i)) &#123;</span><br><span class="line">                falsePositiveCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"é¢„æœŸè¯¯æŠ¥æ¦‚ç‡: 0.01"</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®é™…è¯¯æŠ¥æ¦‚ç‡: "</span> + (<span class="keyword">double</span>) falsePositiveCount / <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥æ± </span></span><br><span class="line">        jedisPool.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Hutoolçš„å¸ƒéš†è¿‡æ»¤å™¨"><a href="#3-Hutoolçš„å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="3.Hutoolçš„å¸ƒéš†è¿‡æ»¤å™¨"></a>3.<code>Hutool</code>çš„å¸ƒéš†è¿‡æ»¤å™¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– </span></span><br><span class="line"><span class="comment">// å‚æ•° m æ€ä¹ˆè®¾ï¼Ÿ</span></span><br><span class="line"><span class="comment">// m æ˜¯ bit æ•°ç»„çš„æ€»é•¿åº¦ï¼Œè¶Šå¤§è¯¯åˆ¤ç‡è¶Šä½ã€‚ä¸€èˆ¬æŒ‰ â€œé¢„è®¡å­˜å‚¨ n ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å¹³å‡å  10-20 ä¸ª bitâ€ æ¥ä¼°ç®—ã€‚æ¯”å¦‚å­˜ 100 ä¸‡ä¸ªå…ƒç´ ï¼Œm è®¾ä¸º 100 ä¸‡ * 15=150ä¸‡ bitï¼ˆçº¦ 1.8MBï¼‰ã€‚</span></span><br><span class="line">BitMapBloomFilter filter = <span class="keyword">new</span> BitMapBloomFilter(<span class="number">10</span>);</span><br><span class="line">filter.add(<span class="string">"123"</span>);</span><br><span class="line">filter.add(<span class="string">"abc"</span>);</span><br><span class="line">filter.add(<span class="string">"ddd"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥æ‰¾</span></span><br><span class="line">filter.contains(<span class="string">"abc"</span>)</span><br></pre></td></tr></table></figure><h5 id="3-1-æ¥å£é˜²åˆ·ï¼šè¿‡æ»¤é»‘åå•-IP"><a href="#3-1-æ¥å£é˜²åˆ·ï¼šè¿‡æ»¤é»‘åå•-IP" class="headerlink" title="3.1 æ¥å£é˜²åˆ·ï¼šè¿‡æ»¤é»‘åå• IP"></a>3.1 æ¥å£é˜²åˆ·ï¼šè¿‡æ»¤é»‘åå• IP</h5><p>é˜²æ­¢æ¶æ„ IP é¢‘ç¹è°ƒç”¨æ¥å£ï¼Œç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿæ‹¦æˆªï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BitMapBloomFilter blackIpFilter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ï¼šåŠ è½½é»‘åå•IP</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é¢„è®¡å­˜10ä¸‡ä¸ªé»‘åå•IPï¼Œæ¯ä¸ªIPè½¬æˆLongå­˜å‚¨</span></span><br><span class="line">        blackIpFilter = BloomFilterUtil.createBitMap(<span class="number">10_000_000</span> * <span class="number">15</span>); <span class="comment">// 15bit/å…ƒç´ </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“åŠ è½½é»‘åå•ï¼ˆå®é™…é¡¹ç›®ç”¨æ‰¹é‡æŸ¥è¯¢ï¼‰</span></span><br><span class="line">        List&lt;String&gt; ipList = ipDao.getBlackList();</span><br><span class="line">        <span class="keyword">for</span> (String ip : ipList) &#123;</span><br><span class="line">            <span class="comment">// IPè½¬Longï¼ˆæ¯”å¦‚"192.168.1.1"è½¬æˆæ•°å­—ï¼‰</span></span><br><span class="line">            <span class="keyword">long</span> ipNum = IpUtil.ipv4ToLong(ip);</span><br><span class="line">            blackIpFilter.add(ipNum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­IPæ˜¯å¦åœ¨é»‘åå•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBlackIp</span><span class="params">(String ip)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> ipNum = IpUtil.ipv4ToLong(ip);</span><br><span class="line">        <span class="keyword">return</span> blackIpFilter.contains(ipNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å£ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/api/data"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">getData</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    String ip = IpUtil.getClientIp(request);</span><br><span class="line">    <span class="keyword">if</span> (ipFilter.isBlackIp(ip)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">"æ‚¨çš„IPå·²è¢«é™åˆ¶è®¿é—®"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ­£å¸¸ä¸šåŠ¡é€»è¾‘...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-2-çˆ¬è™«å»é‡ï¼šé¿å…é‡å¤çˆ¬å–-URL"><a href="#3-2-çˆ¬è™«å»é‡ï¼šé¿å…é‡å¤çˆ¬å–-URL" class="headerlink" title="3.2 çˆ¬è™«å»é‡ï¼šé¿å…é‡å¤çˆ¬å– URL"></a>3.2 çˆ¬è™«å»é‡ï¼šé¿å…é‡å¤çˆ¬å– URL</h5><p>çˆ¬å–ç½‘ç«™æ—¶ï¼Œç”¨å¸ƒéš†è¿‡æ»¤å™¨è®°å½•å·²çˆ¬ URLï¼Œæ¯”ç”¨ Set çœ 10 å€å†…å­˜ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BitSetBloomFilter urlFilter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Spider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®¡åˆ’çˆ¬100ä¸‡URLï¼Œæ§åˆ¶è¯¯åˆ¤ç‡&lt;0.1%</span></span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">1_000_000</span>;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">int</span> c = (<span class="keyword">int</span>) (n * k * <span class="number">1.44</span>);</span><br><span class="line">        urlFilter = BloomFilterUtil.createBitSet(c, n, k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çˆ¬å–URLå‰å…ˆåˆ¤æ–­æ˜¯å¦å·²çˆ¬è¿‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">crawl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// URLè½¬å“ˆå¸Œå€¼ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨æœ¬è´¨å­˜çš„æ˜¯å“ˆå¸Œï¼‰</span></span><br><span class="line">        <span class="keyword">long</span> urlHash = HashUtil.mixHash(url); <span class="comment">// Hutoolçš„å“ˆå¸Œå·¥å…·</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (urlFilter.contains(urlHash)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"URLå·²çˆ¬è¿‡ï¼š"</span> + url);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ‡è®°ä¸ºå·²çˆ¬</span></span><br><span class="line">        urlFilter.add(urlHash);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œçˆ¬å–é€»è¾‘...</span></span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹çˆ¬å–ï¼š"</span> + url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-3-ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼šæ‹¦æˆªä¸å­˜åœ¨çš„-KEY"><a href="#3-3-ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼šæ‹¦æˆªä¸å­˜åœ¨çš„-KEY" class="headerlink" title="3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼šæ‹¦æˆªä¸å­˜åœ¨çš„ KEY"></a>3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼šæ‹¦æˆªä¸å­˜åœ¨çš„ KEY</h5><p>æ•°æ®åº“æŸ¥è¯¢å‰å…ˆæŸ¥ç¼“å­˜ï¼Œç¼“å­˜æ²¡å‘½ä¸­å†æŸ¥åº“ã€‚å¦‚æœé»‘å®¢é¢‘ç¹æŸ¥ä¸å­˜åœ¨çš„ KEYï¼ˆå¦‚ id=-1ï¼‰ï¼Œä¼šç›´æ¥æ‰“ç©¿åˆ°æ•°æ®åº“ï¼Œç”¨å¸ƒéš†è¿‡æ»¤å™¨æŒ¡æ‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, User&gt; redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> BitMapBloomFilter existUserIdFilter; <span class="comment">// å­˜å‚¨æ‰€æœ‰å­˜åœ¨çš„ç”¨æˆ·ID</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ï¼šåŠ è½½æ‰€æœ‰ç”¨æˆ·IDåˆ°å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">        existUserIdFilter = BloomFilterUtil.createBitMap(<span class="number">100_000_000</span>); <span class="comment">// 1äº¿bitï¼ˆçº¦12MBï¼‰</span></span><br><span class="line">        List&lt;Long&gt; allUserIds = userMapper.getAllIds();</span><br><span class="line">        existUserIdFilter.addAll(allUserIds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. å…ˆæŸ¥å¸ƒéš†è¿‡æ»¤å™¨ï¼šå¦‚æœIDä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›null</span></span><br><span class="line">        <span class="keyword">if</span> (!existUserIdFilter.contains(id)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æŸ¥ç¼“å­˜</span></span><br><span class="line">        User user = redisTemplate.opsForValue().get(<span class="string">"user:"</span> + id);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. æŸ¥æ•°æ®åº“ï¼Œæ›´æ–°ç¼“å­˜</span></span><br><span class="line">        user = userMapper.selectById(id);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">"user:"</span> + id, user, <span class="number">1</span>, TimeUnit.HOURS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="ä¸‰ã€é¿å‘æŒ‡å—ï¼šè¿™-3-ä¸ªé”™è¯¯åƒä¸‡åˆ«çŠ¯"><a href="#ä¸‰ã€é¿å‘æŒ‡å—ï¼šè¿™-3-ä¸ªé”™è¯¯åƒä¸‡åˆ«çŠ¯" class="headerlink" title="ä¸‰ã€é¿å‘æŒ‡å—ï¼šè¿™ 3 ä¸ªé”™è¯¯åƒä¸‡åˆ«çŠ¯"></a>ä¸‰ã€é¿å‘æŒ‡å—ï¼šè¿™ 3 ä¸ªé”™è¯¯åƒä¸‡åˆ«çŠ¯</h3><ol><li><strong>ç”¨å¸ƒéš†è¿‡æ»¤å™¨å­˜æ•æ„Ÿæ•°æ®</strong><br>å¸ƒéš†è¿‡æ»¤å™¨åªèƒ½åˆ¤æ–­ â€œæ˜¯å¦å­˜åœ¨â€ï¼Œä¸èƒ½å­˜å…·ä½“æ•°æ®ã€‚æ¯”å¦‚å­˜æ‰‹æœºå·é»‘åå•ï¼Œåªèƒ½å­˜æ‰‹æœºå·çš„å“ˆå¸Œå€¼ï¼Œä¸èƒ½ç›´æ¥å­˜æ‰‹æœºå·ï¼Œå¦åˆ™æœ‰æ³„éœ²é£é™©ã€‚</li><li><strong>å¿½ç•¥è¯¯åˆ¤ç‡ï¼Œç›´æ¥ç”¨ç»“æœåšæ ¸å¿ƒé€»è¾‘</strong><br>è¯¯åˆ¤ç‡å†ä½ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚æ¯”å¦‚ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ â€œç”¨æˆ·æ˜¯å¦å·²æ³¨å†Œâ€ï¼Œè¯¯åˆ¤ä¼šå¯¼è‡´æ–°ç”¨æˆ·æ— æ³•æ³¨å†Œã€‚<strong>è§£å†³</strong>ï¼šè¯¯åˆ¤æ—¶å†æŸ¥ä¸€æ¬¡æ•°æ®åº“ç¡®è®¤ã€‚</li><li><strong>å…ƒç´ æ•°é‡è¶…è¿‡é¢„æœŸå¤ªå¤š</strong><br>å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤ç‡ä¼šéšå…ƒç´ å¢å¤šæ€¥å‰§ä¸Šå‡ã€‚å¦‚æœé¢„è®¡å­˜ 10 ä¸‡ï¼Œå®é™…å­˜äº† 100 ä¸‡ï¼Œè¯¯åˆ¤ç‡å¯èƒ½ä» 0.1% å‡åˆ° 10%ã€‚<strong>è§£å†³</strong>ï¼šåˆå§‹åŒ–æ—¶ç•™è¶³ä½™é‡ï¼ˆæŒ‰é¢„è®¡çš„ 2 å€è®¾å®¹é‡ï¼‰ã€‚</li></ol><hr><h3 id="å››ã€ä¸ºä»€ä¹ˆè¯´å®ƒæ¯”-HashMap-å¥½ï¼Ÿ"><a href="#å››ã€ä¸ºä»€ä¹ˆè¯´å®ƒæ¯”-HashMap-å¥½ï¼Ÿ" class="headerlink" title="å››ã€ä¸ºä»€ä¹ˆè¯´å®ƒæ¯” HashMap å¥½ï¼Ÿ"></a>å››ã€ä¸ºä»€ä¹ˆè¯´å®ƒæ¯” HashMap å¥½ï¼Ÿ</h3><p>åŒæ ·å­˜ 100 ä¸‡ä¸ª Long ç±»å‹å…ƒç´ ï¼š</p><ul><li>HashMapï¼šæ¯ä¸ª Entry çº¦å  40 å­—èŠ‚ï¼Œæ€»å†…å­˜â‰ˆ100 ä¸‡ * 40B = 38MB</li><li>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆ15bit / å…ƒç´ ï¼‰ï¼šæ€»å†…å­˜â‰ˆ100 ä¸‡ * 15bit = 1.8MBï¼Œçœ 95% å†…å­˜</li></ul><p>æŸ¥è¯¢é€Ÿåº¦ä¸Šï¼ŒHashMap çš„<code>containsKey</code>éœ€è¦è®¡ç®—å“ˆå¸Œ + å¯èƒ½çš„é“¾è¡¨éå†ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦å‡ æ¬¡å“ˆå¸Œè®¡ç®— + æ•°ç»„è®¿é—®ï¼Œé€Ÿåº¦å¿« 3-10 å€ã€‚</p><p>ä»¥å‰åšçˆ¬è™«å»é‡ï¼Œç”¨ HashSet å­˜ URLï¼Œçˆ¬äº† 100 ä¸‡æ¡å°±å äº† 500 å¤š MB å†…å­˜ï¼ŒæŸ¥è¯¢è¿˜è¶Šæ¥è¶Šæ…¢ã€‚æ¢æˆ Hutool çš„å¸ƒéš†è¿‡æ»¤å™¨åï¼Œå†…å­˜é™åˆ° 30MBï¼ŒæŸ¥è¯¢å‡ ä¹ä¸è€—æ—¶ï¼Œçˆ¬å–æ•ˆç‡æå‡ä¸€å¤§æˆªã€‚</p><p>å¦‚æœä½ ä¹Ÿåœ¨å¤„ç† â€œè¶…å¤§é›†åˆçš„å­˜åœ¨æ€§åˆ¤æ–­â€ï¼Œåˆ«å†ç”¨ HashMap ç¡¬æ‰›äº†ï¼Œè¯•è¯• Hutool çš„ BloomFilterUtilâ€”â€” çœå†…å­˜ã€é€Ÿåº¦å¿«ï¼Œç†è§£äº†å®ƒçš„ç‰¹æ€§ï¼ˆè¯¯åˆ¤ã€ä¸èƒ½åˆ é™¤ï¼‰å°±èƒ½ç”¨å¥½ï¼Œè¿™æ‰æ˜¯å¤„ç†æµ·é‡æ•°æ®çš„æ­£ç¡®å§¿åŠ¿ã€‚</p><hr><h3 id="ğŸ“š-å»¶ä¼¸é˜…è¯»"><a href="#ğŸ“š-å»¶ä¼¸é˜…è¯»" class="headerlink" title="ğŸ“š å»¶ä¼¸é˜…è¯»"></a>ğŸ“š <strong>å»¶ä¼¸é˜…è¯»</strong></h3><ul><li><a href="https://mp.weixin.qq.com/s/udYuFwU1sTrkVvSuAQIO_w" target="_blank" rel="noopener">è¿˜åœ¨ç”¨ HashMap å­˜ç™¾ä¸‡çº§æ•°æ®ï¼ŸHutool å¸ƒéš†è¿‡æ»¤å™¨è®©å†…å­˜çœ 90%ï¼Œé€Ÿåº¦å¿« 10 å€</a></li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>HikariPoolæœ€ä½³é…ç½®</title>
    <url>/post/dfff14d8.html</url>
    <content><![CDATA[<blockquote><p>HikariPool é…ç½® ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h3><p>Spring Boot é»˜è®¤ä½¿ç”¨ HikariPool è¿™æ˜¯æˆ‘åœ¨æ§åˆ¶å°ä¸­é‡åˆ°çš„é”™è¯¯ï¼šPossibly consider using a shorter maxLifetime valueã€‚</p><h3 id="äºŒã€åŸå› "><a href="#äºŒã€åŸå› " class="headerlink" title="äºŒã€åŸå› "></a>äºŒã€åŸå› </h3><p>spring.datasource.hikari.maxLifetime çš„é»˜è®¤å€¼ï¼ˆ30 åˆ†é’Ÿï¼‰é«˜äºæ•°æ®åº“çš„â€œwait_timeoutâ€ï¼ˆ10 åˆ†é’Ÿï¼‰ã€‚</p><h3 id="ä¸‰ã€æ–¹æ¡ˆ"><a href="#ä¸‰ã€æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€æ–¹æ¡ˆ"></a>ä¸‰ã€æ–¹æ¡ˆ</h3><ol><li>å°† hikari.maxLifetime å‡å°‘åˆ° 10 åˆ†é’Ÿä»¥ä¸‹ã€‚</li><li>å¢åŠ æ•°æ®åº“çš„â€œwait_timeoutâ€å±æ€§ã€‚</li></ol><h3 id="å››ã€æœ€ä½³é…ç½®"><a href="#å››ã€æœ€ä½³é…ç½®" class="headerlink" title="å››ã€æœ€ä½³é…ç½®"></a>å››ã€æœ€ä½³é…ç½®</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230830173019491.png" alt="æ¨èé…ç½®1"></p><p>æœ€ä½³é…ç½®2ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¾ƒä½³é…ç½®</span></span><br><span class="line"><span class="attr">hikari:</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">validation-timeout:</span> <span class="number">3000</span></span><br><span class="line">    <span class="attr">idle-timeout:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">login-timeout:</span> <span class="number">5</span>	</span><br><span class="line">    <span class="attr">max-lifetime:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">read-only:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="äº”ã€å‚æ•°è¯´æ˜"><a href="#äº”ã€å‚æ•°è¯´æ˜" class="headerlink" title="äº”ã€å‚æ•°è¯´æ˜"></a>äº”ã€å‚æ•°è¯´æ˜</h3><p><code>autoCommit</code><br>æ­¤å±æ€§æ§åˆ¶ä»æ± è¿”å›çš„è¿æ¥çš„é»˜è®¤è‡ªåŠ¨æäº¤è¡Œä¸ºã€‚å®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ <em>é»˜è®¤å€¼ï¼šçœŸ</em></p><p>â³<code>connectionTimeout</code><br>æ­¤å±æ€§æ§åˆ¶å®¢æˆ·ç«¯ï¼ˆå³æ‚¨ï¼‰å°†ç­‰å¾…æ¥è‡ªæ± çš„è¿æ¥çš„æœ€å¤§æ¯«ç§’æ•°ã€‚å¦‚æœåœ¨æ²¡æœ‰å¯ç”¨è¿æ¥çš„æƒ…å†µä¸‹è¶…è¿‡æ­¤æ—¶é—´ï¼Œå°†å¼•å‘ SQLExceptionã€‚å¯æ¥å—çš„æœ€ä½è¿æ¥è¶…æ—¶ä¸º 250 æ¯«ç§’ã€‚ <em>é»˜è®¤å€¼ï¼š30000ï¼ˆ30 ç§’ï¼‰</em></p><p>â³<code>idleTimeout</code><br>æ­¤å±æ€§æ§åˆ¶å…è®¸è¿æ¥åœ¨æ± ä¸­ç©ºé—²çš„æœ€é•¿æ—¶é—´ã€‚ <strong>æ­¤è®¾ç½®ä»…åœ¨<code>minimumIdle</code>å®šä¹‰ä¸ºå°äºæ—¶é€‚ç”¨<code>maximumPoolSize</code>ã€‚</strong>ä¸€æ—¦æ± è¾¾åˆ°è¿æ¥ï¼Œ ç©ºé—²è¿æ¥å°†<em>ä¸ä¼š<em><code>minimumIdle</code>è¢«æ·˜æ±°ã€‚è¿æ¥æ˜¯å¦å› ç©ºé—²è€Œé€€å‡ºå–å†³äºæœ€å¤§å˜åŒ–ä¸º +30 ç§’ï¼Œå¹³å‡å˜åŒ–ä¸º +15 ç§’ã€‚åœ¨æ­¤è¶…æ—¶</em>ä¹‹å‰*ï¼Œè¿æ¥æ°¸è¿œä¸ä¼šå› ä¸ºç©ºé—²è€Œé€€å‡ºã€‚å€¼ 0 è¡¨ç¤ºæ°¸è¿œä¸ä¼šä»æ± ä¸­åˆ é™¤ç©ºé—²è¿æ¥ã€‚å…è®¸çš„æœ€å°å€¼ä¸º 10000 æ¯«ç§’ï¼ˆ10 ç§’ï¼‰ã€‚ *é»˜è®¤å€¼ï¼š600000ï¼ˆ10 åˆ†é’Ÿï¼‰</em></p><p>â³<code>keepaliveTime</code><br>æ­¤å±æ€§æ§åˆ¶ HikariCP å°è¯•ä¿æŒè¿æ¥æ´»åŠ¨çš„é¢‘ç‡ï¼Œä»¥é˜²æ­¢å®ƒè¢«æ•°æ®åº“æˆ–ç½‘ç»œåŸºç¡€è®¾æ–½è¶…æ—¶ã€‚è¯¥å€¼å¿…é¡»å°äºè¯¥ <code>maxLifetime</code>å€¼ã€‚â€œkeepaliveâ€åªä¼šå‘ç”Ÿåœ¨ç©ºé—²è¿æ¥ä¸Šã€‚å½“é’ˆå¯¹ç»™å®šè¿æ¥çš„â€œkeepaliveâ€æ—¶é—´åˆ°è¾¾æ—¶ï¼Œè¯¥è¿æ¥å°†ä»æ± ä¸­åˆ é™¤ï¼Œâ€œpingâ€ï¼Œç„¶åè¿”å›åˆ°æ± ä¸­ã€‚â€œpingâ€æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼šè°ƒç”¨ JDBC4<code>isValid()</code>æ–¹æ³•ï¼Œæˆ–æ‰§è¡Œ <code>connectionTestQuery</code>. é€šå¸¸ï¼Œæ± å¤–çš„æŒç»­æ—¶é—´åº”è¯¥ä»¥ä¸ªä½æ•°æ¯«ç§’ç”šè‡³äºšæ¯«ç§’ä¸ºå•ä½æµ‹é‡ï¼Œå› æ­¤åº”è¯¥å¯¹æ€§èƒ½å½±å“å¾ˆå°æˆ–æ²¡æœ‰æ˜æ˜¾å½±å“ã€‚å…è®¸çš„æœ€å°å€¼ä¸º 30000 æ¯«ç§’ï¼ˆ30 ç§’ï¼‰ï¼Œ <em>é»˜è®¤å€¼ï¼š0ï¼ˆç¦ç”¨ï¼‰</em></p><p>â³<code>maxLifetime</code><br>æ­¤å±æ€§æ§åˆ¶æ± ä¸­è¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸã€‚ä½¿ç”¨ä¸­çš„è¿æ¥æ°¸è¿œä¸ä¼šè¢«æ·˜æ±°ï¼Œåªæœ‰å½“å®ƒå…³é—­æ—¶æ‰ä¼šè¢«åˆ é™¤ã€‚åœ¨é€ä¸ªè¿æ¥çš„åŸºç¡€ä¸Šï¼Œåº”ç”¨è¾ƒå°çš„è´Ÿè¡°å‡ä»¥é¿å…æ± ä¸­çš„å¤§è§„æ¨¡ç­ç»ã€‚ <strong>æˆ‘ä»¬å¼ºçƒˆå»ºè®®è®¾ç½®æ­¤å€¼ï¼Œå®ƒåº”è¯¥æ¯”ä»»ä½•æ•°æ®åº“æˆ–åŸºç¡€è®¾æ–½å¼ºåŠ çš„è¿æ¥æ—¶é—´é™åˆ¶çŸ­å‡ ç§’é’Ÿã€‚</strong> å€¼ 0 è¡¨ç¤ºæ²¡æœ‰æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ— é™ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå½“ç„¶å–å†³äº<code>idleTimeout</code>è®¾ç½®ã€‚å…è®¸çš„æœ€å°å€¼ä¸º 30000 æ¯«ç§’ï¼ˆ30 ç§’ï¼‰ã€‚ <em>é»˜è®¤å€¼ï¼š1800000ï¼ˆ30 åˆ†é’Ÿï¼‰</em></p><p>ğŸ”¤<code>connectionTestQuery</code><br><strong>å¦‚æœæ‚¨çš„é©±åŠ¨ç¨‹åºæ”¯æŒ JDBC4ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸è¦è®¾ç½®æ­¤å±æ€§ã€‚</strong>è¿™é€‚ç”¨äºä¸æ”¯æŒ JDBC4 çš„â€œæ—§ç‰ˆâ€é©±åŠ¨ç¨‹åº<code>Connection.isValid() API</code>ã€‚è¿™æ˜¯å°†åœ¨æ± ä¸­ä¸ºæ‚¨æä¾›è¿æ¥ä¹‹å‰æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œä»¥éªŒè¯ä¸æ•°æ®åº“çš„è¿æ¥æ˜¯å¦ä»ç„¶å­˜åœ¨ã€‚<em>åŒæ ·ï¼Œå°è¯•åœ¨æ²¡æœ‰æ­¤å±æ€§çš„æƒ…å†µä¸‹è¿è¡Œæ± ï¼Œå¦‚æœæ‚¨çš„é©±åŠ¨ç¨‹åºä¸ç¬¦åˆ JDBC4ï¼ŒHikariCP å°†è®°å½•é”™è¯¯ä»¥é€šçŸ¥æ‚¨ã€‚</em> <em>é»˜è®¤å€¼ï¼šæ— </em></p><p>ğŸ”¢<code>minimumIdle</code><br>æ­¤å±æ€§æ§åˆ¶HikariCP å°è¯•åœ¨æ± ä¸­ç»´æŠ¤çš„æœ€å°<em>ç©ºé—²è¿æ¥æ•°ã€‚<em>å¦‚æœç©ºé—²è¿æ¥ä½äºæ­¤å€¼å¹¶ä¸”æ± ä¸­çš„æ€»è¿æ¥æ•°å°äº<code>maximumPoolSize</code>ï¼ŒHikariCP å°†å°½æœ€å¤§åŠªåŠ›å¿«é€Ÿæœ‰æ•ˆåœ°æ·»åŠ é¢å¤–çš„è¿æ¥ã€‚ä½†æ˜¯ï¼Œä¸ºäº†è·å¾—æœ€å¤§æ€§èƒ½å’Œå¯¹å³°å€¼éœ€æ±‚çš„å“åº”ï¼Œæˆ‘ä»¬å»ºè®®</em>ä¸è¦<em>è®¾ç½®æ­¤å€¼ï¼Œè€Œæ˜¯å…è®¸ HikariCP å……å½“</em>å›ºå®šå¤§å°*çš„è¿æ¥æ± ã€‚ *é»˜è®¤å€¼ï¼šä¸ maximumPoolSize ç›¸åŒ</em></p><p>ğŸ”¢<code>maximumPoolSize</code><br>æ­¤å±æ€§æ§åˆ¶æ± å…è®¸è¾¾åˆ°çš„æœ€å¤§å¤§å°ï¼ŒåŒ…æ‹¬ç©ºé—²å’Œä½¿ç”¨ä¸­çš„è¿æ¥ã€‚åŸºæœ¬ä¸Šï¼Œæ­¤å€¼å°†ç¡®å®šä¸æ•°æ®åº“åç«¯çš„å®é™…è¿æ¥çš„æœ€å¤§æ•°é‡ã€‚ä¸€ä¸ªåˆç†çš„å€¼æœ€å¥½ç”±æ‚¨çš„æ‰§è¡Œç¯å¢ƒç¡®å®šã€‚<code>connectionTimeout</code>å½“æ± è¾¾åˆ°è¿™ä¸ªå¤§å°å¹¶ä¸”æ²¡æœ‰å¯ç”¨çš„ç©ºé—²è¿æ¥æ—¶ï¼Œå¯¹ getConnection() çš„è°ƒç”¨å°†åœ¨è¶…æ—¶ä¹‹å‰é˜»å¡é•¿è¾¾å‡ æ¯«ç§’ã€‚è¯·é˜…è¯»<a href="https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing" target="_blank" rel="noopener">æœ‰å…³æ± å¤§å°</a>çš„ä¿¡æ¯ã€‚ <em>é»˜è®¤å€¼ï¼š10</em></p><p>ğŸ“ˆ<code>metricRegistry</code><br>æ­¤å±æ€§ä»…å¯é€šè¿‡ç¼–ç¨‹é…ç½®æˆ– IoC å®¹å™¨ä½¿ç”¨ã€‚æ­¤å±æ€§å…è®¸æ‚¨æŒ‡å®š<em>Codahale/Dropwizard</em> <code>MetricRegistry</code>çš„å®ä¾‹ï¼Œä»¥ä¾›æ± ç”¨äºè®°å½•å„ç§æŒ‡æ ‡ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://github.com/brettwooldridge/HikariCP/wiki/Dropwizard-Metrics" target="_blank" rel="noopener">åº¦é‡</a> wiki é¡µé¢ã€‚ <em>é»˜è®¤å€¼ï¼šæ— </em></p><p>ğŸ“ˆ<code>healthCheckRegistry</code><br>æ­¤å±æ€§ä»…å¯é€šè¿‡ç¼–ç¨‹é…ç½®æˆ– IoC å®¹å™¨ä½¿ç”¨ã€‚æ­¤å±æ€§å…è®¸æ‚¨æŒ‡å®š<em>Codahale/Dropwizard</em> <code>HealthCheckRegistry</code>çš„å®ä¾‹ï¼Œä¾›æ± ç”¨äºæŠ¥å‘Šå½“å‰çš„å¥åº·ä¿¡æ¯ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿è¡Œ<a href="https://github.com/brettwooldridge/HikariCP/wiki/Dropwizard-HealthChecks" target="_blank" rel="noopener">çŠ¶å†µæ£€æŸ¥</a> wiki é¡µé¢ã€‚ <em>é»˜è®¤å€¼ï¼šæ— </em></p><p>ğŸ”¤<code>poolName</code><br>æ­¤å±æ€§è¡¨ç¤ºè¿æ¥æ± çš„ç”¨æˆ·å®šä¹‰åç§°ï¼Œä¸»è¦å‡ºç°åœ¨æ—¥å¿—è®°å½•å’Œ JMX ç®¡ç†æ§åˆ¶å°ä¸­ï¼Œä»¥è¯†åˆ«æ± å’Œæ± é…ç½®ã€‚ <em>é»˜è®¤å€¼ï¼šè‡ªåŠ¨ç”Ÿæˆ</em>ã€‚</p><table><thead><tr><th><code>spring.datasource.hikari.connection-timeout</code></th><th>æ§åˆ¶å®¢æˆ·ç«¯ç­‰å¾…æ¥è‡ªæ•°æ®åº“è¿æ¥æ± è¿æ¥çš„æœ€å¤§æ¯«ç§’æ•°ã€‚å¦‚æœåœ¨æ²¡æœ‰å¯ç”¨è¿æ¥çš„æƒ…å†µä¸‹è¶…è¿‡æ­¤æ—¶é—´ï¼Œå°†å¼•å‘ SQLExceptionã€‚å¯æ¥å—çš„æœ€ä½è¿æ¥è¶…æ—¶ä¸º 250 æ¯«ç§’ã€‚ <strong>é»˜è®¤å€¼ï¼š30000ï¼ˆ30 ç§’ï¼‰</strong></th></tr></thead><tbody><tr><td><code>spring.datasource.hikari.idle-timeout</code></td><td>åªæœ‰å½“minimum-idleå°äºmaximum-pool-sizeæ—¶ï¼Œè¿™ä¸ªå‚æ•°æ‰ç”Ÿæ•ˆï¼Œå½“ç©ºé—²è¿æ¥æ•°è¶…è¿‡minimum-idleï¼Œè€Œä¸”ç©ºé—²æ—¶é—´è¶…è¿‡idleTimeoutï¼Œåˆ™ä¼šè¢«ç§»é™¤ã€‚</td></tr><tr><td><code>spring.datasource.hikari.max-lifetime</code></td><td>è¿æ¥åœ¨è¿æ¥æ± ä¸­çš„æœ€å¤§<a href="https://so.csdn.net/so/search?q=ç”Ÿå‘½å‘¨æœŸ&spm=1001.2101.3001.7020" target="_blank" rel="noopener">ç”Ÿå‘½å‘¨æœŸ</a>ï¼Œ å¼ºçƒˆå»ºè®®è®¾ç½®æ­¤å€¼ï¼Œå®ƒåº”è¯¥æ¯”ä»»ä½•æ•°æ®åº“æˆ–åŸºç¡€è®¾æ–½å¼ºåŠ çš„è¿æ¥æ—¶é—´é™åˆ¶çŸ­å‡ ç§’é’Ÿã€‚ å€¼ 0 è¡¨ç¤ºæ²¡æœ‰æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ— é™ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå½“ç„¶å–å†³äº<code>idleTimeout</code>è®¾ç½®ã€‚å…è®¸çš„æœ€å°å€¼ä¸º 30000 æ¯«ç§’ï¼ˆ30 ç§’ï¼‰ã€‚ <em>é»˜è®¤å€¼ï¼š1800000ï¼ˆ30 åˆ†é’Ÿï¼‰</em>æ³¨æ„ï¼šmax-lifetimeå¿…é¡»æ¯”æ•°æ®åº“çš„wait_timeoutå‚æ•°çŸ­ä¸€äº›</td></tr><tr><td><code>spring.datasource.hikari.maximum-pool-size</code></td><td>æ­¤å±æ€§è¡¨ç¤ºæ•°æ®åº“è¿æ¥æ± å…è®¸è¾¾åˆ°çš„æœ€å¤§å¤§å°ï¼ŒåŒ…æ‹¬ç©ºé—²å’Œä½¿ç”¨ä¸­çš„è¿æ¥ã€‚</td></tr><tr><td><code>spring.datasource.hikari.minimum-idle</code></td><td>æ­¤å±æ€§è¡¨ç¤ºæ•°æ®åº“è¿æ¥æ± ä¸­ç»´æŠ¤çš„æœ€å°ç©ºé—²è¿æ¥æ•°</td></tr><tr><td><code>spring.datasource.hikari.pool-name</code></td><td>æ­¤å±æ€§è¡¨ç¤ºè¿æ¥æ± çš„ç”¨æˆ·å®šä¹‰åç§°ï¼Œä¸»è¦å‡ºç°åœ¨æ—¥å¿—è®°å½•å’Œ JMX ç®¡ç†æ§åˆ¶å°ä¸­ï¼Œä»¥è¯†åˆ«æ± å’Œæ± é…ç½®ã€‚</td></tr></tbody></table><p><strong>å®˜ç½‘ï¼š<a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener">https://github.com/brettwooldridge/HikariCP</a></strong></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis-Pluså¦‚ä½•å°†å­—æ®µä¿®æ”¹ä¸ºç©ºå€¼</title>
    <url>/post/62b88c18.html</url>
    <content><![CDATA[<blockquote><p>MyBatis-Pluså¦‚ä½•å°†å­—æ®µä¿®æ”¹ä¸ºç©ºå€¼ ~</p></blockquote><a id="more"></a><h3 id="æ–¹æ¡ˆä¸€ã€ä¿®æ”¹å…¨å±€æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰"><a href="#æ–¹æ¡ˆä¸€ã€ä¿®æ”¹å…¨å±€æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰" class="headerlink" title="æ–¹æ¡ˆä¸€ã€ä¿®æ”¹å…¨å±€æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰"></a>æ–¹æ¡ˆä¸€ã€ä¿®æ”¹å…¨å±€æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">	global-config:</span><br><span class="line">		#å­—æ®µç­–ç•¥ IGNOREDï¼š"å¿½ç•¥åˆ¤æ–­"ã€NOT_NULLï¼š"éNULLåˆ¤æ–­"ã€NOT_EMPTYï¼š"éç©ºåˆ¤æ–­"</span><br><span class="line">    	field-strategy: IGNORED</span><br></pre></td></tr></table></figure><blockquote><p>ä¸æ¨èä½¿ç”¨åŸå› ï¼šä½œç”¨èŒƒå›´å¤ªå¹¿ã€‚<font color="red"><strong>æ³¨æ„ï¼šè°ƒç”¨MyBatis-Pluså°è£…çš„ update ä¹Ÿä¼šä¸ç»æ„å°†å­—æ®µæ”¹ä¸ºç©ºï¼Œå½±å“å…¶ä»–æ¥å£ã€‚</strong></font></p></blockquote><h3 id="æ–¹æ¡ˆäºŒã€ä¿®æ”¹æŒ‡å®šå­—æ®µçš„æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰"><a href="#æ–¹æ¡ˆäºŒã€ä¿®æ”¹æŒ‡å®šå­—æ®µçš„æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰" class="headerlink" title="æ–¹æ¡ˆäºŒã€ä¿®æ”¹æŒ‡å®šå­—æ®µçš„æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰"></a>æ–¹æ¡ˆäºŒã€ä¿®æ”¹æŒ‡å®šå­—æ®µçš„æ›´æ–°ç­–ç•¥ï¼ˆä¸æ¨èï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField</span>(strategy = FieldStrategy.IGNORED)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸æ¨èä½¿ç”¨åŸå› ï¼šç›¸å¯¹äºæ–¹æ¡ˆä¸€ä½œç”¨èŒƒå›´ç›¸å¯¹è¾ƒå°ã€‚<font color="red"><strong>æ³¨æ„ï¼šè°ƒç”¨MyBatis-Pluså°è£…çš„ update ä¹Ÿä¼šä¸ç»æ„å°†å­—æ®µæ”¹ä¸ºç©ºï¼Œå½±å“å…¶ä»–æ¥å£ã€‚</strong></font></p></blockquote><h3 id="æ–¹æ¡ˆä¸‰ã€ä½¿ç”¨LambdaUpdateWrapperåªåœ¨ç‰¹å®šéœ€æ±‚ä¸‹åšå¤„ç†ï¼ˆæ¨èï¼‰"><a href="#æ–¹æ¡ˆä¸‰ã€ä½¿ç”¨LambdaUpdateWrapperåªåœ¨ç‰¹å®šéœ€æ±‚ä¸‹åšå¤„ç†ï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹æ¡ˆä¸‰ã€ä½¿ç”¨LambdaUpdateWrapperåªåœ¨ç‰¹å®šéœ€æ±‚ä¸‹åšå¤„ç†ï¼ˆæ¨èï¼‰"></a>æ–¹æ¡ˆä¸‰ã€ä½¿ç”¨LambdaUpdateWrapperåªåœ¨ç‰¹å®šéœ€æ±‚ä¸‹åšå¤„ç†ï¼ˆæ¨èï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Order order = <span class="keyword">new</span> Order();</span><br><span class="line">order.setId(<span class="number">1</span>);</span><br><span class="line">order.setPrice(<span class="number">3.8</span>)</span><br><span class="line">order.setName(<span class="keyword">null</span>)</span><br><span class="line">LambdaUpdateWrapper&lt;Order&gt; lambdaUpdate = Wrappers.lambdaUpdate();</span><br><span class="line"><span class="comment">//æ„å»ºwhereæ¡ä»¶æ ¹æ®idä¿®æ”¹</span></span><br><span class="line">lambdaUpdate.eq(Order::getId, order.getId()); </span><br><span class="line"><span class="comment">//nameå±æ€§ä¸ºç©ºæ—¶å¯ä»¥ä¿®æ”¹å­—æ®µä¸ºNULL</span></span><br><span class="line"><span class="keyword">if</span> (StringUtils.isEmpty(order.getName())) lambdaUpdate.set(Order::getName, <span class="keyword">null</span>); </span><br><span class="line"><span class="comment">//æ­¤æ—¶ç”Ÿæˆçš„SQLè¯­å¥ä¸ºupdate order set price = 3.8, name = null where id = 1</span></span><br><span class="line"><span class="keyword">super</span>.update(order, lambdaUpdate);</span><br></pre></td></tr></table></figure><blockquote><p>æ¨èåŸå› ï¼šä¸å½±å“ä»»ä½•åœ°æ–¹åªåœ¨æ­¤å¤„ç”Ÿæ•ˆ</p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MyBatisPlus</category>
      </categories>
      <tags>
        <tag>MyBatisPlus</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯ç²¾åº¦ä¸¢å¤±-@JsonSerialize</title>
    <url>/post/9b061489.html</url>
    <content><![CDATA[<blockquote><p>Long å€¼è¶…è¿‡å‰ç«¯ js æ˜¾ç¤ºçš„é•¿åº¦èŒƒå›´æ—¶ä¼šå¯¼è‡´å‰ç«¯å›æ˜¾é”™è¯¯ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h3><p>Long å€¼è¶…è¿‡å‰ç«¯ js æ˜¾ç¤ºçš„é•¿åº¦èŒƒå›´æ—¶ä¼šå¯¼è‡´å‰ç«¯å›æ˜¾é”™è¯¯ã€‚</p><h3 id="äºŒã€è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€è§£å†³æ–¹æ¡ˆ"></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h3><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><p>ç›´æ¥å®šä¹‰æˆStringç±»å‹ï¼Œåç«¯ä½¿ç”¨çš„æ—¶å€™è½¬æˆLongç±»å‹</p><h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p><code>å…¥å‚ï¼šå®šä¹‰æˆLongï¼Œé€šè¿‡dataTypeåˆ¶å®šç±»å‹</code><br><code>@ApiModelProperty(value = &quot;å›¢é˜ŸID&quot;, dataType = &quot;java.lang.String&quot;)</code><br><code>private Long teamId;</code></p><p><code>å‡ºå‚ï¼šå¤„ç†dataTypeä¹‹å¤–ï¼Œè¿˜éœ€è¦å®šä¹‰JsonSerialize</code><br><code>@JsonSerialize(using = ToStringSerializer.class)</code><br><code>@ApiModelProperty(value = &quot;é¡¹ç›®id&quot;, dataType = &quot;java.lang.String&quot;)</code><br><code>private Long projectId;</code></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
  </entry>
  <entry>
    <title>mybatisåŸºç¡€ä¸Šå…¼å®¹mybatisPlus</title>
    <url>/post/bbfd51f8.html</url>
    <content><![CDATA[<blockquote><p>SpringBootåœ¨åŸæœ‰ä½¿ç”¨ Mybatis åŸºç¡€ä¸Šå…¼å®¹ MybatisPlus ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Pom-å¼•å…¥-MybatisPlusä¾èµ–"><a href="#ä¸€ã€Pom-å¼•å…¥-MybatisPlusä¾èµ–" class="headerlink" title="ä¸€ã€Pom  å¼•å…¥ MybatisPlusä¾èµ–"></a>ä¸€ã€Pom å¼•å…¥ MybatisPlusä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å…¼å®¹mybatiså’ŒmybatisPlusä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="äºŒã€ç»§æ‰¿MybatisPluså„å±‚çš„ä¾èµ–"><a href="#äºŒã€ç»§æ‰¿MybatisPluså„å±‚çš„ä¾èµ–" class="headerlink" title="äºŒã€ç»§æ‰¿MybatisPluså„å±‚çš„ä¾èµ–"></a>äºŒã€ç»§æ‰¿MybatisPluså„å±‚çš„ä¾èµ–</h3><p>serviceå±‚ã€serviceImplã€daoå±‚å„è‡ªç»§æ‰¿è‡ªå¸¦çš„å°è£…å¥½çš„Service CRUD æ¥å£ã€‚</p><p>å¢åŠ æ‰«æé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/**/*.xml</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€å®˜ç½‘"><a href="#ä¸‰ã€å®˜ç½‘" class="headerlink" title="ä¸‰ã€å®˜ç½‘"></a>ä¸‰ã€å®˜ç½‘</h3><p><a href="https://baomidou.com/" target="_blank" rel="noopener">https://baomidou.com/</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MyBatisPlus</category>
      </categories>
      <tags>
        <tag>MyBatisPlus</tag>
      </tags>
  </entry>
  <entry>
    <title>QPSã€TPS</title>
    <url>/post/f89ad074.html</url>
    <content><![CDATA[<blockquote><p>QPSã€TPS ~</p></blockquote><a id="more"></a><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>æœ‰ä¸€é“é¢˜ï¼š10Wä¸ªè¯·æ±‚ï¼Œ4ç§’å†…å®Œæˆå¤„ç†ï¼Œæ¯ä¸ªè¯·æ±‚è€—æ—¶2ç§’ï¼Œç³»ç»ŸQPSéœ€è¦è¾¾åˆ°å¤šå°‘æ‰èƒ½æ»¡è¶³ï¼Ÿæ¯ç§’å¤šå°‘å¹¶å‘æ‰èƒ½è¾¾åˆ°è¿™æ ·çš„QPSï¼Ÿ</p><h3 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h3><p>QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡æˆ–æ¯ç§’è¯·æ±‚ç‡ï¼‰æ˜¯è¡¡é‡ç³»ç»Ÿå¤„ç†èƒ½åŠ›çš„ä¸€é¡¹é‡è¦æŒ‡æ ‡ï¼Œè¡¨ç¤ºç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æ•°æˆ–æŸ¥è¯¢æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒQPSè¶Šé«˜ï¼Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å°±è¶Šå¼ºï¼Œå¯ä»¥å¤„ç†æ›´å¤šçš„è¯·æ±‚æˆ–æŸ¥è¯¢ã€‚QPSçš„è®¡ç®—å…¬å¼ä¸ºï¼š<strong>QPS = æ€»è¯·æ±‚æ•° / æ€»å¤„ç†æ—¶é—´</strong> ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿåœ¨1ç§’å†…å¤„ç†äº†1000ä¸ªè¯·æ±‚ï¼Œåˆ™è¯¥ç³»ç»Ÿçš„QPSä¸º1000ã€‚QPSçš„é«˜ä½å–å†³äºç³»ç»Ÿçš„æ€§èƒ½ã€ç¡¬ä»¶é…ç½®ã€ç½‘ç»œå¸¦å®½ç­‰å› ç´ ï¼Œæ˜¯è¯„ä¼°ç³»ç»Ÿæ€§èƒ½çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p><h3 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºæ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ä¸º2ç§’ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼æ¥è®¡ç®—ç³»ç»Ÿçš„ QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰ï¼š</p><p><strong>QPS = æ€»è¯·æ±‚æ•° / æ€»å¤„ç†æ—¶é—´</strong></p><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæ€»è¯·æ±‚æ•°ä¸º10ä¸‡ï¼ˆå³100,000ï¼‰ï¼Œæ€»å¤„ç†æ—¶é—´ä¸º4ç§’ã€‚</p><p>QPS = 100,000 / 4 = 25,000</p><p>å› æ­¤ï¼Œç³»ç»Ÿçš„ QPS éœ€è¦è¾¾åˆ°25,000ã€‚</p><p>è¦è®¡ç®—æ¯ç§’çš„å¹¶å‘æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼š</p><p><strong>å¹¶å‘æ•° = QPS * å¹³å‡å“åº”æ—¶é—´</strong></p><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œå¹³å‡å“åº”æ—¶é—´ä¸º2ç§’ã€‚</p><p>å¹¶å‘æ•° = 25,000 * 2 = 50,000</p><p>å› æ­¤ï¼Œæ¯ç§’éœ€è¦è¾¾åˆ°50,000çš„å¹¶å‘æ•°æ‰èƒ½æ»¡è¶³è¿™æ ·çš„ QPSã€‚</p><h3 id="TPS"><a href="#TPS" class="headerlink" title="TPS"></a>TPS</h3><p>TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰æ˜¯TransactionsPerSecondçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡æ•°/ç§’ã€‚å®ƒæ˜¯è½¯ä»¶æµ‹è¯•ç»“æœçš„æµ‹é‡å•ä½ã€‚ä¸€ä¸ªäº‹åŠ¡æ˜¯<strong>æŒ‡ä¸€ä¸ªå®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç„¶åæœåŠ¡å™¨åšå‡ºååº”çš„è¿‡ç¨‹</strong>ã€‚å®¢æˆ·æœºåœ¨å‘é€è¯·æ±‚æ—¶å¼€å§‹è®¡æ—¶ï¼Œæ”¶åˆ°æœåŠ¡å™¨å“åº”åç»“æŸè®¡æ—¶ï¼Œä»¥æ­¤æ¥è®¡ç®—ä½¿ç”¨çš„æ—¶é—´å’Œå®Œæˆçš„äº‹åŠ¡ä¸ªæ•°ã€‚è®¡ç®—TPSçš„å…¬å¼å¦‚ä¸‹ï¼š</p><p><strong>TPS = æ€»äº‹åŠ¡æ•° / æ€»æ—¶é—´</strong></p><p>å…¶ä¸­ï¼Œæ€»äº‹åŠ¡æ•°æ˜¯æŒ‡åœ¨ç»™å®šæ—¶é—´å†…å®Œæˆçš„äº‹åŠ¡æ•°é‡ï¼Œæ€»æ—¶é—´æ˜¯æŒ‡å®Œæˆè¿™äº›äº‹åŠ¡æ‰€èŠ±è´¹çš„æ€»æ—¶é—´ã€‚</p><p>è¯·æ³¨æ„ï¼ŒTPSä¸QPSçš„æ¦‚å¿µç•¥æœ‰ä¸åŒã€‚TPSé€šå¸¸ç”¨äºè¡¡é‡ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼Œè€ŒQPSé€šå¸¸ç”¨äºè¡¡é‡ç³»ç»Ÿçš„è¯·æ±‚æ•°é‡ã€‚</p><blockquote><p>TPSå¤„ç†æµç¨‹ï¼š</p><p>Tpså³æ¯ç§’å¤„ç†äº‹åŠ¡æ•°ï¼ŒåŒ…æ‹¬äº†</p><p>1ã€ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨</p><p>2ã€æœåŠ¡å™¨è‡ªå·±çš„å†…éƒ¨æŸ¥è¯¢ç­‰å¤„ç†</p><p>3ã€æœåŠ¡å™¨è¿”å›ç»™ç”¨æˆ·</p><p>è¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼Œæ¯ç§’èƒ½å¤Ÿå®ŒæˆNä¸ªè¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼ŒTpsä¹Ÿå°±æ˜¯3ï¼›</p><p>QPSåŸºæœ¬ç±»ä¼¼äºTPSï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªé¡µé¢çš„ä¸€æ¬¡è®¿é—®ï¼Œå½¢æˆä¸€ä¸ªTPSï¼›ä½†ä¸€æ¬¡é¡µé¢è¯·æ±‚ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯¹è¿™äº›è¯·æ±‚ï¼Œå°±å¯è®¡å…¥QPSä¹‹ä¸­ã€‚æ¯ç§’æŸ¥è¯¢ç‡QPSæ˜¯å¯¹ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢æœåŠ¡å™¨åœ¨è§„å®šæ—¶é—´å†…æ‰€å¤„ç†æµé‡å¤šå°‘çš„è¡¡é‡æ ‡å‡†</p><p>ä¸€ä¸ªäº‹åŠ¡æ˜¯æŒ‡ä¸€ä¸ªå®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç„¶åæœåŠ¡å™¨åšå‡ºååº”çš„è¿‡ç¨‹ã€‚å®¢æˆ·æœºåœ¨å‘é€è¯·æ±‚æ—¶å¼€å§‹è®¡æ—¶ï¼Œæ”¶åˆ°æœåŠ¡å™¨å“åº”åç»“æŸè®¡æ—¶ï¼Œä»¥æ­¤æ¥è®¡ç®—ä½¿ç”¨çš„æ—¶é—´å’Œå®Œæˆçš„äº‹åŠ¡ä¸ªæ•°ã€‚</p><p>å¦‚æœæ˜¯å¯¹ä¸€ä¸ªæ¥å£ï¼ˆå•åœºæ™¯ï¼‰å‹æµ‹ï¼Œä¸”è¿™ä¸ªæ¥å£å†…éƒ¨ä¸ä¼šå†å»è¯·æ±‚å…¶å®ƒæ¥å£ï¼Œé‚£ä¹ˆTPSç­‰äºQPSï¼Œå¦åˆ™ï¼ŒTPS ä¸ç­‰äº QPS</p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>QPS</category>
      </categories>
      <tags>
        <tag>QPS</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot æ’ä»¶åŒ–å¼€å‘æ¨¡å¼ï¼Œæ³°é…·è¾£~</title>
    <url>/post/bb3db52d.html</url>
    <content><![CDATA[<blockquote><p>SpringBoot æ’ä»¶åŒ–å¼€å‘æ¨¡å¼ï¼Œæ³°é…·è¾£~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä½¿ç”¨æ’ä»¶çš„å¥½å¤„"><a href="#ä¸€ã€ä½¿ç”¨æ’ä»¶çš„å¥½å¤„" class="headerlink" title="ä¸€ã€ä½¿ç”¨æ’ä»¶çš„å¥½å¤„"></a>ä¸€ã€ä½¿ç”¨æ’ä»¶çš„å¥½å¤„</h3><h4 id="1ã€æ¨¡å—è§£è€¦"><a href="#1ã€æ¨¡å—è§£è€¦" class="headerlink" title="1ã€æ¨¡å—è§£è€¦"></a>1ã€æ¨¡å—è§£è€¦</h4><p>å®ç°æœåŠ¡æ¨¡å—ä¹‹é—´è§£è€¦çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ’ä»¶æ¥è¯´ï¼Œå…¶è§£è€¦çš„ç¨‹åº¦ä¼¼ä¹æ›´é«˜ï¼Œè€Œä¸”æ›´çµæ´»ï¼Œå¯å®šåˆ¶åŒ–ã€ä¸ªæ€§åŒ–æ›´å¥½ã€‚</p><h4 id="2ã€æå‡æ‰©å±•æ€§å’Œå¼€æ”¾æ€§"><a href="#2ã€æå‡æ‰©å±•æ€§å’Œå¼€æ”¾æ€§" class="headerlink" title="2ã€æå‡æ‰©å±•æ€§å’Œå¼€æ”¾æ€§"></a>2ã€æå‡æ‰©å±•æ€§å’Œå¼€æ”¾æ€§</h4><p>ä»¥springæ¥è¯´ï¼Œä¹‹æ‰€ä»¥å…·å¤‡å¦‚æ­¤å¹¿æ³›çš„ç”Ÿæ€ï¼Œä¸å…¶è‡ªèº«å†…ç½®çš„å„ç§å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶æ˜¯åˆ†ä¸å¼€çš„ï¼Œè¯•æƒ³ä¸ºä»€ä¹ˆä½¿ç”¨äº†springæ¡†æ¶ä¹‹åå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹æ¥å…¶ä»–ä¸­é—´ä»¶ï¼Œé‚£å°±æ˜¯springæ¡†æ¶æä¾›äº†å¾ˆå¤šåŸºäºæ’ä»¶åŒ–çš„æ‰©å±•ç‚¹ã€‚</p><p>æ’ä»¶åŒ–æœºåˆ¶è®©ç³»ç»Ÿçš„æ‰©å±•æ€§å¾—ä»¥æå‡ï¼Œä»è€Œå¯ä»¥ä¸°å¯Œç³»ç»Ÿçš„å‘¨è¾¹åº”ç”¨ç”Ÿæ€ã€‚</p><h4 id="3ã€æ–¹ä¾¿ç¬¬ä¸‰æ–¹æ¥å…¥"><a href="#3ã€æ–¹ä¾¿ç¬¬ä¸‰æ–¹æ¥å…¥" class="headerlink" title="3ã€æ–¹ä¾¿ç¬¬ä¸‰æ–¹æ¥å…¥"></a>3ã€æ–¹ä¾¿ç¬¬ä¸‰æ–¹æ¥å…¥</h4><p>æœ‰äº†æ’ä»¶ä¹‹åï¼Œç¬¬ä¸‰æ–¹åº”ç”¨æˆ–ç³»ç»Ÿå¦‚æœè¦å¯¹æ¥è‡ªèº«çš„ç³»ç»Ÿï¼Œç›´æ¥åŸºäºç³»ç»Ÿé¢„ç•™çš„æ’ä»¶æ¥å£å®Œæˆä¸€å¥—é€‚åˆè‡ªå·±ä¸šåŠ¡çš„å®ç°å³å¯ï¼Œè€Œä¸”å¯¹è‡ªèº«ç³»ç»Ÿçš„ä¾µå…¥æ€§å¾ˆå°ï¼Œç”šè‡³å¯ä»¥å®ç°åŸºäºé…ç½®å‚æ•°çš„çƒ­åŠ è½½ï¼Œæ–¹ä¾¿çµæ´»ï¼Œå¼€ç®±å³ç”¨ã€‚</p><h3 id="äºŒã€-æ’ä»¶åŒ–å¸¸ç”¨å®ç°æ€è·¯"><a href="#äºŒã€-æ’ä»¶åŒ–å¸¸ç”¨å®ç°æ€è·¯" class="headerlink" title="äºŒã€ æ’ä»¶åŒ–å¸¸ç”¨å®ç°æ€è·¯"></a>äºŒã€ æ’ä»¶åŒ–å¸¸ç”¨å®ç°æ€è·¯</h3><p>ä»¥javaä¸ºä¾‹ï¼Œè¿™é‡Œç»“åˆå®é™…ç»éªŒï¼Œæ•´ç†ä¸€äº›å¸¸ç”¨çš„æ’ä»¶åŒ–å®ç°æ€è·¯ï¼š</p><ul><li>Java SPI æœºåˆ¶ï¼›</li><li>Spring SPI æœºåˆ¶</li><li>çº¦å®šé…ç½®å’Œç›®å½•ï¼Œåˆ©ç”¨åå°„é…åˆå®ç°ï¼›</li><li>Springbootä¸­çš„Factoriesæœºåˆ¶ï¼›</li><li>Java agentï¼ˆæ¢é’ˆï¼‰æŠ€æœ¯ï¼›</li><li>Springå†…ç½®æ‰©å±•ç‚¹ï¼›</li><li>ç¬¬ä¸‰æ–¹æ’ä»¶åŒ…ï¼Œä¾‹å¦‚ï¼š<a href="https://cloud.tencent.com/developer/article/2310456" target="_blank" rel="noopener">spring-plugin-core</a> \ <a href="https://github.com/pf4j/pf4j" target="_blank" rel="noopener">pf4j</a>ï¼›</li><li>Spring aopæŠ€æœ¯ï¼›</li></ul><h4 id="1ã€Serviceloaderæ–¹å¼"><a href="#1ã€Serviceloaderæ–¹å¼" class="headerlink" title="1ã€Serviceloaderæ–¹å¼"></a>1ã€Serviceloaderæ–¹å¼</h4><p>serviceloaderæ˜¯javaæä¾›çš„spiæ¨¡å¼çš„å®ç°ã€‚æŒ‰ç…§æ¥å£å¼€å‘å®ç°ç±»ï¼Œè€Œåé…ç½®ï¼Œjavaé€šè¿‡ServiceLoaderæ¥å®ç°ç»Ÿä¸€æ¥å£ä¸åŒå®ç°çš„ä¾æ¬¡è°ƒç”¨ã€‚è€Œjavaä¸­æœ€ç»å…¸çš„serviceloaderçš„ä½¿ç”¨å°±æ˜¯Javaçš„spiæœºåˆ¶ã€‚</p><h4 id="2ã€Java-SPI-æœºåˆ¶"><a href="#2ã€Java-SPI-æœºåˆ¶" class="headerlink" title="2ã€Java SPI æœºåˆ¶"></a>2ã€Java SPI æœºåˆ¶</h4><p>SPIå…¨ç§° Service Provider Interface ï¼Œæ˜¯JDKå†…ç½®çš„ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ï¼Œå®ƒå…è®¸æ¨¡å—ä¹‹é—´é€šè¿‡æ¥å£è¿›è¡Œè§£è€¦ï¼Œç”±ç¬¬ä¸‰æ–¹æ¨¡å—æä¾›å®ç°ï¼Œ<strong>è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å®ç°ç±»</strong>ã€‚SPIæ˜¯ä¸€ç§åŠ¨æ€æ›¿æ¢æ‰©å±•æœºåˆ¶ï¼Œæ¯”å¦‚æœ‰ä¸ªæ¥å£ï¼Œä½ æƒ³åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»™ä»–æ·»åŠ å®ç°ï¼Œä½ åªéœ€æŒ‰ç…§è§„èŒƒç»™ä»–æ·»åŠ ä¸€ä¸ªå®ç°ç±»å³å¯ã€‚æ¯”å¦‚å¤§å®¶ç†Ÿæ‚‰çš„jdbcä¸­çš„Driveræ¥å£ï¼Œä¸åŒçš„å‚å•†å¯ä»¥æä¾›ä¸åŒçš„å®ç°ï¼Œæœ‰mysqlçš„ï¼Œä¹Ÿæœ‰oracleçš„ï¼Œè€ŒJavaçš„SPIæœºåˆ¶å°±å¯ä»¥ä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡çš„å®ç°ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230625145517296.png" alt=""></p><h4 id="3ã€ä¼˜ç§€å¼€æºæ’ä»¶é¡¹ç›®-äº²æµ‹å®è·µ"><a href="#3ã€ä¼˜ç§€å¼€æºæ’ä»¶é¡¹ç›®-äº²æµ‹å®è·µ" class="headerlink" title="3ã€ä¼˜ç§€å¼€æºæ’ä»¶é¡¹ç›®(äº²æµ‹å®è·µ)"></a>3ã€ä¼˜ç§€å¼€æºæ’ä»¶é¡¹ç›®(äº²æµ‹å®è·µ)</h4><p><a href="https://github.com/Linyuzai/concept.git" target="_blank" rel="noopener">ã€ŠConcept å¯æ’æ‹”çš„æ’ä»¶èƒ½åŠ›ã€‹</a><br><a href="https://gitee.com/starblues/springboot-plugin-framework-parent.git" target="_blank" rel="noopener">ã€ŠSpring-brick æ’ä»¶å¼å¼€å‘æ¡†æ¶ã€‹</a><br><a href="https://gitee.com/shuaizinanyihao/shuaizi-springboot-test/tree/master/src/main/java/com/shuaizi/classloader" target="_blank" rel="noopener">ã€Šâ˜…ä¸ªäººè‡ªæµ‹ä»£ç ã€‹</a></p><h3 id="ä¸‰ã€èµ„æ–™"><a href="#ä¸‰ã€èµ„æ–™" class="headerlink" title="ä¸‰ã€èµ„æ–™"></a>ä¸‰ã€èµ„æ–™</h3><p><a href="https://mp.weixin.qq.com/s/dOqHqxDhkwvL-5sjoPUv9Q" target="_blank" rel="noopener">ã€ŠSpring Boot æ’ä»¶åŒ–å¼€å‘æ¨¡å¼ã€‹</a><br><a href="https://mp.weixin.qq.com/s/_mbLi48J6Zcssk6XtG6FTg" target="_blank" rel="noopener">ã€ŠSpringBoot+SPIæœºåˆ¶ï¼Œè½»æ¾å®ç°å¯æ’æ‹”ç»„ä»¶ã€‹</a><br><a href="https://linyuzai.github.io/#/plugin/README" target="_blank" rel="noopener">ã€ŠConcept å¯æ’æ‹”çš„æ’ä»¶èƒ½åŠ›ã€‹</a><br><a href="https://gitee.com/starblues/springboot-plugin-framework-parent.git" target="_blank" rel="noopener">ã€ŠSpring-Bootæ’ä»¶å¼å¼€å‘æ¡†æ¶ã€‹</a><br><a href="https://spring4all.com/forum-post/7565.html" target="_blank" rel="noopener">ã€ŠSpring Boot + pf4j å®ç°æ’ä»¶å¼€å‘åŠŸèƒ½ã€‹</a><br><a href="https://www.cnblogs.com/linyb-geek/p/18581236" target="_blank" rel="noopener">ã€Šè¶…è¯¦ç»†ï¼Spring Boot é¡¹ç›®å€ŸåŠ© PF4J å®ç°æ’ä»¶åŠ¨æ€åŠ è½½ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Boot å‡å°‘JARçš„å¤§å°</title>
    <url>/post/ed2b4eb8.html</url>
    <content><![CDATA[<blockquote><p>å¾®æœåŠ¡æ¶æ„ï¼Œæ¯ä¸ªJaråŒ…å¤ªå¤§ï¼Œä¼ åŒ…é€Ÿåº¦åˆå¾ˆæ…¢ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€POMå¢åŠ ä¸€ä¸‹é…ç½®"><a href="#ä¸€ã€POMå¢åŠ ä¸€ä¸‹é…ç½®" class="headerlink" title="ä¸€ã€POMå¢åŠ ä¸€ä¸‹é…ç½®"></a>ä¸€ã€POMå¢åŠ ä¸€ä¸‹é…ç½®</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ‰“å‡ºçš„jaråŒ…åŒ…å  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                     <span class="comment">&lt;!-- é¡¹ç›®å¯åŠ¨æ–‡ä»¶è·¯å¾„ --&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.violet.BaseServerApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!-- è§£å†³windowså‘½ä»¤è¡Œçª—å£ä¸­æ–‡ä¹±ç  --&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">jvmArguments</span>&gt;</span>-Dfile.encoding=UTF-8<span class="tag">&lt;/<span class="name">jvmArguments</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!-- é…ç½®éœ€è¦æ‰“åŒ…è¿›é¡¹ç›®çš„jaråŒ… --&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- éœ€è¦æ’é™¤æ‰€æœ‰ä¾èµ– é…ç½®non-existsè¿™ä¸ªå°±è¡Œ --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--&lt;include&gt; --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--   &lt;groupId&gt;non-exists&lt;/groupId&gt; --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--   &lt;artifactId&gt;non-exists&lt;/artifactId&gt; --&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--&lt;/include&gt; --&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- éœ€è¦æ‰“åŒ…è¿›jaråŒ…çš„ä¾èµ–é…ç½®åœ¨è¿™é‡Œ --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.violet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>base-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- é¡¹ç›®æ‰“åŒ…åˆ†ç¦»é¡¹ç›®ä»£ç å’Œä¾èµ–jar æ’ä»¶ --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                         <span class="comment">&lt;!-- æŠ½å‡ºçš„libåŒ…å­˜æ”¾äº†è·¯å¾„ --&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                           <span class="comment">&lt;!-- æ˜¯å¦æ’é™¤ä¾èµ–ä¼ é€’æ€§ --&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">excludeTransitive</span>&gt;</span>false<span class="tag">&lt;/<span class="name">excludeTransitive</span>&gt;</span></span><br><span class="line">                           <span class="comment">&lt;!-- æ˜¯å¦å»æ‰jaråŒ…ç‰ˆæœ¬ä¿¡æ¯ --&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">stripVersion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">stripVersion</span>&gt;</span></span><br><span class="line">                           <span class="comment">&lt;!-- åŒ…å«èŒƒå›´ --&gt;</span></span><br><span class="line">                           <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="äºŒã€JaråŒ…å¯åŠ¨è„šæœ¬"><a href="#äºŒã€JaråŒ…å¯åŠ¨è„šæœ¬" class="headerlink" title="äºŒã€JaråŒ…å¯åŠ¨è„šæœ¬"></a>äºŒã€JaråŒ…å¯åŠ¨è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-Xms: è®¾ç½®åˆå§‹åŒ–å †å†…å­˜å¤§å°ï¼›</span></span><br><span class="line"><span class="meta">#</span><span class="bash">-Xmx: è®¾ç½®æœ€å¤§å¯åˆ†é…å †å†…å­˜å¤§å°</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MetaspaceSize:å…ƒç©ºé—´é»˜è®¤å¤§å°</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxMetaspaceSize:å…ƒç©ºé—´æœ€å¤§å¤§å°</span></span><br><span class="line"><span class="meta">#</span><span class="bash">JVMå‚æ•°</span></span><br><span class="line">JVM_OPTS="-Xms128m -XX:MetaspaceSize=128M -Xmx128m -XX:MaxMetaspaceSize=512M -Dfile.encoding=utf-8"</span><br><span class="line"><span class="meta">#</span><span class="bash">æ—¥å¿—è¾“å‡ºè·¯å¾„</span></span><br><span class="line">LOG_HOME="/opt/data/logs/"</span><br><span class="line"><span class="meta">#</span><span class="bash">æœåŠ¡åç§°</span></span><br><span class="line">SERVER_NAME="base-server"</span><br><span class="line"><span class="meta">#</span><span class="bash">å½“å‰æ—¥æœŸ å¦‚ï¼š2022-01-01</span></span><br><span class="line">TODAY=$(date -d "now" +"%Y-%m-%d")</span><br><span class="line">LOG_PATH="$&#123;LOG_HOME&#125;$&#123;SERVER_NAME&#125;/$&#123;TODAY&#125;/deb.log"</span><br><span class="line">ACTIVE="test"</span><br><span class="line"><span class="meta">#</span><span class="bash">è„šæœ¬ç»å¯¹è·¯å¾„</span></span><br><span class="line">SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" &amp;&amp; pwd )"</span><br><span class="line">JAR_PATH="$&#123;SCRIPT_DIR&#125;/$&#123;SERVER_NAME&#125;.jar"</span><br><span class="line">LIB_PATH="$&#123;SCRIPT_DIR&#125;/lib"</span><br><span class="line"><span class="meta">#</span><span class="bash">æ€æ­»å·²æœ‰è¿›ç¨‹</span></span><br><span class="line">echo stop $&#123;SERVER_NAME&#125; ..</span><br><span class="line">PID=$(ps -ef | grep $&#123;SERVER_NAME&#125;.jar | grep -v grep | awk '&#123;print $2&#125;')</span><br><span class="line"></span><br><span class="line">if [ ! $PID ]; then</span><br><span class="line">    echo "process $&#123;SERVER_NAME&#125; not exit"</span><br><span class="line">else</span><br><span class="line">    echo "process id: $PID"</span><br><span class="line">kill -9 $&#123;PID&#125;</span><br><span class="line">  if [ $? -eq 0 ]; then</span><br><span class="line">    echo "stop $&#123;SERVER_NAME&#125; success"</span><br><span class="line">  else</span><br><span class="line">    exit</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo start $&#123;SERVER_NAME&#125; ..</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨jaråŒ… è¾“å‡ºå¯åŠ¨æ—¥å¿—</span></span><br><span class="line">nohup java $&#123;JVM_OPTS&#125; -jar -Dloader.path=$&#123;LIB_PATH&#125; $&#123;JAR_PATH&#125; -Dspring.profiles.active=$&#123;ACTIVE&#125;&gt;$&#123;LOG_PATH&#125; 2&gt;&amp;1 &amp; tail -200f $&#123;LOG_PATH&#125;</span><br><span class="line">echo 'start successful'</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenSSLç”Ÿæˆè¯ä¹¦</title>
    <url>/post/da432f73.html</url>
    <content><![CDATA[<blockquote><p>OpenSSLä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€äº‹å‰å‡†å¤‡"><a href="#ä¸€ã€äº‹å‰å‡†å¤‡" class="headerlink" title="ä¸€ã€äº‹å‰å‡†å¤‡"></a>ä¸€ã€äº‹å‰å‡†å¤‡</h3><p>ä½¿ç”¨ç‰ˆæœ¬ï¼šOpenSSL 1.0.2k-fips 26 Jan 2017</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">/bin/sh</span></span><br><span class="line">yum install openssl</span><br><span class="line">yum install vim</span><br><span class="line">mkdir /opt/ssl</span><br><span class="line">cd /opt/ssl/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç”Ÿæˆè¯ä¹¦çš„æ—¶å€™æ¯æ¬¡éƒ½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ¸…é™¤ç¼“å­˜</span></span></span><br><span class="line">cp /etc/pki/tls/openssl.cnf ./</span><br><span class="line">rm -rf /etc/pki/CA/*.old</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ é™¤è¯ä¹¦ç´¢å¼•åº“æ•°æ®åº“æ–‡ä»¶</span></span></span><br><span class="line">rm -rf /etc/pki/CA/index.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç”Ÿæˆè¯ä¹¦ç´¢å¼•åº“æ•°æ®åº“æ–‡ä»¶</span></span></span><br><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŒ‡å®šç¬¬ä¸€ä¸ªé¢å‘è¯ä¹¦çš„åºåˆ—å·</span></span></span><br><span class="line">echo 01 &gt; /etc/pki/CA/serial</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span></span><br><span class="line">rm -rf certs;mkdir certs</span><br></pre></td></tr></table></figure><h3 id="äºŒã€ç”Ÿæˆè¯ä¹¦"><a href="#äºŒã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="äºŒã€ç”Ÿæˆè¯ä¹¦"></a>äºŒã€ç”Ÿæˆè¯ä¹¦</h3><h4 id="1-ç”ŸæˆCAæ ¹è¯ä¹¦"><a href="#1-ç”ŸæˆCAæ ¹è¯ä¹¦" class="headerlink" title="1. ç”ŸæˆCAæ ¹è¯ä¹¦"></a>1. ç”ŸæˆCAæ ¹è¯ä¹¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æ ¹è¯ä¹¦ï¼š</span><br><span class="line">1.ç”Ÿæˆæ ¹è¯ä¹¦ç§é’¥ï¼›</span><br><span class="line">openssl genrsa -out IoTRootCA.key 2048</span><br><span class="line">2.ç”Ÿæˆæ ¹è¯ä¹¦ç­¾å‘ç”³è¯·æ–‡ä»¶å¹¶ç”Ÿæˆæ ¹è¯ä¹¦ï¼›</span><br><span class="line">openssl req -x509 -new -key IoTRootCA.key -sha256 -days 3650 -subj "/C=CN/ST=Zhejiang/L=Hangzhou/O=EMQ/OU=Broker/CN=RootCA" -out IoTRootCA.pem -config openssl.cnf</span><br></pre></td></tr></table></figure><h4 id="2-ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦"><a href="#2-ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦" class="headerlink" title="2. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦"></a>2. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„ç§é’¥ï¼›</span><br><span class="line">openssl genrsa -out EMQServer.key 2048</span><br><span class="line">2.æ ¹æ®ç§é’¥ç­¾å‘ä¸€ä¸ªè¯ä¹¦è¯·æ±‚ï¼›</span><br><span class="line">openssl req -new  -days 3650 -key EMQServer.key -out EMQServer.csr -subj "/C=CN/ST=Zhejiang/L=Hangzhou/O=EMQ/OU=Broker/CN=Server"</span><br><span class="line">3.ç”Ÿæˆè¯ä¹¦;</span><br><span class="line">openssl ca -config openssl.cnf -extensions v3_req -days 3650 -in EMQServer.csr -out EMQServer.pem  -cert IoTRootCA.pem -keyfile IoTRootCA.key</span><br></pre></td></tr></table></figure><h4 id="3-ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦"><a href="#3-ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦" class="headerlink" title="3. ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦"></a>3. ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦çš„ç§é’¥ï¼›</span><br><span class="line">openssl genrsa -out Client.key 2048</span><br><span class="line">2.æ ¹æ®ç§é’¥ç­¾å‘ä¸€ä¸ªè¯ä¹¦è¯·æ±‚;</span><br><span class="line">openssl req -new -key Client.key -out Client.csr -subj "/C=CN/ST=Beijing/L=Beijing/O=ENN/OU=GZ24G/CN=GZ24GD001"</span><br><span class="line">3.ç”Ÿæˆè¯ä¹¦;</span><br><span class="line">openssl x509 -req -CAserial IoTRootCA.srl -CAcreateserial  -in Client.csr -signkey Client.key -CA IoTRootCA.pem -CAkey IoTRootCA.key -out Client.pem -days 36500 -sha256</span><br></pre></td></tr></table></figure><h4 id="4-ç”Ÿæˆå®¢æˆ·ç«¯å…¬é’¥"><a href="#4-ç”Ÿæˆå®¢æˆ·ç«¯å…¬é’¥" class="headerlink" title="4. ç”Ÿæˆå®¢æˆ·ç«¯å…¬é’¥"></a>4. ç”Ÿæˆå®¢æˆ·ç«¯å…¬é’¥</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl rsa -in Client.key -out client_pub.key -pubout</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€éªŒè¯"><a href="#ä¸‰ã€éªŒè¯" class="headerlink" title="ä¸‰ã€éªŒè¯"></a>ä¸‰ã€éªŒè¯</h3><h4 id="1-éªŒè¯CAæ ¹è¯ä¹¦"><a href="#1-éªŒè¯CAæ ¹è¯ä¹¦" class="headerlink" title="1. éªŒè¯CAæ ¹è¯ä¹¦"></a>1. éªŒè¯CAæ ¹è¯ä¹¦</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl verify -CAfile IoTRootCA.pem IoTRootCA.pem</span><br></pre></td></tr></table></figure><h4 id="2-å•å‘è®¤è¯æµ‹è¯•"><a href="#2-å•å‘è®¤è¯æµ‹è¯•" class="headerlink" title="2. å•å‘è®¤è¯æµ‹è¯•"></a>2. å•å‘è®¤è¯æµ‹è¯•</h4><p>æ‰“å¼€2ä¸ªsshä¼šè¯çª—å£ï¼Œç¬¬ä¸€ä¸ªçª—å£æ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œç¬¬äºŒä¸ªçª—å£æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹Verify return codeè¿”å›å€¼ã€‚åŒå‘è®¤è¯ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl s_server -accept 2009 -key EMQServer.key -cert EMQServer.pem</span><br><span class="line">openssl s_client -connect localhost:2009 -CAfile IoTRootCA.pem -showcerts</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">Verify return code: 0 (ok)</span><br></pre></td></tr></table></figure><h4 id="3-åŒå‘è®¤è¯æµ‹è¯•"><a href="#3-åŒå‘è®¤è¯æµ‹è¯•" class="headerlink" title="3. åŒå‘è®¤è¯æµ‹è¯•"></a>3. åŒå‘è®¤è¯æµ‹è¯•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl s_server -accept 2009 -key EMQServer.key -cert EMQServer.pem -CAfile IoTRootCA.pem -Verify 1</span><br><span class="line">openssl s_client -connect localhost:2009 -key Client.key -cert Client.pem -CAfile IoTRootCA.pem -showcerts</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">Verify return code: 0 (ok)</span><br></pre></td></tr></table></figure><h3 id="å››ã€æœ¯è¯­"><a href="#å››ã€æœ¯è¯­" class="headerlink" title="å››ã€æœ¯è¯­"></a>å››ã€æœ¯è¯­</h3><ol><li>keyé€šå¸¸æŒ‡ç§é’¥ã€‚</li><li>CSR æ˜¯Certificate Signing Requestçš„ç¼©å†™ï¼Œå³è¯ä¹¦ç­¾åç”³è¯·ï¼Œè¿™ä¸æ˜¯è¯ä¹¦ï¼Œè¿™æ˜¯è¦æ±‚CAç»™è¯ä¹¦ç­¾åçš„ä¸€ç§æ­£å¼ç”³è¯·ï¼Œè¯¥ç”³è¯·åŒ…å«ç”³è¯·è¯ä¹¦çš„å®ä½“çš„å…¬é’¥åŠè¯¥å®ä½“åº—æŸäº›ä¿¡æ¯ã€‚è¯¥æ•°æ®å°†æˆä¸ºè¯ä¹¦çš„ä¸€éƒ¨åˆ†ã€‚CSRå§‹ç»ˆä½¿ç”¨å®ƒæºå¸¦çš„å…¬é’¥æ‰€å¯¹åº”çš„ç§é’¥è¿›è¡Œç­¾åã€‚</li><li>CRT å³ certificateçš„ç¼©å†™ï¼Œå³è¯ä¹¦ï¼Œå¯ä»¥å°†pemæ–‡ä»¶çš„åç¼€æ”¹ä¸ºcrtç»“å°¾ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯ä¹¦ã€‚</li><li>PEM - Privacy Enhanced Mail,æ‰“å¼€çœ‹æ–‡æœ¬æ ¼å¼,ä»¥â€â€”â€“BEGINâ€¦â€å¼€å¤´, â€œâ€”â€“ENDâ€¦â€ç»“å°¾,å†…å®¹æ˜¯BASE64ç¼–ç ï¼›</li></ol><h3 id="äº”ã€è‡ªå®šä¹‰åŸŸåé™åˆ¶æˆ–è€…IPé™åˆ¶"><a href="#äº”ã€è‡ªå®šä¹‰åŸŸåé™åˆ¶æˆ–è€…IPé™åˆ¶" class="headerlink" title="äº”ã€è‡ªå®šä¹‰åŸŸåé™åˆ¶æˆ–è€…IPé™åˆ¶"></a>äº”ã€è‡ªå®šä¹‰åŸŸåé™åˆ¶æˆ–è€…IPé™åˆ¶</h3><p>æ‰“å¼€<code>openssl.cnf</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°subjectAltNameï¼Œå¢åŠ  <code>alt_names</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[alt_names]</span><br><span class="line">DNS.1 = osw.uio.owsxxb.com</span><br><span class="line">IP.1 = 10.23.65.34</span><br><span class="line">IP.2 = 127.0.0.1</span><br></pre></td></tr></table></figure><p>æ·»åŠ æˆåŠŸåå¯ä»¥åœ¨ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦æˆ–è€…æœåŠ¡ç«¯è¯ä¹¦çœ‹åˆ°ã€‚</p><h3 id="å…­ã€æ–‡çŒ®"><a href="#å…­ã€æ–‡çŒ®" class="headerlink" title="å…­ã€æ–‡çŒ®"></a>å…­ã€æ–‡çŒ®</h3><p><a href="https://www.openssl.org/" target="_blank" rel="noopener">OpenSsl å®˜ç½‘</a></p><p><a href="https://www.cnblogs.com/juanjuankaikai/p/11425598.html" target="_blank" rel="noopener">EMQå¯ç”¨TLSåŒå‘è®¤è¯</a></p><h3 id="ä¸ƒã€FAQ"><a href="#ä¸ƒã€FAQ" class="headerlink" title="ä¸ƒã€FAQ"></a>ä¸ƒã€FAQ</h3><ol><li>å‡ºç°å¥‡è‘©é—®é¢˜ï¼Œå¯ä»¥æ›´æ¢emqæœåŠ¡å™¨ä¸­çš„è¯ä¹¦ä½ç½®ã€‚</li><li>å‡ºç°å¥‡è‘©é—®é¢˜ï¼Œå¯ä»¥æ¸…é™¤ç¼“å­˜ã€‚</li></ol><h3 id="å…«ã€linuxå¯æ‰§è¡Œshæ–‡ä»¶"><a href="#å…«ã€linuxå¯æ‰§è¡Œshæ–‡ä»¶" class="headerlink" title="å…«ã€linuxå¯æ‰§è¡Œshæ–‡ä»¶"></a>å…«ã€linuxå¯æ‰§è¡Œshæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/pki/CA/*.old</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ é™¤è¯ä¹¦ç´¢å¼•åº“æ•°æ®åº“æ–‡ä»¶</span></span></span><br><span class="line">rm -rf /etc/pki/CA/index.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç”Ÿæˆè¯ä¹¦ç´¢å¼•åº“æ•°æ®åº“æ–‡ä»¶</span></span></span><br><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æŒ‡å®šç¬¬ä¸€ä¸ªé¢å‘è¯ä¹¦çš„åºåˆ—å·</span></span></span><br><span class="line">echo 01 &gt; /etc/pki/CA/serial</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ ¹è¯ä¹¦</span></span><br><span class="line">openssl genrsa -out IoTRootCA.key 2048</span><br><span class="line">openssl req -x509 -new -key IoTRootCA.key -sha256 -days 3650 -subj "/C=CN/ST=Zhejiang/L=Hangzhou/O=EMQ/OU=Broker/CN=RootCA" -out IoTRootCA.pem -config openssl.cnf</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash">æœåŠ¡å™¨è¯ä¹¦</span></span><br><span class="line">openssl genrsa -out EMQServer.key 2048</span><br><span class="line">openssl req -new  -days 3650 -key EMQServer.key -out EMQServer.csr -subj "/C=CN/ST=Zhejiang/L=Hangzhou/O=EMQ/OU=Broker/CN=Server"</span><br><span class="line">openssl ca -config openssl.cnf -extensions v3_req -days 3650 -in EMQServer.csr -out EMQServer.pem  -cert IoTRootCA.pem -keyfile IoTRootCA.key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å®¢æˆ·ç«¯è¯ä¹¦</span></span><br><span class="line">openssl genrsa -out Client.key 2048</span><br><span class="line">openssl req -new -key Client.key -out Client.csr -subj "/C=CN/ST=Beijing/L=Beijing/O=ENN/OU=GZ24G/CN=GZ24GD001"</span><br><span class="line">openssl x509 -req -CAserial IoTRootCA.srl -CAcreateserial  -in Client.csr -signkey Client.key -CA IoTRootCA.pem -CAkey IoTRootCA.key -out Client.pem -days 36500 -sha256</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å®¢æˆ·ç«¯å…¬é’¥</span></span><br><span class="line">openssl rsa -in Client.key -out client_pub.key -pubout;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>OpenSSL</category>
      </categories>
      <tags>
        <tag>OpenSSL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlè§„èŒƒ</title>
    <url>/post/569feba.html</url>
    <content><![CDATA[<blockquote><p>MySqlè§„èŒƒä»‹ç» ~</p></blockquote><a id="more"></a><h2 id="1-èƒŒæ™¯å’Œç›®çš„"><a href="#1-èƒŒæ™¯å’Œç›®çš„" class="headerlink" title="1. èƒŒæ™¯å’Œç›®çš„"></a>1. èƒŒæ™¯å’Œç›®çš„</h2><p>å¼€å‘äººå‘˜åœ¨é¡¹ç›®ä¸­é’ˆå¯¹DBï¼ˆMySQLï¼‰éœ€è¦è§„èŒƒä½¿ç”¨ã€‚</p><h2 id="2-MySQLæ•°æ®åº“è§„èŒƒ"><a href="#2-MySQLæ•°æ®åº“è§„èŒƒ" class="headerlink" title="2. MySQLæ•°æ®åº“è§„èŒƒ"></a>2. MySQLæ•°æ®åº“è§„èŒƒ</h2><p>ä»¥ä¸‹æ‰€æœ‰è§„èŒƒä¼šæŒ‰ç…§<strong>ã€å¼ºåˆ¶ã€‘ã€ã€å»ºè®®ã€‘</strong>ä¸¤ä¸ªçº§åˆ«è¿›è¡Œæ ‡æ³¨ï¼Œ<strong>å¼ºåˆ¶ä¹Ÿè¡¨ç¤ºæ­¤è§„èŒƒå¿…é¡»è¦è½åœ°</strong>ã€‚</p><h3 id="2-1-1-å­—ç¬¦é›†"><a href="#2-1-1-å­—ç¬¦é›†" class="headerlink" title="2.1.1 å­—ç¬¦é›†"></a>2.1.1 å­—ç¬¦é›†</h3><p>ã€å¼ºåˆ¶ã€‘æ•°æ®åº“æœ¬èº«åº“ã€è¡¨ã€åˆ—æ‰€æœ‰å­—ç¬¦é›†å¿…é¡»ä¿æŒä¸€è‡´ï¼Œ ä½¿ç”¨<code>utf8mb4ï¼ˆä½¿ç”¨MySQLç‰ˆæœ¬ 5.7.27ï¼Œå¯å®Œç¾æ”¯æŒemojiå­—ç¬¦)</code>ã€‚</p><h3 id="2-1-2-ä¸€èˆ¬å‘½åè§„åˆ™-ï¼ˆé€‚ç”¨äº-åº“åï¼Œè¡¨åï¼Œå­—æ®µ-ç´¢å¼•å-ï¼‰"><a href="#2-1-2-ä¸€èˆ¬å‘½åè§„åˆ™-ï¼ˆé€‚ç”¨äº-åº“åï¼Œè¡¨åï¼Œå­—æ®µ-ç´¢å¼•å-ï¼‰" class="headerlink" title="2.1.2 ä¸€èˆ¬å‘½åè§„åˆ™ ï¼ˆé€‚ç”¨äº åº“åï¼Œè¡¨åï¼Œå­—æ®µ ç´¢å¼•å ï¼‰"></a>2.1.2 ä¸€èˆ¬å‘½åè§„åˆ™ ï¼ˆé€‚ç”¨äº åº“åï¼Œè¡¨åï¼Œå­—æ®µ ç´¢å¼•å ï¼‰</h3><ol><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¿ç•™å­—ä½œä¸ºåç§°ã€‚</li><li>ã€æ¨èã€‘æœ‰æ•ˆçš„å¯ç†è§£çš„åç§°ï¼Œç¦æ­¢ä½¿ç”¨æ‹¼éŸ³ï¼Œè‹±æ–‡å•è¯ä½¿ç”¨å•æ•°ï¼›</li></ol><h3 id="2-2-åº“"><a href="#2-2-åº“" class="headerlink" title="2.2 åº“"></a>2.2 åº“</h3><h4 id="2-2-1-è§„åˆ™"><a href="#2-2-1-è§„åˆ™" class="headerlink" title="2.2.1 è§„åˆ™"></a>2.2.1 è§„åˆ™</h4><ol><li><p>ã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡åŸŸå_åº”ç”¨åï¼ŒåªåŒ…å«å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œä¸”ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œé•¿åº¦ä¸è¶…è¿‡64ä¸ªå­—ç¬¦ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯ utf8mb4ã€‚åˆ›å»ºæ•°æ®åº“ SQL ä¸¾ä¾‹ï¼š</p><p><code>create</code> <code>database</code> db_name default<code></code>character<code></code>set<code></code>utf8mb4ï¼›</p></li></ol><h3 id="2-3-è¡¨"><a href="#2-3-è¡¨" class="headerlink" title="2.3 è¡¨"></a>2.3 è¡¨</h3><h4 id="2-3-1-è¡¨è®¾è®¡åŸåˆ™"><a href="#2-3-1-è¡¨è®¾è®¡åŸåˆ™" class="headerlink" title="2.3.1 è¡¨è®¾è®¡åŸåˆ™"></a>2.3.1 è¡¨è®¾è®¡åŸåˆ™</h4><ol><li>æ›´å¿«é€Ÿçš„å®ç°ä¸šåŠ¡æ”¯æ’‘&amp;æ•°æ®æ›´å¥½ç»´æŠ¤</li><li>åœ¨çº¿ä¸Šä¸šåŠ¡å‹åŠ›å¢å¤§çš„æƒ…å†µï¼Œæˆ–æ˜¯è¦æ”¯æ’‘æ›´å¤§çš„å¹¶å‘æ—¶ï¼ŒçŸ¥é“æ€ä¹ˆåšèƒ½è·å¾—æœ€ä½³çš„å®è·µã€‚</li></ol><h4 id="2-3-2-è¡¨è®¾è®¡ç›®æ ‡"><a href="#2-3-2-è¡¨è®¾è®¡ç›®æ ‡" class="headerlink" title="2.3.2 è¡¨è®¾è®¡ç›®æ ‡"></a>2.3.2 è¡¨è®¾è®¡ç›®æ ‡</h4><ol><li>å°½é‡å°çš„åŸåˆ™ï¼Œä¸æµªè´¹</li><li>ä¸ºäº†é«˜å¹¶å‘ï¼Œå»ºè®®ç¦æ­¢ä½¿ç”¨å¤–é”®</li><li>å­—ç¬¦é›†å’Œåº“çº§ä¿æŒä¸€è‡´ã€‚ä¸å•ç‹¬å®šä¹‰å­—æ®µå­—ç¬¦é›†( utf8mb4)ã€‚</li></ol><h4 id="2-3-3-è¡¨è®¾è®¡è§„åˆ™"><a href="#2-3-3-è¡¨è®¾è®¡è§„åˆ™" class="headerlink" title="2.3.3 è¡¨è®¾è®¡è§„åˆ™"></a>2.3.3 è¡¨è®¾è®¡è§„åˆ™</h4><ol><li><p>ã€å¼ºåˆ¶ã€‘åªåŒ…å«å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œä¸”ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œé•¿åº¦ä¸è¶…è¿‡64ä¸ªå­—ç¬¦ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ <strong>ä»¥ä¸‹é’ˆå¯¹éåˆ†åº“åˆ†è¡¨åœºæ™¯</strong> å…³äºä¸»é”®ï¼š(1) å‘½åä¸º <code>id</code>ï¼Œ<strong>å¼ºåˆ¶bigintï¼Œä¸”ä¸º <code>auto_increment</code></strong>ï¼›(2) æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®®è®¾ä¸ºå…¶å®ƒå­—æ®µå¦‚ <code>user_id</code>ï¼Œ<code>order_id</code>ç­‰ï¼Œæ ¹æ®å®é™…ä½¿ç”¨é¢‘ç‡æ¥å»ºç«‹ç´¢å¼•ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘ <strong>é’ˆå¯¹åˆ†åº“åˆ†è¡¨åœºæ™¯ å…³äºä¸»é”®ç­–ç•¥ï¼Œå‡å®šä½¿ç”¨MyCatï¼Œéœ€è€ƒè™‘ä½¿ç”¨å…¨å±€ä¸»é”®ç”Ÿæˆæ–¹æ¡ˆ:</strong> 1. æœ¬åœ°æ–‡ä»¶æ–¹å¼ï¼šä½¿ç”¨æœåŠ¡å™¨æœ¬åœ°ç£ç›˜æ–‡ä»¶çš„æ–¹å¼. 2. æœ¬åœ°æ—¶é—´æˆ³æ–¹å¼ï¼šä½¿ç”¨æ—¶é—´æˆ³æ–¹å¼ã€‚</p></li><li><p>ã€å»ºè®®ã€‘ç›¸å…³æ¨¡å—çš„è¡¨åä¸è¡¨åä¹‹é—´å°½é‡ä½“ç° join çš„å…³ç³»ï¼Œå¦‚ <code>user</code> è¡¨å’Œ <code>user_login</code> è¡¨ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šå­—ç¬¦é›†ä¸º utf8mb4ã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“ç±»å‹ï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸º InnoDBã€‚</p></li><li><p>ã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰ commentã€‚</p></li><li><p>ã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼Œé‡‘é’±ç›¸å…³çš„è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„åˆ›å»ºæ—¶é—´å­—æ®µ <code>create_time</code> å’Œæœ€åæ›´æ–°æ—¶é—´å­—æ®µ <code>update_time</code>ï¼Œå»ºè®®æ•°æ®ç±»å‹æ˜¯datatime,å»ºè®® <code>create_timeçš„é»˜è®¤æ•°å€¼æ˜¯CURRENT_TIMESTAMP().</code></p></li><li><p>ã€å»ºè®®ã€‘åˆå§‹åŒ–å»ºè¡¨æ—¶æ‰€æœ‰å­—æ®µå¿…é¡»éƒ½æ˜¯ <code>NOT NULL</code> å±æ€§(<strong>é™¤äº†ç‰¹æ®Šä¸šåŠ¡åœºæ™¯ä¸‹çš„æ—¶é—´ç±»å‹å­—æ®µ</strong>)ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰ <code>DEFAULT</code> å€¼ã€‚åæœŸå¯¹åŸå§‹è¡¨è¿›è¡Œddlæ“ä½œ,è¡¨æ•°æ®é‡è¾¾åˆ°ç™¾ä¸‡çº§åˆ«æ—¶ï¼Œå¯ä»¥å…è®¸ä¸ºnullï¼ˆä¸»è¦æ˜¯å‡å°‘å˜æ›´è€—æ—¶ï¼‰</p></li><li><p>ã€å»ºè®®ã€‘å»ºè®®å¯¹è¡¨é‡Œçš„ <code>blob</code>ã€<code>text</code> ç­‰å¤§å­—æ®µï¼Œå‚ç›´æ‹†åˆ†åˆ°å…¶å®ƒè¡¨é‡Œï¼Œä»…åœ¨éœ€è¦è¯»è¿™äº›å¯¹è±¡çš„æ—¶å€™æ‰å» selectï¼Œæ¯”å¦‚è®¢å•orderè¡¨ï¼Œæœ‰commentå­—æ®µï¼Œå¯ä»¥åˆ›å»ºorder_commentæ˜ å°„è¡¨,æ‰€æœ‰çš„commentå•ç‹¬æ”¾åœ¨commentè¡¨é‡Œ.</p></li><li><p>ã€å¼ºåˆ¶ã€‘ä¸­é—´è¡¨ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°å¿…é¡»ä»¥ <code>tmp_</code> å¼€å¤´ã€‚å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°å¿…é¡»ä»¥ _<code>bak</code>ç»“å°¾ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚</p></li></ol><h3 id="2-4-å­—æ®µ"><a href="#2-4-å­—æ®µ" class="headerlink" title="2.4 å­—æ®µ"></a>2.4 å­—æ®µ</h3><h4 id="2-4-1-å­—æ®µè®¾è®¡åŸåˆ™"><a href="#2-4-1-å­—æ®µè®¾è®¡åŸåˆ™" class="headerlink" title="2.4.1 å­—æ®µè®¾è®¡åŸåˆ™"></a>2.4.1 å­—æ®µè®¾è®¡åŸåˆ™</h4><ul><li>InnoDBè¡¨æ˜¯ç´¢å¼•èšé›†ç»„ç»‡è¡¨ï¼ˆIOTï¼‰ï¼Œ æ‰€æœ‰çš„è¡Œæ•°æ®ï¼ˆrow dataï¼‰éƒ½æ˜¯ä»¥ä¸»é”®ï¼ˆä¸¥æ ¼æ„ä¹‰è®²ï¼Œæ˜¯èšé›†ç´¢å¼•ï¼‰é€»è¾‘é¡ºåºå­˜å‚¨ï¼Œè€ŒäºŒçº§ç´¢å¼•ï¼ˆæˆ–ç§°è¾…åŠ©ç´¢å¼•ï¼Œsecondary indexï¼‰çš„valueåˆ™åŒæ—¶åŒ…å«ä¸»é”®ã€‚</li><li>InnoDBçš„æœ€å°I/Oå•ä½æ˜¯data pageï¼ˆé»˜è®¤ä¸€ä¸ªdata pageå¤§å°æ˜¯16KBï¼‰ï¼Œåœ¨buffer poolä¸­çš„æœ€å°å•ä½æ˜¯data pageï¼ˆè€Œä¸æ˜¯æ¯è¡Œæ•°æ®å“¦ï¼‰ã€‚å› æ­¤ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œä¸€ä¸ªdata pageé‡Œçš„çƒ­ç‚¹æ•°æ®è¶Šå¤šï¼Œå…¶åœ¨buffer poolçš„å‘½ä¸­ç‡å°±ä¼šè¶Šé«˜ã€‚</li><li>MySQLå¤åˆ¶ç¯å¢ƒä¸­ï¼Œå¦‚æœbinlog formatæ˜¯rowçš„ï¼Œåˆ™ä»åº“ä¸Šçš„æ•°æ®æ›´æ–°æ—¶æ˜¯ä»¥ä¸»é”®ä¸ºä¾æ®è¿›è¡Œapplyçš„ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®åˆ™å°†å¯èƒ½ä¼šæœ‰ç¾éš¾æ€§çš„åæœã€‚</li><li>æ­¤å¤–ï¼Œå»ºè®®æ¯å¼ è¡¨ä¸‰ä¸ªå¿…åŠ å­—æ®µï¼šidï¼ˆint/bigint unsignedç±»å‹ï¼Œè‡ªå¢é•¿åˆ—ï¼Œå¹¶ä¸”ä½œä¸ºä¸»é”®ï¼‰ï¼Œcreate_timeï¼ˆtimestampæˆ–int unsignedï¼‰ã€update_timeï¼ˆå’Œcreate_timeç›¸åŒï¼‰ç”¨äºè®°å½•è¡Œåˆ›å»ºæ—¶é—´ä»¥åŠæœ€åæ›´æ–°æ—¶é—´ï¼Œåœ¨ä¸šåŠ¡ä¸Šä»¥åŠæ—¥å¸¸ç»´æŠ¤ä¸Šä¼šæœ‰å¾ˆå¤šä¾¿åˆ©ï¼›</li></ul><h4 id="2-4-2-å­—æ®µè®¾è®¡ç›®æ ‡"><a href="#2-4-2-å­—æ®µè®¾è®¡ç›®æ ‡" class="headerlink" title="2.4.2 å­—æ®µè®¾è®¡ç›®æ ‡"></a>2.4.2 å­—æ®µè®¾è®¡ç›®æ ‡</h4><p>â€‹ ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹</p><h4 id="2-4-3-å­—æ®µè®¾è®¡è§„åˆ™"><a href="#2-4-3-å­—æ®µè®¾è®¡è§„åˆ™" class="headerlink" title="2.4.3 å­—æ®µè®¾è®¡è§„åˆ™"></a>2.4.3 å­—æ®µè®¾è®¡è§„åˆ™</h4><ol><li>ã€å¼ºåˆ¶ã€‘åªåŒ…å«å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œä¸”ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œé•¿åº¦ä¸è¶…è¿‡64ä¸ªå­—ç¬¦ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¿ç•™å­—ä½œä¸ºå­—æ®µåç§°ï¼›</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨ä¸è¡¨åç›¸åŒçš„å­—æ®µåï¼Œè¿™ä¼šåœ¨ç¼–å†™æŸ¥è¯¢æ—¶é€ æˆæ··æ·†ã€‚</li><li>ã€å»ºè®®ã€‘ä»æ€§èƒ½è§’åº¦ï¼Œä¸å»ºè®®ä½¿ç”¨å¤–é”®ã€‚</li><li>ã€å¼ºåˆ¶ã€‘å­—æ®µåç§°é•¿åº¦ä¸è¶…è¿‡64ä¸ªå­—ç¬¦ã€‚</li><li>ã€å»ºè®®ã€‘ ä½¿ç”¨å®Œæ•´å•è¯åŠ ä¸‹åˆ’çº¿å‘½åï¼Œé¿å…ä½¿ç”¨ç¼©å†™æˆ–åŸºäºé¦–å­—æ¯ç¼©å†™è¯çš„åç§°ã€‚</li></ol><h3 id="2-5-ç´¢å¼•è®¾è®¡"><a href="#2-5-ç´¢å¼•è®¾è®¡" class="headerlink" title="2.5 ç´¢å¼•è®¾è®¡"></a>2.5 ç´¢å¼•è®¾è®¡</h3><h4 id="2-5-1-ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#2-5-1-ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="2.5.1 ç´¢å¼•è®¾è®¡åŸåˆ™"></a>2.5.1 ç´¢å¼•è®¾è®¡åŸåˆ™</h4><ol><li>æ•°æ®åº“ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒä»¥é¢å¤–çš„å†™å…¥å’Œå­˜å‚¨ç©ºé—´ä¸ºä»£ä»·æ¥æé«˜æ•°æ®åº“è¡¨ä¸Šæ•°æ®æ£€ç´¢æ“ä½œçš„é€Ÿåº¦ã€‚é€šä¿—æ¥è¯´ï¼Œç´¢å¼•ç±»ä¼¼äºä¹¦çš„ç›®å½•ï¼Œæ ¹æ®å…¶ä¸­è®°å½•çš„é¡µç å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„å†…å®¹ã€‚</li><li>ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¦æ ¹æ®æŸ¥è¯¢ï¼Œæœ‰é’ˆå¯¹æ€§çš„åˆ›å»ºï¼Œè€ƒè™‘åœ¨WHEREå’ŒORDER BYå‘½ä»¤ä¸Šæ¶‰åŠçš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œå¯æ ¹æ®EXPLAINæ¥æŸ¥çœ‹æ˜¯ä½¿ç”¨äº†ç´¢å¼•è¿˜æ˜¯å…¨è¡¨æ‰«æã€‚</li><li>å€¼åˆ†å¸ƒå¾ˆç¨€å°‘çš„å­—æ®µä¸é€‚åˆå»ºç´¢å¼•ã€‚</li><li>é’ˆå¯¹ç´¢å¼•çš„å„ç§ç±»å‹(æ™®é€šç´¢å¼•,å”¯ä¸€ç´¢å¼•,ä¸»é”®ç´¢å¼•,å…¨æ–‡ç´¢å¼•,ç»„åˆç´¢å¼•),æœ‰é’ˆå¯¹æ€§çš„åˆ›å»ºã€‚</li></ol><h4 id="2-5-2-ç´¢å¼•è®¾è®¡ç›®æ ‡"><a href="#2-5-2-ç´¢å¼•è®¾è®¡ç›®æ ‡" class="headerlink" title="2.5.2 ç´¢å¼•è®¾è®¡ç›®æ ‡"></a>2.5.2 ç´¢å¼•è®¾è®¡ç›®æ ‡</h4><ol><li>é™ä½æŸ¥è¯¢æ—¶é—´ã€‚</li><li>å¢åŠ ç´¢å¼•å‘½ä¸­ç‡ã€‚</li></ol><h4 id="2-5-3-ç´¢å¼•è®¾è®¡è§„åˆ™"><a href="#2-5-3-ç´¢å¼•è®¾è®¡è§„åˆ™" class="headerlink" title="2.5.3 ç´¢å¼•è®¾è®¡è§„åˆ™"></a>2.5.3 ç´¢å¼•è®¾è®¡è§„åˆ™</h4><ol><li>ã€å¼ºåˆ¶ã€‘ç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™.</li><li>ã€å¼ºåˆ¶ã€‘<strong>ä»¥ä¸‹é’ˆå¯¹éåˆ†åº“åˆ†è¡¨åœºæ™¯</strong> ï¼ŒInnoDBè¡¨å¿…é¡»ä¸»é”®ä¸ºbigint auto_increment,ä¸”ä¸»é”®å€¼ç¦æ­¢è¢«æ›´æ–°.</li><li>ã€å»ºè®®ã€‘å”¯ä¸€é”®ä»¥â€œuk_â€å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥â€œidx_â€å¼€å¤´ï¼Œä¸»é”®ä»¥â€œpkâ€å¼€å¤´ï¼Œä¸€å¾‹ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€.</li><li>ã€å¼ºåˆ¶ã€‘ å¼•æ“å¼ºåˆ¶ä¸ºInnoDBï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸ºBTREEï¼›MEMORYè¡¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©HASHæˆ–è€…BTREEç±»å‹ç´¢å¼•</li><li>ã€å»ºè®®ã€‘æ­£ç¡®ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¦‚æœå­—æ®µå€¼è¶…è¿‡10ä¸ªå­—ç¬¦ï¼Œå¯ä»¥è€ƒè™‘å»ºç«‹å‰ç¼€ç´¢å¼•ï¼Œä¾‹å¦‚Keyï¼ˆå­—æ®µï¼ˆ6ï¼‰ï¼‰ï¼Œé’ˆå¯¹å­—æ®µçš„å‰6ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼• ï¼Œä¸ç”¨å»ºç«‹æ•´ä¸ªå­—æ®µçš„ç´¢å¼•ã€‚</li><li>ã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•°ä¸èƒ½è¶…è¿‡5ä¸ª.</li><li>ã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹è”åˆç´¢å¼•ï¼Œæ ¹æ®ä½¿ç”¨é¢‘ç‡ï¼Œ å¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚å¦‚åˆ—useridçš„åŒºåˆ†åº¦å¯ç”±select count(distinct userid)è®¡ç®—å‡ºæ¥.</li><li>ã€å»ºè®®ã€‘åœ¨å¤šè¡¨joinçš„SQLé‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼ŒåŒæ—¶å»ºè®®ç”¨å°çš„æ•°æ®è¡¨é©±åŠ¨å¤§çš„è¡¨ï¼Œè¿™æ ·joinæ‰§è¡Œæ•ˆç‡æœ€é«˜.</li><li>ã€å»ºè®®ã€‘æ ¹æ®ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨å†—ä½™ç´¢å¼•ã€‚å¯¹äºMySQLæ¥è¯´ï¼Œå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨key(a,b)ï¼Œåˆ™key(a)ä¸ºå†—ä½™ç´¢å¼•ï¼Œå»ºè®®åˆ é™¤.</li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redissonç¼“å­˜</title>
    <url>/post/390aefa8.html</url>
    <content><![CDATA[<blockquote><p>Redissonæ˜¯ redis å®˜æ–¹æ¨èçš„ä¸€æ¬¾åº”ç”¨åœ¨åˆ†å¸ƒç¯å¢ƒä¸­çš„ redis å®¢æˆ·ç«¯ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Redissonç®€ä»‹"><a href="#ä¸€ã€Redissonç®€ä»‹" class="headerlink" title="ä¸€ã€Redissonç®€ä»‹"></a>ä¸€ã€Redissonç®€ä»‹</h3><p>Redissonæ˜¯ redis å®˜æ–¹æ¨èçš„ä¸€æ¬¾åº”ç”¨åœ¨åˆ†å¸ƒç¯å¢ƒä¸­çš„ redis å®¢æˆ·ç«¯ï¼ŒRedisson åœ¨Javaå·¥å…·åŒ…ä¸­æ¥å£çš„åŸºç¡€ä¸Šï¼Œä¸ºä½¿ç”¨è€…æä¾›äº†ä¸€ç³»åˆ—å…·æœ‰åˆ†å¸ƒå¼ç‰¹æ€§çš„å¸¸ç”¨å·¥å…·ç±»æ¯”å¦‚ï¼šåˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼è¿œç¨‹æœåŠ¡ã€åˆ†å¸ƒå¼è°ƒåº¦ä»»åŠ¡æœåŠ¡ç­‰ï¼Œå…·æœ‰æ›´ä¸°å¯Œçš„æ•°æ®ç»“æ„ã€‚</p><h3 id="äºŒã€Springboot-æ•´åˆ-Redisson"><a href="#äºŒã€Springboot-æ•´åˆ-Redisson" class="headerlink" title="äºŒã€Springboot æ•´åˆ Redisson"></a>äºŒã€Springboot æ•´åˆ Redisson</h3><h4 id="1ã€å¼•å…¥åŒ…"><a href="#1ã€å¼•å…¥åŒ…" class="headerlink" title="1ã€å¼•å…¥åŒ…"></a>1ã€å¼•å…¥åŒ…</h4><p>Redisson æä¾›äº† Springboot ç‰ˆæœ¬çš„starter</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2ã€redisson-yml-é…ç½®"><a href="#2ã€redisson-yml-é…ç½®" class="headerlink" title="2ã€redisson.yml é…ç½®"></a>2ã€redisson.yml é…ç½®</h4><p>resources ç›®å½•ä¸‹åˆ›å»º redisson é…ç½®æ–‡ä»¶ redisson.ymlï¼Œä¹Ÿå¯ä»¥æ·»åŠ åœ¨application.ymlï¼Œçœ‹ä¸ªäººå–œå¥½ã€‚</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">&#123;</span></span><br><span class="line">  <span class="string">"singleServerConfig"</span><span class="string">:&#123;</span></span><br><span class="line">    <span class="string">"idleConnectionTimeout"</span><span class="string">:10000,</span></span><br><span class="line">    <span class="string">"pingTimeout"</span><span class="string">:1000,</span></span><br><span class="line">    <span class="string">"connectTimeout"</span><span class="string">:10000,</span></span><br><span class="line">    <span class="string">"timeout"</span><span class="string">:3000,</span></span><br><span class="line">    <span class="string">"retryAttempts"</span><span class="string">:3,</span></span><br><span class="line">    <span class="string">"retryInterval"</span><span class="string">:1500,</span></span><br><span class="line">    <span class="string">"password"</span><span class="string">:"123456",</span></span><br><span class="line">    <span class="string">"subscriptionsPerConnection"</span><span class="string">:5,</span></span><br><span class="line">    <span class="string">"clientName"</span><span class="string">:null,</span></span><br><span class="line">    <span class="attr">"address":</span> <span class="string">"redis://127.0.0.1:6379"</span><span class="string">,</span></span><br><span class="line">    <span class="string">"subscriptionConnectionMinimumIdleSize"</span><span class="string">:1,</span></span><br><span class="line">    <span class="string">"subscriptionConnectionPoolSize"</span><span class="string">:50,</span></span><br><span class="line">    <span class="string">"connectionMinimumIdleSize"</span><span class="string">:32,</span></span><br><span class="line">    <span class="string">"connectionPoolSize"</span><span class="string">:64,</span></span><br><span class="line">    <span class="string">"database"</span><span class="string">:14</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">"threads"</span><span class="string">:0,</span></span><br><span class="line">  <span class="string">"nettyThreads"</span><span class="string">:0,</span></span><br><span class="line">  <span class="string">"codec"</span><span class="string">:&#123;</span></span><br><span class="line">    <span class="string">"class"</span><span class="string">:"org.redisson.codec.JsonJacksonCodec"</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">"transportMode"</span><span class="string">:"NIO"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="3ã€application-ymlé…ç½®"><a href="#3ã€application-ymlé…ç½®" class="headerlink" title="3ã€application.ymlé…ç½®"></a>3ã€application.ymlé…ç½®</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">redisson:</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">"classpath:redisson.yml"</span></span><br></pre></td></tr></table></figure><h4 id="4ã€ä½¿ç”¨RedissonClient"><a href="#4ã€ä½¿ç”¨RedissonClient" class="headerlink" title="4ã€ä½¿ç”¨RedissonClient"></a>4ã€ä½¿ç”¨RedissonClient</h4><p>åˆ›å»ºå¹¶æ³¨å…¥ RedissonClient å®ä¾‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedissonConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedissonClient <span class="title">redisson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Redisson.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨@Autowiredæ³¨è§£å¼•ç”¨å³å¯è°ƒç”¨ api</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>                                 </span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€åˆ†å¸ƒå¼é”"><a href="#ä¸‰ã€åˆ†å¸ƒå¼é”" class="headerlink" title="ä¸‰ã€åˆ†å¸ƒå¼é”"></a>ä¸‰ã€åˆ†å¸ƒå¼é”</h3><p>Redissonæä¾›äº†å¤šç§ç±»å‹çš„é”ï¼Œæ¯”å¦‚ï¼šå¯é‡å…¥é”ã€å…¬å¹³é”ã€è”é”ã€çº¢é”ã€è¯»å†™é”ç­‰ï¼ŒåŒæ—¶Redissonè¿˜æä¾›äº†ä¸€ç§ç›‘æ§é”å« â€œçœ‹é—¨ç‹—â€ çš„æœºåˆ¶ï¼Œä¸ºäº†è§£å†³å› Redisson å®•æœºå¯¼è‡´æ­»é” å’Œ ç”±äºä¸šåŠ¡æ‰§è¡Œæ—¶é•¿è¶…å‡ºé”æœ‰æ•ˆæœŸçš„bugï¼Œå®ƒé€šè¿‡ä¸æ–­å»¶é•¿é”çš„æœ‰æ•ˆæœŸå¤„ç†æ­¤ç±»é—®é¢˜ã€‚</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>Redisson å®ç°åˆ†å¸ƒå¼é”çš„åŸç†æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸»è¦ç”¨åˆ°çš„å‘½ä»¤è¿˜æ˜¯setNx å’Œ expireï¼Œåªä¸è¿‡Redisson å®¢æˆ·ç«¯æ˜¯å‘ redis å‘é€ä¸€ä¸ªluaè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥ç†è§£æˆæ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå®ƒæ˜¯ä¸€äº›é€»è¾‘çš„åˆé›†ï¼ŒåŒåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯ä»¥ä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŸå­æ€§ã€‚</p><p>åŠ é”æˆåŠŸåä¼šå°† key å’Œé”å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€é”æ¬¡æ•°ç­‰æ•°æ®ï¼Œæ”¾å…¥åˆ°å…¨å±€å˜é‡lockContentMapä¸­ã€‚</p><p>çœ‹ä¸‹è¾¹åŠ é”æ ¸å¿ƒç±»ï¼ŒRedisDistributionLockPlus ç±»å®ä¾‹åŒ–æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªScheduleExecutorä»»åŠ¡æ± ï¼Œèµ·ä¸€ä¸ªå«Lock-Renew-Task çš„å®šæ—¶ä»»åŠ¡ï¼Œè€Œè¿™ä¸ªä»»åŠ¡æ‰§è¡Œçš„ ScheduleTask å·¥ä½œå°±æ˜¯ä»lockContentMapä¸­æŸ¥æ‰¾å¿«è¦è¿‡æœŸçš„keyï¼Œç»™keyå¢åŠ expireè¿‡æœŸæ—¶é—´ï¼Œä»¥æ­¤è¾¾åˆ°ç»™keyç»­æœŸçš„æ•ˆæœï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„çœ‹é—¨ç‹—ã€‚</p><p>é»˜è®¤åŠ é”çš„æ—¶é—´æ˜¯30ç§’ï¼Œè¿‡10ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œä¸€æ—¦åŠ é”çš„ä¸šåŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡ç»­æœŸï¼ŒæŠŠé”çš„è¿‡æœŸæ—¶é—´å†æ¬¡é‡ç½®æˆ30ç§’ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisDistributionLockPlus</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ é”è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼Œ å³ï¼šåŠ é”æ—¶é—´å†…æ‰§è¡Œå®Œæ“ä½œï¼Œå¦‚æœæœªå®Œæˆä¼šæœ‰å¹¶å‘ç°è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> DEFAULT_LOCK_TIMEOUT = <span class="number">30</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> TIME_SECONDS_FIVE = <span class="number">5</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯ä¸ªkeyçš„è¿‡æœŸæ—¶é—´ &#123;<span class="doctag">@link</span> LockContent&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, LockContent&gt; lockContentMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">512</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redisæ‰§è¡ŒæˆåŠŸçš„è¿”å›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Long EXEC_SUCCESS = <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–é”luaè„šæœ¬ï¼Œ k1ï¼šè·é”key, k2ï¼šç»­çº¦è€—æ—¶key, arg1:requestIdï¼Œarg2ï¼šè¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOCK_SCRIPT = <span class="string">"if redis.call('exists', KEYS[2]) == 1 then ARGV[2] = math.floor(redis.call('get', KEYS[2]) + 10) end "</span> +</span><br><span class="line">        <span class="string">"if redis.call('exists', KEYS[1]) == 0 then "</span> +</span><br><span class="line">           <span class="string">"local t = redis.call('set', KEYS[1], ARGV[1], 'EX', ARGV[2]) "</span> +</span><br><span class="line">           <span class="string">"for k, v in pairs(t) do "</span> +</span><br><span class="line">             <span class="string">"if v == 'OK' then return tonumber(ARGV[2]) end "</span> +</span><br><span class="line">           <span class="string">"end "</span> +</span><br><span class="line">        <span class="string">"return 0 end"</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡Šæ”¾é”luaè„šæœ¬, k1ï¼šè·é”key, k2ï¼šç»­çº¦è€—æ—¶key, arg1:requestIdï¼Œarg2ï¼šä¸šåŠ¡è€—æ—¶ arg3: ä¸šåŠ¡å¼€å§‹è®¾ç½®çš„timeout</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UNLOCK_SCRIPT = <span class="string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +</span><br><span class="line">        <span class="string">"local ctime = tonumber(ARGV[2]) "</span> +</span><br><span class="line">        <span class="string">"local biz_timeout = tonumber(ARGV[3]) "</span> +</span><br><span class="line">        <span class="string">"if ctime &gt; 0 then  "</span> +</span><br><span class="line">           <span class="string">"if redis.call('exists', KEYS[2]) == 1 then "</span> +</span><br><span class="line">               <span class="string">"local avg_time = redis.call('get', KEYS[2]) "</span> +</span><br><span class="line">               <span class="string">"avg_time = (tonumber(avg_time) * 8 + ctime * 2)/10 "</span> +</span><br><span class="line">               <span class="string">"if avg_time &gt;= biz_timeout - 5 then redis.call('set', KEYS[2], avg_time, 'EX', 24*60*60) "</span> +</span><br><span class="line">               <span class="string">"else redis.call('del', KEYS[2]) end "</span> +</span><br><span class="line">           <span class="string">"elseif ctime &gt; biz_timeout -5 then redis.call('set', KEYS[2], ARGV[2], 'EX', 24*60*60) end "</span> +</span><br><span class="line">        <span class="string">"end "</span> +</span><br><span class="line">        <span class="string">"return redis.call('del', KEYS[1]) "</span> +</span><br><span class="line">        <span class="string">"else return 0 end"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»­çº¦luaè„šæœ¬</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RENEW_SCRIPT = <span class="string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('expire', KEYS[1], ARGV[2]) else return 0 end"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RedisDistributionLockPlus</span><span class="params">(StringRedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    ScheduleTask task = <span class="keyword">new</span> ScheduleTask(<span class="keyword">this</span>, lockContentMap);</span><br><span class="line">    <span class="comment">// å¯åŠ¨å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    ScheduleExecutor.schedule(task, <span class="number">1</span>, <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleExecutor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">schedule</span><span class="params">(ScheduleTask task, <span class="keyword">long</span> initialDelay, <span class="keyword">long</span> period, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> delay = unit.toMillis(initialDelay);</span><br><span class="line">        <span class="keyword">long</span> period_ = unit.toMillis(period);</span><br><span class="line">        <span class="comment">// å®šæ—¶æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">new</span> Timer(<span class="string">"Lock-Renew-Task"</span>).schedule(task, delay, period_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisDistributionLockPlus redisDistributionLock;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, LockContent&gt; lockContentMap;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScheduleTask</span><span class="params">(RedisDistributionLockPlus redisDistributionLock, Map&lt;String, LockContent&gt; lockContentMap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisDistributionLock = redisDistributionLock;</span><br><span class="line">        <span class="keyword">this</span>.lockContentMap = lockContentMap;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lockContentMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Map.Entry&lt;String, LockContent&gt;&gt; entries = lockContentMap.entrySet();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, LockContent&gt; entry : entries) &#123;</span><br><span class="line">            String lockKey = entry.getKey();</span><br><span class="line">            LockContent lockContent = entry.getValue();</span><br><span class="line">            <span class="keyword">long</span> expireTime = lockContent.getExpireTime();</span><br><span class="line">            <span class="comment">// å‡å°‘çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°é‡</span></span><br><span class="line">            <span class="keyword">if</span> ((expireTime - System.currentTimeMillis())/ <span class="number">1000</span> &lt; TIME_SECONDS_FIVE) &#123;</span><br><span class="line">                <span class="comment">//çº¿ç¨‹æ± å¼‚æ­¥ç»­çº¦</span></span><br><span class="line">                ThreadPool.submit(() -&gt; &#123;</span><br><span class="line">                    <span class="keyword">boolean</span> renew = redisDistributionLock.renew(lockKey, lockContent);</span><br><span class="line">                    <span class="keyword">if</span> (renew) &#123;</span><br><span class="line">                        <span class="keyword">long</span> expireTimeNew = lockContent.getStartTime() + (expireTime - lockContent.getStartTime()) * <span class="number">2</span> - TIME_SECONDS_FIVE * <span class="number">1000</span>;</span><br><span class="line">                        lockContent.setExpireTime(expireTimeNew);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// ç»­çº¦å¤±è´¥ï¼Œè¯´æ˜å·²ç»æ‰§è¡Œå®Œ OR redis å‡ºç°é—®é¢˜</span></span><br><span class="line">                        lockContentMap.remove(lockKey);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ é”</span></span><br><span class="line"><span class="comment"> * å–åˆ°é”åŠ é”ï¼Œå–ä¸åˆ°é”ä¸€ç›´ç­‰å¾…çŸ¥é“è·å¾—é”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requestId å…¨å±€å”¯ä¸€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> expire   é”è¿‡æœŸæ—¶é—´, å•ä½ç§’</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String lockKey, String requestId, <span class="keyword">long</span> expire)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">"å¼€å§‹æ‰§è¡ŒåŠ é”, lockKey =&#123;&#125;, requestId=&#123;&#125;"</span>, lockKey, requestId);</span><br><span class="line">    <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦å·²ç»æœ‰çº¿ç¨‹æŒæœ‰é”ï¼Œå‡å°‘redisçš„å‹åŠ›</span></span><br><span class="line">        LockContent lockContentOld = lockContentMap.get(lockKey);</span><br><span class="line">        <span class="keyword">boolean</span> unLocked = <span class="keyword">null</span> == lockContentOld;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰è¢«é”ï¼Œå°±è·å–é”</span></span><br><span class="line">        <span class="keyword">if</span> (unLocked) &#123;</span><br><span class="line">            <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">            <span class="comment">// è®¡ç®—è¶…æ—¶æ—¶é—´</span></span><br><span class="line">            <span class="keyword">long</span> bizExpire = expire == <span class="number">0L</span> ? DEFAULT_LOCK_TIMEOUT : expire;</span><br><span class="line">            String lockKeyRenew = lockKey + <span class="string">"_renew"</span>;</span><br><span class="line"> </span><br><span class="line">            RedisScript&lt;Long&gt; script = RedisScript.of(LOCK_SCRIPT, Long<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            keys.add(lockKey);</span><br><span class="line">            keys.add(lockKeyRenew);</span><br><span class="line">            Long lockExpire = redisTemplate.execute(script, keys, requestId, Long.toString(bizExpire));</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != lockExpire &amp;&amp; lockExpire &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†é”æ”¾å…¥map</span></span><br><span class="line">                LockContent lockContent = <span class="keyword">new</span> LockContent();</span><br><span class="line">                lockContent.setStartTime(startTime);</span><br><span class="line">                lockContent.setLockExpire(lockExpire);</span><br><span class="line">                lockContent.setExpireTime(startTime + lockExpire * <span class="number">1000</span>);</span><br><span class="line">                lockContent.setRequestId(requestId);</span><br><span class="line">                lockContent.setThread(Thread.currentThread());</span><br><span class="line">                lockContent.setBizExpire(bizExpire);</span><br><span class="line">                lockContent.setLockCount(<span class="number">1</span>);</span><br><span class="line">                lockContentMap.put(lockKey, lockContent);</span><br><span class="line">                log.info(<span class="string">"åŠ é”æˆåŠŸ, lockKey =&#123;&#125;, requestId=&#123;&#125;"</span>, lockKey, requestId);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡å¤è·å–é”ï¼Œåœ¨çº¿ç¨‹æ± ä¸­ç”±äºçº¿ç¨‹å¤ç”¨ï¼Œçº¿ç¨‹ç›¸ç­‰å¹¶ä¸èƒ½ç¡®å®šæ˜¯è¯¥çº¿ç¨‹çš„é”</span></span><br><span class="line">        <span class="keyword">if</span> (Thread.currentThread() == lockContentOld.getThread()</span><br><span class="line">                  &amp;&amp; requestId.equals(lockContentOld.getRequestId()))&#123;</span><br><span class="line">            <span class="comment">// è®¡æ•° +1</span></span><br><span class="line">            lockContentOld.setLockCount(lockContentOld.getLockCount()+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å¦‚æœè¢«é”æˆ–è·å–é”å¤±è´¥ï¼Œåˆ™ç­‰å¾…100æ¯«ç§’</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œç”¨lombok æœ‰é—®é¢˜</span></span><br><span class="line">            log.error(<span class="string">"è·å–redis é”å¤±è´¥, lockKey =&#123;&#125;, requestId=&#123;&#125;"</span>, lockKey, requestId, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£é”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockValue</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unlock</span><span class="params">(String lockKey, String lockValue)</span> </span>&#123;</span><br><span class="line">    String lockKeyRenew = lockKey + <span class="string">"_renew"</span>;</span><br><span class="line">    LockContent lockContent = lockContentMap.get(lockKey);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">long</span> consumeTime;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == lockContent) &#123;</span><br><span class="line">        consumeTime = <span class="number">0L</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lockValue.equals(lockContent.getRequestId())) &#123;</span><br><span class="line">        <span class="keyword">int</span> lockCount = lockContent.getLockCount();</span><br><span class="line">        <span class="comment">// æ¯æ¬¡é‡Šæ”¾é”ï¼Œ è®¡æ•° -1ï¼Œå‡åˆ°0æ—¶åˆ é™¤redisä¸Šçš„key</span></span><br><span class="line">        <span class="keyword">if</span> (--lockCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            lockContent.setLockCount(lockCount);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        consumeTime = (System.currentTimeMillis() - lockContent.getStartTime()) / <span class="number">1000</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log.info(<span class="string">"é‡Šæ”¾é”å¤±è´¥ï¼Œä¸æ˜¯è‡ªå·±çš„é”ã€‚"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// åˆ é™¤å·²å®Œæˆkeyï¼Œå…ˆåˆ é™¤æœ¬åœ°ç¼“å­˜ï¼Œå‡å°‘rediså‹åŠ›, åˆ†å¸ƒå¼é”ï¼Œåªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œä¸åŠ é”</span></span><br><span class="line">    lockContentMap.remove(lockKey);</span><br><span class="line"> </span><br><span class="line">    RedisScript&lt;Long&gt; script = RedisScript.of(UNLOCK_SCRIPT, Long<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    keys.add(lockKey);</span><br><span class="line">    keys.add(lockKeyRenew);</span><br><span class="line"> </span><br><span class="line">    Long result = redisTemplate.execute(script, keys, lockValue, Long.toString(consumeTime),</span><br><span class="line">            Long.toString(lockContent.getBizExpire()));</span><br><span class="line">    <span class="keyword">return</span> EXEC_SUCCESS.equals(result);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»­çº¦</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lockContent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true:ç»­çº¦æˆåŠŸï¼Œfalse:ç»­çº¦å¤±è´¥ï¼ˆ1ã€ç»­çº¦æœŸé—´æ‰§è¡Œå®Œæˆï¼Œé”è¢«é‡Šæ”¾ 2ã€ä¸æ˜¯è‡ªå·±çš„é”ï¼Œ3ã€ç»­çº¦æœŸé—´é”è¿‡æœŸäº†ï¼ˆæœªè§£å†³ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">renew</span><span class="params">(String lockKey, LockContent lockContent)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// æ£€æµ‹æ‰§è¡Œä¸šåŠ¡çº¿ç¨‹çš„çŠ¶æ€</span></span><br><span class="line">    Thread.State state = lockContent.getThread().getState();</span><br><span class="line">    <span class="keyword">if</span> (Thread.State.TERMINATED == state) &#123;</span><br><span class="line">        log.info(<span class="string">"æ‰§è¡Œä¸šåŠ¡çš„çº¿ç¨‹å·²ç»ˆæ­¢,ä¸å†ç»­çº¦ lockKey =&#123;&#125;, lockContent=&#123;&#125;"</span>, lockKey, lockContent);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    String requestId = lockContent.getRequestId();</span><br><span class="line">    <span class="keyword">long</span> timeOut = (lockContent.getExpireTime() - lockContent.getStartTime()) / <span class="number">1000</span>;</span><br><span class="line"> </span><br><span class="line">    RedisScript&lt;Long&gt; script = RedisScript.of(RENEW_SCRIPT, Long<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    keys.add(lockKey);</span><br><span class="line"> </span><br><span class="line">    Long result = redisTemplate.execute(script, keys, requestId, Long.toString(timeOut));</span><br><span class="line">    log.info(<span class="string">"ç»­çº¦ç»“æœï¼ŒTrueæˆåŠŸï¼ŒFalseå¤±è´¥ lockKey =&#123;&#125;, result=&#123;&#125;"</span>, lockKey, EXEC_SUCCESS.equals(result));</span><br><span class="line">    <span class="keyword">return</span> EXEC_SUCCESS.equals(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>}</p><h4 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h4><p>å¯é‡å…¥ä¹Ÿå°±æ˜¯è¯´æŸä¸ªçº¿ç¨‹å·²ç»è·å¾—è¿‡æŸä¸ªé”ï¼Œè¿˜å¯ä»¥å†æ¬¡è·å–é”è€Œä¸ä¼šå‡ºç°æ­»é”ã€‚</p><p>Redissoné”çš„ä½¿ç”¨ä¸ java.util.concurrent.locks.Lock ä½¿ç”¨æ–¹æ³•æ˜¯ä¸€è‡´çš„ã€‚ä¸‹é¢æ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RLock reentrantLock = redissonClient.getLock(<span class="string">"order:A0001"</span>);</span><br><span class="line">reentrantLock.lock();</span><br><span class="line"><span class="comment">//TODO something</span></span><br><span class="line">reentrantLock.unlock();</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç»™é”åŠ è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ— éœ€è°ƒç”¨unlockæ–¹æ³•æ‰‹åŠ¨è§£é”</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ é”ä»¥å10ç§’é’Ÿè‡ªåŠ¨è§£é”</span></span><br><span class="line">reentrantLock.lock(<span class="number">10</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure><p>Redisson è¿˜æä¾›ä¸€ä¸ªleaseTime å‚æ•°æ¥æŒ‡å®šå°è¯•åŠ é”çš„æ—¶é—´ï¼Œå¦‚ä¸‹æœ€å¤šç­‰å¾…100ç§’ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒåŠ é”ã€‚</p><p>// å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…100ç§’ï¼Œä¸Šé”ä»¥å10ç§’è‡ªåŠ¨è§£é”</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> res = reentrantLock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="keyword">if</span> (res) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     ...</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h4><p>å…¬å¹³é”ï¼Œå®ƒä¿è¯äº†å½“å¤šä¸ªRedissonå®¢æˆ·ç«¯çº¿ç¨‹åŒæ—¶è¯·æ±‚åŠ é”æ—¶ï¼Œä¼˜å…ˆåˆ†é…ç»™å…ˆå‘å‡ºè¯·æ±‚çš„çº¿ç¨‹ã€‚æ‰€æœ‰è¯·æ±‚çº¿ç¨‹ä¼šåœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œå½“æŸä¸ªçº¿ç¨‹å‡ºç°å®•æœºæ—¶ï¼ŒRedissonä¼šç­‰å¾…5ç§’åç»§ç»­ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå‰é¢æœ‰5ä¸ªçº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆåé¢çš„çº¿ç¨‹ä¼šç­‰å¾…è‡³å°‘25ç§’ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RLock fairLock= redissonClient.getFairLock(<span class="string">"order:A0001"</span>);</span><br><span class="line"><span class="comment">// å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…100ç§’ï¼Œä¸Šé”ä»¥å10ç§’è‡ªåŠ¨è§£é”</span></span><br><span class="line"><span class="keyword">if</span> (fairLock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     ...</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Redisson è¿˜ä¸ºåˆ†å¸ƒå¼å¯é‡å…¥å…¬å¹³é”æä¾›äº†å¼‚æ­¥æ‰§è¡Œçš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RLock fairLock= redissonClient.getFairLock(<span class="string">"order:A0001"</span>);</span><br><span class="line"><span class="comment">// å¼€å¯å¼‚æ­¥æ¨¡å¼</span></span><br><span class="line">fairLock.lockAsync();</span><br><span class="line"><span class="comment">// å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…100ç§’ï¼Œä¸Šé”ä»¥å10ç§’è‡ªåŠ¨è§£é”</span></span><br><span class="line"><span class="keyword">if</span> (fairLock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     ...</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è”é”"><a href="#è”é”" class="headerlink" title="è”é”"></a>è”é”</h4><p>è”é”ï¼ŒRedisson å°†å¤šä¸ªRLockå¯¹è±¡å…³è”ä¸ºä¸€ä¸ªè”é”ï¼Œæ¯ä¸ªRLockå¯¹è±¡å®ä¾‹å¯ä»¥æ¥è‡ªäºä¸åŒçš„Redissonå®ä¾‹ã€‚ä¹Ÿå°±è¯´å¤šä¸ª key åŒæ—¶åŠ é”æˆåŠŸæ‰ç®—è·å¾—æ‰€ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RLock lock1 = redissonClient.getLock(<span class="string">"order:A0001"</span>);</span><br><span class="line">RLock lock2 = redissonClient.getLock(<span class="string">"order:A0002"</span>);</span><br><span class="line">RLock lock3 = redissonClient.getLock(<span class="string">"order:A0003"</span>);</span><br><span class="line"></span><br><span class="line">RLock multiLock = redissonClient.getMultiLock(lock1, lock2, lock3);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (multiLock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="comment">//TODO something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    multiLock.unlock();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    multiLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="çº¢é”"><a href="#çº¢é”" class="headerlink" title="çº¢é”"></a>çº¢é”</h4><p>çº¢é”å’Œè”é”å¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å¤šä¸ªRLockå¯¹è±¡å…³è”ä¸ºä¸€ä¸ªè”é”ï¼Œä¸åŒçš„æ˜¯çº¢é”ä¸­åªè¦éƒ¨åˆ† key åŠ é”æˆåŠŸï¼Œå³è§†ä¸ºè·å¾—é”æˆåŠŸã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RLock lock1 = redissonClient.getLock(<span class="string">"order:A0001"</span>);</span><br><span class="line">RLock lock2 = redissonClient.getLock(<span class="string">"order:A0002"</span>);</span><br><span class="line">RLock lock3 = redissonClient.getLock(<span class="string">"order:A0003"</span>);</span><br><span class="line"></span><br><span class="line">RLock multiLock = redissonClient.getMultiLock(lock1, lock2, lock3);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (multiLock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="comment">//TODO something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    multiLock.unlock();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    multiLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h4><p>è¯»å†™é”ï¼Œåˆ†ä¸ºè¯»é”ä¸å†™é”ï¼Œå…è®¸åŒæ—¶æœ‰å¤šä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”å¤„äºåŠ é”çŠ¶æ€ã€‚</p><p>RReadWriteLock readWriteLock = redissonClient.getReadWriteLock(â€œorder:A0001â€);</p><pre><code> try {

    if (readWriteLock.writeLock().tryLock(100, 10, TimeUnit.SECONDS)) {
        //TODO something
    }

    if (readWriteLock.readLock().tryLock(100, 10, TimeUnit.SECONDS)) {
        //TODO something
    }

    if (readWriteLock.readLock().tryLock(100, 10, TimeUnit.SECONDS)) {
        //TODO something
    }

} catch (Exception e) {
    readWriteLock.writeLock().unlock();
    readWriteLock.readLock().unlock();
} finally {
    readWriteLock.writeLock().unlock();
    readWriteLock.readLock().unlock();
}</code></pre><h3 id="å››ã€åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡ï¼ˆLive-Objectï¼‰æœåŠ¡"><a href="#å››ã€åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡ï¼ˆLive-Objectï¼‰æœåŠ¡" class="headerlink" title="å››ã€åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡ï¼ˆLive Objectï¼‰æœåŠ¡"></a>å››ã€åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡ï¼ˆLive Objectï¼‰æœåŠ¡</h3><p>æˆ‘ä»¬å¯ä»¥å°†Live Objectç†è§£æˆå¤šRedissonèŠ‚ç‚¹åº”ç”¨é—´å…±äº«çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä»…å¯ä»¥è¢«ä¸€ä¸ªJVMé‡Œçš„å„ä¸ªçº¿ç¨‹ç›¸å¼•ç”¨ï¼Œè¿˜å¯ä»¥è¢«å¤šä¸ªä½äºä¸åŒJVMé‡Œçš„çº¿ç¨‹åŒæ—¶å¼•ç”¨ã€‚</p><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>åˆ†å¸ƒå¼å¯¹è±¡è¿ç”¨ä»£ç†ç±»ï¼ˆProxyï¼‰ï¼Œå°†ä¸€ä¸ªæŒ‡å®šçš„æ™®é€šJavaç±»é‡Œçš„æ‰€æœ‰å­—æ®µï¼Œå…¨éƒ¨æ˜ å°„åˆ°ä¸€ä¸ªRedis Hashçš„æ•°æ®ç»“æ„ã€‚è€Œæ¯ä¸ªå­—æ®µçš„ getå’Œ set æ–¹æ³•æœ€ç»ˆè¢«è½¬è¯‘ä¸ºé’ˆå¯¹åŒä¸€ä¸ªRedis Hashçš„ hget å’Œ hsetå‘½ä»¤ï¼Œä»è€Œä½¿æ‰€æœ‰è¿æ¥åˆ°åŒä¸€ä¸ªRedisèŠ‚ç‚¹çš„æ‰€æœ‰å¯ä»¥å®¢æˆ·ç«¯åŒæ—¶å¯¹ä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡è¿›è¡Œæ“ä½œã€‚</p><h4 id="è®¾è®¡åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ"><a href="#è®¾è®¡åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ" class="headerlink" title="è®¾è®¡åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ"></a>è®¾è®¡åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</h4><p>ç›¸æ¯”äºå¹³æ—¶æ“ä½œredisæ•°æ®ç»“æ„ï¼Œåˆ†å¸ƒå¼å®æ—¶å¯¹è±¡é¿å…äº†é’ˆå¯¹ä»»ä½•ä¸€ä¸ªå­—æ®µæ“ä½œéƒ½éœ€è¦å°†æ•´ä¸ªå¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç¹çï¼Œè¿›è€Œé™ä½äº†ç¨‹åºå¼€å‘çš„å¤æ‚æ€§å’Œå…¶æ•°æ®æ¨¡å‹çš„å¤æ‚æ€§ï¼Œä»ä»»ä½•ä¸€ä¸ªå®¢æˆ·ç«¯ä¿®æ”¹ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œå¤„åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šçš„å®¢æˆ·ç«¯å³åˆ»ä¾¿èƒ½æŸ¥çœ‹åˆ°ï¼Œå®ç°ä»£ç ä¸å•æœºç¨‹åºä»£ç æ— å¼‚ã€‚</p><p>ç”±äºRedisæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„ç¨‹åºï¼Œé’ˆå¯¹å®æ—¶å¯¹è±¡çš„æ‰€æœ‰çš„å­—æ®µæ“ä½œä¹Ÿå…¨éƒ¨æ˜¯åŸå­æ€§æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å–ä¸€ä¸ªå­—æ®µçš„è¿‡ç¨‹ä¸ä¼šæ‹…å¿ƒè¢«å…¶ä»–çº¿ç¨‹æ‰€ä¿®æ”¹ã€‚</p><p>å¦‚æœä¸€ä¸ªJavaå¯¹è±¡è¦ä½œä¸ºåˆ†å¸ƒå¼å¯¹è±¡ï¼Œè¦ä½¿ç”¨åˆ°@REntityã€@RIdã€@RIndexæ³¨è§£ã€‚</p><p>@REntityå’Œ@RIdä¸¤ä¸ªæ³¨è§£æ˜¯åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡çš„å¿…è¦æ¡ä»¶ã€‚</p><p>æ³¨æ„ï¼š æ ‡æ³¨@RIdçš„å­—æ®µç±»å‹ä¸èƒ½æ˜¯æ•°ç»„ç±»ï¼ˆArrayï¼‰ï¼Œæ¯”å¦‚int[]ï¼Œlong[]ï¼Œdouble[]ï¼Œbyte[]ã€‚</p><p>@RIndex ç”¨æ¥æŒ‡å®šå¯ç”¨äºæœç´¢çš„å­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@REntity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderInfo</span> </span>&#123;</span><br><span class="line"><span class="meta">@RId</span></span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RIndex</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RIndex</span></span><br><span class="line"><span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>persist() æŒä¹…åŒ–å¯¹è±¡ç›¸å½“äºaddï¼Œå¦‚æœå¯¹è±¡å·²å­˜åœ¨ï¼Œæ·»åŠ ä¼šæŠ¥é”™ï¼Œéœ€åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²å­˜åœ¨ã€‚</p><p>attach()ã€merge() æ˜¯å¯¹è±¡çš„ä¸¤ç§æ›´æ–°æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reduceStock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   RLiveObjectService service = redissonClient.getLiveObjectService();</span><br><span class="line">    OrderInfo orderInfo = <span class="keyword">new</span> OrderInfo();</span><br><span class="line">    orderInfo.setId(<span class="number">1</span>);</span><br><span class="line">    orderInfo.setName(<span class="string">"å°å¯Œ"</span>);</span><br><span class="line">    orderInfo.setAge(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    OrderInfo orderInfo2 = <span class="keyword">new</span> OrderInfo();</span><br><span class="line">    orderInfo2.setId(<span class="number">2</span>);</span><br><span class="line">    orderInfo2.setName(<span class="string">"å°ç‘"</span>);</span><br><span class="line">    orderInfo2.setAge(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†orderInfoå¯¹è±¡å½“å‰çš„çŠ¶æ€æŒä¹…åŒ–åˆ°Redisé‡Œå¹¶ä¸ä¹‹ä¿æŒåŒæ­¥ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!service.isExists(orderInfo)) &#123;</span><br><span class="line">        orderInfo = service.persist(orderInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!service.isExists(orderInfo2)) &#123;</span><br><span class="line">        orderInfo2 = service.persist(orderInfo2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠ›å¼ƒorderInfoå¯¹è±¡å½“å‰çš„çŠ¶æ€ï¼Œå¹¶ä¸Redisé‡Œçš„æ•°æ®å»ºç«‹è¿æ¥å¹¶ä¿æŒåŒæ­¥ã€‚</span></span><br><span class="line">    <span class="comment">//orderInfo = service.attach(orderInfo);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†orderInfoå¯¹è±¡å½“å‰çš„çŠ¶æ€ä¸Redisé‡Œçš„æ•°æ®åˆå¹¶ä¹‹åä¸ä¹‹ä¿æŒåŒæ­¥ã€‚</span></span><br><span class="line">    <span class="comment">//orderInfo = service.merge(orderInfo);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ¡ä»¶å¯ä»¥æ˜¯å«ï¼ˆINï¼‰ï¼Œæˆ–ï¼ˆORï¼‰ï¼Œå’Œï¼ˆANDï¼‰æˆ–ç›¸ç­‰ï¼ˆEQï¼‰ä»¥åŠå®ƒä»¬çš„ä»»æ„ç»„åˆã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reduceStock</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">   RLiveObjectService service = redissonClient.getLiveObjectService();</span><br><span class="line">    <span class="comment">// é€šè¿‡IDè·å–åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡</span></span><br><span class="line">    OrderInfo myObject = service.get(OrderInfo<span class="class">.<span class="keyword">class</span>, 1)</span>;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(myObject)) &#123;</span><br><span class="line">        System.out.println(<span class="string">"å•æ¡:"</span> + JSON.toJSONString(myObject));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡ç´¢å¼•æŸ¥æ‰¾åˆ†å¸ƒå¼å®æ—¶å¯¹è±¡</span></span><br><span class="line">    Collection&lt;OrderInfo&gt; myObjects = service.find(OrderInfo.class, Conditions.in("age", 16));</span><br><span class="line">    Collection&lt;OrderInfo&gt; myObjects1 = service.find(OrderInfo.class, Conditions.and(Conditions.in("name", "å°å¯Œ", "å°ç‘"), Conditions.eq("age", 1)));</span><br><span class="line">        System.out.println(<span class="string">"å¤šæ¡:"</span> + JSON.toJSONString(myObjects));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redisson</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaæ¶ˆè´¹è€…ç»„ç§¯å‹</title>
    <url>/post/c02adc20.html</url>
    <content><![CDATA[<blockquote><p>æ­£ç¡®ç†è§£kafkaæ¶ˆæ¯ç§¯å‹ ~</p></blockquote><a id="more"></a><p>â€œæ¶ˆè´¹è€…â€ä¸â€œæ¶ˆè´¹è€…â€ç»„ï¼š</p><ul><li>æ¶ˆè´¹è€…ç»„æ˜¯ä¸€ç»„å…·æœ‰å…±åŒæ¶ˆè´¹ç‰¹å¾çš„æ¶ˆè´¹è€…çš„é›†åˆï¼Œå¯¹äºkafkaæ¥è¯´ï¼Œè¿™ä¸ªç‰¹å¾å°±æ˜¯è¿™äº›æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ªæˆ–å‡ ä¸ªä¸»é¢˜ã€‚</li><li>æ¶ˆè´¹è€…ç»„å­˜åœ¨çš„ä¸€ä¸ªé‡è¦åŸå› æ˜¯ï¼šå•ä¸ªæ¶ˆè´¹è€…æ— æ³•æ»¡è¶³æŸä¸ªä¸»é¢˜ä¸‹çš„æ•°æ®å¤„ç†çš„é€Ÿåº¦ï¼Œæ‰€ä»¥éœ€è¦å¤šä¸ªæ¶ˆè´¹è€…æ¥è´Ÿè½½</li></ul><p>æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…éƒ½å…·å¤‡ä¸€ä¸ªå…±äº«idï¼Œå³group idï¼ˆæ¶ˆè´¹è€…ç»„idï¼‰ã€‚åœ¨åˆ›å»ºæ¶ˆè´¹è€…çš„æ—¶å€™ï¼Œè®¾ç½®group idã€‚é»˜è®¤åˆ›å»ºæ¶ˆè´¹è€…çš„group idã€‚</p><h3 id="ä¸€ã€ä¸»é¢˜åˆ†åŒºä¸æ¶ˆè´¹è€…çš„æ•°é‡"><a href="#ä¸€ã€ä¸»é¢˜åˆ†åŒºä¸æ¶ˆè´¹è€…çš„æ•°é‡" class="headerlink" title="ä¸€ã€ä¸»é¢˜åˆ†åŒºä¸æ¶ˆè´¹è€…çš„æ•°é‡"></a>ä¸€ã€ä¸»é¢˜åˆ†åŒºä¸æ¶ˆè´¹è€…çš„æ•°é‡</h3><p>åœ¨å¼€å§‹ä¸ºå¤§å®¶ä»‹ç»æ¶ˆè´¹è€…ä¹‹å‰ï¼Œæœ‰å¿…è¦æ·±å…¥çš„äº†è§£ä¸€ä¸‹â€œä¸»é¢˜åˆ†åŒºæ•°é‡â€ä¸â€œæ¶ˆè´¹è€…æ•°é‡â€ä¹‹é—´çš„å…³ç³»ã€‚kafkaä¸»é¢˜åˆ†åŒºæ¶ˆè´¹çš„ä¸€ä¸ªåŸåˆ™æ˜¯ï¼š<strong>ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«æ¶ˆè´¹è€…ç»„é‡Œé¢çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</strong>ã€‚</p><h4 id="1-1-å½“åˆ†åŒºæ•°é‡å¤šäºæ¶ˆè´¹è€…çš„æ•°é‡"><a href="#1-1-å½“åˆ†åŒºæ•°é‡å¤šäºæ¶ˆè´¹è€…çš„æ•°é‡" class="headerlink" title="1.1.å½“åˆ†åŒºæ•°é‡å¤šäºæ¶ˆè´¹è€…çš„æ•°é‡"></a>1.1.å½“åˆ†åŒºæ•°é‡å¤šäºæ¶ˆè´¹è€…çš„æ•°é‡</h4><p>å½“æŸä¸ªä¸»é¢˜çš„åˆ†åŒºæ•°é‡ï¼Œå¤§äºè®¢é˜…å®ƒçš„æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…æ•°é‡ï¼Œå°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/0a0410547d61489e9eaab96a0b2a8f67.png" alt=""></p><ul><li>ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹å¤šä¸ªåˆ†åŒº</li><li>åˆ†åŒºå°½é‡å‡è¡¡çš„åˆ†ç»™æ¶ˆè´¹è€…ç»„å†…çš„å¤šä¸ªæ¶ˆè´¹è€…</li></ul><h4 id="1-2-å½“åˆ†åŒºæ•°é‡å°äºæ¶ˆè´¹è€…æ•°é‡"><a href="#1-2-å½“åˆ†åŒºæ•°é‡å°äºæ¶ˆè´¹è€…æ•°é‡" class="headerlink" title="1.2.å½“åˆ†åŒºæ•°é‡å°äºæ¶ˆè´¹è€…æ•°é‡"></a>1.2.å½“åˆ†åŒºæ•°é‡å°äºæ¶ˆè´¹è€…æ•°é‡</h4><p>å½“æŸä¸ªä¸»é¢˜çš„åˆ†åŒºæ•°é‡ï¼Œå°äºè®¢é˜…å®ƒçš„æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…æ•°é‡ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œå››ä¸ªåˆ†åŒºäº”ä¸ªæ¶ˆè´¹è€…ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¤„äºç©ºé—²çŠ¶æ€ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/b12988acab994583959eebd307f6d501.png" alt=""></p><p>æ‰€ä»¥kafkaæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä¹Ÿä¸æ˜¯æ¶ˆè´¹è€…è¶Šå¤šå¤„ç†é€Ÿåº¦è¶Šå¿«ã€‚<strong>å¦‚æœåˆ†åŒºæ•°æ²¡æœ‰åŒ¹é…æ¶ˆè´¹è€…æ•°é‡ï¼Œåˆ›å»ºå†å¤šçš„æ¶ˆè´¹è€…ä¹Ÿä¸ä¼šæé«˜æ•°æ®æ¶ˆè´¹é€Ÿç‡ã€‚</strong></p><h4 id="1-3-å½“åˆ†åŒºæ•°é‡ç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡"><a href="#1-3-å½“åˆ†åŒºæ•°é‡ç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡" class="headerlink" title="1.3.å½“åˆ†åŒºæ•°é‡ç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡"></a>1.3.å½“åˆ†åŒºæ•°é‡ç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡</h4><p>åŸºäºä¸Šé¢çš„å†…å®¹ï¼Œä»¥åŠ<strong>ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«æ¶ˆè´¹è€…ç»„é‡Œé¢çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</strong>çš„åŸåˆ™ï¼Œæœ€ä½³çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/89ac128920f04e6c915cc9c7f4d59046.png" alt=""></p><p>æ‰€ä»¥å½“æˆ‘ä»¬å‘ç°æŸä¸€ä¸ªä¸»é¢˜çš„æ¶ˆè´¹æ•°æ®ç§¯å‹çš„æ—¶å€™ï¼Œé¦–å…ˆæƒ³åˆ°çš„åº”è¯¥æ˜¯ä¼˜åŒ–æ¶ˆè´¹è€…æ•°æ®æ¶ˆè´¹çš„ç¨‹åºï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚å¦‚æœä»ç„¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œåˆ™<strong>åŒæ­¥çš„åŠ å¤§ä¸»é¢˜çš„åˆ†åŒºæ•°é‡ä»¥åŠæ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…çš„æ•°é‡ï¼Œè®©äºŒè€…ä¿æŒæ•°é‡ä¸€è‡´</strong>ã€‚</p><h4 id="1-4-å¤šä¸ªæ¶ˆè´¹è€…ç»„-å¤šä¸»é¢˜"><a href="#1-4-å¤šä¸ªæ¶ˆè´¹è€…ç»„-å¤šä¸»é¢˜" class="headerlink" title="1.4.å¤šä¸ªæ¶ˆè´¹è€…ç»„-å¤šä¸»é¢˜"></a>1.4.å¤šä¸ªæ¶ˆè´¹è€…ç»„-å¤šä¸»é¢˜</h4><p>ä¸‹é¢å†ç”¨ä¸€å¼ æ›´å¤æ‚ä¸€ç‚¹çš„å›¾å¸®åŠ©å¤§å®¶ç†è§£ï¼Œâ€œä¸»é¢˜åˆ†åŒºæ•°é‡â€ä¸â€œæ¶ˆè´¹è€…æ•°é‡â€ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/2ef7976792b84d6b9b167af5c2fe0ad1.png" alt=""></p><ul><li>ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«æ¶ˆè´¹è€…ç»„é‡Œé¢çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</li><li>ä¸€ä¸ªæ¶ˆè´¹è€…å¯èƒ½ä¼šæ¶ˆè´¹æŸä¸ªä¸»é¢˜å†…çš„å¤šä¸ªåˆ†åŒº</li><li>æœ€ä½³çŠ¶æ€æ—¶ä¸»é¢˜åˆ†åŒºæ•°ç­‰äºæ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…æ•°é‡</li><li>å¦‚æœæŸæ¶ˆè´¹è€…ç»„æ¶ˆè´¹è€…æ•°é‡å¤§äºå…¶è®¢é˜…çš„ä¸»é¢˜çš„åˆ†åŒºæ•°ï¼Œä¼šå‘ç”Ÿå¤šå‡ºæ¥çš„æ¶ˆè´¹è€…ç©ºè½¬çš„ç°è±¡ã€‚</li></ul><h3 id="äºŒã€æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹"><a href="#äºŒã€æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹" class="headerlink" title="äºŒã€æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹"></a>äºŒã€æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹</h3><p>åœ¨ä¸ºå¤§å®¶è®²è§£å¦‚ä½•æŸ¥çœ‹â€œæ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹â€ä¹‹å‰ï¼Œå…ˆçº æ­£éƒ¨åˆ†æœ‹å‹çš„ä¸€ä¸ªé”™è¯¯æ¦‚å¿µï¼š<strong>ç§¯å‹ä¸æ˜¯åœ¨kafkaä¸»é¢˜åˆ†åŒºå†…äº§ç”Ÿçš„ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦æŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„æ•°æ®ç§¯å‹ï¼Ÿ</strong>ã€‚è¿™ä¸ªé—®é¢˜æ˜¯æˆ‘åœ¨åˆšå¼€å§‹å­¦ä¹ kafkaçš„æ—¶å€™æ²¡æƒ³é€šçš„ä¸€ä¸ªé—®é¢˜ã€‚</p><ul><li>ä¸€ä¸ªä¸»é¢˜å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…ç»„è®¢é˜…ï¼Œæ¯”å¦‚æ¶ˆè´¹è€…ç»„Aã€æ¶ˆè´¹è€…ç»„B</li><li>æ¶ˆè´¹è€…ç»„Açš„æ¶ˆè´¹è¿›åº¦å’Œæ¶ˆè´¹è€…ç»„Bçš„æ¶ˆè´¹è¿›åº¦ä¸€å®šä¸ä¸€æ ·</li><li>å¦‚æœæ¶ˆè´¹è€…ç»„Bçš„æ¶ˆè´¹è¿›åº¦æ…¢ï¼Œå°±æ˜¯æ¶ˆè´¹è€…ç»„Bçš„æ¶ˆæ¯æ•°æ®å‘ç”Ÿç§¯å‹ã€‚ä¸æ¶ˆè´¹è€…ç»„Aæ— å…³ã€‚</li></ul><p>æ‰€ä»¥æŸ¥çœ‹æ•°æ®æ¶ˆè´¹è¿›åº¦ï¼Œæˆ–è€…æ¶ˆæ¯æ•°æ®æ˜¯å¦ç§¯å‹ï¼Œæ˜¯ä»¥â€œæ¶ˆè´¹è€…â€ç»„ä¸ºå•ä½è¿›è¡ŒæŸ¥çœ‹çš„ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡ŒæŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è¿›åº¦æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> bin/kafka-consumer-groups.sh --bootstrap-server zimug1:9092 --describe --group my-group</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¿™æ ·çš„å“åº”ç»“æœï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/83061ac8755e41648951ff2eadada8c1.png" alt=""></p><p>ç”±ä¸Šæ–‡ç»“æœæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p><ul><li>ä¸€ä¸ªä¸»é¢˜çš„ä¸€ä¸ªåˆ†åŒºä¿¡æ¯å ä¸€è¡Œ</li><li>è¯¥æ¶ˆè´¹è€…ç»„è®¢é˜…äº†ä¸‰ä¸ªä¸»é¢˜ï¼štopic1ï¼ˆä¸€ä¸ªåˆ†åŒº0ï¼‰ã€topic2ï¼ˆä¸¤ä¸ªåˆ†åŒº0ã€1ï¼‰ã€topic3ï¼ˆä¸‰ä¸ªåˆ†åŒº0ã€1ã€2ï¼‰</li><li>CURRENT-OFFSETæ˜¯å½“å‰æ•°æ®æ¶ˆè´¹è¿›åº¦çš„åç§»</li><li>LOG-END-OFFSETæ˜¯å½“å‰åˆ†åŒºå·²ç»æ¥æ”¶åˆ°çš„æ•°æ®ä¿¡æ¯åç§»</li><li>LAG = ï¼ˆLOG-END-OFFSET - CURRENT-OFFSETï¼‰ã€‚LAGçš„å€¼è¶Šå¤§è¯´æ˜æ•°æ®ç§¯å‹è¶Šä¸¥é‡ã€‚</li></ul><h3 id="ä¸‰ã€æ•°æ®ç§¯å‹å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#ä¸‰ã€æ•°æ®ç§¯å‹å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="ä¸‰ã€æ•°æ®ç§¯å‹å¦‚ä½•å¤„ç†ï¼Ÿ"></a>ä¸‰ã€æ•°æ®ç§¯å‹å¦‚ä½•å¤„ç†ï¼Ÿ</h3><h4 id="ä»€ä¹ˆæ˜¯æ•°æ®ç§¯å‹"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®ç§¯å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®ç§¯å‹"></a>ä»€ä¹ˆæ˜¯æ•°æ®ç§¯å‹</h4><p>ç­”ï¼šæˆ‘çœ‹è¿‡æœ‰çš„æ–‡ç« è¯´LAG&gt;0æ˜¯æ•°æ®ç§¯å‹ï¼Œå¯èƒ½ç¬”è€…å¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£ä¸åŒã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæŸåˆ†åŒºä¸€å¤©å¹³å‡1000ä¸‡æ•°æ®ï¼Œç§¯å‹é‡ç¨³å®šåœ¨1ä¸‡æ¡ï¼Œè¿™ç®—æ˜¯æ•°æ®ç§¯å‹ä¹ˆï¼Ÿæˆ‘è§‰å¾—å¯ä»¥ç®—ä¹Ÿå¯ä»¥ä¸ç®—ï¼Œè¿™å–å†³äºä½ çš„ç”¨æˆ·å¯¹äºæ•°æ®å»¶æ—¶çš„éœ€æ±‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿå¦‚æœä½ å¹³æ—¶LAGå°±æ˜¯1ä¸‡ï¼Œä»ç”¨æˆ·æ„ŸçŸ¥çš„è§’åº¦ä¹Ÿæ²¡æœ‰æå‡ºé™ä½æ•°æ®å»¶æ—¶çš„éœ€æ±‚ï¼Œé‚£ä¹ˆè¿™å°±ä¸æ˜¯æ•°æ®ç§¯å‹ã€‚å¦‚æœä½ å¹³æ—¶çš„LAGæ˜¯1ä¸‡ï¼Œå¼‚å¸¸çŠ¶æ€ä¸‹å˜æˆäº†å‡ åä¸‡ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯æ•°æ®ç§¯å‹äº†ã€‚</p><h4 id="å¦‚ä½•è§£å†³ç§¯å‹"><a href="#å¦‚ä½•è§£å†³ç§¯å‹" class="headerlink" title="å¦‚ä½•è§£å†³ç§¯å‹"></a>å¦‚ä½•è§£å†³ç§¯å‹</h4><p>å¦‚æœå‘ç”Ÿæ•°æ®ç§¯å‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹</p><ul><li>ä¼˜åŒ–æ•°æ®å¤„ç†ç¨‹åºï¼Œæé«˜æ•°æ®å¤„ç†çš„é€Ÿåº¦</li><li>å¢å¤§å‘ç”Ÿç§¯å‹çš„ä¸»é¢˜çš„åˆ†åŒºçš„æ•°é‡</li><li>åŒæ—¶å¢å¤§æ¶ˆè´¹è¯¥ä¸»é¢˜çš„æ¶ˆè´¹è€…çš„æ•°é‡ï¼Œè®©å…¶ç­‰äºè¯¥ä¸»é¢˜çš„åˆ†åŒºæ•°</li><li>å‰é¢ä¸‰ç‚¹éƒ½æ˜¯åŸºäºkafkaå»å¤„ç†ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥æŠ›å¼€kafkaï¼Œåœ¨ç”¨æˆ·è¯·æ±‚äº§ç”Ÿæ•°æ®çš„æ—¶å€™ç»™äºˆä¸€å®šçš„æµé‡æ§åˆ¶ï¼Œæ¯”å¦‚ï¼šå¾®æœåŠ¡å¯ä»¥ä½¿ç”¨Spring Cloud alibaba sentinal</li></ul><blockquote><p>ç¤ºä¾‹1ï¼šä¸»é¢˜åˆ†åŒºæ•°=40ï¼ŒèŠ‚ç‚¹æ€»æ•°=10ï¼Œç›‘å¬å™¨çº¿ç¨‹æ•°=40/10=4</p><p>ç¤ºä¾‹2ï¼šä¸»é¢˜åˆ†åŒºæ•°=108ï¼Œåº”ç”¨èŠ‚ç‚¹æ€»æ•°=18ï¼Œç›‘å¬å™¨çº¿ç¨‹æ•°=108/18=6</p><p>å…¬å¼ï¼š</p><p>1ã€ä¸»é¢˜åˆ†åŒºæ•°= åº”ç”¨èŠ‚ç‚¹æ€»æ•° * ç›‘å¬å™¨çº¿ç¨‹æ•°</p><p>2ã€åº”ç”¨èŠ‚ç‚¹æ€»æ•° = ä¸»é¢˜åˆ†åŒºæ•° / ç›‘å¬å™¨çº¿ç¨‹æ•°</p><p>3ã€ç›‘å¬å™¨çº¿ç¨‹æ•° = ä¸»é¢˜åˆ†åŒºæ•°/ åº”ç”¨èŠ‚ç‚¹æ€»æ•°</p></blockquote><p>å¦‚ä½•å¢å¤§ä¸»é¢˜åˆ†åŒºæ•°é‡ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1. &gt; bin/kafka-topics.sh --alter \</span><br><span class="line">2. --bootstrap-server broker1:9092,broker2:9092,broker3:9092 \</span><br><span class="line">3. --topic my_topic_name </span><br><span class="line">4. --partitions 4</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚åŸæ¥my_topic_name ä¸»é¢˜åˆ†åŒºæ•°2ä¸ªï¼Œæˆ‘æƒ³å¢å¤§ä¸º4ä¸ªï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ã€‚<strong>æ³¨æ„ï¼šä¸»é¢˜çš„åˆ†åŒºæ•°åªèƒ½å¢å¤§ï¼Œä¸èƒ½å‡å°ï¼Œæ‰€ä»¥è¯·è°¨æ…è¯„ä¼°ï¼Œåˆç†æ‰©å®¹ã€‚</strong></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>kafka</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ä»“åº“</title>
    <url>/post/ec060e02.html</url>
    <content><![CDATA[<blockquote><p>å¤§æ•°æ®-æ•°æ®ä»“åº“ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æ•°æ®ä»“åº“æ¶æ„"><a href="#ä¸€ã€æ•°æ®ä»“åº“æ¶æ„" class="headerlink" title="ä¸€ã€æ•°æ®ä»“åº“æ¶æ„"></a>ä¸€ã€æ•°æ®ä»“åº“æ¶æ„</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115622312.png" alt=""></p><h3 id="äºŒã€æ•°æ®ä»“åº“å®ä¾‹"><a href="#äºŒã€æ•°æ®ä»“åº“å®ä¾‹" class="headerlink" title="äºŒã€æ•°æ®ä»“åº“å®ä¾‹"></a>äºŒã€<strong>æ•°æ®ä»“åº“å®ä¾‹</strong></h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115656360.png" alt=""></p><h3 id="ä¸‰ã€å¤§æ•°æ®æŠ€æœ¯æ ˆ"><a href="#ä¸‰ã€å¤§æ•°æ®æŠ€æœ¯æ ˆ" class="headerlink" title="ä¸‰ã€å¤§æ•°æ®æŠ€æœ¯æ ˆ"></a>ä¸‰ã€<strong>å¤§æ•°æ®æŠ€æœ¯æ ˆ</strong></h3><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115814844.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115829295.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115840903.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115915722.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115933393.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115944567.png" style="zoom:33%"> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115951486.png" style="zoom:33%"><h3 id="å››ã€å¤§æ•°æ®æ¶æ„æ¼”å˜"><a href="#å››ã€å¤§æ•°æ®æ¶æ„æ¼”å˜" class="headerlink" title="å››ã€å¤§æ•°æ®æ¶æ„æ¼”å˜"></a>å››ã€<strong>å¤§æ•°æ®æ¶æ„</strong>æ¼”å˜</h3><h4 id="ä¼ ç»Ÿç¦»çº¿æ¶æ„ï¼ˆç¦»çº¿ï¼‰"><a href="#ä¼ ç»Ÿç¦»çº¿æ¶æ„ï¼ˆç¦»çº¿ï¼‰" class="headerlink" title="ä¼ ç»Ÿç¦»çº¿æ¶æ„ï¼ˆç¦»çº¿ï¼‰"></a>ä¼ ç»Ÿç¦»çº¿æ¶æ„ï¼ˆç¦»çº¿ï¼‰</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312115515623.png" alt=""></p><p>ç¼ºç‚¹ï¼šä¸èƒ½å¤„ç†å®æ—¶æ•°æ®ï¼Œæœ‰å»¶è¿Ÿã€‚</p><h4 id="ä¼ ç»Ÿå®æ—¶Lambdaæ¶æ„ï¼ˆç¦»çº¿-å®æ—¶é“¾è·¯ï¼‰"><a href="#ä¼ ç»Ÿå®æ—¶Lambdaæ¶æ„ï¼ˆç¦»çº¿-å®æ—¶é“¾è·¯ï¼‰" class="headerlink" title="ä¼ ç»Ÿå®æ—¶Lambdaæ¶æ„ï¼ˆç¦»çº¿+å®æ—¶é“¾è·¯ï¼‰"></a>ä¼ ç»Ÿå®æ—¶Lambdaæ¶æ„ï¼ˆç¦»çº¿+å®æ—¶é“¾è·¯ï¼‰</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312120934952.png" alt=""></p><p>ç¼ºç‚¹ï¼šå®æ—¶é“¾è·¯çƒŸå›±å¼å¼€å‘ï¼Œæ•°æ®ä¸èƒ½è¢«å¤ç”¨ã€‚</p><h4 id="Lambdaæ¶æ„ï¼ˆç¦»çº¿æ•°ä»“-å®æ—¶æ•°ä»“ï¼‰"><a href="#Lambdaæ¶æ„ï¼ˆç¦»çº¿æ•°ä»“-å®æ—¶æ•°ä»“ï¼‰" class="headerlink" title="Lambdaæ¶æ„ï¼ˆç¦»çº¿æ•°ä»“+å®æ—¶æ•°ä»“ï¼‰"></a>Lambdaæ¶æ„ï¼ˆç¦»çº¿æ•°ä»“+å®æ—¶æ•°ä»“ï¼‰</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312122121491.png" alt=""></p><p>ç¼ºç‚¹ï¼š</p><ol><li>åŒæ ·éœ€æ±‚éœ€è¦å¼€å‘å¤šå¥—ä¸€æ ·çš„ä»£ç ï¼›</li><li>é›†ç¾¤èµ„æºä½¿ç”¨å¤šï¼›</li><li>è®¡ç®—å’Œç¦»çº¿è®¡ç®—ç»“æœä¸ä¸€è‡´ï¼›</li><li>æ‰¹é‡è®¡ç®— T+1 å¯èƒ½è®¡ç®—ä¸å®Œï¼›</li><li>æœåŠ¡å™¨å­˜å‚¨å¤§ï¼›</li></ol><h4 id="Kappaæ¶æ„ï¼ˆçº¯å®æ—¶æ•°ä»“ï¼‰"><a href="#Kappaæ¶æ„ï¼ˆçº¯å®æ—¶æ•°ä»“ï¼‰" class="headerlink" title="Kappaæ¶æ„ï¼ˆçº¯å®æ—¶æ•°ä»“ï¼‰"></a>Kappaæ¶æ„ï¼ˆçº¯å®æ—¶æ•°ä»“ï¼‰</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312123548987.png" alt=""></p><p>ç¼ºç‚¹ï¼š</p><ol><li>kafkaæ— æ³•æ”¯æ’‘æµ·é‡æ•°æ®åº“å­˜å‚¨ï¼Œä¸æ”¯æŒsqlæŸ¥è¯¢ï¼›</li><li>kafkaä¸æ”¯æŒé«˜æ•ˆçš„OLAPï¼ˆä¸æ”¯æŒSQLæŸ¥è¯¢ï¼‰ï¼›</li><li>æ— æ³•å¤ç”¨æ•°æ®è¡€ç¼˜ç®¡ç†ä½“ç³»ï¼›</li><li>kafkaä¸æ”¯æŒæ›´æ–°ï¼Œåªæ”¯æŒè¿½åŠ ï¼›</li></ol><h4 id="æ¶æ„é€‰æ‹©"><a href="#æ¶æ„é€‰æ‹©" class="headerlink" title="æ¶æ„é€‰æ‹©"></a>æ¶æ„é€‰æ‹©</h4><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312125650029.png" style="zoom:25%"><p>å¤§éƒ¨åˆ†å…¬å¸é‡‡ç”¨Lambdaæ¶æ„ï¼Œäº’è”ç½‘å…¬å¸å®æ—¶ä¸šåŠ¡å¤šçš„é‡‡ç”¨æ··åˆæ¶æ„ã€‚ç»å¤§å¤šæ•°å…¬å¸é‡‡ç”¨kappaæ¶æ„ï¼Œå…³é”®æ ¸å¿ƒä¸šåŠ¡ä½¿ç”¨ç¦»çº¿å…¨é‡è®¡ç®—æ–¹å¼</p><h3 id="äº”ã€å®æ—¶æ•°ä»“å‘å±•è¶‹åŠ¿"><a href="#äº”ã€å®æ—¶æ•°ä»“å‘å±•è¶‹åŠ¿" class="headerlink" title="äº”ã€å®æ—¶æ•°ä»“å‘å±•è¶‹åŠ¿"></a>äº”ã€å®æ—¶æ•°ä»“å‘å±•è¶‹åŠ¿</h3><h4 id="æ‰¹æµä¸€ä½“"><a href="#æ‰¹æµä¸€ä½“" class="headerlink" title="æ‰¹æµä¸€ä½“"></a>æ‰¹æµä¸€ä½“</h4><p>æ—¢èƒ½å¤„ç†æ‰¹æ•°æ®ï¼Œä¹Ÿå¯ä»¥å¤„ç†å®æ—¶æµæ•°æ®ã€‚</p><h4 id="æ¹–ä»“ä¸€ä½“"><a href="#æ¹–ä»“ä¸€ä½“" class="headerlink" title="æ¹–ä»“ä¸€ä½“"></a>æ¹–ä»“ä¸€ä½“</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312131536980.png" alt=""></p><p>å¯ä»¥ç”¨Hudi ä»£æ›¿ lacBergã€‚</p><p>ä¼˜ç‚¹ï¼š</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312132039579.png" style="zoom:33%"><p>ç¼ºç‚¹ï¼š</p><ol><li>æ•°æ®æ¹–ï¼Œæ•°æ®å­˜å‚¨é€Ÿåº¦æ²¡æœ‰kafkaå¿«ï¼›</li><li>hudiå’ŒlacBergå¦‚ä½•è§£å†³å­˜å‚¨é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Ÿé’ˆå¯¹å†™ï¼Œé‡‡ç”¨è¡Œå¼å­˜å‚¨ï¼Œé’ˆå¯¹è¯»ï¼Œé‡‡ç”¨åˆ—å¼å­˜å‚¨ï¼›</li></ol><h3 id="å…­ã€äº’è”ç½‘æ•°ä»“å®è·µ"><a href="#å…­ã€äº’è”ç½‘æ•°ä»“å®è·µ" class="headerlink" title="å…­ã€äº’è”ç½‘æ•°ä»“å®è·µ"></a>å…­ã€äº’è”ç½‘æ•°ä»“å®è·µ</h3><h4 id="ç½‘æ˜“"><a href="#ç½‘æ˜“" class="headerlink" title="ç½‘æ˜“"></a>ç½‘æ˜“</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312132421394.png" alt=""></p><h4 id="é¡ºä¸°"><a href="#é¡ºä¸°" class="headerlink" title="é¡ºä¸°"></a>é¡ºä¸°</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312132750323.png" alt=""></p><h4 id="è…¾è®¯"><a href="#è…¾è®¯" class="headerlink" title="è…¾è®¯"></a>è…¾è®¯</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312133529551.png" alt=""></p><h4 id="æ»´æ»´"><a href="#æ»´æ»´" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20230312133348139.png" alt=""></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>DWH</category>
      </categories>
      <tags>
        <tag>DWH</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaé…ç½®auto.offset.resetæ—¶earliestå’Œlatestçš„åŒºåˆ«</title>
    <url>/post/9f1e82e9.html</url>
    <content><![CDATA[<blockquote><p>kafkaé…ç½®auto.offset.resetæ—¶earliestå’Œlatestçš„åŒºåˆ« ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€earliest"><a href="#ä¸€ã€earliest" class="headerlink" title="ä¸€ã€earliest"></a>ä¸€ã€earliest</h3><p>åˆ›å»ºä¸€ä¸ªtopicåç§°ä¸º <strong>test1</strong> ,è®¾å®šè¿™ä¸ªtopicåˆå§‹æœ‰ä¸‰ä¸ªåˆ†åŒº</p><p>ç”Ÿæˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ g001 ,è®¢é˜… <strong>test1</strong> ,å‚æ•°ä½¿ç”¨ earliest</p><p>å¦‚æœ g001 æ¶ˆè´¹è€…ç»„ åœ¨ test1çš„å…¶ä¸­ä¸€ä¸ªåˆ†åŒºä¸‹<u>æ²¡æœ‰æäº¤ åç§»é‡offset æ—¶</u>,åœ¨æ¶ˆè´¹è¯¥åˆ†åŒºæ•°æ®çš„æ—¶å€™ä¼š <strong>ä»å¤´ å…¨éƒ¨è¯»å–</strong></p><p>å¦‚æœ g001 æ¶ˆè´¹è€…ç»„ åœ¨ test1 çš„å…¶ä¸­ä¸€ä¸ªåˆ†åŒºä¸‹<u>æœ‰æäº¤ åç§»é‡offset æ—¶</u>,åœ¨æ¶ˆè´¹è¯¥åˆ†åŒºæ•°æ®çš„æ—¶å€™ä¼š<strong>ä» åç§»é‡offsetå¤„å¼€å§‹è¯»å–</strong></p><h3 id="äºŒã€latest"><a href="#äºŒã€latest" class="headerlink" title="äºŒã€latest"></a>äºŒã€latest</h3><p>åˆ›å»ºä¸€ä¸ªtopicåç§°ä¸º test2 ,è®¾å®šè¿™ä¸ªtopicåˆå§‹æœ‰ä¸‰ä¸ªåˆ†åŒº</p><p>ç”Ÿæˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ g002 ,è®¢é˜… test2 ,å‚æ•°ä½¿ç”¨ latest</p><p>å¦‚æœ g002 æ¶ˆè´¹è€…ç»„ åœ¨ test2 çš„å…¶ä¸­ä¸€ä¸ªåˆ†åŒºä¸‹<u>æ²¡æœ‰æäº¤ åç§»é‡offset æ—¶</u>,åœ¨æ¶ˆè´¹è¯¥åˆ†åŒºæ•°æ®çš„æ—¶ä¸ä¼š ä»å¤´ å…¨éƒ¨è¯»å–ï¼Œè€Œ<strong>æ˜¯è¯»å– æ–°äº§ç”Ÿçš„æ•°æ®</strong>ã€‚</p><p>å¦‚æœ g002 æ¶ˆè´¹è€…ç»„ åœ¨ test2 çš„å…¶ä¸­ä¸€ä¸ªåˆ†åŒºä¸‹<u>æœ‰æäº¤ åç§»é‡offset æ—¶</u>,åœ¨æ¶ˆè´¹è¯¥åˆ†åŒºæ•°æ®çš„æ—¶å€™ä¼š<strong>ä» åç§»é‡offset å¤„å¼€å§‹è¯»å–ã€‚</strong></p><h3 id="ä¸‰ã€æµ‹è¯•"><a href="#ä¸‰ã€æµ‹è¯•" class="headerlink" title="ä¸‰ã€æµ‹è¯•"></a>ä¸‰ã€æµ‹è¯•</h3><p>å¦‚æœæƒ³è¦æµ‹è¯•,å¯ä»¥è®¾ç½®å‚æ•° enable.auto.commit ä¸º fales (å½“è®¾ç½®ä¸ºfalesæ—¶å½“å‰æ¶ˆè´¹è€…ç»„å°†ä¸å†è‡ªåŠ¨æäº¤åç§»é‡offset,é»˜è®¤æ˜¯true)</p><p>åˆ›å»ºä¸€ä¸ªtopicåç§°ä¸º test3 ,è®¾å®šè¿™ä¸ªtopicåˆå§‹æœ‰ä¸‰ä¸ªåˆ†åŒº,å‡è®¾æœ‰åˆå§‹æ•°æ®10æ¡</p><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ç»„ g003 ,è®¢é˜… test3 ,å‚æ•°ä½¿ç”¨ earliest è®¾ç½®å‚æ•° enable.auto.commit ä¸º fales</p><p>æ¶ˆè´¹è€…ç»„ g003 ä¸ç®¡é‡æ–°å¯åŠ¨å¤šå°‘æ¬¡,ä¾æ—§æ¶ˆè´¹è¿™10æ¡æ•°æ®,å› ä¸º g003 è¿˜æ²¡æœ‰æäº¤è¿‡å…³äº test3 çš„ åç§»é‡offset</p><p>å½“æ¶ˆè´¹è€…ç»„ g003 æäº¤äº†ä¸€æ¬¡å…³äº test3 çš„ åç§»é‡offset ä¹‹å(åœ¨è¿™æˆ‘ä»¬å‡è®¾æäº¤ä¹‹å åç§»é‡offset ä¸º11) , æœ‰ä¸€ä¸ªç”Ÿäº§è€…å‘ test3 æ–°æäº¤äº†5æ¡æ•°æ®</p><p>è¿™æ—¶,ä¸ç®¡é‡å¯å¤šå°‘æ¬¡ g003 ,ä¹Ÿåªä¼šæ¶ˆè´¹è¿™æ–°çš„5æ¡æ•°æ®</p><p>åˆ›å»ºä¸€ä¸ªtopicåç§°ä¸º test4 ,è®¾å®šè¿™ä¸ªtopicåˆå§‹æœ‰ä¸‰ä¸ªåˆ†åŒº,å‡è®¾æœ‰åˆå§‹æ•°æ®10æ¡</p><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ç»„ g004 ,è®¢é˜… test4 ,å‚æ•°ä½¿ç”¨ latest è®¾ç½®å‚æ•° enable.auto.commit ä¸º fales</p><p>æ¶ˆè´¹è€…ç»„ g004 ä¸ç®¡é‡æ–°å¯åŠ¨å¤šå°‘æ¬¡,éƒ½ä¸ä¼šæ¶ˆè´¹åˆ°è¿™10æ¡æ•°æ®,å› ä¸º g004 è¿˜æ²¡æœ‰æäº¤è¿‡å…³äº test4 çš„ åç§»é‡offset æ‰€ä»¥ latest ä¼šè®©æ¶ˆè´¹è€…ç»„è¯»å–æ–°äº§ç”Ÿçš„æ•°æ®</p><p>å½“æ¶ˆè´¹è€…ç»„ g004 æäº¤äº†ä¸€æ¬¡å…³äº test4 çš„ åç§»é‡offset ä¹‹å(åœ¨è¿™æˆ‘ä»¬å‡è®¾æäº¤ä¹‹å åç§»é‡offset ä¸º11) , æœ‰ä¸€ä¸ªç”Ÿäº§è€…å‘ test4 æ–°æäº¤äº†5æ¡æ•°æ®</p><p>è¿™æ—¶,ä¸ç®¡é‡å¯å¤šå°‘æ¬¡ g004 ,ä¹Ÿéƒ½ä¼šä¸€ç›´æ¶ˆè´¹è¿™æ–°çš„5æ¡æ•°æ®</p><h3 id="å››ã€ç»“è®º"><a href="#å››ã€ç»“è®º" class="headerlink" title="å››ã€ç»“è®º"></a>å››ã€ç»“è®º</h3><p><strong>earliest å’Œ latest åœ¨æœ‰ åç§»é‡offset æ—¶,æ•ˆæœæ˜¯ä¸€æ ·çš„,éƒ½ä¼šä» åç§»é‡offset å¤„ç»§ç»­æ¶ˆè´¹;å½“æ²¡æœ‰ åç§»é‡offset æ—¶, ealiest ä»å¤´æ¶ˆè´¹, latest æ¶ˆè´¹æ–°äº§ç”Ÿçš„æ•°æ®</strong>ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaæŒ‡å®šæ—¶é—´æ®µæ¶ˆè´¹ä¸»é¢˜æ¶ˆæ¯</title>
    <url>/post/17596c1b.html</url>
    <content><![CDATA[<blockquote><p>kafkaæŒ‡å®šæ—¶é—´æ®µæ¶ˆè´¹ä¸»é¢˜æ¶ˆæ¯ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€-Pomåæ ‡"><a href="#ä¸€ã€-Pomåæ ‡" class="headerlink" title="ä¸€ã€ Pomåæ ‡"></a>ä¸€ã€ Pomåæ ‡</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="äºŒã€å·¥å…·ç±»"><a href="#äºŒã€å·¥å…·ç±»" class="headerlink" title="äºŒã€å·¥å…·ç±»"></a>äºŒã€å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.OffsetAndTimestamp;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.TopicPartition;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KafkaConsumer&lt;String, String&gt; <span class="title">getConsumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.put(<span class="string">"bootstrap.servers"</span>, getServers());</span><br><span class="line">        props.put(<span class="string">"enable.auto.commit"</span>, <span class="string">"true"</span>);</span><br><span class="line">        props.put(<span class="string">"auto.commit.interval.ms"</span>, <span class="string">"2000"</span>);</span><br><span class="line">        props.put(<span class="string">"session.timeout.ms"</span>, <span class="string">"30000"</span>);</span><br><span class="line">        props.put(<span class="string">"group.id"</span>, <span class="string">"jias_test"</span>);</span><br><span class="line">        props.put(<span class="string">"auto.offset.reset"</span>, <span class="string">"earliest"</span>);</span><br><span class="line">        props.put(<span class="string">"key.deserializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        props.put(<span class="string">"value.deserializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KafkaConsumer&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KafkaProducer&lt;String, String&gt; <span class="title">getKafkaProducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.put(<span class="string">"bootstrap.servers"</span>, getServers());</span><br><span class="line">        props.put(<span class="string">"enable.auto.commit"</span>, <span class="string">"true"</span>);</span><br><span class="line">        props.put(<span class="string">"auto.commit.interval.ms"</span>, <span class="string">"2000"</span>);</span><br><span class="line">        props.put(<span class="string">"session.timeout.ms"</span>, <span class="string">"30000"</span>);</span><br><span class="line">        props.put(<span class="string">"group.id"</span>, <span class="string">"jias_test_producer_one"</span>);</span><br><span class="line">        props.put(<span class="string">"key.serializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        props.put(<span class="string">"value.serializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringSerializer"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KafkaProducer&lt;&gt;(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ—¶é—´æˆ³è·å–åç§»é‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> partition åˆ†åŒºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datetimeStr æ¶ˆæ¯æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getOffsetByDateTime</span><span class="params">(KafkaConsumer consumer, String topic, <span class="keyword">int</span> partition, String datetimeStr)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        <span class="keyword">long</span> timestamp = df.parse(datetimeStr).getTime();</span><br><span class="line">        Map&lt;TopicPartition, Long&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        TopicPartition topicPartition = <span class="keyword">new</span> TopicPartition(topic, partition);</span><br><span class="line">        map.put(topicPartition, timestamp);</span><br><span class="line">        Map&lt;TopicPartition, OffsetAndTimestamp&gt; offset = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            offset = consumer.offsetsForTimes(map, Duration.ofSeconds(<span class="number">10</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> offset.get(topicPartition).offset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆè´¹æŸæ—¶é—´èŒƒå›´å†…çš„ä¸€æ‰¹æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> producer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to_topic</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> partition åˆ†åŒºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startTime æ¶ˆè´¹èµ·å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endTime æ¶ˆè´¹ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consumerOnTimeBatch</span><span class="params">(KafkaProducer&lt;String, String&gt; producer,</span></span></span><br><span class="line"><span class="function"><span class="params">        KafkaConsumer&lt;String, String&gt; consumer, String topic, String to_topic, <span class="keyword">int</span> partition, String startTime,</span></span></span><br><span class="line"><span class="function"><span class="params">        String endTime)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        TopicPartition topicPartition = <span class="keyword">new</span> TopicPartition(topic, partition);</span><br><span class="line">        <span class="comment">// æŒ‡å®šä¸»é¢˜åˆ†åŒº</span></span><br><span class="line">        consumer.assign(Arrays.asList(topicPartition));</span><br><span class="line">        <span class="keyword">long</span> startOffset = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">long</span> endOffset = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            startOffset = getOffsetByDateTime(consumer, topic, partition, startTime);</span><br><span class="line">            endOffset = getOffsetByDateTime(consumer, topic, partition, endTime);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        consumer.seek(topicPartition, startOffset);</span><br><span class="line">        <span class="keyword">boolean</span> reachedEnd = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                <span class="keyword">if</span> (record.offset() &gt;= endOffset) &#123;</span><br><span class="line">                    reachedEnd = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                count++;</span><br><span class="line">                log.info(<span class="string">"æ—¶é—´ï¼š"</span> + <span class="keyword">new</span> Date(record.timestamp()) + <span class="string">",åç§»é‡ï¼š"</span> + record.offset() + <span class="string">",æ¶ˆæ¯ä½“ï¼š"</span> + record.value());</span><br><span class="line">                <span class="comment">// writeFile(record.value(), "/Users/app.log");</span></span><br><span class="line">                <span class="comment">// try &#123;</span></span><br><span class="line">                <span class="comment">// Thread.sleep(20);</span></span><br><span class="line">                <span class="comment">// producer.send(new ProducerRecord&lt;&gt;(to_topic, record.value()));</span></span><br><span class="line">                <span class="comment">// &#125; catch (Exception e) &#123;</span></span><br><span class="line">                <span class="comment">// e.printStackTrace();</span></span><br><span class="line">                <span class="comment">// reachedEnd = true;</span></span><br><span class="line">                <span class="comment">// break;</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (reachedEnd)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(String.format(<span class="string">"åˆ†åŒºï¼š%d:%d"</span>, partition, count));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getServers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"kafka broker åœ°å€"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘æ–‡ä»¶è¿½åŠ å†…å®¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content å†™å…¥çš„å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">(String content, String fileName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨æ–‡ä»¶å¤¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(fileName);</span><br><span class="line"></span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">        OutputStreamWriter osw = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                <span class="keyword">boolean</span> hasFile = file.createNewFile();</span><br><span class="line">                <span class="keyword">if</span> (hasFile) &#123;</span><br><span class="line">                    log.info(<span class="string">"file not exists, create new file"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                fos = <span class="keyword">new</span> FileOutputStream(file, <span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            osw = <span class="keyword">new</span> OutputStreamWriter(fos, <span class="string">"utf-8"</span>);</span><br><span class="line">            <span class="comment">// å†™å…¥å†…å®¹</span></span><br><span class="line">            osw.write(content);</span><br><span class="line">            <span class="comment">// æ¢è¡Œ</span></span><br><span class="line">            osw.write(<span class="string">"\r\n"</span>);</span><br><span class="line">            log.info(<span class="string">"æˆåŠŸå‘æ–‡ä»¶ [&#123;&#125;] å†™å…¥å†…å®¹ï¼š[&#123;&#125;]"</span>, fileName, content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">"å†™å…¥æ–‡ä»¶å‘ç”Ÿå¼‚å¸¸"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­æµ</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (osw != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    osw.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.info(<span class="string">"å…³é—­æµå¼‚å¸¸"</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = getConsumer();</span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = getKafkaProducer();</span><br><span class="line">        String topic = <span class="string">"ä¸»é¢˜"</span>;</span><br><span class="line">        String to_topic = <span class="string">""</span>;</span><br><span class="line">        String startTime = <span class="string">"å¼€å§‹æ—¶é—´"</span>;</span><br><span class="line">        String endTime = <span class="string">"ç»“æŸæ—¶é—´"</span>;</span><br><span class="line">        <span class="comment">// å¾ªç¯åˆ†åŒºæ•°  </span></span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            consumerOnTimeBatch(producer, consumer, topic, to_topic, i, startTime, endTime);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>Droolsè§„åˆ™å¼•æ“</title>
    <url>/post/7180ebce.html</url>
    <content><![CDATA[<blockquote><p>Drools è§„åˆ™å¼•æ“ ~</p></blockquote><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“"><a href="#ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“" class="headerlink" title="ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“"></a>ä»€ä¹ˆæ˜¯è§„åˆ™å¼•æ“</h3><p>è§„åˆ™å¼•æ“æ˜¯å¤„ç†å¤æ‚è§„åˆ™é›†åˆçš„å¼•æ“ã€‚é€šè¿‡è¾“å…¥ä¸€äº›åŸºç¡€äº‹ä»¶ï¼Œä»¥æ¨æ¼”æˆ–è€…å½’çº³ç­‰æ–¹å¼ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ‰§è¡Œç»“æœã€‚è§„åˆ™å¼•æ“çš„æ ¸å¿ƒä½œç”¨åœ¨äºå°†å¤æ‚ã€æ˜“å˜çš„è§„åˆ™ä»ç³»ç»Ÿä¸­æŠ½ç¦»å‡ºæ¥ï¼Œç”±çµæ´»å¯å˜çš„è§„åˆ™æ¥æè¿°ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="Drools-ç®€ä»‹"><a href="#Drools-ç®€ä»‹" class="headerlink" title="Drools ç®€ä»‹"></a>Drools ç®€ä»‹</h3><p>Drools æ˜¯ Java ç¼–å†™çš„ä¸€æ¬¾å¼€æºè§„åˆ™å¼•æ“ã€‚Drools çš„æ ¸å¿ƒç®—æ³•åŸºäº Reteã€‚æ—©äº›ç‰ˆæœ¬ä¸­ï¼ŒDrools ä½¿ç”¨çš„æ˜¯åŸºäº Rete äºŒæ¬¡å¼€å‘çš„ ReteOO ç®—æ³•ã€‚åœ¨ 7.x ç‰ˆæœ¬çš„ Drools ä¸­ï¼Œå…¶å†…éƒ¨ç®—æ³•å·²ç»æ”¹ä¸ºä½¿ç”¨ Phreakã€‚Phreak ä¹Ÿæ˜¯Drools å›¢é˜Ÿè‡ªç ”çš„ç®—æ³•ï¼Œè™½ç„¶ç½‘ä¸Šå…³äºè¯¥ç®—æ³•çš„èµ„æ–™å¾ˆå°‘ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´ä¸ Rete ç®—æ³•ç›¸ä¼¼ã€‚é˜…è¯»æœ¬æ–‡ä¹‹å‰å¯ä»¥å…ˆäº†è§£ä¸‹ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FRete_algorithm" target="_blank" rel="noopener">Rete ç®—æ³•</a>ã€‚</p><h3 id="è§„åˆ™å¼•æ“çš„æ„æˆ"><a href="#è§„åˆ™å¼•æ“çš„æ„æˆ" class="headerlink" title="è§„åˆ™å¼•æ“çš„æ„æˆ"></a>è§„åˆ™å¼•æ“çš„æ„æˆ</h3><p>droolsè§„åˆ™å¼•æ“ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†æ„æˆï¼š</p><ol><li>Working Memoryï¼ˆå·¥ä½œå†…å­˜ï¼‰</li><li>Rule Baseï¼ˆè§„åˆ™åº“ï¼‰</li><li>Inference Engineï¼ˆæ¨ç†å¼•æ“ï¼‰</li><li>å…¶ä¸­Inference Engineï¼ˆæ¨ç†å¼•æ“ï¼‰åˆåŒ…æ‹¬ï¼š<ul><li>Pattern Matcherï¼ˆåŒ¹é…å™¨ï¼‰ å…·ä½“åŒ¹é…å“ªä¸€ä¸ªè§„åˆ™ï¼Œç”±è¿™ä¸ªå®Œæˆ</li><li>Agenda(è®®ç¨‹)</li><li>Execution Engineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰</li></ul></li></ol><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20220809104314344.png" alt=""></p><h3 id="ç»§æ‰¿æ–¹å¼"><a href="#ç»§æ‰¿æ–¹å¼" class="headerlink" title="ç»§æ‰¿æ–¹å¼"></a>ç»§æ‰¿æ–¹å¼</h3><ol><li>å•ç‹¬ä½¿ç”¨ droolsï¼›</li><li>æ­é…springä½¿ç”¨ï¼Œspringbootæ•´åˆDroolsï¼›</li></ol><blockquote><p>IDEAå®‰è£…äº†droolsæ’ä»¶ï¼Œæ”¯æŒdroolsè¯­æ³•ç¼–å†™ã€‚</p></blockquote><p>è¯¦ç»†ä»£ç ä¸åœ¨è¿™é‡Œåšè¯¦ç»†æè¿°ã€‚</p><h3 id="è§„åˆ™åŠ¨æ€å­˜å‚¨æ•°æ®åº“"><a href="#è§„åˆ™åŠ¨æ€å­˜å‚¨æ•°æ®åº“" class="headerlink" title="è§„åˆ™åŠ¨æ€å­˜å‚¨æ•°æ®åº“"></a>è§„åˆ™åŠ¨æ€å­˜å‚¨æ•°æ®åº“</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>éœ€è¦æŠŠè§„åˆ™æ–‡ä»¶çš„å†…å®¹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼›</li><li>Droolsç›¸å…³å¯¹è±¡ï¼ˆä¾‹å¦‚KieContainerå¯¹è±¡ï¼‰çš„åˆ›å»ºéƒ½åŸºäºæ•°æ®åº“ä¸­å­˜å‚¨çš„è§„åˆ™æ¥åˆ›å»ºï¼›</li><li>æä¾›HTTPè®¿é—®æ¥å£ï¼Œå½“è§„åˆ™å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨æ­¤æ¥å£é‡æ–°åŠ è½½æ•°æ®åº“ä¸­çš„è§„åˆ™ï¼Œé‡æ–°åˆ›å»ºKieContainerç­‰å¯¹è±¡ï¼›</li></ol><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> droolsRule</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">id</span>               <span class="built_in">bigint</span> auto_increment</span><br><span class="line">        primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">content</span>          <span class="built_in">text</span>         <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    create_time      <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    last_modify_time <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">null</span>,</span><br><span class="line">    rule_key         <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">version</span>          <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> UK_9yepjak9olg92holwkr8p3l0f</span><br><span class="line">        <span class="keyword">unique</span> (rule_key),</span><br><span class="line">    <span class="keyword">constraint</span> UK_ei48upwykmhx9r5p7p4ndxvgn</span><br><span class="line">        <span class="keyword">unique</span> (last_modify_time),</span><br><span class="line">    <span class="keyword">constraint</span> UK_ilmbp99kyt6gy10224pc9bl6n</span><br><span class="line">        <span class="keyword">unique</span> (<span class="keyword">version</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> drools.droolsRule (<span class="keyword">id</span>, <span class="keyword">content</span>, create_time, last_modify_time, rule_key, <span class="keyword">version</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'package rules;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import com.shuaizi.domain.Order;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//100å…ƒä»¥ä¸‹ä¸åŠ åˆ†</span></span><br><span class="line"><span class="string">rule "score_1" //åç§°éœ€å”¯ä¸€</span></span><br><span class="line"><span class="string">when</span></span><br><span class="line"><span class="string">$orderTest:Order(amount &lt; 100);</span></span><br><span class="line"><span class="string">then</span></span><br><span class="line"><span class="string">$orderTest.setScore(0);</span></span><br><span class="line"><span class="string">System.out.println("è§¦å‘è§„åˆ™ï¼Œ100å…ƒä»¥ä¸‹ä¸åŠ åˆ†");</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//100å…ƒ-500å…ƒ åŠ 100åˆ†</span></span><br><span class="line"><span class="string">rule "score_2"</span></span><br><span class="line"><span class="string">when</span></span><br><span class="line"><span class="string">$orderTest:Order(100 &lt; amount &amp;&amp; amount&lt; 500)</span></span><br><span class="line"><span class="string">then</span></span><br><span class="line"><span class="string">$orderTest.setScore(100);</span></span><br><span class="line"><span class="string">System.out.println("è§¦å‘è§„åˆ™ï¼Œ100å…ƒ-500å…ƒ åŠ 100åˆ†");</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//500å…ƒ-1000å…ƒ åŠ 500åˆ†</span></span><br><span class="line"><span class="string">rule "score_3"</span></span><br><span class="line"><span class="string">when</span></span><br><span class="line"><span class="string">$orderTest:Order(500 &lt; amount &amp;&amp; amount &lt; 1000)</span></span><br><span class="line"><span class="string">then</span></span><br><span class="line"><span class="string">$orderTest.setScore(500);</span></span><br><span class="line"><span class="string">System.out.println("è§¦å‘è§„åˆ™ï¼Œ500å…ƒ-1000å…ƒ åŠ 500åˆ†");</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//1000å…ƒä»¥ä¸Š åŠ 1000åˆ†</span></span><br><span class="line"><span class="string">rule "score_4"</span></span><br><span class="line"><span class="string">when</span></span><br><span class="line"><span class="string">$orderTest:Order(1000 &lt; amount)</span></span><br><span class="line"><span class="string">then</span></span><br><span class="line"><span class="string">$orderTest.setScore(1000);</span></span><br><span class="line"><span class="string">System.out.println("è§¦å‘è§„åˆ™ï¼Œ500å…ƒ-1000å…ƒ åŠ 1000åˆ†");</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">'</span>, <span class="string">'2022-08-09 12:12:23'</span>, <span class="string">'2022-08-09 12:12:23'</span>, <span class="string">'1'</span>, <span class="string">'1.0'</span>);</span><br></pre></td></tr></table></figure><h4 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shuaizi.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§„åˆ™å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/8/9 10:50 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@Accessors</span>(chain = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"droolsRule"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rule</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@TableId</span>(value = <span class="string">"id"</span>, type = IdType.INPUT)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String ruleKey;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="keyword">private</span> String lastModifyTime;</span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰€æœ‰çš„è§„åˆ™é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/8/8 6:10 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DroolsKieAllConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RULES_PATH = <span class="string">"rules/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> ReloadDroolsRulesService droolsRulesService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DroolsKieAllConfig</span><span class="params">(ReloadDroolsRulesService droolsRulesService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.droolsRulesService = droolsRulesService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KieContainer <span class="title">kieContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> KieRepository kieRepository = getKieServices().getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        KieBuilder kieBuilder = getKieServices().newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        <span class="keyword">return</span> getKieServices().newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> KieServices <span class="title">getKieServices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> KieServices.Factory.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KieFileSystem <span class="title">kieFileSystem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        KieFileSystem kieFileSystem = getKieServices().newKieFileSystem();</span><br><span class="line">         <span class="comment">// åŠ è½½æ•°æ®åº“ä¸­å­˜å‚¨çš„è§„åˆ™</span></span><br><span class="line">        List&lt;DroolsRule&gt; all = droolsRulesService.loadRules();</span><br><span class="line">        all.forEach(droolsRule -&gt; &#123;</span><br><span class="line">            <span class="comment">//è¯¥ç›®å½•æ–‡ä»¶ä¸ºè™šæ‹Ÿç›®å½•,ä¸éœ€è¦å®é™…å­˜åœ¨,**åç¼€ä¸€å®šè¦å¸¦.drl**</span></span><br><span class="line">            String path = <span class="string">"src/main/resources/"</span> + RULES_PATH + droolsRule.getId() + <span class="string">".drl"</span>;</span><br><span class="line">            kieFileSystem.write(path, droolsRule.getContent().getBytes());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€åˆ·æ–°"><a href="#åŠ¨æ€åˆ·æ–°" class="headerlink" title="åŠ¨æ€åˆ·æ–°"></a>åŠ¨æ€åˆ·æ–°</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡æ–°åŠ è½½æ‰€æœ‰çš„è§„åˆ™</span></span><br><span class="line"><span class="comment"> * è®¿é—®åœ°å€ï¼š&lt;a href="http://127.0.0.1:2342/rules/reloading"&gt;è®¿é—®åœ°å€&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/reloading"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reloading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        KieContainer kieContainer = droolsKieAllConfig.kieContainer();</span><br><span class="line">        kieContext.update(kieContainer);</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; stringListMap = kieContext.droolsBaseInfo();</span><br><span class="line">        System.out.println(stringListMap);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">"é‡è½½kieå¼‚å¸¸,å¼‚å¸¸ä¸º:&#123;&#125;"</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="workBench"><a href="#workBench" class="headerlink" title="workBench"></a>workBench</h3><p><a href="http://www.bigtspace.com/archives/7588.html" target="_blank" rel="noopener">ã€Š workbenchå­¦ä¹ å’Œæ¡ˆä¾‹ ã€‹</a></p><h3 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h3><p><a href="https://blog.csdn.net/chy_18883701161/article/details/124027004" target="_blank" rel="noopener">ã€Šèµ„æ–™ 1ã€‹</a><br><a href="https://blog.csdn.net/qq_41358574/article/details/122323187" target="_blank" rel="noopener">ã€Šèµ„æ–™ 2ã€‹</a><br><a href="https://blog.csdn.net/weixin_44728369/article/details/120413891" target="_blank" rel="noopener">ã€Šèµ„æ–™ 3ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Drools</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¤šçº¿ç¨‹- wait/notifyæœºåˆ¶</title>
    <url>/post/19d6c147.html</url>
    <content><![CDATA[<blockquote><p>Javaå¤šçº¿ç¨‹- wait/notifyæœºåˆ¶ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="Waitä¸Notify"><a href="#Waitä¸Notify" class="headerlink" title="Waitä¸Notify"></a>Waitä¸Notify</h3><p><strong>waitï¼šè°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•èƒ½è®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹å¿…é¡»æ‹¥æœ‰æ­¤å¯¹è±¡çš„é”.</strong></p><p><strong>notifyï¼šè°ƒç”¨æŸä¸ªå¯¹è±¡çš„notify()æ–¹æ³•èƒ½å¤Ÿå”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„é”çš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œåˆ™åªèƒ½å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹</strong></p><p><strong>notifyAllï¼šæ–¹æ³•èƒ½å¤Ÿå”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡é”çš„çº¿ç¨‹ï¼›</strong></p><p>waitæ˜¯Objectç±»çš„æ–¹æ³•ï¼Œè€ŒåŒæ ·å¯ä»¥å®ç°é˜»å¡åŠŸèƒ½çš„sleep()æ–¹æ³•æ˜¯Threadç±»çš„æ–¹æ³•ï¼Œå¿…é¡»ä½¿ç”¨synchorizedä»£ç å—è¿›è¡Œæ§åˆ¶ï¼Œè€Œsleep()æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œsleep()ä¸ä¼šé‡Šæ”¾è¯¥åŒæ­¥é”ï¼Œwait()ä¼šé‡Šæ”¾è¯¥åŒæ­¥é”ã€‚</p><p>notify()ä¸ä¼šç«‹åˆ»ç«‹åˆ»é‡Šæ”¾syncronizedï¼ˆobjï¼‰ä¸­çš„objé”ï¼Œå¿…é¡»è¦ç­‰notify()æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œå®Œsynchronizedï¼ˆobjï¼‰å—ä¸­çš„æ‰€æœ‰ä»£ç æ‰ä¼šé‡Šæ”¾è¿™æŠŠé”ã€‚</p><p>ç”±ä¸Šé¢ç¬¬äºŒæ¡ç»“è®ºï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨wait()ã€notify()æ–¹æ³•è¿›è¡Œæ§åˆ¶ä¹‹åï¼Œè‹¥notify()å¯¹åº”åŒæ­¥å—æ–¹æ³•ä»æœªæ‰§è¡Œå®Œï¼Œä»ä¼šå æœ‰é”ï¼Œé‚£ä¹ˆwait()å¯¹åº”çº¿ç¨‹ä¹Ÿæ˜¯æ²¡åŠæ³•æ‰§è¡Œçš„ï¼Œå› ä¸ºè·å–ä¸åˆ°é”ã€‚æ‰€ä»¥åº”è¯¥notifyå®Œä¹‹åå†æ¬¡waitï¼Œä»è€Œå°†é”é‡Šæ”¾ã€‚</p><h3 id="Notifyå’ŒNotifyAllçš„åŒºåˆ«"><a href="#Notifyå’ŒNotifyAllçš„åŒºåˆ«" class="headerlink" title="Notifyå’ŒNotifyAllçš„åŒºåˆ«"></a>Notifyå’ŒNotifyAllçš„åŒºåˆ«</h3><p><strong>notify</strong>åªä¼šéšæœºé€‰å–ä¸€ä¸ªå¤„äºç­‰å¾…æ± ä¸­çš„çº¿ç¨‹è¿›å…¥é”æ± å»ç«äº‰è·å–é”çš„æœºä¼šï¼›<br><strong>notifyAll</strong>ä¼šè®©æ‰€æœ‰å¤„äºç­‰å¾…æ± çš„çº¿ç¨‹å…¨éƒ¨è¿›å…¥é”æ± å»ç«äº‰è·å–é”çš„æœºä¼šï¼›</p><h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shuaizi.Thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (object) &#123;</span><br><span class="line">                System.out.println(System.currentTimeMillis() + <span class="string">":"</span> + Thread.currentThread().getName() + <span class="string">"è¿›å…¥å¯åŠ¨"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…(è¿›å…¥Object.waité˜Ÿåˆ—)å¹¶é‡Šæ”¾å¯¹è±¡é”</span></span><br><span class="line">                    object.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(System.currentTimeMillis() + <span class="string">":"</span> + Thread.currentThread().getName() + <span class="string">"çº¿ç¨‹æ‰§è¡Œç»“æŸ"</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        Thread thread_2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (object) &#123;</span><br><span class="line">                System.out.println(System.currentTimeMillis() + <span class="string">":"</span> + Thread.currentThread().getName() + <span class="string">"è¿›å…¥å¯åŠ¨"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//éšæœºåœ¨Object.waitdé˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹</span></span><br><span class="line">                    object.notify();</span><br><span class="line">                    System.out.println(System.currentTimeMillis() + <span class="string">":"</span> + Thread.currentThread().getName() + <span class="string">"å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹"</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread_2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æ—¶é—´æˆ³ä¸­å¯ä»¥çœ‹å‡º Thread-1 åœ¨é€šçŸ¥Thread-0 ç»§ç»­æ‰§è¡Œåï¼ŒThread-0 å¹¶æœªç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…Thread-1 é‡Šæ”¾Objecté”ï¼Œåœ¨é‡æ–°è·å¾—Objecté”åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚(æœ€åä¸¤ä¸ªæ—¶é—´æˆ³ç›¸å‡åˆšå¥½æ˜¯10ç§’)</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>æ…¢æ¥å£åœºæ™¯ä¼˜åŒ–æ–¹å¼æ€»ç»“</title>
    <url>/post/6bc54127.html</url>
    <content><![CDATA[<blockquote><p>é¡¹ç›®ä¸­é€šå¸¸ä¼šæœ‰æ…¢æ¥å£ï¼šä¸è®ºå¤šå°‘ï¼Œåæ­£æˆ–å¤šæˆ–å°‘ã€‚å°¤å…¶æ˜¯æˆ‘ä»¬ä¾èµ–äº†å…¶ä»–è¢«ä¾èµ–ç¨‹åº¦æé«˜çš„å¤§æ•°æ®æœåŠ¡ã€ä¸»æ•°æ®æœåŠ¡ã€é‰´æƒæœåŠ¡ç­‰ï¼Œå®ƒä»¬è¿™äº›ç³»ç»Ÿçš„æ¥å£æ€§èƒ½ç›´æ¥å½±å“äº†æˆ‘ä»¬å¯¹å¤–æä¾›æœåŠ¡çš„æ„ŸçŸ¥åº¦ï¼šæ¯•ç«Ÿæˆ‘ä»¬æ‰æ˜¯å‰å° ~</p></blockquote><a id="more"></a><h1 id="ä¹‹å‰çš„å°è¯•"><a href="#ä¹‹å‰çš„å°è¯•" class="headerlink" title="ä¹‹å‰çš„å°è¯•"></a>ä¹‹å‰çš„å°è¯•</h1><p>ä¹‹å‰æˆ‘ä»¬å·²ç»åœ¨ç»å†è¿‡çš„å„ç§æ…¢åœºæ™¯ä¸­å°è¯•äº†è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦åˆ†æˆä¸‰ç§é€”å¾„ï¼š</p><h2 id="ä¼˜åŒ–æœ¬åœ°ä»£ç "><a href="#ä¼˜åŒ–æœ¬åœ°ä»£ç " class="headerlink" title="ä¼˜åŒ–æœ¬åœ°ä»£ç "></a>ä¼˜åŒ–æœ¬åœ°ä»£ç </h2><p>æ¥å£å¤ªæ…¢äº†ï¼Œåœ¨ä¸æ˜¯å¤–éƒ¨åŸå› çš„æƒ…å†µä¸‹æˆ‘ä»¬é€šå¸¸ç¬¬ä¸€æ­¥æ–¹æ¡ˆéƒ½æ˜¯ä»£ç ä¼˜åŒ–ï¼Œç„¶åæ‰ä¼šè€ƒè™‘ä½¿ç”¨ä¸­é—´ä»¶ã€‚</p><p>ä¼˜å…ˆè€ƒè™‘ä¼˜åŒ–æœ¬åœ°ä»£ç çš„åŸå› æ˜¯æˆ‘ä»¬ç¡®å®èƒ½åŠ›æœ‰é™ï¼Œè°éƒ½ä¼šå†™å‡ºä¸å¤Ÿå¥½çš„ä»£ç ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬çš„ä»£ç éƒ½æœ‰ä¸€å®šç¨‹åº¦çš„å¯ä¼˜åŒ–ç©ºé—´ã€‚æ¯”å¦‚æ•°æ®ç»“æ„ä½¿ç”¨çš„ä¸å¥½ï¼Œåº”è¯¥ç”¨LinkedListå´ç”¨äº†ArrayListï¼Œæ¯”å¦‚ä½¿ç”¨äº†ArrayListå¯¼è‡´äº†é¢‘ç¹æ‰©å®¹ï¼Œæ¯”å¦‚åˆ›å»ºäº†å¤ªå¤šéå¿…è¦ä¸´æ—¶å¯¹è±¡å¯¼è‡´GCå¤ªå¤šï¼Œæ¯”å¦‚çº¿ç¨‹æ± é…ç½®ä¸åˆé€‚å¯¼è‡´CPUè´Ÿè½½å¤ªé«˜ï¼Œç­‰ç­‰ç­‰ï¼›å¦å¤–ä¸ç›´æ¥è€ƒè™‘å¼•å…¥ä¸­é—´ä»¶çš„åŸå› è¿˜æœ‰ï¼Œä½¿ç”¨ä¸­é—´ä»¶ä¼šä½¿ç³»ç»Ÿå¤æ‚æ€§æé«˜ï¼Œéœ€è¦ç¼–å†™æ›´å¤šçš„ä»£ç ä¿è¯åŠŸèƒ½çš„ä½¿ç”¨ï¼Œå‡ºäº†é—®é¢˜ä¹Ÿæ¯”æ²¡æœ‰ä¸­é—´ä»¶æ›´éš¾æ’æŸ¥ã€‚</p><p>ä½†æ˜¯æœ¬åœ°ä»£ç ä¼˜åŒ–åçš„æ”¹å–„é€šå¸¸å¾ˆå°ã€‚ä¸€ä¸ªåŸå› æ˜¯å°±ç®—ä»£ç å†çƒ‚ï¼Œç°ä»£é«˜é€ŸCPUä¹Ÿä¼šæŠ¹å¹³å’Œå¥½ä»£ç çš„æ—¶é—´å·®å¼‚ï¼Œé‚£ç‚¹æ¯«ç§’çº§å·®å¼‚ç”šè‡³å¾®ç§’çº§å·®å¼‚å¯¹æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡å®åœ¨è´¡çŒ®å¤ªå°‘ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯å—é™äºæŠ€æœ¯èƒ½åŠ›ï¼Œå°±ç®—å®šä½äº†çƒ‚ä»£ç ï¼Œä¹Ÿä¸ä¸€å®šèƒ½å†™å‡ºå¥½ä»£ç ã€‚æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œä»£ç ä¼˜åŒ–å’Œä»£ç ç¾åŒ–ä¸€æ ·åªæ˜¯æˆ‘ä»¬çš„ä¸ªäººè¿½æ±‚ã€‚</p><h2 id="ä½¿ç”¨ç¼“å­˜"><a href="#ä½¿ç”¨ç¼“å­˜" class="headerlink" title="ä½¿ç”¨ç¼“å­˜"></a>ä½¿ç”¨ç¼“å­˜</h2><p>æ¯«æ— ç–‘é—®ï¼Œç¼“å­˜æ˜¯æå‡ç³»ç»Ÿç›¸åº”é€Ÿåº¦æœ€æœ‰åˆ©çš„æ­¦å™¨ä¹‹ä¸€ã€‚å…³äºå®ƒçš„å¥½å¤„è¿™é‡Œä¸æäº†ï¼›ä»…è¯´ä¸€å¥ï¼Œç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜ï¼ˆé€šè¿‡Javaçš„æ•°æ®ç»“æ„è®°åœ¨å †å†…å­˜é‡Œï¼‰å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€èˆ¬å°±æ˜¯Redisï¼‰ã€‚</p><p>ç¼“å­˜å¸¦æ¥çš„åå¤„ä¹Ÿæ˜¯é«˜é¢‘è€ƒç‚¹ï¼šæ•°æ®çš„ä¸€è‡´æ€§ã€‚æ‰€ä»¥ä½¿ç”¨ç¼“å­˜éœ€æ±‚æƒè¡¡è¿™ä¸ªä¸­é—´ç‚¹ï¼šæ—¢ä¸èƒ½å­˜çš„å¤ªä¹…ä¸¥é‡å½±å“ä¸€è‡´æ€§ï¼Œä¹Ÿä¸èƒ½å­˜çš„å¤ªçŸ­å½±å“ç³»ç»Ÿå…¶ä»–æ–¹é¢æ€§èƒ½ã€‚æ‰€ä»¥å“ªäº›æ•°æ®èƒ½ç¼“å­˜ã€ç¼“å­˜å¤šä¹…ã€ç¼“å­˜åœ¨å“ªã€æ€ä¹ˆç¼“å­˜éƒ½æ˜¯éœ€è¦ä»”ç»†è€ƒè™‘çš„ã€‚ä½¿ç”¨ä»€ä¹ˆå®šæ—¶ä»»åŠ¡ã€ä½¿ç”¨å‡ ä¸ªå®šæ—¶ä»»åŠ¡ä¹Ÿæ˜¯å…³é”®ä¸€æ­¥ã€‚</p><h2 id="ä¼˜åŒ–SQL"><a href="#ä¼˜åŒ–SQL" class="headerlink" title="ä¼˜åŒ–SQL"></a>ä¼˜åŒ–SQL</h2><p>è‡ªå·±ç³»ç»Ÿå†…éƒ¨çš„æ¥å£æ…¢ï¼Œæœ€å¤§çš„å¯èƒ½æ˜¯æŸ¥è¯¢æ•°æ®åº“å¼•èµ·çš„ã€‚æ‰€ä»¥ä¼˜åŒ–è¡¨è®¾è®¡å’ŒSQLè„šæœ¬ä¹Ÿè‡³å…³é‡è¦ã€‚</p><h1 id="æœ€è¿‘çš„ç ”ç©¶"><a href="#æœ€è¿‘çš„ç ”ç©¶" class="headerlink" title="æœ€è¿‘çš„ç ”ç©¶"></a>æœ€è¿‘çš„ç ”ç©¶</h1><p>ç»è¿‡ä¸Šé¢æåˆ°çš„è¿™äº›æ‰‹æ®µä¼˜åŒ–è¿‡ä»¥åï¼Œä¾ç„¶å­˜åœ¨æ¼ç½‘ä¹‹é±¼ï¼šè¿™äº›æ…¢æ¥å£éƒ½æ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹ç³»ç»Ÿã€è€Œä¸”æ— æ³•è®¾è®¡ï¼ˆæå‰ï¼‰ç¼“å­˜æ¥æ”¹å–„ã€‚è¿™æ ·å°±æ„å‘³ç€æ²¡æœ‰å…¶ä»–ï¼ˆæˆ–è€…ç°åœ¨æ²¡æƒ³åˆ°ï¼‰æ‰‹æ®µæ¥æå‡æ¥å£çš„é€Ÿåº¦äº†ã€‚</p><p>æ…¢æ¥å£å¸¦æ¥çš„é—®é¢˜ä¸»è¦æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªå½“ç„¶æ˜¯ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œå¦ä¸€ä¸ªæ˜¯å…¬å¸çš„è´¨é‡æ£€æµ‹ã€‚</p><p>å…¬å¸å¯¹æ…¢æ¥å£çš„ç›‘æ§æ˜¯ä¾æ®URLè¯·æ±‚å“åº”é—´éš”è¶…è¿‡ä¸€å®šæ—¶é—´è¿›è¡Œç»Ÿè®¡çš„ã€‚æ‰€ä»¥æœ€è¿‘æˆ‘åˆ†åˆ«è€ƒè™‘äº†ä»¥ä¸‹æŠ€æœ¯ï¼š</p><ul><li>çŸ­è½®è¯¢</li><li>é•¿è½®è¯¢</li><li>å“åº”å¼</li><li>éé˜»å¡å¼‚æ­¥</li><li>WebSocket</li><li>SSE</li><li>Servlet4</li></ul><h2 id="çŸ­è½®è¯¢"><a href="#çŸ­è½®è¯¢" class="headerlink" title="çŸ­è½®è¯¢"></a>çŸ­è½®è¯¢</h2><p>çŸ­è½®è¯¢å°±æ˜¯æŸ¥ä¸€ä¸‹ï¼Œæœ‰æ•°æ®å°±æ‹¿åˆ°ï¼Œæ²¡æ•°æ®å°±æ‹¿ä¸åˆ°ï¼›è¿‡ä¸€ä¼šå†å°è¯•ã€‚</p><p>è¦ä½¿ç”¨çŸ­è½®è¯¢ï¼ŒæœåŠ¡ç«¯éœ€è¦ä½¿ç”¨ç¼“å­˜ï¼šå‰ç«¯è¯·æ±‚çš„æ—¶å€™å°±å»ç¼“å­˜æ‹¿ï¼Œæ²¡æ‹¿åˆ°ï¼ˆæˆ–æ•°æ®è¿‡æœŸäº†ï¼‰å°±è¿”å›ï¼›åŒæ—¶åå°å¼‚æ­¥å»å–æ•°æ®ï¼Œå¯èƒ½å¾ˆæ…¢ï¼Œå•¥æ—¶å€™å–å¥½äº†å°±æ”¾åˆ°ç¼“å­˜ç­‰ç€ä¸‹ä¸€æ¬¡è½®è¯¢ï¼ˆæœŸé—´å¯èƒ½å·²ç»è½®è¯¢å¥½å‡ æ¬¡äº†ï¼‰ã€‚</p><h2 id="é•¿è½®è¯¢"><a href="#é•¿è½®è¯¢" class="headerlink" title="é•¿è½®è¯¢"></a>é•¿è½®è¯¢</h2><p>é•¿è½®è¯¢å°±æ˜¯æŸ¥ä¸€ä¸‹ï¼Œæœ‰æ•°æ®å°±è¿”å›ï¼Œæ²¡æ•°æ®å°±ä¸è¿”å›ï¼Œåœ¨é‚£ç­‰ç€ï¼šè¿™æ ·çœ‹èµ·æ¥ä¼¼ä¹æˆ‘ä»¬çš„æ¥å£åŸºæœ¬éƒ½è¿™æ ·ï¼Œå¯ä»¥ç»™é•¿è½®è¯¢ä½¿ç”¨ã€‚ä¸è¿‡çœŸæ­£æ„ä¹‰çš„é•¿è½®è¯¢ä¸æ˜¯åç«¯æ”¶åˆ°è¯·æ±‚å°±å»å–æ•°æ®ï¼Œè€Œæ˜¯åç«¯å°±ç®—å–äº†æ²¡å–åˆ°ï¼Œè¯·æ±‚ä¹Ÿä¸ä¼šç»“æŸï¼Œä¼šä¸€ç›´ç­‰åˆ°åç«¯æœ‰æ•°æ®äº†æˆ–è€…è¯·æ±‚è¶…æ—¶äº†æ‰è¿”å›ï¼Œç„¶åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚</p><p>å¾ˆå¤šäººéƒ½ä»¥ä¸ºé•¿è½®è¯¢æ˜¯å¯¹çŸ­è½®è¯¢çš„ä»£æ›¿ï¼Œæœ‰äº†é•¿è½®è¯¢å°±å†ä¹Ÿä¸éœ€è¦çŸ­è½®è¯¢äº†ã€‚å…¶å®å®ƒä»¬å„è‡ªæœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åç«¯æ•°æ®æ›´æ–°ç‰¹åˆ«é¢‘ç¹ï¼Œä¸€ç§’æ›´å¥½å‡ æ¬¡ã€‚è¿™ä¸ªæ—¶å€™ä½¿ç”¨é•¿è½®è¯¢ä¼šå¯¼è‡´è¿ç»­ä¸æ–­è¯·æ±‚ï¼Œæµè§ˆå™¨éƒ½å¯èƒ½å¡æ­»ï¼›ç›¸åä½¿ç”¨çŸ­è½®è¯¢ï¼Œ1ç§’æˆ–å‡ ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼Œæ€§èƒ½å¥½æ•°æ®å»¶è¿Ÿä¹Ÿä¸å¤§ã€‚</p><h2 id="å“åº”å¼"><a href="#å“åº”å¼" class="headerlink" title="å“åº”å¼"></a>å“åº”å¼</h2><p>å“åº”å¼å°±æ˜¯RxJavaï¼ˆRx æ˜¯ C# çš„ï¼‰ï¼Œåœ¨Spring5ä¸­æ˜¯WebFluxï¼Œæ®è¯´æ€§èƒ½æ¯”Vert.xå·®å¾ˆå¤šã€‚å“åº”å¼æ˜¯åŸºäºNIOçš„ï¼Œå¿…é¡»è¿è¡Œåœ¨nettyæˆ–è€…Servlet3.1ä»¥ä¸Šçš„å®¹å™¨ï¼Œå®ƒä»¬å¤„ç†è¯·æ±‚å’Œè¿”å›å“åº”çš„çº¿ç¨‹ä¸æ˜¯åŒä¸€ä¸ªã€‚å“åº”å¼ä¸€èˆ¬ä¸èƒ½æå‡å“åº”é€Ÿåº¦ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨æ‹¿åˆ°ç»“æœçš„æ—¶é—´ä¸ä¼šä¸‹é™ï¼›è€Œæ˜¯ä¼šæå‡æœåŠ¡ç«¯çš„ååé‡ï¼Œä¹Ÿå°±æ˜¯éç›¸åº”å¼çš„æ—¶å€™ï¼ˆä½¿ç”¨Spring MVCï¼‰æœåŠ¡å™¨æœ¬æ¥æ¯”å¦‚åªèƒ½æ¥å—1ä¸‡ä¸ªè¯·æ±‚ï¼Œä½¿ç”¨WebFluxå¯ä»¥æ— ä¸Šé™çš„æ¥å—ï¼ˆå‰æå½“ç„¶æ˜¯ä¸è¢«å…¶ä»–æ¡ä»¶çº¦æŸï¼Œæ¯”å¦‚å†…å­˜ï¼Œæ¯”å¦‚çº¿ç¨‹æ•°é‡ï¼‰ã€‚</p><p>é‚£ä½¿ç”¨WebFluxå¯ä»¥å‡å°‘æ…¢æ¥å£å—ï¼Ÿåœ¨ä¸€å®šæ¡ä»¶ä¸‹å¯ä»¥ã€‚æ¯”å¦‚æœåŠ¡ç«¯æ¥å£å®é™…å¤„ç†ä¸šåŠ¡éœ€è¦ç­‰2ç§’ï¼ˆå¿…é¡»æ˜¯IOå‹çš„ï¼Œæ¯”å¦‚è¯·æ±‚å…¶ä»–æœåŠ¡æˆ–è€…æ•°æ®åº“ã€ä¸­é—´ä»¶ç­‰ï¼‰ï¼Œæœºå™¨æœ‰10ä¸ªCPUï¼Œåœ¨Web MVCåœºæ™¯ä¸‹è¿™æ—¶å€™å¦‚æœæœ‰10ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚ï¼Œåˆ™tomcatå¯ä»¥éƒ½åˆ›å»ºè¿æ¥å¹¶é€šè¿‡çº¿ç¨‹æ± è°ƒåº¦ï¼Œä½¿å¾—æ¯ä¸ªè¯·æ±‚éƒ½åœ¨2ç§’å·¦å³ç»“æŸã€‚å¦‚æœè¿™æ—¶å€™æœ‰20ä¸ªè¯·æ±‚ï¼Œè™½ç„¶éƒ½èƒ½å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯åªæœ‰10ä¸ªèƒ½åœ¨2ç§’ç»“æŸå¹¶è¿”å›ï¼Œå‰©ä¸‹çš„10ä¸ªè¦ç»§ç»­æ‰§è¡Œ2ç§’ï¼Œæ€»å…±4ç§’æ‰è¿”å›ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨WebFluxï¼Œè¿™20ä¸ªï¼ˆå“ªæ€•2åƒ2ä¸‡ï¼‰éƒ½æ˜¯2ç§’å·¦å³è¿”å›ã€‚ä»è¿™ä¸ªè§’åº¦è®²ï¼ŒWebFluxæ˜¯å¯ä»¥æå‡å“åº”é€Ÿåº¦çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ¥å£æ…¢å¹¶ä¸æ˜¯å› ä¸ºè¿æ¥æ•°å¤šï¼Œç›¸åè¿æ¥æ•°å¾ˆéš¾ä¸Šä¸¤ä½æ•°ã€‚</p><h2 id="éé˜»å¡å¼‚æ­¥"><a href="#éé˜»å¡å¼‚æ­¥" class="headerlink" title="éé˜»å¡å¼‚æ­¥"></a>éé˜»å¡å¼‚æ­¥</h2><p>å¦‚æœä¸æƒ³é¢å¤–å¼•å…¥WebFluxä¾èµ–ï¼Œæˆ–è€…é¡¹ç›®ä½¿ç”¨çš„Springç‰ˆæœ¬æ˜¯5ä»¥ä¸‹çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Springæä¾›çš„å¼‚æ­¥å·¥å…·ï¼šDeferredResultï¼Œæˆ–è€…Callableã€‚ä½†æ˜¯è¿™ä¸ªå’ŒWebFluxåŸç†ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ˜¯åŸºäºçº¿ç¨‹æ± çš„ï¼Œå’ŒNIOæ¨¡å¼çš„tomcatä¸€æ ·ï¼ˆå°±æ˜¯ä¸Šé¢æåˆ°çš„åªèƒ½åŒæ—¶å¤„ç†10ä¸ªè¯·æ±‚é‚£ç§ï¼‰ï¼›è€ŒWebFluxæ˜¯åŸºäºselectorçš„ã€‚æ‰€ä»¥ä»–ä»¬èƒ½åŠ›å®Œå…¨ä¸åŒã€‚</p><h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>è¦ç”¨websocketéœ€è¦åç«¯ä¹Ÿä¸€èµ·æ”¹é€ ï¼Œå› ä¸ºmvcå¹¶ä¸èƒ½æä¾›websocketçš„è¿æ¥ï¼Œwebsocketçš„åè®®æ˜¯wsçš„ä¸æ˜¯httpã€‚å›¾æ¨¡çš„åç«¯é¡¹ç›®ugmdp-apiä¸­å®šä¹‰äº†WebSocketçš„ç«¯ç‚¹ã€‚</p><h2 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h2><p>sseæ˜¯websocketçš„ç®€åŒ–ç‰ˆã€‚websocektæ˜¯å…¨åŒå·¥é€šä¿¡ï¼Œsseæ˜¯åªèƒ½æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€ã€‚å®ƒæ¯”websocketå¥½ç”¨çš„ä¸€ç‚¹æ˜¯æ™®é€šmvcçš„ç«¯ç‚¹å°±èƒ½ä½¿ç”¨ï¼Œå› ä¸ºå®ƒè¿æ¥çš„å°±æ˜¯httpç«¯ç‚¹ã€‚<strong>æ³¨æ„</strong>ï¼šæµè§ˆå™¨æœ‰é™åˆ¶ï¼Œå¯¹äºé•¿é“¾æ¥æœ€å¤šåªèƒ½ä¿æŒ6ä¸ªã€‚</p><h2 id="Servlet4"><a href="#Servlet4" class="headerlink" title="Servlet4"></a>Servlet4</h2><p>Servlet4çš„ä¸€ä¸ªä¸»è¦åŠŸèƒ½ä¹Ÿæ˜¯æœåŠ¡å™¨æ¨é€ï¼Œä½†æ˜¯å®ƒæ˜¯ç»™http/2ç”¨çš„ã€‚é‰´äºæˆ‘ä»¬ç°åœ¨éƒ½åœ¨ç”¨http/1.1ï¼Œè¿™ä¸€æ–¹é¢æˆ‘æ²¡æœ‰ç‰¹åˆ«ç ”ç©¶ã€‚</p><h1 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h1><p>é€šè¿‡ä¸Šé¢è¿™å‡ ç§æŠ€æœ¯å¯¹æ¯”ï¼Œæˆ‘è®¡åˆ’ä½¿ç”¨SSEæ¥å°è¯•æ”¹å–„æ¥å£æ€§èƒ½å¹¶ä¸€å®šç¨‹åº¦æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p><ul><li>å“åº”å¼ï¼Œæˆ–å…¶ä»–å¼‚æ­¥æŠ€æœ¯ï¼Œå¹¶ä¸èƒ½æ”¹å˜æ¥å£å“åº”æ—¶é—´ï¼šå®ƒæ”¹å–„çš„ä¸æ˜¯å®¢æˆ·ç«¯è€Œæ˜¯æœåŠ¡ç«¯æ€§èƒ½</li><li>çŸ­è½®è¯¢å’ŒWebSocketå¯ä»¥æ¶ˆé™¤æ…¢æ¥å£ï¼Œä½†æ˜¯è¦æ±‚ç³»ç»Ÿè¿›è¡Œæ¯”è¾ƒå¤§çš„æ”¹é€ ï¼›å‰ç«¯æ”¹åŠ¨é‡ä¹Ÿä¸å°</li><li>SSEéœ€è¦å‰åç«¯éƒ½æœ‰æ”¹é€ ï¼Œä½†æ˜¯æ”¹åŠ¨é‡éƒ½ä¸å¤§</li></ul><h1 id="SSEç”¨æ³•"><a href="#SSEç”¨æ³•" class="headerlink" title="SSEç”¨æ³•"></a>SSEç”¨æ³•</h1><p>Springæä¾›äº†ï¼ˆè‡³å°‘ï¼‰ä¸¤ç§æ–¹æ³•æ¥ç”ŸæˆSSEæµï¼Œä¸‹é¢åˆ†åˆ«æ¥ä»‹ç»ã€‚</p><h2 id="é€šè¿‡WebFluxæä¾›SSEæµ"><a href="#é€šè¿‡WebFluxæä¾›SSEæµ" class="headerlink" title="é€šè¿‡WebFluxæä¾›SSEæµ"></a>é€šè¿‡WebFluxæä¾›SSEæµ</h2><p>è¿™ä¸ªè‡ªè¡Œç™¾åº¦å§</p><h2 id="é€šè¿‡SseEmitteræä¾›SSEæµ"><a href="#é€šè¿‡SseEmitteræä¾›SSEæµ" class="headerlink" title="é€šè¿‡SseEmitteræä¾›SSEæµ"></a>é€šè¿‡SseEmitteræä¾›SSEæµ</h2><p>SseEmitteræ˜¯Spring 4 æä¾›çš„ç”¨æ¥å‘é€SSEæµçš„å·¥å…·ï¼Œæ— éœ€å¼•å…¥WebFluxã€‚</p><h4 id="åç«¯ä»£ç "><a href="#åç«¯ä»£ç " class="headerlink" title="åç«¯ä»£ç "></a>åç«¯ä»£ç </h4><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯å»è¯·æ±‚ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¦10ç§’æ‰èƒ½è¿”å›ã€‚ä¸ºäº†è®©ç”¨æˆ·æœ‰ç‚¹å¸Œæœ›ï¼Œæ¯ç§’è¿”å›ä¸€ä¸ªéšæœºçš„è¿›åº¦ï¼Œæœ€å¤šè¿”å›5æ¬¡ã€‚10ç§’åæŠŠç»“æœï¼ˆå­—ç¬¦ä¸²okï¼‰è¿”å›ç»™å‰ç«¯ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.SseEmitter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/sse/mvc"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(PerformanceController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService bossPool = Executors.newCachedThreadPool();</span><br><span class="line">    Random r = <span class="keyword">new</span> Random();</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping</span>(path = <span class="string">"/process"</span>, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br><span class="line">    <span class="function">SseEmitter <span class="title">getWords</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SseEmitter emitter = <span class="keyword">new</span> SseEmitter();</span><br><span class="line">        logger.info(<span class="string">"Emitter created: &#123;&#125;"</span>, emitter);</span><br><span class="line"> </span><br><span class="line">        CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">        &#125;).whenCompleteAsync((res, ex) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (ex == <span class="keyword">null</span>) &#123;</span><br><span class="line">                WebResult&lt;String&gt; wr = <span class="keyword">new</span> WebResult&lt;&gt;();</span><br><span class="line">                wr.setData(res);</span><br><span class="line">                SseEmitter.SseEventBuilder data = SseEmitter.event().data(wr);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    emitter.send(data);</span><br><span class="line">                    emitter.complete();</span><br><span class="line">                    logger.info(<span class="string">"Emitter completed: &#123;&#125;"</span>, emitter);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    emitter.completeWithError(e);</span><br><span class="line">                    logger.warn(<span class="string">"Emitter failed: &#123;&#125; &#123;&#125;"</span>, emitter, e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        AtomicInteger base = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">        <span class="keyword">int</span> step = <span class="number">20</span>;</span><br><span class="line">        bossPool.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (base.get() &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                WebResult&lt;String&gt; wr = <span class="keyword">new</span> WebResult&lt;&gt;();</span><br><span class="line">                wr.setSuccess(<span class="keyword">false</span>);</span><br><span class="line">                wr.setMsg(<span class="string">""</span> + (r.nextInt(step) + base.get()) + <span class="string">"%"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    emitter.send(SseEmitter.event().data(wr));</span><br><span class="line">                    base.addAndGet(step);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    emitter.complete();</span><br><span class="line">                    logger.info(<span class="string">"Emitter completed period: &#123;&#125;"</span>, emitter);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> emitter;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebResult</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> success = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‰ç«¯æ¶ˆè´¹SSEæµ"><a href="#å‰ç«¯æ¶ˆè´¹SSEæµ" class="headerlink" title="å‰ç«¯æ¶ˆè´¹SSEæµ"></a>å‰ç«¯æ¶ˆè´¹SSEæµ</h4><p>å‰ç«¯ä¸æ–­å—åˆ°åç«¯çš„æ¶ˆæ¯ï¼Œå¦‚æœsuccessè¿”å›trueäº†ï¼Œå°±å…³é—­è¿æ¥ï¼Œå¦åˆ™å°±æ˜¾ç¤ºè¿›åº¦ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;common-container margin=<span class="string">"0 184px"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"content"</span>&gt;wxd&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button v-on:click="reverseMessage"&gt;è·å–æ¶ˆæ¯&lt;/</span>button&gt;</span><br><span class="line">    &lt;div style=<span class="string">"background: lightblue"</span>&gt;</span><br><span class="line">      &lt;ul&gt;&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">      &lt;loading v-if="true" /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>common-container&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: 'OneColForm',</span></span><br><span class="line"><span class="regexp">  data() &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;&#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  components: &#123;&#125;,</span></span><br><span class="line"><span class="regexp">  mounted() &#123;&#125;,</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    async reverseMessage() &#123;</span></span><br><span class="line"><span class="regexp">      if (window.EventSource == null) &#123;</span></span><br><span class="line"><span class="regexp">        alert('The browser does not support Server-Sent Events')</span></span><br><span class="line"><span class="regexp">      &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        var eventSource = new EventSource(</span></span><br><span class="line"><span class="regexp">          'http:/</span><span class="regexp">/localhost:8080/</span>sse/mvc/process<span class="string">'</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        var eventList = document.querySelector('</span>ul<span class="string">')</span></span><br><span class="line"><span class="string">        eventSource.onopen = function () &#123;</span></span><br><span class="line"><span class="string">          console.log('</span>connection is established<span class="string">')</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        eventSource.onerror = function (error) &#123;</span></span><br><span class="line"><span class="string">          console.log(</span></span><br><span class="line"><span class="string">            '</span>connection state: <span class="string">' + eventSource.readyState + '</span>, <span class="attr">error</span>: <span class="string">' + event</span></span><br><span class="line"><span class="string">          )</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        eventSource.onmessage = function (event) &#123;</span></span><br><span class="line"><span class="string">          var obj = JSON.parse(event.data)</span></span><br><span class="line"><span class="string">          console.log('</span>id: <span class="string">' + event.lastEventId + '</span>, <span class="attr">data</span>: <span class="string">' + event.data)</span></span><br><span class="line"><span class="string">          this.message = event.data</span></span><br><span class="line"><span class="string">          var newElement = document.createElement('</span>li<span class="string">')</span></span><br><span class="line"><span class="string">          var msg = obj.success ? obj.data : obj.msg</span></span><br><span class="line"><span class="string">          newElement.textContent = new Date() + '</span>æ”¶åˆ°æ¶ˆæ¯<span class="string">' + msg</span></span><br><span class="line"><span class="string">          eventList.appendChild(newElement)</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">          if (!!obj.success) &#123;</span></span><br><span class="line"><span class="string">            eventSource.close()</span></span><br><span class="line"><span class="string">            console.log('</span>connection is closed<span class="string">')</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&lt;style&gt;&lt;/style&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220627142227.png" border="1"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>Service Mesh æœåŠ¡ç½‘æ ¼</title>
    <url>/post/28775a98.html</url>
    <content><![CDATA[<blockquote><p>Service MeshæœåŠ¡ç½‘æ ¼ !</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯ServiceMesh"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯ServiceMesh" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ServiceMesh"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ServiceMesh</h3><p>Service Meshæ˜¯ç”¨äºå¤„ç†æœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç”¨äºåœ¨äº‘åŸç”Ÿåº”ç”¨å¤æ‚çš„æœåŠ¡æ‹“æ‰‘ä¸­å®ç°å¯é çš„è¯·æ±‚ä¼ é€’ã€‚åœ¨å®è·µä¸­ï¼ŒService Meshé€šå¸¸æ˜¯ä¸€ç»„ä¸åº”ç”¨ä¸€èµ·éƒ¨ç½²ï¼Œä½†å¯¹åº”ç”¨é€æ˜çš„è½»é‡çº§ç½‘ç»œä»£ç†ã€‚Service Meshä¸ä¼ ç»ŸåŸºç¡€è®¾æ–½å±‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå½¢æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„äº’è¿ä»£ç†ç½‘ç»œï¼Œä»¥Sidecarå½¢å¼éƒ¨ç½²åœ¨æœåŠ¡ä¸¤ä¾§ï¼ŒæœåŠ¡å¯¹äºä»£ç†æ— æ„ŸçŸ¥ï¼Œä¸”æœåŠ¡é—´æ‰€æœ‰é€šä¿¡éƒ½ç”±ä»£ç†è¿›è¡Œè·¯ç”±ã€‚</p><p>å¦‚æœç®€å•çš„æè¿°çš„è¯ï¼Œå¯ä»¥å°†å®ƒæ¯”ä½œæ˜¯åº”ç”¨ç¨‹åºæˆ–è€…è¯´å¾®æœåŠ¡é—´çš„ TCP/IPï¼Œè´Ÿè´£æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè°ƒç”¨ã€é™æµã€ç†”æ–­å’Œç›‘æ§ï¼Œå¦‚æœä½¿ç”¨ ServiceMesh ä¹Ÿå°±æ— é¡»å…³ç³»æœåŠ¡ä¹‹é—´çš„é‚£äº›åŸæ¥æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºæˆ–è€…å…¶ä»–æ¡†æ¶å®ç°çš„äº‹æƒ…ï¼Œæ¯”å¦‚ Spring Cloudã€OSSï¼Œç°åœ¨åªè¦äº¤ç»™ ServiceMesh å°±å¯ä»¥äº†ã€‚ServiceMeshçš„å‡ºç°ä¸»è¦æ˜¯ç”±äºåº”ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯çš„å‘å±•ï¼Œä¾‹å¦‚Kubernetes,Rainbondç­‰é¡¹ç›®ï¼Œå¤§å¤§é™ä½äº†åº”ç”¨çš„éƒ¨ç½²å’Œè¿ç»´å¤æ‚åº¦ã€‚</p><p>Service Mesh ä¸­æ–‡ç§°ä¸º æœåŠ¡ç½‘æ ¼ï¼Œä¸ºå•¥ï¼Œå› ä¸ºå®ƒçš„éƒ¨ç½²å›¾çœ‹èµ·æ¥å°±åƒä¸€ä¸ªç½‘æ ¼ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220418142746.jpg" alt=""></p><h3 id="äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ServiceMesh"><a href="#äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ServiceMesh" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ServiceMesh"></a>äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ServiceMesh</h3><p>åœ¨ä¼ ç»Ÿå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œéšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤§ï¼Œæ‹†åˆ†çš„æœåŠ¡å®ä¾‹ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œé‚£ä¹ˆå„ä¸ªæœåŠ¡ä¹‹é—´çš„ä¾èµ–å°±å˜æˆäº†éå¸¸å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œå¯èƒ½å°±ç±»ä¼¼äºè¿™æ ·äº†ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220418142832.jpg" alt=""></p><p>åœ¨å¦‚æ­¤å¤æ‚çš„åˆ†å¸ƒå¼éƒ¨ç½²ç»“æ„ä¸‹ï¼Œå’±ä»¬å¾®æœåŠ¡ä¸­æœåŠ¡ä¾èµ–è°ƒç”¨å’Œæ•°æ®ä¼ è¾“æ‰€é¢ä¸´çš„é—®é¢˜ä¹Ÿæˆå€å¢åŠ ï¼Œæå¤§çš„æé«˜äº†æœåŠ¡æ²»ç†çš„éš¾åº¦ã€‚</p><p>åŒæ—¶ï¼Œç”±äº å®¹å™¨åŒ–æŠ€æœ¯ çš„æˆç†Ÿå’Œè§„æ¨¡åŒ–ï¼Œå¾®æœåŠ¡éƒ½ä¼šé‡‡ç”¨å®¹å™¨åŒ–ï¼Œå¹¶æœç€ äº‘åŸç”Ÿåº”ç”¨ çš„æ–¹å‘å‘å±•ã€‚è€Œä¼ ç»Ÿçš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œè™½ç„¶ä¹Ÿæœ‰æœåŠ¡æ²»ç†çš„ç»„ä»¶ï¼Œä½†æ˜¯è¿™äº›ç»„ä»¶å¤§å¤šéœ€è¦åœ¨åº”ç”¨ä»£ç é‡Œè¿›è¡Œé›†æˆï¼Œè¿™æ˜¯ä¸ç¬¦åˆ äº‘åŸç”Ÿåº”ç”¨ çš„æ€æƒ³çš„ã€‚å› æ­¤ï¼Œå¤§å®¶æ€¥éœ€ä¸€ä¸ªæ ‡å‡†åŒ–ï¼Œèƒ½é«˜æ•ˆéƒ¨ç½²å’Œè¿ç»´çš„å¾®æœåŠ¡ä½“ç³»æ–¹æ¡ˆã€‚</p><p>å› æ­¤ï¼ŒService Mesh å°±å‡ºç°äº†ï¼ŒService Mesh å°±æ˜¯ç”¨æ¥è§£å†³è¿™äº›ç—›ç‚¹çš„ï¼Œè®¾è®¡çš„ç›®çš„å°±æ˜¯ç”¨æ¥è§£å†³å¾®æœåŠ¡æ¶æ„ä¸­ æœåŠ¡é—´å¯é è°ƒç”¨ã€æœåŠ¡æ²»ç† ç­‰é—®é¢˜ã€‚</p><p>ä¸‹é¢å°±æ‹¿ç¬¬ä¸€ä»£ Service Mesh äº§å“ Linkerd ä¸¾ä¾‹è¯´æ˜ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220418143015.jpg" alt=""></p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼ˆServiceï¼‰çš„éƒ¨ç½²éƒ½ä¼šåŒæ—¶éƒ¨ç½²ä¸€ä¸ª Linkerd å®ä¾‹ï¼Œå¹¶ä¸”æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å¹¶ä¸æ˜¯ç›´æ¥è¿›è¡Œçš„ï¼Œè€Œæ˜¯å…ˆç»è¿‡ Linkerd æ¨¡å—å»ä»£ç†è½¬å‘å®Œæˆçš„ã€‚</p><p>ä¾‹å¦‚ï¼šService A éœ€è¦è°ƒç”¨ Service B çš„æ—¶å€™ï¼ŒService A æ˜¯æŠŠè¯·æ±‚å‘ç»™ä¸å®ƒä¸€èµ·éƒ¨ç½²çš„ Linkerd-1 çš„ï¼Œç„¶åè¿™ä¸ª Linkerd-1 å°†è¯·æ±‚å‘ç»™ Service B æ‰€éƒ¨ç½²æ¨¡å—çš„ Linkerd-2ï¼Œç„¶å Linkerd-2 å†å°†è¯·æ±‚å†…å®¹è½¬å‘ç»™ Service B å¤„ç†ã€‚å› æ­¤ï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­ï¼ŒService A å’Œ Service B åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œæ— éœ€å…³æ³¨ä»»ä½•æœåŠ¡æ¡†æ¶çš„åŠŸèƒ½ï¼Œè¿™äº›æœåŠ¡æ¡†æ¶çš„åŠŸèƒ½éƒ½æ˜¯ç”±Linkerd å»å®ç°ï¼ŒLinkerd è¦åš è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€é™æµã€ç›‘æ§ç­‰ç­‰ã€‚</p><h3 id="ä¸‰ã€ServiceMeshåŸç†ä¸åº”ç”¨"><a href="#ä¸‰ã€ServiceMeshåŸç†ä¸åº”ç”¨" class="headerlink" title="ä¸‰ã€ServiceMeshåŸç†ä¸åº”ç”¨"></a>ä¸‰ã€ServiceMeshåŸç†ä¸åº”ç”¨</h3><p>Service Mesh çš„æ ¸å¿ƒå…¶å®å°±2ä¸ªæ¨¡å—ï¼š<strong>SideCar</strong> ä¸ <strong>Control Plane</strong>ï¼Œå¦‚å›¾ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220418143104.jpg" alt=""></p><p>ææ‡‚äº† SideCar ä¸ Control Plane ä¹Ÿå°±å¯¹ Service Mesh çš„åŸºç¡€æ€æƒ³åŸç†æ˜ç™½äº†ã€‚</p><h4 id="SideCar"><a href="#SideCar" class="headerlink" title="SideCar"></a>SideCar</h4><p>ä¸Šé¢è¯´åˆ°çš„ä¸æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·çš„è½»é‡çº§ç½‘ç»œä»£ç†ä¹Ÿå°±æ˜¯æŒ‡SideCarï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å®ç°æœåŠ¡æ¡†æ¶çš„å„é¡¹åŠŸèƒ½ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥è®©æœåŠ¡ï¼ˆService A æˆ– Service Bï¼‰å›å½’ä¸šåŠ¡æœ¬è´¨ã€‚</p><p>ä¼ ç»Ÿçš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„ç§æœåŠ¡æ¡†æ¶çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼šæœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€é™æµç†”æ–­ç­‰ï¼‰éƒ½ä»£ç é€»è¾‘æˆ–å¤šæˆ–å°‘çš„éƒ½éœ€è¦è€¦åˆåˆ°æœåŠ¡å®ä¾‹çš„ä»£ç é‡Œï¼Œç»™æœåŠ¡å®ä¾‹å¢åŠ äº†å¾ˆå¤šæ— å…³ä¸šåŠ¡çš„ä»£ç ï¼Œä¹Ÿå¸¦æ¥äº†å¤æ‚åº¦ã€‚</p><p>æœ‰äº†SideCarä¹‹åï¼ŒæœåŠ¡èŠ‚ç‚¹åªåšä¸šåŠ¡é€»è¾‘è‡ªèº«çš„åŠŸèƒ½ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨äº¤ç»™äº†SideCarï¼Œç”±SideCarå»æ³¨å†ŒæœåŠ¡ã€å»åšæœåŠ¡å‘ç°ã€å»åšè¯·æ±‚è·¯ç”±ã€å»å®ç°ç†”æ–­é™æµã€å»åšæ—¥å¿—ç»Ÿè®¡ã€‚</p><p>é‚£ä¹ˆåœ¨è¿™ç§æ–°çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ‰€æœ‰çš„ SideCar ç»„æˆåœ¨ä¸€èµ·ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæœåŠ¡ç½‘æ ¼äº†ã€‚é‚£ä¹ˆè¿™ä¸ªå¤§å‹çš„æœåŠ¡ç½‘æ ¼å¹¶ä¸æ˜¯å®Œå…¨è‡ªæ²»çš„ï¼Œå®ƒè¿˜éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ Control Planeã€‚</p><h4 id="Control-Plane"><a href="#Control-Plane" class="headerlink" title="Control Plane"></a>Control Plane</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220418143312.jpg" alt=""></p><p>Control Plane æ˜¯ç”¨æ¥ä»å…¨å±€çš„è§’åº¦ä¸Šæ§åˆ¶ SideCar çš„ã€‚æ¯”å¦‚ å®ƒè´Ÿè´£æ‰€æœ‰ SideCar çš„æ³¨å†Œï¼Œå®ƒå­˜å‚¨ä¸€ä¸ªç»Ÿä¸€çš„è·¯ç”±è¡¨ï¼Œå¸®åŠ©å„ä¸ª SideCar è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè¯·æ±‚è°ƒåº¦ã€‚å®ƒæ”¶é›†æ‰€æœ‰ SideCar çš„ç›‘æ§ä¿¡æ¯å’Œæ—¥å¿—æ•°æ®ã€‚å®ƒå°±ç›¸å½“äº Service Meshæ¶æ„ çš„å¤§è„‘ã€‚Control Plane æ§åˆ¶ç€ SideCar æ¥å®ç°æœåŠ¡æ²»ç†çš„å„é¡¹åŠŸèƒ½ã€‚</p><p>åœ¨æ–‡ç« çš„æœ€å¼€å§‹æåˆ°è¿‡ï¼Œä»¥ Linkerd ä¸ºä»£è¡¨çš„è¢«ç§°ä¸ºç¬¬ä¸€ä»£ Service Meshï¼Œè€Œä»¥ Istio ä¸ºä»£è¡¨çš„ç§°ä¸ºäº†ç¬¬äºŒä»£ Service Meshã€‚ä¸»è¦çš„ä¸åŒå°±æ˜¯ Istio å¼•å…¥äº† Control Plane çš„æ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡ Control Plane æ¥å¯¹æœåŠ¡è¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ï¼Œæ‰€ä»¥ Istio ä¹Ÿè¢«ç§°ä¸ºæ˜¯å®é™…ä¸Šçš„ Service Mesh æ ‡å‡†äº§å“ã€‚</p><h3 id="å››ã€ServiceMeshå¹³å°åŠŸèƒ½å¯¹æ¯”"><a href="#å››ã€ServiceMeshå¹³å°åŠŸèƒ½å¯¹æ¯”" class="headerlink" title="å››ã€ServiceMeshå¹³å°åŠŸèƒ½å¯¹æ¯”"></a>å››ã€ServiceMeshå¹³å°åŠŸèƒ½å¯¹æ¯”</h3><style>table th:first-of-type{width:80px}</style><table><thead><tr><th align="center">åŠŸèƒ½</th><th align="center">Linkerd</th><th align="center">Envoy</th><th align="center">Istio</th><th align="center">Conduit</th></tr></thead><tbody><tr><td align="center">ä»£ç†</td><td align="center">Finagle(scala) + Jetty(java)</td><td align="center">Envoy(c++)</td><td align="center">Envoy(c++)/Mosn(golang)</td><td align="center">Conduit(rust)</td></tr><tr><td align="center">ç†”æ–­</td><td align="center">æ”¯æŒï¼ŒåŸºäºè¿æ¥çš„ç†”æ–­å™¨Fast Failå’ŒåŸºäºè¯·æ±‚çš„ç†”æ–­å™¨Failure Accrual</td><td align="center">æ”¯æŒï¼Œé€šè¿‡ç‰¹å®šå‡†åˆ™ï¼Œå¦‚æœ€å¤§è¿æ¥æ•°ã€ æœ€å¤§è¯·æ±‚æ•°ã€æœ€å¤§æŒ‚èµ·è¯·æ±‚æ•°æˆ–è€…æœ€å¤§é‡è¯•æ•°çš„è®¾å®š</td><td align="center">æ”¯æŒï¼Œé€šè¿‡ç‰¹å®šå‡†åˆ™ï¼Œå¦‚æœ€å¤§è¿æ¥æ•°å’Œæœ€å¤§è¯·æ±‚æ•°ç­‰çš„è®¾å®š</td><td align="center">æš‚ä¸æ”¯æŒ</td></tr><tr><td align="center">åŠ¨æ€è·¯ç”±</td><td align="center">æ”¯æŒï¼Œé€šè¿‡è®¾ç½®Linkerdçš„dtabè§„åˆ™å®ç°ä¸åŒç‰ˆæœ¬æœåŠ¡è¯·æ±‚çš„åŠ¨æ€è·¯ç”±</td><td align="center">æ”¯æŒï¼Œé€šè¿‡æœåŠ¡çš„ç‰ˆæœ¬æˆ–ç¯å¢ƒä¿¡æ¯å®ç°</td><td align="center">æ”¯æŒï¼Œé€šè¿‡æœåŠ¡çš„ç‰ˆæœ¬æˆ–ç¯å¢ƒä¿¡æ¯å®ç°</td><td align="center">æš‚ä¸æ”¯æŒ</td></tr><tr><td align="center">æµé‡åˆ†æµ</td><td align="center">æ”¯æŒï¼Œä»¥å¢é‡å’Œå—æ§çš„æ–¹å¼å®ç°åˆ†æµ</td><td align="center">æ”¯æŒï¼Œä»¥å¢é‡å’Œå—æ§çš„æ–¹å¼å®ç°åˆ†æµ</td><td align="center">æ”¯æŒï¼Œä»¥å¢é‡å’Œå—æ§çš„æ–¹å¼å®ç°åˆ†æµ</td><td align="center">æš‚ä¸æ”¯æŒ</td></tr><tr><td align="center">æœåŠ¡å‘ç°</td><td align="center">æ”¯æŒï¼Œæ”¯æŒå¤šç§æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¦‚åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°ã€Consulã€Zookeeperã€Kubernetesç­‰</td><td align="center">æ”¯æŒï¼Œé€šè¿‡æä¾›å¹³å°æ— å…³çš„æœåŠ¡å‘ç°æ¥å£å®ç°ä¸ä¸åŒæœåŠ¡å‘ç°å·¥å…·é›†æˆ</td><td align="center">æ”¯æŒï¼Œé€šè¿‡æä¾›å¹³å°æ— å…³çš„æœåŠ¡å‘ç°æ¥å£å®ç°ä¸ä¸åŒæœåŠ¡å‘ç°å·¥å…·é›†æˆ</td><td align="center">åªæ”¯æŒKubernetes</td></tr><tr><td align="center">è´Ÿè½½å‡è¡¡</td><td align="center">æ”¯æŒï¼Œæä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•</td><td align="center">æ”¯æŒï¼Œæä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚Round Robinã€åŠ æƒæœ€å°è¯·æ±‚ã€å“ˆå¸Œç¯ã€Maglevç­‰</td><td align="center">æ”¯æŒï¼Œæä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚Round Robinã€åŠ æƒæœ€å°è¯·æ±‚ã€å“ˆå¸Œç¯ã€Maglevç­‰</td><td align="center">æ”¯æŒï¼Œå½“å‰åªæœ‰HTTPè¯·æ±‚æ”¯æŒåŸºäº P2C + least-loadedçš„è´Ÿè½½å‡è¡¡ç®—æ³•</td></tr><tr><td align="center">å®‰å…¨é€šä¿¡</td><td align="center">æ”¯æŒTLS</td><td align="center">æ”¯æŒTLS</td><td align="center">æ”¯æŒTLS</td><td align="center">æ”¯æŒTLS</td></tr><tr><td align="center">è®¿é—®æ§åˆ¶</td><td align="center">ä¸æ”¯æŒ</td><td align="center">ä¸æ”¯æŒ</td><td align="center">æ”¯æŒï¼ŒåŸºäºRBACçš„è®¿é—®æ§åˆ¶</td><td align="center">æš‚ä¸æ”¯æŒ</td></tr><tr><td align="center">å¯è§æ€§</td><td align="center">åˆ†å¸ƒå¼è¿½è¸ª(Zipkin)ã€è¿è¡Œæ—¶æŒ‡æ ‡(InfluxDBã€Prometheusã€statsd)</td><td align="center">åˆ†å¸ƒå¼è¿½è¸ª(Zipkin)ã€è¿è¡Œæ—¶æŒ‡æ ‡(statsd)</td><td align="center">åˆ†å¸ƒå¼è¿½è¸ª(Zipkin)ã€è¿è¡Œæ—¶æŒ‡æ ‡(Prometheusã€statsd)ã€ç›‘æ§(NewRepicã€Stackdriver)</td><td align="center">è¿è¡Œæ—¶æŒ‡æ ‡(Prometheus)</td></tr><tr><td align="center">éƒ¨ç½²æ¨¡å¼</td><td align="center">sidecaræˆ–è€…per-hostæ¨¡å¼</td><td align="center">sidecaræ¨¡å¼</td><td align="center">sidecaræ¨¡å¼</td><td align="center">sidecaræ¨¡å¼</td></tr><tr><td align="center">æ§åˆ¶å¹³é¢</td><td align="center">Namerd(scala)</td><td align="center">æ²¡æœ‰ï¼Œä½†å¯é€šè¿‡APIå®ç°(api)</td><td align="center">Pilotã€Mixerã€Citadel(golang)</td><td align="center">Conduit(golang)</td></tr><tr><td align="center">åè®®æ”¯æŒ</td><td align="center">HTTP/1.xã€HTTP/2ã€gRPC</td><td align="center">HTTP/1.xã€HTTP/2ã€gRPCã€TCP</td><td align="center">HTTP/1.xã€HTTP/2ã€gRPCã€TCP, dubbo(mosn)</td><td align="center">HTTP/1.xã€HTTP/2ã€gRPCã€TCP</td></tr><tr><td align="center">è¿è¡Œå¹³å°</td><td align="center">å¹³å°æ— å…³</td><td align="center">å¹³å°æ— å…³</td><td align="center">ç›®å‰æ”¯æŒKubernetesï¼Œå¹³å°æ— å…³æ˜¯æœ€ç»ˆå®ç°ç›®æ ‡</td><td align="center">åªæ”¯æŒKubernetes</td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>middleware</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æå‡ Spring Boot ååé‡ç¥æŠ€ï¼</title>
    <url>/post/65e82e4.html</url>
    <content><![CDATA[<blockquote><p>æå‡Spring Bootååé‡ç¥æŠ€ ~</p></blockquote><a id="more"></a><h4 id="ä¸€ã€å¼‚æ­¥æ‰§è¡Œ"><a href="#ä¸€ã€å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="ä¸€ã€å¼‚æ­¥æ‰§è¡Œ"></a>ä¸€ã€å¼‚æ­¥æ‰§è¡Œ</h4><h5 id="æ³¨è§£æ–¹å¼å’ŒFutureç±»"><a href="#æ³¨è§£æ–¹å¼å’ŒFutureç±»" class="headerlink" title="æ³¨è§£æ–¹å¼å’ŒFutureç±»"></a>æ³¨è§£æ–¹å¼å’ŒFutureç±»</h5><p>ä½¿ç”¨å¼‚æ­¥æ³¨è§£<code>@aysnc</code>ã€<code>å¯åŠ¨ç±»ï¼šæ·»åŠ @EnableAsyncæ³¨è§£</code></p><p>JDK 8æœ¬èº«æœ‰ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Futureç±»â€”â€”<code>CompletableFuture</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AskThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CompletableFuture&lt;Integer&gt; re = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> myRe = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            myRe = re.get() * re.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(myRe);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> CompletableFuture&lt;Integer&gt; future = <span class="keyword">new</span> CompletableFuture&lt;&gt;();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> AskThread(future)).start();</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿé•¿æ—¶é—´çš„è®¡ç®—è¿‡ç¨‹</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//å‘ŠçŸ¥å®Œæˆç»“æœ</span></span><br><span class="line">        future.complete(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚æ­¥è°ƒç”¨-Deferred"><a href="#å¼‚æ­¥è°ƒç”¨-Deferred" class="headerlink" title="å¼‚æ­¥è°ƒç”¨ Deferred"></a>å¼‚æ­¥è°ƒç”¨ Deferred</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncDeferredController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LongTimeTask taskService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AsyncDeferredController</span><span class="params">(LongTimeTask taskService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.taskService = taskService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/deferred"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DeferredResult&lt;String&gt; <span class="title">executeSlowTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(Thread.currentThread().getName() + <span class="string">"è¿›å…¥executeSlowTaskæ–¹æ³•"</span>);</span><br><span class="line">        DeferredResult&lt;String&gt; deferredResult = <span class="keyword">new</span> DeferredResult&lt;&gt;();</span><br><span class="line">        <span class="comment">// è°ƒç”¨é•¿æ—¶é—´æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        taskService.execute(deferredResult);</span><br><span class="line">        <span class="comment">// å½“é•¿æ—¶é—´ä»»åŠ¡ä¸­ä½¿ç”¨deferred.setResult("world");è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šä»é•¿æ—¶é—´ä»»åŠ¡ä¸­è¿”å›ï¼Œç»§ç»­controlleré‡Œé¢çš„æµç¨‹</span></span><br><span class="line">        logger.info(Thread.currentThread().getName() + <span class="string">"ä»executeSlowTaskæ–¹æ³•è¿”å›"</span>);</span><br><span class="line">        <span class="comment">// è¶…æ—¶çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">        deferredResult.onTimeout(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" onTimeout"</span>);</span><br><span class="line">				<span class="comment">// è¿”å›è¶…æ—¶ä¿¡æ¯</span></span><br><span class="line">				deferredResult.setErrorResult(<span class="string">"time out!"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†å®Œæˆçš„å›è°ƒæ–¹æ³•ï¼Œæ— è®ºæ˜¯è¶…æ—¶è¿˜æ˜¯å¤„ç†æˆåŠŸï¼Œéƒ½ä¼šè¿›å…¥è¿™ä¸ªå›è°ƒæ–¹æ³•</span></span><br><span class="line">        deferredResult.onCompletion(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">		</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" onCompletion"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> deferredResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚æ­¥è°ƒç”¨-WebAsyncTask"><a href="#å¼‚æ­¥è°ƒç”¨-WebAsyncTask" class="headerlink" title="å¼‚æ­¥è°ƒç”¨ WebAsyncTask"></a>å¼‚æ­¥è°ƒç”¨ WebAsyncTask</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HelloController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> HelloService hello;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¸¦è¶…æ—¶æ—¶é—´çš„å¼‚æ­¥è¯·æ±‚ é€šè¿‡WebAsyncTaskè‡ªå®šä¹‰å®¢æˆ·ç«¯è¶…æ—¶é—´</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/world"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> WebAsyncTask&lt;String&gt; <span class="title">worldController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥helloControlleræ–¹æ³•"</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="comment">// 3sé’Ÿæ²¡è¿”å›ï¼Œåˆ™è®¤ä¸ºè¶…æ—¶</span></span><br><span class="line">		WebAsyncTask&lt;String&gt; webAsyncTask = <span class="keyword">new</span> WebAsyncTask&lt;&gt;(<span class="number">3000</span>, <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"> </span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥callæ–¹æ³•"</span>);</span><br><span class="line">				String say = hello.sayHello();</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" ä»helloServiceæ–¹æ³•è¿”å›"</span>);</span><br><span class="line">				<span class="keyword">return</span> say;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" ä»helloControlleræ–¹æ³•è¿”å›"</span>);</span><br><span class="line"> </span><br><span class="line">		webAsyncTask.onCompletion(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"> </span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"> </span><br><span class="line">		webAsyncTask.onTimeout(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"> </span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" onTimeout"</span>);</span><br><span class="line">				<span class="comment">// è¶…æ—¶çš„æ—¶å€™ï¼Œç›´æ¥æŠ›å¼‚å¸¸ï¼Œè®©å¤–å±‚ç»Ÿä¸€å¤„ç†è¶…æ—¶å¼‚å¸¸</span></span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException(<span class="string">"è°ƒç”¨è¶…æ—¶"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="keyword">return</span> webAsyncTask;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¼‚æ­¥è°ƒç”¨ï¼Œå¼‚å¸¸å¤„ç†ï¼Œè¯¦ç»†çš„å¤„ç†æµç¨‹è§MyExceptionHandlerç±»</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/exception"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> WebAsyncTask&lt;String&gt; <span class="title">exceptionController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥helloControlleræ–¹æ³•"</span>);</span><br><span class="line">		Callable&lt;String&gt; callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"> </span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥callæ–¹æ³•"</span>);</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException(<span class="string">"è°ƒç”¨è¶…æ—¶!"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" ä»helloControlleræ–¹æ³•è¿”å›"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> WebAsyncTask&lt;&gt;(<span class="number">20000</span>, callable);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚æ­¥è°ƒç”¨-Callable"><a href="#å¼‚æ­¥è°ƒç”¨-Callable" class="headerlink" title="å¼‚æ­¥è°ƒç”¨ Callable"></a>å¼‚æ­¥è°ƒç”¨ Callable</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HelloController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> HelloService hello;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/helloworld"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">helloWorldController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> hello.sayHello();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¼‚æ­¥è°ƒç”¨restful</span></span><br><span class="line"><span class="comment">	 * å½“controllerè¿”å›å€¼æ˜¯Callableçš„æ—¶å€™ï¼Œspringmvcå°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å°†Callableäº¤ç»™TaskExecutorå»å¤„ç†</span></span><br><span class="line"><span class="comment">	 * ç„¶åDispatcherServletè¿˜æœ‰æ‰€æœ‰çš„springæ‹¦æˆªå™¨éƒ½é€€å‡ºä¸»çº¿ç¨‹ï¼Œç„¶åæŠŠresponseä¿æŒæ‰“å¼€çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">	 * å½“Callableæ‰§è¡Œç»“æŸä¹‹åï¼Œspringmvcå°±ä¼šé‡æ–°å¯åŠ¨åˆ†é…ä¸€ä¸ªrequestè¯·æ±‚ï¼Œç„¶åDispatcherServletå°±é‡æ–°</span></span><br><span class="line"><span class="comment">	 * è°ƒç”¨å’Œå¤„ç†Callableå¼‚æ­¥æ‰§è¡Œçš„è¿”å›ç»“æœï¼Œ ç„¶åè¿”å›è§†å›¾</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Callable&lt;String&gt; <span class="title">helloController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥helloControlleræ–¹æ³•"</span>);</span><br><span class="line">		Callable&lt;String&gt; callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"> </span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥callæ–¹æ³•"</span>);</span><br><span class="line">				String say = hello.sayHello();</span><br><span class="line">				logger.info(Thread.currentThread().getName() + <span class="string">" ä»helloServiceæ–¹æ³•è¿”å›"</span>);</span><br><span class="line">				<span class="keyword">return</span> say;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" ä»helloControlleræ–¹æ³•è¿”å›"</span>);</span><br><span class="line">		<span class="keyword">return</span> callable;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒã€å¢åŠ å†…åµŒTomcatçš„æœ€å¤§è¿æ¥æ•°"><a href="#äºŒã€å¢åŠ å†…åµŒTomcatçš„æœ€å¤§è¿æ¥æ•°" class="headerlink" title="äºŒã€å¢åŠ å†…åµŒTomcatçš„æœ€å¤§è¿æ¥æ•°"></a>äºŒã€å¢åŠ å†…åµŒTomcatçš„æœ€å¤§è¿æ¥æ•°</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurableServletWebServerFactory <span class="title">webServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TomcatServletWebServerFactory tomcatFactory = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">        tomcatFactory.addConnectorCustomizers(<span class="keyword">new</span> MyTomcatConnectorCustomizer());</span><br><span class="line">        tomcatFactory.setPort(<span class="number">8005</span>);</span><br><span class="line">        tomcatFactory.setContextPath(<span class="string">"/api-g"</span>);</span><br><span class="line">        <span class="keyword">return</span> tomcatFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyTomcatConnectorCustomizer</span> <span class="keyword">implements</span> <span class="title">TomcatConnectorCustomizer</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Connector connector)</span> </span>&#123;</span><br><span class="line">            Http11NioProtocol protocol = (Http11NioProtocol) connector.getProtocolHandler();</span><br><span class="line">            <span class="comment">//è®¾ç½®æœ€å¤§è¿æ¥æ•°               </span></span><br><span class="line">            protocol.setMaxConnections(<span class="number">20000</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°               </span></span><br><span class="line">            protocol.setMaxThreads(<span class="number">2000</span>);</span><br><span class="line">            protocol.setConnectionTimeout(<span class="number">30000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸‰ã€ä½¿ç”¨-ComponentScan-å®šä½æ‰«åŒ…æ¯”-SpringBootApplicationæ‰«åŒ…æ›´å¿«"><a href="#ä¸‰ã€ä½¿ç”¨-ComponentScan-å®šä½æ‰«åŒ…æ¯”-SpringBootApplicationæ‰«åŒ…æ›´å¿«" class="headerlink" title="ä¸‰ã€ä½¿ç”¨@ComponentScan()å®šä½æ‰«åŒ…æ¯”@SpringBootApplicationæ‰«åŒ…æ›´å¿«"></a>ä¸‰ã€ä½¿ç”¨@ComponentScan()å®šä½æ‰«åŒ…æ¯”@SpringBootApplicationæ‰«åŒ…æ›´å¿«</h4><h4 id="å››ã€é»˜è®¤tomcatå®¹å™¨æ”¹ä¸ºUndertowï¼ˆJbossä¸‹çš„æœåŠ¡å™¨ï¼ŒTomcatååé‡5000ï¼ŒUndertowååé‡8000ï¼‰"><a href="#å››ã€é»˜è®¤tomcatå®¹å™¨æ”¹ä¸ºUndertowï¼ˆJbossä¸‹çš„æœåŠ¡å™¨ï¼ŒTomcatååé‡5000ï¼ŒUndertowååé‡8000ï¼‰" class="headerlink" title="å››ã€é»˜è®¤tomcatå®¹å™¨æ”¹ä¸ºUndertowï¼ˆJbossä¸‹çš„æœåŠ¡å™¨ï¼ŒTomcatååé‡5000ï¼ŒUndertowååé‡8000ï¼‰"></a>å››ã€é»˜è®¤tomcatå®¹å™¨æ”¹ä¸ºUndertowï¼ˆJbossä¸‹çš„æœåŠ¡å™¨ï¼ŒTomcat<a href="https://so.csdn.net/so/search?q=ååé‡&spm=1001.2101.3001.7020" target="_blank" rel="noopener">ååé‡</a>5000ï¼ŒUndertowååé‡8000ï¼‰</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ”¹æˆ</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="äº”ã€ä½¿ç”¨-BufferedWriter-è¿›è¡Œç¼“å†²"><a href="#äº”ã€ä½¿ç”¨-BufferedWriter-è¿›è¡Œç¼“å†²" class="headerlink" title="äº”ã€ä½¿ç”¨ BufferedWriter è¿›è¡Œç¼“å†²"></a>äº”ã€ä½¿ç”¨ BufferedWriter è¿›è¡Œç¼“å†²</h4><h4 id="å…­ã€å¼‚æ­¥è°ƒç”¨å¯ä»¥ä½¿ç”¨AsyncHandlerInterceptorè¿›è¡Œæ‹¦æˆª"><a href="#å…­ã€å¼‚æ­¥è°ƒç”¨å¯ä»¥ä½¿ç”¨AsyncHandlerInterceptorè¿›è¡Œæ‹¦æˆª" class="headerlink" title="å…­ã€å¼‚æ­¥è°ƒç”¨å¯ä»¥ä½¿ç”¨AsyncHandlerInterceptorè¿›è¡Œæ‹¦æˆª"></a>å…­ã€å¼‚æ­¥è°ƒç”¨å¯ä»¥ä½¿ç”¨AsyncHandlerInterceptorè¿›è¡Œæ‹¦æˆª</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAsyncHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">AsyncHandlerInterceptor</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MyAsyncHandlerInterceptor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">			ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//		HandlerMethod handlerMethod = (HandlerMethod) handler;</span></span><br><span class="line">		logger.info(Thread.currentThread().getName()+ <span class="string">"æœåŠ¡è°ƒç”¨å®Œæˆï¼Œè¿”å›ç»“æœç»™å®¢æˆ·ç«¯"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> != ex)&#123;</span><br><span class="line">			System.out.println(<span class="string">"å‘ç”Ÿå¼‚å¸¸:"</span>+ex.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConcurrentHandlingStarted</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// æ‹¦æˆªä¹‹åï¼Œé‡æ–°å†™å›æ•°æ®ï¼Œå°†åŸæ¥çš„hello worldæ¢æˆå¦‚ä¸‹å­—ç¬¦ä¸²</span></span><br><span class="line">		String resp = <span class="string">"my name is chhliu!"</span>;</span><br><span class="line">		response.setContentLength(resp.length());</span><br><span class="line">		response.getOutputStream().write(resp.getBytes());</span><br><span class="line">		</span><br><span class="line">		logger.info(Thread.currentThread().getName() + <span class="string">" è¿›å…¥afterConcurrentHandlingStartedæ–¹æ³•"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>HashMapçš„è´Ÿè½½å› å­åˆå§‹å€¼ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Ÿ</title>
    <url>/post/fb9b2f80.html</url>
    <content><![CDATA[<blockquote><p>HashMapçš„è´Ÿè½½å› å­åˆå§‹å€¼ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Œæ€»ç»“ä¸€ä¸‹å§ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€è´Ÿè½½å› å­çš„ä½œç”¨"><a href="#ä¸€ã€è´Ÿè½½å› å­çš„ä½œç”¨" class="headerlink" title="ä¸€ã€è´Ÿè½½å› å­çš„ä½œç”¨"></a>ä¸€ã€è´Ÿè½½å› å­çš„ä½œç”¨</h3><p>è´Ÿè½½å› å­æ˜¯å’Œæ‰©å®¹æœºåˆ¶æœ‰å…³çš„ï¼Œæ„æ€æ˜¯å¦‚æœå½“å‰å®¹å™¨çš„å®¹é‡ï¼Œè¾¾åˆ°äº†æˆ‘ä»¬è®¾å®šçš„æœ€å¤§å€¼ï¼Œå°±è¦å¼€å§‹æ‰§è¡Œæ‰©å®¹æ“ä½œã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªæ‰©å®¹æœºåˆ¶çš„é˜ˆå€¼ã€‚å½“è¶…è¿‡äº†è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚</p><blockquote><p>æ¯”å¦‚è¯´å½“å‰çš„å®¹å™¨å®¹é‡æ˜¯16ï¼Œè´Ÿè½½å› å­æ˜¯0.75,16*0.75=12ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å®¹é‡è¾¾åˆ°äº†12çš„æ—¶å€™å°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br></pre></td></tr></table></figure><p>ç¿»çœ‹HashMapçš„æºç å¯ä»¥çœ‹å‡ºï¼Œç³»ç»Ÿé»˜è®¤çš„è´Ÿè½½å› å­å€¼å°±æ˜¯0.75ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­å»æŒ‡å®šã€‚</p><h3 id="äºŒã€åŸå› è§£é‡Š"><a href="#äºŒã€åŸå› è§£é‡Š" class="headerlink" title="äºŒã€åŸå› è§£é‡Š"></a>äºŒã€åŸå› è§£é‡Š</h3><h4 id="1ã€è´Ÿè½½å› å­æ˜¯1-0"><a href="#1ã€è´Ÿè½½å› å­æ˜¯1-0" class="headerlink" title="1ã€è´Ÿè½½å› å­æ˜¯1.0"></a><strong>1ã€è´Ÿè½½å› å­æ˜¯1.0</strong></h4><p>æˆ‘ä»¬å…ˆçœ‹HashMapçš„åº•å±‚æ•°æ®ç»“æ„</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220407162656.png" alt=""></p><p>æˆ‘ä»¬çš„æ•°æ®ä¸€å¼€å§‹æ˜¯ä¿å­˜åœ¨æ•°ç»„é‡Œé¢çš„ï¼Œå½“å‘ç”Ÿäº†Hashç¢°æ’çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šï¼Œç”Ÿå‡ºä¸€ä¸ªé“¾è¡¨ï¼Œå½“é“¾è¡¨é•¿åº¦è¾¾åˆ°ä¸€å®šé•¿åº¦çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠé“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</p><p><strong>å½“è´Ÿè½½å› å­æ˜¯1.0çš„æ—¶å€™ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œåªæœ‰å½“æ•°ç»„çš„8ä¸ªå€¼ï¼ˆè¿™ä¸ªå›¾è¡¨ç¤ºäº†8ä¸ªï¼‰å…¨éƒ¨å¡«å……äº†ï¼Œæ‰ä¼šå‘ç”Ÿæ‰©å®¹ã€‚è¿™å°±å¸¦æ¥äº†å¾ˆå¤§çš„é—®é¢˜ï¼Œå› ä¸ºHashå†²çªæ—¶é¿å…ä¸äº†çš„ã€‚å½“è´Ÿè½½å› å­æ˜¯1.0çš„æ—¶å€™ï¼Œæ„å‘³ç€ä¼šå‡ºç°å¤§é‡çš„Hashçš„å†²çªï¼Œåº•å±‚çš„çº¢é»‘æ ‘å˜å¾—å¼‚å¸¸å¤æ‚ã€‚å¯¹äºæŸ¥è¯¢æ•ˆç‡æå…¶ä¸åˆ©ã€‚è¿™ç§æƒ…å†µå°±æ˜¯ç‰ºç‰²äº†æ—¶é—´æ¥ä¿è¯ç©ºé—´çš„åˆ©ç”¨ç‡ã€‚</strong></p><p><em>ä¸€å¥è¯æ€»ç»“å°±æ˜¯è´Ÿè½½å› å­è¿‡å¤§ï¼Œè™½ç„¶ç©ºé—´åˆ©ç”¨ç‡ä¸Šå»äº†ï¼Œä½†æ˜¯æ—¶é—´æ•ˆç‡é™ä½äº†ã€‚</em></p><h4 id="2ã€è´Ÿè½½å› å­æ˜¯0-5"><a href="#2ã€è´Ÿè½½å› å­æ˜¯0-5" class="headerlink" title="2ã€è´Ÿè½½å› å­æ˜¯0.5"></a><strong>2ã€è´Ÿè½½å› å­æ˜¯0.5</strong></h4><p>è´Ÿè½½å› å­æ˜¯0.5çš„æ—¶å€™ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå½“æ•°ç»„ä¸­çš„å…ƒç´ è¾¾åˆ°äº†ä¸€åŠå°±å¼€å§‹æ‰©å®¹ï¼Œæ—¢ç„¶å¡«å……çš„å…ƒç´ å°‘äº†ï¼ŒHashå†²çªä¹Ÿä¼šå‡å°‘ï¼Œé‚£ä¹ˆåº•å±‚çš„é“¾è¡¨é•¿åº¦æˆ–è€…æ˜¯çº¢é»‘æ ‘çš„é«˜åº¦å°±ä¼šé™ä½ã€‚æŸ¥è¯¢æ•ˆç‡å°±ä¼šå¢åŠ ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ—¶å€™ç©ºé—´åˆ©ç”¨ç‡å°±ä¼šå¤§å¤§çš„é™ä½ï¼ŒåŸæœ¬å­˜å‚¨1Mçš„æ•°æ®ï¼Œç°åœ¨å°±æ„å‘³ç€éœ€è¦2Mçš„ç©ºé—´ã€‚</p><p><em>ä¸€å¥è¯æ€»ç»“å°±æ˜¯è´Ÿè½½å› å­å¤ªå°ï¼Œè™½ç„¶æ—¶é—´æ•ˆç‡æå‡äº†ï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡é™ä½äº†ã€‚</em></p><h4 id="3ã€è´Ÿè½½å› å­0-75"><a href="#3ã€è´Ÿè½½å› å­0-75" class="headerlink" title="3ã€è´Ÿè½½å› å­0.75"></a><strong>3ã€è´Ÿè½½å› å­0.75</strong></h4><p>ç»è¿‡å‰é¢çš„åˆ†æï¼ŒåŸºæœ¬ä¸Šä¸ºä»€ä¹ˆæ˜¯0.75çš„ç­”æ¡ˆä¹Ÿå°±å‡ºæ¥äº†ï¼Œè¿™æ˜¯æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡ã€‚å½“ç„¶è¿™ä¸ªç­”æ¡ˆä¸æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„ã€‚ç­”æ¡ˆå°±åœ¨æºç ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* &lt;p&gt;As a general rule, the default load factor (.75) offers a good</span></span><br><span class="line"><span class="comment">* tradeoff between time and space costs.  Higher values decrease the</span></span><br><span class="line"><span class="comment">* space overhead but increase the lookup cost (reflected in most of</span></span><br><span class="line"><span class="comment">* the operations of the &lt;tt&gt;HashMap&lt;/tt&gt; class, including</span></span><br><span class="line"><span class="comment">* &lt;tt&gt;get&lt;/tt&gt; and &lt;tt&gt;put&lt;/tt&gt;).  The expected number of entries in</span></span><br><span class="line"><span class="comment">* the map and its load factor should be taken into account when</span></span><br><span class="line"><span class="comment">* setting its initial capacity, so as to minimize the number of</span></span><br><span class="line"><span class="comment">* rehash operations.  If the initial capacity is greater than the</span></span><br><span class="line"><span class="comment">* maximum number of entries divided by the load factor, no rehash</span></span><br><span class="line"><span class="comment">* operations will ever occur.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯è¯´è´Ÿè½½å› å­æ˜¯0.75çš„æ—¶å€™ï¼Œç©ºé—´åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œè€Œä¸”é¿å…äº†ç›¸å½“å¤šçš„Hashå†²çªï¼Œä½¿å¾—åº•å±‚çš„é“¾è¡¨æˆ–è€…æ˜¯çº¢é»‘æ ‘çš„é«˜åº¦æ¯”è¾ƒä½ï¼Œæå‡äº†ç©ºé—´æ•ˆç‡ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Container</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§æ•°æ®ä¸­é—´ä»¶ç”Ÿæ€ç³»åˆ—</title>
    <url>/post/e6be6b16.html</url>
    <content><![CDATA[<blockquote><p>å¤§æ•°æ®ä¸­é—´ä»¶ç”Ÿæ€ç³»åˆ— ~</p></blockquote><a id="more"></a><blockquote class="pullquote mindmap mindmap-lg"><ul><li>å¤§æ•°æ®æ¡†æ¶<ul><li>Hadoop<ul><li>ä¸€ä¸ªåˆ†å¸ƒå¼å¹¶è¡Œè®¡ç®—æ¡†æ¶</li><li>æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯ï¼šMapReduceå’ŒHDFS</li><li>MapReduceæ˜¯Googleæå‡ºçš„ä¸€ä¸ªè½¯ä»¶æ¶æ„ï¼Œç”¨äºå¤§è§„æ¨¡æ•°æ®é›†ï¼ˆå¤§äº1TBï¼‰çš„å¹¶è¡Œè¿ç®—ã€‚æ¦‚å¿µâ€Mapï¼ˆæ˜ å°„ï¼‰â€å’Œâ€Reduceï¼ˆåŒ–ç®€ï¼‰â€</li><li>Map(æ˜ å°„)å’Œreduce(åŒ–ç®€)æ˜¯åˆ†å¼€å¤„ç†çš„ï¼Œmapæ˜¯å°†ä¸€ä¸ªä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªä»»åŠ¡æ‰§è¡Œï¼Œreduceæ˜¯å°†å¤šä¸ªä»»åŠ¡æ±‡æ€»èµ·æ¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚æŠŠä¸€ä¸ªlistæ‹†è§£ä¸ºå¤šä¸ªæ”¾åˆ°çº¿ç¨‹æ± ä¸­å¯åŠ¨å¤šä¸ªçº¿ç¨‹è®¡ç®—listä¸­å€¼ï¼Œç„¶åæŠŠå¤šä¸ªä»»åŠ¡è¿”å›çš„ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªæ€»çš„ç»“æœå…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„MapReduceçš„åº”ç”¨</li></ul></li><li>æ—¥å¿—æ”¶é›†æ¡†æ¶<ul><li>Flume</li><li>ElasticSearch</li><li>Logstash</li><li>Kibana</li></ul></li><li>åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ<ul><li>Hadoop HDFS<ul><li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œè´Ÿè´£åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨</li></ul></li><li>KFS</li><li>GFS<ul><li>æ”¯æŒç»“æ„åŒ–ã€åŠç»“æ„å’Œéç»“æ„åŒ–æ•°æ®çš„å­˜å‚¨ï¼Œå¹¶é€šè¿‡å¢åŠ æœºå™¨è¿›è¡Œæ¨ªå‘æ‰©å±•</li></ul></li></ul></li><li>æ•°æ®åº“ç³»ç»Ÿ<ul><li>Hive</li><li>Mongodb</li><li>TIDB<ul><li><a href="https://zhuanlan.zhihu.com/p/409413038" target="_blank" rel="noopener">TiDB</a></li><li>TiDB æ˜¯ PingCAP å…¬å¸åŸºäº Google Spanner / F1 è®ºæ–‡å®ç°çš„å¼€æºåˆ†å¸ƒå¼ NewSQL æ•°æ®åº“</li><li>SQLæ”¯æŒ ï¼ˆTiDB æ˜¯ MySQL å…¼å®¹çš„ï¼‰</li><li>æ°´å¹³çº¿æ€§å¼¹æ€§æ‰©å±•</li><li>åˆ†å¸ƒå¼äº‹åŠ¡</li><li>æ•…éšœè‡ªæ¢å¤çš„é«˜å¯ç”¨</li><li>è·¨æ•°æ®ä¸­å¿ƒæ•°æ®å¼ºä¸€è‡´æ€§ä¿è¯</li></ul></li><li>PreSto<ul><li>Facebookå¼€æºçš„ï¼Œå®Œå…¨åŸºäºå†…å­˜çš„å¹¶â¾è®¡ç®—ï¼Œåˆ†å¸ƒå¼SQLäº¤äº’å¼æŸ¥è¯¢å¼•æ“</li><li>ä¸€ç§Massively parallel processing (MPP)æ¶æ„ï¼Œå¤šä¸ªèŠ‚ç‚¹ç®¡é“å¼æ‰§â¾</li><li>â½€æŒä»»æ„æ•°æ®æºï¼ˆé€šè¿‡æ‰©å±•å¼Connectorç»„ä»¶ï¼‰</li><li>æ•°æ®è§„æ¨¡GB~PBçº§</li></ul></li><li>HBase<ul><li>åˆ—å¼æ•°æ®åº“ï¼Œéå…³ç³»å‹åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæ”¯æŒéšæœºè¯»å†™å’Œå®æ—¶åº”ç”¨,HDFSæ˜¯åšé¡ºåºè¯»å†™çš„ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å¾ˆå¤šéœ€è¦éšæœºè¯»å†™ï¼Œå°±ç”±HBaseå®Œæˆ</li><li><a href="https://blog.csdn.net/m0_55868614/article/details/121147275" target="_blank" rel="noopener">Hiveä¸HBaseä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»</a></li></ul></li></ul></li><li>åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼š<ul><li>Hadoop MapReduce<ul><li>åˆ†å¸ƒå¼å¹¶è¡Œç¼–ç¨‹æ¡†æ¶,ç£ç›˜è®¡ç®—æ¡†æ¶,ç¦»çº¿è®¡ç®—æ¡†æ¶</li><li>ä¸»è¦é€‚ç”¨äºå¤§æ‰¹é‡çš„é›†ç¾¤ä»»åŠ¡ï¼Œç”±äºæ˜¯æ‰¹é‡æ‰§è¡Œï¼Œæ•…æ—¶æ•ˆæ€§åä½</li></ul></li><li>Storm<ul><li>æµå¼è®¡ç®—æ¡†æ¶</li></ul></li><li>Spark<ul><li>æ˜¯ä¸“ä¸ºå¤§è§„æ¨¡æ•°æ®å¤„ç†è€Œè®¾è®¡çš„å¿«é€Ÿé€šç”¨çš„è®¡ç®—å¼•æ“ï¼Œå…¶æ˜¯åŸºäºå†…å­˜çš„è®¡ç®—æ¡†æ¶</li><li>Sparkæ˜¯åŸºäºæ•°æ®ç‰‡é›†åˆï¼ˆRDDï¼‰è¿›è¡Œå°æ‰¹é‡å¤„ç†çš„</li><li>åªèƒ½æ”¯æŒç§’çº§è®¡ç®—</li></ul></li><li>Flinkï¼ˆä¸»æµï¼‰<ul><li>ä¸€ä¸ªé¢å‘æ•°æ®æµå¤„ç†å’Œæ‰¹é‡æ•°æ®å¤„ç†çš„å¯åˆ†å¸ƒå¼çš„å¼€æºè®¡ç®—æ¡†æ¶</li><li>FlinkåŸºäºæ¯ä¸ªäº‹ä»¶ä¸€è¡Œä¸€è¡Œåœ°æµå¼å¤„ç†ï¼Œæ˜¯çœŸæ­£çš„æµå¼è®¡ç®—</li><li>åŸºäºåŒä¸€ä¸ªFlinkæµå¼æ‰§è¡Œæ¨¡å‹ï¼Œèƒ½å¤Ÿæ”¯æŒæµå¤„ç†å’Œæ‰¹å¤„ç†ä¸¤ç§åº”ç”¨ç±»å‹</li><li>æ”¯æŒæ¯«ç§’çº§è®¡ç®—</li></ul></li><li><a href="https://www.cnblogs.com/eetv/p/13584557.html" target="_blank" rel="noopener">åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶æ¡†æ¶å¯¹æ¯”</a></li></ul></li><li>æŸ¥è¯¢åˆ†ææ¡†æ¶<ul><li>Hive<ul><li>æ˜¯æ•°æ®ä»“åº“ï¼Œæ˜¯æ¶æ„åœ¨MapReduceä¹‹ä¸Šï¼ŒSQLä¼šè¢«è½¬åŒ–ä¸ºä¸€å †çš„MapReduceä½œä¸šå†å»æ‰§è¡Œ</li></ul></li><li>Pig<ul><li>Pigæ˜¯ä¸€ä¸ªApacheé¡¹ç›®ï¼Œä¸ºæ–‡æœ¬å¤„ç†æä¾›é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥å°†æ–‡æœ¬å¤„ç†å‘½ä»¤è½¬æ¢æˆHadoopçš„MapReduceä½œä¸š</li></ul></li><li>Phoenix<ul><li>Phoenixæ˜¯æ„å»ºåœ¨HBaseä¸Šçš„ä¸€ä¸ªSQLå±‚ï¼Œèƒ½è®©æˆ‘ä»¬ç”¨æ ‡æ¤çš„JDBC APIsè€Œä¸æ˜¯HBaseå®¢æˆ·ç«¯APIsæ¥åˆ›å»ºè¡¨ï¼Œæ’å…¥æ•°æ®å’Œå¯¹HBaseæ•°æ®è¿›ç¨‹æŸ¥è¯¢</li><li>Phoenixå®Œå…¨ä½¿ç”¨javaç¼–å†™ï¼Œä½œä¸ºHBaseå†…åµŒçš„JDBCé©±åŠ¨ï¼ŒPhoenixæŸ¥è¯¢å¼•æ“ä¼šå°†SQLæŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªHBaseæ‰«æï¼ˆScanï¼‰ï¼Œå¹¶ç¼–æ’æ‰§è¡Œä»¥ç”Ÿæˆæ ‡æ¤çš„JDBCç»“æœé›†ï¼›</li><li>ç›´æ¥ä½¿ç”¨HBase APIååŒå¤„ç†å™¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå¯¹äºç®€å•æŸ¥è¯¢æ¥è¯´ï¼Œå…¶æ€§èƒ½é‡çº§æ˜¯æ¯«ç§’ï¼Œå¯¹äºç™¾ä¸‡çº§çš„è¡Œæ•°æ¥è¯´ï¼Œå…¶æ€§èƒ½é‡çº§æ˜¯ç§’ï¼›</li></ul></li></ul></li><li>æ•°æ®è¿ç§»å·¥å…·<ul><li>Sqoop<ul><li>Sqoopæ˜¯é’ˆå¯¹å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰ä¸Hadoopä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“çš„å·¥å…·ï¼Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹å¤§éƒ¨åˆ†æ˜¯è‡ªåŠ¨çš„ï¼Œé€šè¿‡MapReduceè¿‡ç¨‹æ¥å®ç°ï¼Œåªéœ€è¦ä¾èµ–æ•°æ®åº“çš„Schemaä¿¡æ¯ã€‚Sqoopæ‰€æ‰§è¡Œçš„æ“ä½œæ˜¯å¹¶è¡Œçš„ï¼Œæ•°æ®ä¼ è¾“æ€§èƒ½é«˜ï¼Œå…·å¤‡è¾ƒå¥½çš„å®¹é”™æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹ã€‚</li></ul></li><li>Canal<ul><li>Canal æ¨¡æ‹Ÿ MySQLçš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸ºSlaveï¼Œå‘Masterå‘é€dump åè®®ï¼›</li><li>Masteræ”¶åˆ°dumpè¯·æ±‚ï¼Œå¼€å§‹æ¨é€ binary log ç»™Slave(å³Canal)ï¼›</li><li>Canalè§£æbinary logï¼Œè·å¾—Mysqlçš„æ›´æ–°ä¿¡æ¯ã€‚</li></ul></li></ul></li><li>ä»»åŠ¡è°ƒåº¦æ¡†æ¶<ul><li>Azkaban<ul><li>Azkabanæ˜¯ç”±Linkedinå¼€æºçš„ä¸€ä¸ªæ‰¹é‡å·¥ä½œæµä»»åŠ¡è°ƒåº¦å™¨ã€‚ç”¨äºåœ¨ä¸€ä¸ªå·¥ä½œæµå†…ä»¥ä¸€ä¸ªç‰¹å®šçš„é¡ºåºè¿è¡Œä¸€ç»„å·¥ä½œå’Œæµç¨‹ã€‚Azkabanå®šä¹‰äº†ä¸€ç§KVæ–‡ä»¶æ ¼å¼æ¥å»ºç«‹ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶æä¾›ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„webç”¨æˆ·ç•Œé¢ç»´æŠ¤å’Œè·Ÿè¸ªä½ çš„å·¥ä½œæµã€‚</li><li>Oozie</li><li>Apache Oozieï¼Œå…¶é…ç½®å·¥ä½œæµçš„è¿‡ç¨‹æ˜¯ç¼–å†™å¤§é‡çš„XMLé…ç½®ï¼Œè€Œä¸”ä»£ç å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œä¸æ˜“äºäºŒæ¬¡å¼€å‘ã€‚</li><li>Oozieç›¸æ¯”azkabanæ˜¯ä¸€ä¸ªé‡é‡çº§çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ŒåŠŸèƒ½å…¨é¢ï¼Œä½†é…ç½®ä½¿ç”¨ä¹Ÿæ›´å¤æ‚ã€‚å¦‚æœå¯ä»¥ä¸åœ¨æ„æŸäº›åŠŸèƒ½çš„ç¼ºå¤±ï¼Œè½»é‡çº§è°ƒåº¦å™¨azkabanæ˜¯å¾ˆä¸é”™çš„å€™é€‰å¯¹è±¡ã€‚</li></ul></li><li>DolphinScheduler</li><li><a href="https://blog.csdn.net/zhanglong_4444/article/details/114017156" target="_blank" rel="noopener">ä»»åŠ¡è°ƒåº¦æ¡†æ¶å¯¹æ¯”</a></li></ul></li><li>é›†ç¾¤ç®¡ç†<ul><li>é›†ç¾¤éƒ¨ç½²å’Œç›‘æ§<ul><li>Ambari<ul><li>æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®,å°±æ˜¯åˆ›å»ºã€ç®¡ç†ã€ç›‘è§† Hadoop çš„é›†ç¾¤,ä¸ºäº†è®© Hadoop ä»¥åŠç›¸å…³çš„å¤§æ•°æ®è½¯ä»¶æ›´å®¹æ˜“ä½¿ç”¨çš„ä¸€ä¸ªå·¥å…·ã€‚</li></ul></li><li>Cloudera Manager</li></ul></li><li>é›†ç¾¤èµ„æºç®¡ç†å™¨<ul><li>Hadoop YARN<ul><li>Yarn æ˜¯ä¸€ä¸ªèµ„æºè°ƒåº¦å¹³å°ï¼Œè´Ÿè´£ä¸ºè¿ç®—ç¨‹åºæä¾›æœåŠ¡å™¨è¿ç®—èµ„æºï¼Œç›¸å½“äºä¸€ä¸ªåˆ†å¸ƒå¼çš„æ“ä½œç³»ç»Ÿå¹³å°</li></ul></li><li>Tez<ul><li>è´Ÿè´£DAGè®¡ç®—ï¼ŒæŠŠå¾ˆå¤šMapReduceä½œä¸šè¿›è¡Œåˆ†æä¼˜åŒ–ï¼Œæ„å»ºæˆä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼Œå¯ä»¥ä¿è¯æœ€å¥½çš„å¤„ç†æ•ˆç‡ï¼Œåˆ†æ¸…æœ‰äº›å…ˆåšæœ‰äº›ååšæœ‰äº›ä¸è¦é‡å¤åš</li></ul></li></ul></li><li>åˆ†å¸ƒå¼åè°ƒæœåŠ¡<ul><li>Zookeeper</li></ul></li></ul></li><li>æ—¶åºæ•°æ®åº“<ul><li>InfluxDB</li><li>TDengine</li><li>OpenTSDB</li></ul></li></ul></li></ul></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>bigData</category>
      </categories>
  </entry>
  <entry>
    <title>UUIDå¤ªé•¿æ€ä¹ˆåŠï¼Ÿå¿«æ¥è¯•è¯•NanoId (Javaç‰ˆæœ¬)</title>
    <url>/post/8b659f0f.html</url>
    <content><![CDATA[<blockquote><p>UUIDå¤ªé•¿æ€ä¹ˆåŠï¼Ÿå¿«æ¥è¯•è¯•NanoIdå§ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯NanoId"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯NanoId" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯NanoId"></a>ä¸€ã€ä»€ä¹ˆæ˜¯NanoId</h3><p>Nano ID ä¸ UUID v4 (åŸºäºéšæœº) ç›¸å½“ã€‚å®ƒä»¬åœ¨ ID ä¸­æœ‰ç›¸ä¼¼æ•°é‡çš„éšæœºä½ (Nano ID ä¸º126ï¼ŒUUID ä¸º122),å› æ­¤å®ƒä»¬çš„å†²çªæ¦‚ç‡ç›¸ä¼¼,è¦æƒ³æœ‰åäº¿åˆ†ä¹‹ä¸€çš„é‡å¤æœºä¼š, å¿…é¡»äº§ç”Ÿ103ä¸‡äº¿ä¸ªç‰ˆæœ¬4çš„IDã€‚NanoIDçš„æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨è‡ªå®šä¹‰å­—æ¯ã€‚ä½ å¯ä»¥æ”¹å˜å­—é¢æ„æ€æˆ–IDçš„å¤§å°ã€‚è€ƒè™‘åˆ°å®ƒçš„å°å°ºå¯¸ã€URL å‹å¥½æ€§ã€å®‰å…¨æ€§å’Œé€Ÿåº¦ï¼Œæˆ‘å»ºè®®åœ¨æœªæ¥çš„ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨ NanoID è€Œä¸æ˜¯ UUIDã€‚</p><h3 id="äºŒã€å¦‚ä½•ä½¿ç”¨"><a href="#äºŒã€å¦‚ä½•ä½¿ç”¨" class="headerlink" title="äºŒã€å¦‚ä½•ä½¿ç”¨"></a>äºŒã€å¦‚ä½•ä½¿ç”¨</h3><p>å¼•å…¥pomåæ ‡</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aventrix.jnanoid<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jnanoid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€å·¥å…·ç±»"><a href="#ä¸‰ã€å·¥å…·ç±»" class="headerlink" title="ä¸‰ã€å·¥å…·ç±»"></a>ä¸‰ã€å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * NanoIdç”Ÿæˆå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/3/28 17:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NanoIdUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SecureRandom DEFAULT_NUMBER_GENERATOR = <span class="keyword">new</span> SecureRandom();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] DEFAULT_ALPHABET = <span class="string">"_-0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>.toCharArray();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NanoIdUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">randomNanoId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> randomNanoId(DEFAULT_NUMBER_GENERATOR, DEFAULT_ALPHABET, DEFAULT_SIZE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">randomNanoId</span><span class="params">(Random random, <span class="keyword">char</span>[] alphabet, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (random == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"random cannot be null."</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (alphabet == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"alphabet cannot be null."</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (alphabet.length != <span class="number">0</span> &amp;&amp; alphabet.length &lt; <span class="number">256</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"size must be greater than zero."</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> mask = (<span class="number">2</span> &lt;&lt; (<span class="keyword">int</span>) Math.floor(Math.log((<span class="keyword">double</span>) (alphabet.length - <span class="number">1</span>)) / Math.log(<span class="number">2.0</span>D))) - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">int</span> step = (<span class="keyword">int</span>) Math.ceil(<span class="number">1.6</span>D * (<span class="keyword">double</span>) mask * (<span class="keyword">double</span>) size / (<span class="keyword">double</span>) alphabet.length);</span><br><span class="line">                StringBuilder idBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[step];</span><br><span class="line">                    random.nextBytes(bytes);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; step; ++i) &#123;</span><br><span class="line">                        <span class="keyword">int</span> alphabetIndex = bytes[i] &amp; mask;</span><br><span class="line">                        <span class="keyword">if</span> (alphabetIndex &lt; alphabet.length) &#123;</span><br><span class="line">                            idBuilder.append(alphabet[alphabetIndex]);</span><br><span class="line">                            <span class="keyword">if</span> (idBuilder.length() == size) &#123;</span><br><span class="line">                                <span class="keyword">return</span> idBuilder.toString();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"alphabet must contain between 1 and 255 symbols."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(NanoIdUtils.randomNanoId());</span><br><span class="line">            System.out.println(UUID.randomUUID());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ã€ä¸¾ä¾‹"><a href="#å››ã€ä¸¾ä¾‹" class="headerlink" title="å››ã€ä¸¾ä¾‹"></a>å››ã€ä¸¾ä¾‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">9GbBeXWTgzhHyq6D2Yw2k</span><br><span class="line">M-EQX_HNQIhnAZvt9wsnV</span><br><span class="line">lWsqiiICbO3Ap6YoyRI_h</span><br><span class="line">gIKypjdIQmr8b-KplY9LF</span><br><span class="line">dughj0nsIoExHLCn9sEGU</span><br><span class="line">i7QutbhcpD-haYhudeTsx</span><br><span class="line">OkjYlBa8uzTu5NiMfYkIY</span><br><span class="line">dTVLLd9r8VhzUGw2MxoLy</span><br><span class="line">CPsmZfnGeydbT8KiNDtmH</span><br><span class="line">sOEMsKe2xpvFiO6VOXOGw</span><br></pre></td></tr></table></figure><h3 id="äº”ã€ä¼˜ç§€èµ„æ–™"><a href="#äº”ã€ä¼˜ç§€èµ„æ–™" class="headerlink" title="äº”ã€ä¼˜ç§€èµ„æ–™"></a>äº”ã€ä¼˜ç§€èµ„æ–™</h3><p><a href="https://zhuanlan.zhihu.com/p/472060150" target="_blank" rel="noopener">ã€Šæ˜¯æ—¶å€™ä½¿ç”¨NanoIDå–ä»£UUIDäº†ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Volatileå®ç°åŸç†</title>
    <url>/post/93ed042.html</url>
    <content><![CDATA[<blockquote><p>volatile ç›¸å…³æ•´ç†å’Œè®¤è¯† ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€volatileå…³é”®å­—"><a href="#ä¸€ã€volatileå…³é”®å­—" class="headerlink" title="ä¸€ã€volatileå…³é”®å­—"></a>ä¸€ã€volatileå…³é”®å­—</h3><p>volatile å¯ä»¥è¯´æ˜¯ JVM æä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œå½“ä¸€ä¸ªå˜é‡å®šä¹‰ä¸ºvolatileä¹‹åï¼Œå®ƒå°†å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼š</p><ol><li><p>ä¿è¯å˜é‡åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚å½“è¢«volatileä¿®é¥°çš„å˜é‡è¢«ä¿®æ”¹æ—¶ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹åˆ»è¯»åˆ°è¢«ä¿®æ”¹å˜é‡çš„æœ€æ–°å€¼ã€‚</p></li><li><p>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚æ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚è¢«volatileä¿®é¥°çš„å˜é‡é€šè¿‡åœ¨è¯»å†™æŒ‡ä»¤é™„åŠ  <u>å†…å­˜å±éšœæŒ‡ä»¤</u> æ¥ç¦æ­¢é‡æ’åºï¼Œä»è€Œä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚</p></li></ol><h3 id="äºŒã€æŒ‡ä»¤é‡æ’åº"><a href="#äºŒã€æŒ‡ä»¤é‡æ’åº" class="headerlink" title="äºŒã€æŒ‡ä»¤é‡æ’åº"></a>äºŒã€æŒ‡ä»¤é‡æ’åº</h3><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚</p><ol><li>ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</li><li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼Œ ILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯» / å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚</li><li>ä» java æºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢ä¸‰ç§é‡æ’åºï¼š<br>a. æºä»£ç ï¼›<br>b. ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºï¼›<br>c. æŒ‡ä»¤é›†é‡æ’åºï¼›<br>d. å†…å­˜ç³»ç»Ÿé‡æ’åºï¼›<br>e. æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤ï¼›</li><li>JMM å±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</li><li>java ç¼–è¯‘å™¨ç¦æ­¢å¤„ç†å™¨é‡æ’åºæ˜¯é€šè¿‡åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®ä¼šæ’å…¥å†…å­˜å±éšœï¼ˆé‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼‰æŒ‡ä»¤æ¥å®ç°çš„ã€‚</li><li>é‡æ’åºéœ€è¦éµå®ˆhappens-beforeè§„åˆ™ã€‚(JSR133å¯¹happens-beforeæœ‰æ˜ç¡®å®šä¹‰)</li></ol><h3 id="ä¸‰ã€åº”è¯¥å¦‚ä½•æ­£ç¡®åœ°è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#ä¸‰ã€åº”è¯¥å¦‚ä½•æ­£ç¡®åœ°è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="ä¸‰ã€åº”è¯¥å¦‚ä½•æ­£ç¡®åœ°è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹"></a>ä¸‰ã€åº”è¯¥å¦‚ä½•æ­£ç¡®åœ°è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹</h3><p><strong>åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œå¯è§æ€§ã€æœ‰åºæ€§ä»¥åŠåŸå­æ€§æ˜¯æ„æˆçº¿ç¨‹å®‰å…¨çš„åŸºçŸ³ã€‚</strong></p><ul><li><p><strong>å¯è§æ€§</strong></p><p>é€šè¿‡volatileä¿®é¥°å˜é‡ä¿è¯å˜é‡è¢«ä¿®æ”¹åå…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ã€‚</p><p>atomic åŸå­æ“ä½œä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ï¼ˆé«˜æ•ˆä¸”ä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼ŒåŸºäºCASï¼‰</p></li><li><p><strong>æœ‰åºæ€§</strong></p><p>é€šè¿‡Volatileä¿®é¥°å˜é‡ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¸¥æ ¼ä¿è¯ä»£ç çš„æ‰§è¡Œæœ‰åºæ€§ã€‚</p></li><li><p><strong>åŸå­æ€§</strong></p><p>è¦ä¸¥æ ¼ä¿è¯åŸå­æ€§ï¼Œéœ€è¦åœ¨volatileä¿®é¥°çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨åŒæ­¥å—æŠ€æœ¯ï¼ˆé”ï¼‰å’ŒJava concurrentåŒ…ï¼ˆåŸå­æ“ä½œç±»ç­‰ï¼‰ã€‚å¦å¤–è¿˜æœ‰ï¼šCASæ— é”ç®—æ³•</p></li></ul><h3 id="å››ã€Volatileå’ŒSynchronizedåŒºåˆ«"><a href="#å››ã€Volatileå’ŒSynchronizedåŒºåˆ«" class="headerlink" title="å››ã€Volatileå’ŒSynchronizedåŒºåˆ«"></a>å››ã€Volatileå’ŒSynchronizedåŒºåˆ«</h3><p><strong>Volatileåªæ˜¯ä¿è¯å˜é‡å¯è§æ€§ï¼Œå¹¶ä¸èƒ½ç¡®ä¿åŸå­æ€§ã€‚</strong>å®ƒæ˜¯<u>ä¾èµ–CPUæä¾›çš„ç‰¹æ®ŠæŒ‡ä»¤å†…å­˜å±éšœæŒ‡ä»¤æ¥æ§åˆ¶å¯è§æ€§</u>ï¼Œè¢«Volatileä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨è¢«çº¿ç¨‹è®¿é—®æ—¶åœ¨è¯»æ“ä½œå‰ä¼šå¼ºè¡Œæ’å…¥ä¸€æ¡å†…å­˜å±éšœè¯»æŒ‡ä»¤å¼ºè¡Œä»ä¸»å­˜ä¸­è¯»å–ï¼ˆè®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ï¼‰ï¼Œå˜é‡åœ¨è¢«çº¿ç¨‹ä¿®æ”¹æ—¶ä¼šåœ¨å†™æŒ‡ä»¤ä¹‹åæ’å…¥å†™å±éšœï¼Œè®©å†™å…¥ç¼“å­˜çš„æœ€æ–°æ•°æ®å†™å›åˆ°ä¸»å†…å­˜ã€‚</p><p><em>ä¸èƒ½ç¡®ä¿åŸå­æ€§</em>ï¼Œæ˜¯å› ä¸ºå¦‚æœAçº¿ç¨‹å’ŒBçº¿ç¨‹åŒæ—¶è¯»å–åˆ°å˜é‡aå€¼ï¼ŒAçº¿ç¨‹ä¿®æ”¹aåå°†å€¼åˆ·åˆ°ä¸»å­˜ã€åŒæ—¶Bçº¿ç¨‹ä¹Ÿä¿®æ”¹äº†açš„å€¼å¹¶åˆ·åˆ°ä¸»å­˜ï¼Œè¿™æ—¶å€™Bçº¿ç¨‹å°±è¦†ç›–äº†Açº¿ç¨‹ä¿®æ”¹æ“ä½œã€‚</p><p><strong>Synchronized</strong>æ˜¯é€šè¿‡<u>å¯¹çº¿ç¨‹åŠ é”ï¼ˆç‹¬å é”ï¼‰æ§åˆ¶çº¿ç¨‹åŒæ­¥</u>ï¼Œè¢«Synchronizedä¿®é¥°çš„å†…å­˜åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼›</p><h3 id="äº”ã€ä¼˜ç§€èµ„æ–™"><a href="#äº”ã€ä¼˜ç§€èµ„æ–™" class="headerlink" title="äº”ã€ä¼˜ç§€èµ„æ–™"></a>äº”ã€ä¼˜ç§€èµ„æ–™</h3><p><a href="https://www.cnblogs.com/xrq730/p/7048693.html" target="_blank" rel="noopener">ã€Šå°±æ˜¯è¦ä½ æ‡‚Javaä¸­volatileå…³é”®å­—å®ç°åŸç†ã€‹</a><br><a href="http://ifeve.com/wp-content/uploads/2014/03/JSR133%E4%B8%AD%E6%96%87%E7%89%881.pdf" target="_blank" rel="noopener">ã€ŠJSR133è§„èŒƒä¸­æ–‡ç‰ˆã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>lock</category>
        <category>MultiThread</category>
      </categories>
      <tags>
        <tag>lock</tag>
      </tags>
  </entry>
  <entry>
    <title>Web Hook é’©å­</title>
    <url>/post/a2f884a0.html</url>
    <content><![CDATA[<blockquote><p>WebHook ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯Web-Hookï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯Web-Hookï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯Web Hookï¼Ÿ"></a><strong>ä¸€ã€ä»€ä¹ˆæ˜¯Web Hookï¼Ÿ</strong></h3><p>Webhookæ˜¯ä¸€ä¸ªAPIæ¦‚å¿µï¼Œå¹¶ä¸”å˜å¾—è¶Šæ¥è¶Šæµè¡Œã€‚æˆ‘ä»¬èƒ½ç”¨äº‹ä»¶æè¿°çš„äº‹ç‰©è¶Šå¤šï¼Œwebhookçš„ä½œç”¨èŒƒå›´ä¹Ÿå°±è¶Šå¤§ã€‚Webhookä½œä¸ºä¸€ä¸ªè½»é‡çš„äº‹ä»¶å¤„ç†åº”ç”¨ï¼Œæ­£å˜å¾—è¶Šæ¥è¶Šæœ‰ç”¨ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä¸€ç§åå‘APIæœºåˆ¶,ç±»ä¼¼äºè§¦å‘å™¨ä¸€æ ·ã€‚</p><h3 id="äºŒã€åº”ç”¨åœºæ™¯"><a href="#äºŒã€åº”ç”¨åœºæ™¯" class="headerlink" title="äºŒã€åº”ç”¨åœºæ™¯"></a>äºŒã€åº”ç”¨åœºæ™¯</h3><p>å¯¹äºç¬¬ä¸‰æ–¹å¹³å°éªŒæƒã€ç™»é™†ç­‰ æ²¡æœ‰å‰ç«¯ç•Œé¢åšä¸­è½¬çš„åœºæ™¯ï¼Œæˆ–è€…å¼ºå®‰å…¨è¦æ±‚çš„æ”¯ä»˜åœºæ™¯ç­‰ï¼Œé€‚åˆç”¨ Webhooks åšæ•°æ®ä¸»åŠ¨æ¨é€ã€‚è¯´ç™½äº†å°±æ˜¯åœ¨å‰ç«¯æ— ä»å‚ä¸ï¼Œæˆ–è€…å› ä¸ºå‰ç«¯å®‰å…¨é—®é¢˜ä¸é€‚åˆå‚ä¸æ—¶ï¼Œå°±æ˜¯ Webhooks çš„åœºæ™¯ã€‚å¾ˆæ˜¾ç„¶ Webhooks ä¹Ÿä¸æ˜¯ Http çš„æ›¿ä»£å“ï¼Œä¸è¿‡çš„ç¡®æ˜¯ä¸€ç§æ–°çš„å‰åç«¯äº¤äº’æ–¹å¼ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯è¦é•¿æœŸç›‘å¬æŸä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼ŒæŒ‰ç…§æ­£å¸¸çš„apiè°ƒç”¨çš„æ–¹å¼å»åšï¼Œé‚£ä¹ˆå¿…é¡»ä¸åœå¾—è½®è®­æœåŠ¡å™¨æ¥è·å–å½“å‰çŠ¶æ€ï¼›ä½¿ç”¨webhookåˆ™æ— éœ€è½®è®­ï¼Œé€šè¿‡API å¯ä»¥ç¡®å®šæ˜¯å¦å‘ç”Ÿäº†æ›´æ”¹ï¼Œå¦‚æœæ›´æ”¹äº†åªéœ€è¦ç­‰å¾…æœåŠ¡å™¨æ¨é€ä¿¡æ¯è¿‡æ¥ï¼Œç„¶åå®¢æˆ·ç«¯æ›´æ–°å°±å¯ä»¥ã€‚</p><p>egï¼šgit webhookå…¶å®ä¹Ÿæ˜¯è¿™æ–¹é¢çš„åº”ç”¨ï¼›</p><h3 id="ä¸‰ã€å®‰å…¨é—®é¢˜"><a href="#ä¸‰ã€å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸‰ã€å®‰å…¨é—®é¢˜"></a>ä¸‰ã€å®‰å…¨é—®é¢˜</h3><p>ç”±äºwebhookä¼šå‘å…¬ç½‘ä¸Šçš„hook urlå‘é€æ•°æ®,è¿™å°±æ„å‘³ç€æŸäº›ä¸å¥½å¿ƒçš„äººå¯èƒ½ä¼šæ‰¾åˆ°è¿™ä¸ªurl,ä»è€Œè¿›è¡Œå‘é€é”™è¯¯çš„æ•°æ®,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜:</p><ul><li>å¢åŠ tokenæœºåˆ¶</li><li>å¢åŠ authè®¤è¯</li><li>åªæ¥æ”¶å¯¹åº”æœåŠ¡ç«¯domainæˆ–IPè¯·æ±‚</li><li>æ•°æ®ç­¾å</li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>WebHook</category>
      </categories>
      <tags>
        <tag>WebHook</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–ç›¸å…³é—®é¢˜åˆ†æ</title>
    <url>/post/c71ae8ea.html</url>
    <content><![CDATA[<blockquote><p>Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h3><p>â€‹ Javaå¯¹è±¡<strong>åºåˆ—åŒ–</strong>çš„æ„æ€å°±æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€è½¬åŒ–æˆå­—èŠ‚æµï¼Œä»¥åå¯ä»¥é€šè¿‡è¿™äº›å€¼å†ç”Ÿæˆç›¸åŒçŠ¶æ€çš„å¯¹è±¡ã€‚å¯¹è±¡åºåˆ—åŒ–æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€ç§å®ç°æ–¹æ³•ï¼Œå®ƒæ˜¯å°†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•è½¬åŒ–ä¸ºä¸€ç§åºåˆ—åŒ–çš„å½¢å¼ç”¨äºå­˜å‚¨å’Œä¼ è¾“ã€‚<strong>ååºåˆ—åŒ–</strong>å°±æ˜¯æ ¹æ®è¿™äº›ä¿å­˜çš„ä¿¡æ¯é‡å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p>åºåˆ—åŒ–ï¼šå°†javaå¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ã€‚</p><p>ååºåˆ—åŒ–ï¼šå°†å­—èŠ‚åºåˆ—è½¬åŒ–ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><h3 id="äºŒã€ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#äºŒã€ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>äºŒã€ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><p>â€‹ æˆ‘ä»¬çŸ¥é“ï¼Œå½“ä¸¤ä¸ªè¿›ç¨‹è¿›è¡Œè¿œç¨‹é€šä¿¡æ—¶ï¼Œå¯ä»¥ç›¸äº’å‘é€å„ç§ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼Œ è€Œè¿™äº›æ•°æ®éƒ½ä¼šä»¥äºŒè¿›åˆ¶åºåˆ—çš„å½¢å¼åœ¨ç½‘ç»œä¸Šä¼ é€ã€‚é‚£ä¹ˆå½“ä¸¤ä¸ªJavaè¿›ç¨‹è¿›è¡Œé€šä¿¡æ—¶ï¼Œèƒ½å¦å®ç°è¿›ç¨‹é—´çš„å¯¹è±¡ä¼ é€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚å¦‚ä½•åšåˆ°å‘¢ï¼Ÿè¿™å°±éœ€è¦Javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–äº†ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ–¹é¢ï¼Œå‘é€æ–¹éœ€è¦æŠŠè¿™ä¸ªJavaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œç„¶ååœ¨ç½‘ç»œä¸Šä¼ é€ï¼›å¦ä¸€æ–¹é¢ï¼Œæ¥æ”¶æ–¹éœ€è¦ä»å­—èŠ‚åºåˆ—ä¸­æ¢å¤å‡ºJavaå¯¹è±¡ã€‚å½“æˆ‘ä»¬æ˜æ™°äº†ä¸ºä»€ä¹ˆéœ€è¦Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–åï¼Œæˆ‘ä»¬å¾ˆè‡ªç„¶åœ°ä¼šæƒ³Javaåºåˆ—åŒ–çš„å¥½å¤„ã€‚å…¶å¥½å¤„ä¸€æ˜¯å®ç°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…åœ°ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼ˆé€šå¸¸å­˜æ”¾åœ¨æ–‡ä»¶é‡Œï¼‰ï¼ŒäºŒæ˜¯ï¼Œåˆ©ç”¨åºåˆ—åŒ–å®ç°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚</p><h3 id="ä¸‰ã€åºåˆ—åŒ–IDçš„ä½œç”¨"><a href="#ä¸‰ã€åºåˆ—åŒ–IDçš„ä½œç”¨" class="headerlink" title="ä¸‰ã€åºåˆ—åŒ–IDçš„ä½œç”¨"></a>ä¸‰ã€åºåˆ—åŒ–IDçš„ä½œç”¨</h3><p>â€‹ å…¶å®ï¼Œè¿™ä¸ªåºåˆ—åŒ–IDèµ·ç€å…³é”®çš„ä½œç”¨ï¼Œå®ƒå†³å®šç€æ˜¯å¦èƒ½å¤ŸæˆåŠŸååºåˆ—åŒ–ï¼ç®€å•æ¥è¯´ï¼Œjavaçš„åºåˆ—åŒ–æœºåˆ¶æ˜¯é€šè¿‡åœ¨è¿è¡Œæ—¶åˆ¤æ–­ç±»çš„serialVersionUIDæ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVMä¼šæŠŠä¼ æ¥çš„å­—èŠ‚æµä¸­çš„serialVersionUIDä¸æœ¬åœ°å®ä½“ç±»ä¸­çš„serialVersionUIDè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™è®¤ä¸ºæ˜¯ä¸€è‡´çš„ï¼Œä¾¿å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ¥åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚</p><h3 id="å››ã€åºåˆ—åŒ–IDå¦‚ä½•äº§ç”Ÿ"><a href="#å››ã€åºåˆ—åŒ–IDå¦‚ä½•äº§ç”Ÿ" class="headerlink" title="å››ã€åºåˆ—åŒ–IDå¦‚ä½•äº§ç”Ÿ"></a>å››ã€åºåˆ—åŒ–IDå¦‚ä½•äº§ç”Ÿ</h3><p>â€‹ å½“æˆ‘ä»¬ä¸€ä¸ªå®ä½“ç±»ä¸­æ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰ä¸€ä¸ªåä¸ºâ€œserialVersionUIDâ€ã€ç±»å‹ä¸ºlongçš„å˜é‡æ—¶ï¼ŒJavaåºåˆ—åŒ–æœºåˆ¶ä¼šæ ¹æ®ç¼–è¯‘æ—¶çš„classè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªserialVersionUIDä½œä¸ºåºåˆ—åŒ–ç‰ˆæœ¬æ¯”è¾ƒï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰åŒä¸€æ¬¡ç¼–è¯‘ç”Ÿæˆçš„classæ‰ä¼šç”Ÿæˆç›¸åŒçš„serialVersionUIDã€‚è­¬å¦‚ï¼Œå½“æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç±»æ—¶ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬å› ä¸ºéœ€æ±‚æ”¹åŠ¨ï¼Œéœ€è¦åœ¨æœ¬åœ°ç±»ä¸­æ·»åŠ å…¶ä»–çš„å­—æ®µï¼Œè¿™ä¸ªæ—¶å€™å†ååºåˆ—åŒ–æ—¶ä¾¿ä¼šå‡ºç°serialVersionUIDä¸ä¸€è‡´ï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿä¾¿æ˜¯åœ¨æœ¬åœ°ç±»ä¸­æ·»åŠ ä¸€ä¸ªâ€œserialVersionUIDâ€å˜é‡ï¼Œå€¼ä¿æŒä¸å˜ï¼Œä¾¿å¯ä»¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><h3 id="äº”ã€Javaå¯¹è±¡åºåˆ—åŒ–çš„æ–¹å¼"><a href="#äº”ã€Javaå¯¹è±¡åºåˆ—åŒ–çš„æ–¹å¼" class="headerlink" title="äº”ã€Javaå¯¹è±¡åºåˆ—åŒ–çš„æ–¹å¼"></a>äº”ã€Javaå¯¹è±¡åºåˆ—åŒ–çš„æ–¹å¼</h3><h4 id="1ã€åŸç”Ÿåºåˆ—åŒ–æ–¹å¼"><a href="#1ã€åŸç”Ÿåºåˆ—åŒ–æ–¹å¼" class="headerlink" title="1ã€åŸç”Ÿåºåˆ—åŒ–æ–¹å¼"></a>1ã€åŸç”Ÿåºåˆ—åŒ–æ–¹å¼</h4><p>åœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡è¦æƒ³å®ç°åºåˆ—åŒ–ï¼Œå¿…é¡»è¦å®ç°ä¸‹é¢ä¸¤ä¸ªæ¥å£ä¹‹ä¸€ï¼š</p><ul><li><p><strong>Serializable æ¥å£</strong></p><p>ä¸€ä¸ªå¯¹è±¡æƒ³è¦è¢«åºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„ç±»å°±è¦å®ç°æ­¤æ¥å£æˆ–è€…å®ƒçš„å­æ¥å£ã€‚</p><p>è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬privateå±æ€§ã€åŒ…æ‹¬å…¶å¼•ç”¨çš„å¯¹è±¡ï¼‰éƒ½å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥ä¿å­˜ã€ä¼ é€’ã€‚ä¸æƒ³åºåˆ—åŒ–çš„å­—æ®µå¯ä»¥ä½¿ç”¨transientä¿®é¥°ã€‚</p></li><li><p><strong>Externalizable æ¥å£</strong></p><p>å®ƒæ˜¯Serializableæ¥å£çš„å­ç±»ï¼Œç”¨æˆ·è¦å®ç°çš„writeExternal()å’ŒreadExternal() æ–¹æ³•ï¼Œç”¨æ¥å†³å®šå¦‚ä½•åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p></li></ul><h4 id="2ã€Jsonåºåˆ—åŒ–"><a href="#2ã€Jsonåºåˆ—åŒ–" class="headerlink" title="2ã€Jsonåºåˆ—åŒ–"></a>2ã€Jsonåºåˆ—åŒ–</h4><p>jacksonã€fastjson</p><h4 id="3ã€ProtoBuffåºåˆ—åŒ–"><a href="#3ã€ProtoBuffåºåˆ—åŒ–" class="headerlink" title="3ã€ProtoBuffåºåˆ—åŒ–"></a>3ã€ProtoBuffåºåˆ—åŒ–</h4><p>ProtocolBufferæ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ã€‚é€‚åˆåšæ•°æ®å­˜å‚¨æˆ– RPC æ•°æ®äº¤æ¢æ ¼å¼ã€‚å¯ç”¨äºé€šè®¯åè®®ã€æ•°æ®å­˜å‚¨ç­‰é¢†åŸŸçš„è¯­è¨€æ— å…³ã€å¹³å°æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®æ ¼å¼ã€‚</p><p>ä¼˜ç‚¹ï¼šè·¨è¯­è¨€ï¼›åºåˆ—åŒ–åæ•°æ®å ç”¨ç©ºé—´æ¯”JSONå°ï¼ŒJSONæœ‰ä¸€å®šçš„æ ¼å¼ï¼Œåœ¨æ•°æ®é‡ä¸Šè¿˜æœ‰å¯ä»¥å‹ç¼©çš„ç©ºé—´ã€‚</p><p>ç¼ºç‚¹ï¼šå®ƒä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å­˜å‚¨ï¼Œæ— æ³•ç›´æ¥è¯»å–ç¼–è¾‘ï¼Œé™¤éä½ æœ‰ .proto å®šä¹‰ï¼Œå¦åˆ™æ— æ³•ç›´æ¥è¯»å‡º Protobufferçš„ä»»ä½•å†…å®¹ã€‚</p><p>å…¶ä¸thriftçš„å¯¹æ¯”ï¼šä¸¤è€…è¯­æ³•ç±»ä¼¼ï¼Œéƒ½æ”¯æŒç‰ˆæœ¬å‘åå…¼å®¹å’Œå‘å‰å…¼å®¹ï¼Œthriftä¾§é‡ç‚¹æ˜¯æ„å»ºè·¨è¯­è¨€çš„å¯ä¼¸ç¼©çš„æœåŠ¡ï¼Œæ”¯æŒçš„è¯­è¨€å¤šï¼ŒåŒæ—¶æä¾›äº†å…¨å¥—RPCè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥æ„å»ºæœåŠ¡ï¼Œä¸éœ€è¦åšå¤ªå¤šå…¶ä»–çš„å·¥ä½œã€‚ Protobufferä¸»è¦æ˜¯ä¸€ç§åºåˆ—åŒ–æœºåˆ¶ï¼Œåœ¨æ•°æ®åºåˆ—åŒ–ä¸Šè¿›è¡Œæ€§èƒ½æ¯”è¾ƒï¼ŒProtobufferç›¸å¯¹è¾ƒå¥½ã€‚</p><p>ç™¾åº¦ç ”å‘çš„<strong>jprotobuf</strong>æ¡†æ¶å°†GoogleåŸå§‹çš„protobufè¿›è¡Œäº†å°è£…ï¼Œå¯¹å…¶è¿›è¡Œç®€åŒ–ï¼Œä»…æä¾›åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ã€‚</p><h3 id="å…­ã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨"><a href="#å…­ã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨" class="headerlink" title="å…­ã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨"></a>å…­ã€ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨</h3><p>å› ä¸ºåºåˆ—åŒ–çš„å¯¹è±¡æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œå¹¶ä¸”å®Œå…¨å¯é€†ã€‚ä½†æ˜¯åœ¨RMIè°ƒç”¨æ—¶ï¼Œæ‰€æœ‰privateå­—æ®µçš„æ•°æ®éƒ½ä»¥æ˜æ–‡äºŒè¿›åˆ¶çš„å½¢å¼å‡ºç°åœ¨ç½‘ç»œçš„å¥—æ¥å­—ä¸Šï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š<br>1ã€ åºåˆ—åŒ–HookåŒ–ï¼ˆç§»ä½å’Œå¤ä½ï¼‰<br>2ã€ åºåˆ—æ•°æ®åŠ å¯†å’Œç­¾å<br>3ã€ åˆ©ç”¨transientçš„ç‰¹æ€§è§£å†³<br>4ã€ æ‰“åŒ…å’Œè§£åŒ…ä»£ç†</p><h3 id="ä¸ƒã€åºåˆ—åŒ–å’Œå•ä¾‹æ¨¡å¼"><a href="#ä¸ƒã€åºåˆ—åŒ–å’Œå•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸ƒã€åºåˆ—åŒ–å’Œå•ä¾‹æ¨¡å¼"></a>ä¸ƒã€åºåˆ—åŒ–å’Œå•ä¾‹æ¨¡å¼</h3><p>æ‰€è°“å•ä¾‹ï¼šå°±æ˜¯å•ä¾‹æ¨¡å¼å°±æ˜¯åœ¨æ•´ä¸ªå…¨å±€ä¸­ï¼ˆæ— è®ºæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼‰ï¼Œè¯¥å¯¹è±¡åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”åªåº”è¯¥å­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œæ²¡æœ‰å‰¯æœ¬ã€‚<br>åºåˆ—åŒ–å¯¹å•ä¾‹æœ‰ç ´åçš„ï¼š<br>1ã€é€šè¿‡å¯¹æŸä¸ªå¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å¾—åˆ°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™å°±ç ´åäº†å•ä¾‹æ¨¡å¼çš„å•ä¾‹æ€§ã€‚<br>2ã€æˆ‘ä»¬çŸ¥é“readObject()çš„æ—¶å€™ï¼Œåº•å±‚è¿ç”¨äº†åå°„çš„æŠ€æœ¯ï¼Œåºåˆ—åŒ–ä¼šé€šè¿‡åå°„è°ƒç”¨æ— å‚æ•°çš„æ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™ç ´åäº†å¯¹è±¡çš„å•ä¾‹æ€§ã€‚<br>3ã€è§£å†³æ–¹æ¡ˆï¼šåœ¨éœ€è¦çš„å•ä¾‹çš„å¯¹è±¡ç±»ä¸­æ·»åŠ ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä½è¿ç®—</title>
    <url>/post/44f703eb.html</url>
    <content><![CDATA[<blockquote><p>ä½è¿ç®— ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä½è¿ç®—æ¦‚è§ˆ"><a href="#ä¸€ã€ä½è¿ç®—æ¦‚è§ˆ" class="headerlink" title="ä¸€ã€ä½è¿ç®—æ¦‚è§ˆ"></a>ä¸€ã€ä½è¿ç®—æ¦‚è§ˆ</h3><table><thead><tr><th align="center">ç¬¦å·</th><th align="center">æè¿°</th><th align="center">è¿ç®—è§„åˆ™</th></tr></thead><tbody><tr><td align="center">&amp;</td><td align="center">ä¸</td><td align="center">ä¸¤ä¸ªä½éƒ½ä¸º1æ—¶ï¼Œç»“æœæ‰ä¸º1</td></tr><tr><td align="center">|</td><td align="center">æˆ–</td><td align="center">ä¸¤ä¸ªä½éƒ½ä¸º0æ—¶ï¼Œç»“æœæ‰ä¸º0</td></tr><tr><td align="center">^</td><td align="center">å¼‚æˆ–</td><td align="center">ä¸¤ä¸ªä½ç›¸åŒä¸º0ï¼Œç›¸å¼‚ä¸º1</td></tr><tr><td align="center">~</td><td align="center">å–å</td><td align="center">0å˜1ï¼Œ1å˜0</td></tr><tr><td align="center">&lt;&lt;</td><td align="center">å·¦ç§»</td><td align="center">å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥0</td></tr><tr><td align="center">&gt;&gt;</td><td align="center">å³ç§»</td><td align="center">å„äºŒè¿›ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ï¼Œ<br>å¯¹æ— ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥0ï¼Œæœ‰ç¬¦å·ä½ï¼Œå„ç¼–è¯‘å™¨å¤„ç†æ–¹æ³•ä¸ä¸€æ ·ï¼Œ<br>æœ‰çš„è¡¥ç¬¦å·ä½ï¼ˆç®—æœ¯å³ç§»ï¼‰ï¼Œæœ‰çš„è¡¥0ï¼ˆé€»è¾‘å³ç§»ï¼‰</td></tr></tbody></table><h3 id="äºŒã€ä¸¾ä¾‹"><a href="#äºŒã€ä¸¾ä¾‹" class="headerlink" title="äºŒã€ä¸¾ä¾‹"></a>äºŒã€ä¸¾ä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// &amp; 0x01 è·å–æœ€ä½ä½</span></span><br><span class="line">    System.out.println(<span class="number">0b1011</span> &amp; <span class="number">0x01</span>);</span><br><span class="line">    <span class="comment">// &amp; 0x0f è·å–ä½å­—èŠ‚</span></span><br><span class="line">    System.out.println(<span class="number">0x03</span> &amp; <span class="number">0x0f</span>);</span><br><span class="line">    <span class="comment">//  &gt;&gt; 4  è·å–é«˜å­—èŠ‚</span></span><br><span class="line">    System.out.println(<span class="number">0xBa</span> &gt;&gt; <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ä¸€äº›æ—¶å€™, æˆ‘ä»¬ä¸éœ€è¦åˆ¤æ–­ä¼ è¿›æ¥çš„æ•°æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°, ä½†æ˜¯å¸Œæœ›å¾—åˆ°çš„ç»“æœä¸€å®šæ˜¯ä¸€ä¸ªæ­£æ•°çš„æ—¶å€™,</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸è¿ç®—ç›¸åº”ä½çš„0XFF, å°±èƒ½ä¿è¯å¾—åˆ°çš„ä¸€å®šæ˜¯ä¸€ä¸ªæ­£æ•°.</span></span><br><span class="line">    <span class="comment">// 10111010</span></span><br><span class="line">    <span class="comment">// 11111111</span></span><br><span class="line">    <span class="comment">// 10111010</span></span><br><span class="line">    System.out.println(<span class="number">0b10111010</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…æRPC</title>
    <url>/post/c220c6b3.html</url>
    <content><![CDATA[<blockquote><p>æµ…æRPCçš„å®ç°åŸç† ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯RPC"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯RPC" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯RPC"></a>ä¸€ã€ä»€ä¹ˆæ˜¯RPC</h3><p>RPC çš„å…¨ç§°æ˜¯ <strong>Remote Procedure Call</strong> æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚å®ƒå…è®¸ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼ˆé€šå¸¸æ˜¯å…±äº«ç½‘ç»œçš„å¦ä¸€å°æœºå™¨ä¸Šï¼‰çš„è¿‡ç¨‹æˆ–å‡½æ•°ï¼Œè€Œä¸ç”¨ç¨‹åºå‘˜æ˜¾å¼ç¼–ç è¿™ä¸ªè¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚ã€‚å³æ— è®ºæ˜¯è°ƒç”¨æœ¬åœ°æ¥å£/æœåŠ¡çš„è¿˜æ˜¯è¿œç¨‹çš„æ¥å£/æœåŠ¡ï¼Œæœ¬è´¨ä¸Šç¼–å†™çš„è°ƒç”¨ä»£ç åŸºæœ¬ç›¸åŒã€‚</p><p>æ¯”å¦‚ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°æˆ–è€…æ–¹æ³•ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œè¿™æ—¶å€™éœ€è¦é€šè¿‡å°±å¯ä»¥åº”ç”¨RPCæ¡†æ¶çš„å®ç°æ¥è§£å†³ã€‚</p><ul><li><p>RPC ä¼šéšè—åº•å±‚çš„é€šè®¯ç»†èŠ‚ï¼ˆä¸éœ€è¦ç›´æ¥å¤„ç†Socketé€šè®¯æˆ–Httpé€šè®¯ï¼‰</p></li><li><p>RPC æ˜¯ä¸€ä¸ªè¯·æ±‚å“åº”æ¨¡å‹ã€‚å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”ï¼ˆç±»ä¼¼äºHttpçš„å·¥ä½œæ–¹å¼ï¼‰</p></li><li><p>RPC åœ¨ä½¿ç”¨å½¢å¼ä¸Šåƒè°ƒç”¨æœ¬åœ°å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ä¸€æ ·å»è°ƒç”¨è¿œç¨‹çš„å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ã€‚</p></li></ul><h3 id="äºŒã€ä¸€æ¬¡åŸºæœ¬çš„-RPC-è°ƒç”¨ä¼šæ¶‰åŠåˆ°ä»€ä¹ˆï¼Ÿ"><a href="#äºŒã€ä¸€æ¬¡åŸºæœ¬çš„-RPC-è°ƒç”¨ä¼šæ¶‰åŠåˆ°ä»€ä¹ˆï¼Ÿ" class="headerlink" title="äºŒã€ä¸€æ¬¡åŸºæœ¬çš„ RPC è°ƒç”¨ä¼šæ¶‰åŠåˆ°ä»€ä¹ˆï¼Ÿ"></a>äºŒã€ä¸€æ¬¡åŸºæœ¬çš„ RPC è°ƒç”¨ä¼šæ¶‰åŠåˆ°ä»€ä¹ˆï¼Ÿ</h3><p>ç°åœ¨ä¸šç•Œå†…æ¯”è¾ƒæµè¡Œçš„ä¸€äº› RPC æ¡†æ¶ï¼Œä¾‹å¦‚ Dubbo æä¾›çš„æ˜¯<code>åŸºäºæ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨</code>ï¼Œå³å®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“æ¥å£çš„å®šä¹‰å³å¯è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚åœ¨ Java ä¸­æ¥å£å¹¶ä¸èƒ½ç›´æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡å…¶å®ç°ç±»å¯¹è±¡æ¥å®Œæˆæ­¤æ“ä½œï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å¿…é¡»ä¸ºè¿™äº›æ¥å£ç”Ÿæˆ<code>ä»£ç†å¯¹è±¡</code>ï¼Œå¯¹æ­¤ Java æä¾›äº† <code>Proxy</code>ã€<code>InvocationHandler</code> ç”ŸæˆåŠ¨æ€ä»£ç†çš„æ”¯æŒï¼›ç”Ÿæˆäº†ä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆæ¯ä¸ªå…·ä½“çš„å‘æ–¹æ³•æ˜¯æ€ä¹ˆè°ƒç”¨çš„å‘¢ï¼Ÿjdk åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è°ƒç”¨æŒ‡å®šæ–¹æ³•æ—¶å®é™…ä¼šæ‰§è¡Œ <code>InvocationHandler</code> ä¸­å®šä¹‰çš„ <code>#invoke</code> æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å®Œæˆè¿œç¨‹æ–¹æ³•è°ƒç”¨å¹¶è·å–ç»“æœã€‚</p><p>æŠ›å¼€å®¢æˆ·ç«¯ï¼Œå›è¿‡å¤´æ¥çœ‹ RPC æ˜¯ä¸¤å°è®¡ç®—æœºé—´çš„è°ƒç”¨ï¼Œå®è´¨ä¸Šæ˜¯ä¸¤å°ä¸»æœºé—´çš„<code>ç½‘ç»œé€šä¿¡</code>ï¼Œæ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡åˆå¿…ç„¶ä¼šæœ‰<code>åºåˆ—åŒ–ã€ååºåˆ—åŒ–</code>ï¼Œ<code>ç¼–è§£ç </code>ç­‰ä¸€äº›å¿…é¡»è¦è€ƒè™‘çš„é—®é¢˜ï¼›åŒæ—¶å®é™…ä¸Šç°åœ¨å¤§å¤šç³»ç»Ÿéƒ½æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œå¤šå°ä¸»æœº/å®¹å™¨å¯¹å¤–æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œå¦‚æœé›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆç®¡ç†æœåŠ¡åœ°å€ä¹Ÿå°†æ˜¯ä¸€ä»¶ååˆ†ç¹ççš„äº‹æƒ…ï¼Œå¸¸è§çš„åšæ³•æ˜¯å„ä¸ªæœåŠ¡èŠ‚ç‚¹å°†è‡ªå·±çš„åœ°å€å’Œæä¾›çš„æœåŠ¡åˆ—è¡¨æ³¨å†Œåˆ°ä¸€ä¸ª <code>æ³¨å†Œä¸­å¿ƒ</code>ï¼Œç”± <code>æ³¨å†Œä¸­å¿ƒ</code> æ¥ç»Ÿä¸€ç®¡ç†æœåŠ¡åˆ—è¡¨ï¼›è¿™æ ·çš„åšæ³•è§£å†³äº†ä¸€äº›é—®é¢˜åŒæ—¶ä¸ºå®¢æˆ·ç«¯å¢åŠ äº†ä¸€é¡¹æ–°çš„å·¥ä½œâ€”â€”é‚£å°±æ˜¯<code>æœåŠ¡å‘ç°</code>ï¼Œé€šä¿—æ¥è¯´å°±æ˜¯ä»æ³¨å†Œä¸­å¿ƒä¸­æ‰¾åˆ°è¿œç¨‹æ–¹æ³•å¯¹åº”çš„æœåŠ¡åˆ—è¡¨å¹¶é€šè¿‡æŸç§ç­–ç•¥ä»ä¸­é€‰å–ä¸€ä¸ªæœåŠ¡åœ°å€æ¥å®Œæˆç½‘ç»œé€šä¿¡ã€‚</p><p>èŠäº†å®¢æˆ·ç«¯å’Œ <code>æ³¨å†Œä¸­å¿ƒ</code>ï¼Œå¦å¤–ä¸€ä¸ªé‡è¦çš„è§’è‰²è‡ªç„¶æ˜¯æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æœ€é‡è¦çš„ä»»åŠ¡ä¾¿æ˜¯æä¾›æœåŠ¡æ¥å£çš„çœŸæ­£å®ç°å¹¶åœ¨æŸä¸ªç«¯å£ä¸Šç›‘å¬ç½‘ç»œè¯·æ±‚ï¼Œç›‘å¬åˆ°è¯·æ±‚åä»ç½‘ç»œè¯·æ±‚ä¸­è·å–åˆ°å¯¹åº”çš„å‚æ•°ï¼ˆæ¯”å¦‚æœåŠ¡æ¥å£ã€æ–¹æ³•ã€è¯·æ±‚å‚æ•°ç­‰ï¼‰ï¼Œå†æ ¹æ®è¿™äº›å‚æ•°é€šè¿‡<code>åå°„</code>çš„æ–¹å¼è°ƒç”¨æ¥å£çš„çœŸæ­£å®ç°è·å–ç»“æœå¹¶å°†å…¶å†™å…¥å¯¹åº”çš„å“åº”æµä¸­ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€æ¬¡åŸºæœ¬çš„ RPC è°ƒç”¨æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20220118180310.png" alt=""></p><h3 id="ä¸‰ã€ä½¿ç”¨åˆ°çš„æŠ€æœ¯"><a href="#ä¸‰ã€ä½¿ç”¨åˆ°çš„æŠ€æœ¯" class="headerlink" title="ä¸‰ã€ä½¿ç”¨åˆ°çš„æŠ€æœ¯"></a>ä¸‰ã€ä½¿ç”¨åˆ°çš„æŠ€æœ¯</h3><h4 id="1-åŠ¨æ€ä»£ç†"><a href="#1-åŠ¨æ€ä»£ç†" class="headerlink" title="1.åŠ¨æ€ä»£ç†"></a>1.åŠ¨æ€ä»£ç†</h4><p>ç”Ÿæˆ client stubå’Œserver stubéœ€è¦ç”¨åˆ° Java åŠ¨æ€ä»£ç†æŠ€æœ¯ ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨JDKåŸç”Ÿçš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¼€æºå­—èŠ‚ç å·¥å…·æ¡†æ¶ å¦‚ï¼šCgLibã€Javassistç­‰ã€‚</p><h4 id="2-åºåˆ—åŒ–"><a href="#2-åºåˆ—åŒ–" class="headerlink" title="2.åºåˆ—åŒ–"></a>2.åºåˆ—åŒ–</h4><p>ä¸ºäº†èƒ½åœ¨ç½‘ç»œä¸Šä¼ è¾“å’Œæ¥æ”¶ Javaå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œ åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚</p><ul><li><p>åºåˆ—åŒ–ï¼šå°†Javaå¯¹è±¡è½¬æ¢æˆ byte[] çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¼–ç çš„è¿‡ç¨‹ï¼›</p></li><li><p>ååºåˆ—åŒ–ï¼šå°† byte[] è½¬æ¢æˆJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼›</p></li></ul><p>å¯ä»¥ä½¿ç”¨JavaåŸç”Ÿçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œä½†æ˜¯æ•ˆç‡éå¸¸ä½ï¼Œæ¨èä½¿ç”¨ä¸€äº›å¼€æºçš„ã€æˆç†Ÿçš„åºåˆ—åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š<code>protobuf</code>ã€<code>Thrift</code>ã€<code>hessian</code>ã€<code>Kryo</code>ã€<code>Msgpack</code></p><p>å…³äºåºåˆ—åŒ–å·¥å…·æ€§èƒ½æ¯”è¾ƒå¯ä»¥å‚è€ƒï¼š<code>jvm-serializers</code></p><h4 id="3-NIO"><a href="#3-NIO" class="headerlink" title="3.NIO"></a>3.NIO</h4><p>å¾ˆå¤šRPCæ¡†æ¶éƒ½ç›´æ¥åŸºäº<strong><code>Netty</code></strong>è¿™ä¸€IOé€šä¿¡æ¡†æ¶ï¼Œæ¯”å¦‚é˜¿é‡Œå·´å·´çš„<code>HSF</code>ã€<code>dubbo</code>ï¼Œ<code>Hadoop Avro</code>ï¼Œæ¨èä½¿ç”¨<code>Netty</code> ä½œä¸ºåº•å±‚é€šä¿¡æ¡†æ¶ã€‚</p><h4 id="4-æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#4-æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4.æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>4.æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h4><p>å¯é€‰æŠ€æœ¯ï¼šRedisã€Zookeeperã€Consulã€Etcdã€Nacosã€Eureka</p><h3 id="å››ã€Nettyå®ç°-Dubbo-RPC"><a href="#å››ã€Nettyå®ç°-Dubbo-RPC" class="headerlink" title="å››ã€Nettyå®ç° Dubbo RPC"></a>å››ã€Nettyå®ç° <code>Dubbo RPC</code></h3><p><a href="https://dongzl.github.io/netty-handbook/#/_content/chapter11" target="_blank" rel="noopener">ã€Š Nettyå®ç° Dubbo RPC ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨@Scheduledå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„å‘</title>
    <url>/post/9c19b9ad.html</url>
    <content><![CDATA[<blockquote><p>ä½¿ç”¨@Scheduledå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„å‘,å¤šä»»åŠ¡é˜»å¡æ‰§è¡Œ ~</p></blockquote><a id="more"></a><p><strong>SpringBootä½¿ç”¨@Scheduledå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™æ˜¯åœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ï¼Œå…¶ä¸­ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œåˆ™æœ‰å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–åç»­ä»»åŠ¡è¢«é˜»å¡ç›´åˆ°è¯¥ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ä¹Ÿå°±æ˜¯ä¼šé€ æˆä¸€äº›ä»»åŠ¡æ— æ³•å®šæ—¶æ‰§è¡Œï¼Œé€ æˆç”Ÿäº§äº‹ä»¶çš„å‘ç”Ÿã€‚</strong></p><h3 id="å®è·µæ¨¡æ‹Ÿ"><a href="#å®è·µæ¨¡æ‹Ÿ" class="headerlink" title="å®è·µæ¨¡æ‹Ÿ"></a>å®è·µæ¨¡æ‹Ÿ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"0/1 * * * * ? "</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">one</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    log.info(<span class="string">"one success, time:"</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿé•¿æ—¶é—´æ‰§è¡Œï¼Œæ¯”å¦‚IOæ“ä½œï¼Œhttpè¯·æ±‚</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"0/1 * * * * ? "</span>ï¼‰</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">two</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">"two success, time:"</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œè‹¥æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰å¤šä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´æ¯”è¾ƒä¹…æˆ–è€…å‡ºç°æ•…éšœï¼Œåˆ™ä¼šå¯¼è‡´å…¶å®ƒjobæ²¡èƒ½è¢«çº¿ç¨‹æ‰€æ‰§è¡Œï¼Œå¯¼è‡´æ²¡èƒ½è¾¾åˆ°å‡†ç‚¹æ‰§è¡Œçš„æ•ˆæœã€‚</p><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><h4 id="1-å°†-Scheduledæ³¨é‡Šçš„æ–¹æ³•å†…éƒ¨æ”¹æˆå¼‚æ­¥æ‰§è¡Œ"><a href="#1-å°†-Scheduledæ³¨é‡Šçš„æ–¹æ³•å†…éƒ¨æ”¹æˆå¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="1.å°†@Scheduledæ³¨é‡Šçš„æ–¹æ³•å†…éƒ¨æ”¹æˆå¼‚æ­¥æ‰§è¡Œ"></a>1.å°†@Scheduledæ³¨é‡Šçš„æ–¹æ³•å†…éƒ¨æ”¹æˆå¼‚æ­¥æ‰§è¡Œ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å½“ç„¶äº†ï¼Œæ„å»ºä¸€ä¸ªåˆç†çš„çº¿ç¨‹æ± ä¹Ÿæ˜¯ä¸€ä¸ªå…³é”®ï¼Œå¦åˆ™æäº¤çš„ä»»åŠ¡ä¹Ÿä¼šåœ¨è‡ªå·±æ„å»ºçš„çº¿ç¨‹æ± ä¸­é˜»å¡</span></span><br><span class="line">    ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/1 * * * * ? "</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">one</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        service.execute(() -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">"one success, time:"</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ”¹æˆå¼‚æ­¥æ‰§è¡Œåï¼Œå°±ç®—ä½ å†è€—æ—¶ä¹Ÿä¸ä¼šå°è±¡åˆ°åç»­ä»»åŠ¡çš„å®šæ—¶è°ƒåº¦äº†</span></span><br><span class="line">                Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0/1 * * * * ? "</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">two</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        service.execute(()-&gt;&#123;</span><br><span class="line">            log.info(<span class="string">"two success, time:"</span> + <span class="keyword">new</span> Date().toString());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="2-æŠŠScheduledé…ç½®æˆæˆå¤šçº¿ç¨‹æ‰§è¡Œ"><a href="#2-æŠŠScheduledé…ç½®æˆæˆå¤šçº¿ç¨‹æ‰§è¡Œ" class="headerlink" title="2.æŠŠScheduledé…ç½®æˆæˆå¤šçº¿ç¨‹æ‰§è¡Œ"></a>2.æŠŠScheduledé…ç½®æˆæˆå¤šçº¿ç¨‹æ‰§è¡Œ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line">        Method[] methods = BatchProperties.Job<span class="class">.<span class="keyword">class</span>.<span class="title">getMethods</span>()</span>;</span><br><span class="line">       <span class="comment">// è·å–è®¡ç®—æœºçš„è®¡ç®—çº¿ç¨‹æ•°</span></span><br><span class="line">        <span class="keyword">int</span> defaultPoolSize = Runtime.getRuntime().availableProcessors();</span><br><span class="line">        <span class="keyword">int</span> corePoolSize = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (methods.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">                Scheduled annotation = method.getAnnotation(Scheduled<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    corePoolSize++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (defaultPoolSize &gt; corePoolSize)</span><br><span class="line">                corePoolSize = defaultPoolSize;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//å½“ç„¶äº†ï¼Œè¿™é‡Œè®¾ç½®çš„çº¿ç¨‹æ± æ˜¯corePoolSizeä¹Ÿæ˜¯å¾ˆå…³é”®äº†ï¼Œè‡ªå·±æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾å®šï¼Œå‡è®¾ä½ æœ‰4ä¸ªä»»åŠ¡éœ€è¦æ¯éš”1ç§’æ‰§è¡Œï¼Œè€Œå…¶ä¸­ä¸‰ä¸ªéƒ½æ˜¯æ¯”è¾ƒè€—æ—¶çš„æ“ä½œå¯èƒ½éœ€è¦10å¤šç§’ï¼Œè€Œä½ ä¸Šé¢çš„è¯­å¥æ˜¯è¿™æ ·å†™çš„ï¼š</span></span><br><span class="line">        taskRegistrar.setScheduler(Executors.newScheduledThreadPool(corePoolSize));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
  </entry>
  <entry>
    <title>Ideaä»£ç æäº¤åˆ†æ”¯åˆå¹¶</title>
    <url>/post/42c5ff4c.html</url>
    <content><![CDATA[<blockquote><p>Ideaä»£ç æäº¤åˆ†æ”¯åˆå¹¶ä»‹ç» ~</p></blockquote><a id="more"></a><h4 id="ä¸€ã€åŠŸèƒ½ç®€è¿°"><a href="#ä¸€ã€åŠŸèƒ½ç®€è¿°" class="headerlink" title="ä¸€ã€åŠŸèƒ½ç®€è¿°"></a>ä¸€ã€åŠŸèƒ½ç®€è¿°</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20211223152307.png" alt=""></p><ol><li><strong>checkout</strong>ï¼šæ£€å‡ºï¼›</li><li><strong>new branch from selected</strong> ï¼šä»å½“å‰é€‰æ‹©çš„åˆ†æ”¯ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼›</li><li><strong>Compare with current</strong>ï¼šè·Ÿå½“å‰çš„åˆ†æ”¯æ¯”è¾ƒï¼›</li><li><strong>show diff with working tree</strong>ï¼šæ¯”è¾ƒå¹¶å±•ç¤ºåˆ°ideaçª—å£ä¸­ï¼›</li><li><strong>rebase current onto selected</strong>ï¼šä»å½“å‰å·²é€‰æ‹©çš„åˆ†æ”¯rebaseï¼›</li><li><strong>merge selected into current</strong>ï¼šä»å½“å‰å·²é€‰æ‹©çš„åˆ†æ”¯mergeï¼›</li><li><strong>pull into current using rebase</strong>ï¼šä»å½“å‰å·²é€‰æ‹©çš„åˆ†æ”¯rebaseï¼›</li><li><strong>pull into current using merge</strong>ï¼šä»å½“å‰å·²é€‰æ‹©çš„åˆ†æ”¯mergeï¼›</li></ol><blockquote><p><font color="red"><strong>rebaseå’Œmergeçš„åŒºåˆ«ï¼Ÿ</strong></font></p><ol><li>ä¸‹æ¸¸åˆ†æ”¯æ›´æ–°ä¸Šæ¸¸åˆ†æ”¯å†…å®¹çš„æ—¶å€™ä½¿ç”¨ <code>rebase</code></li><li>ä¸Šæ¸¸åˆ†æ”¯åˆå¹¶ä¸‹æ¸¸åˆ†æ”¯å†…å®¹çš„æ—¶å€™ä½¿ç”¨ <code>merge</code></li><li>æ›´æ–°å½“å‰åˆ†æ”¯çš„å†…å®¹æ—¶ä¸€å®šè¦ä½¿ç”¨ <code>--rebase</code> å‚æ•°</li></ol><p>ä¾‹å¦‚ï¼š</p><p>1ã€ç°æœ‰ä¸Šæ¸¸åˆ†æ”¯ masterï¼ŒåŸºäº master åˆ†æ”¯æ‹‰å‡ºæ¥ä¸€ä¸ªå¼€å‘åˆ†æ”¯ devï¼Œåœ¨ dev ä¸Šå¼€å‘äº†ä¸€æ®µæ—¶é—´åè¦æŠŠ master åˆ†æ”¯æäº¤çš„æ–°å†…å®¹æ›´æ–°åˆ° dev åˆ†æ”¯ï¼Œæ­¤æ—¶åˆ‡æ¢åˆ° dev åˆ†æ”¯ï¼Œä½¿ç”¨ <code>git rebase master</code></p><p>2ã€ç­‰ dev åˆ†æ”¯å¼€å‘å®Œæˆäº†ä¹‹åï¼Œè¦åˆå¹¶åˆ°ä¸Šæ¸¸åˆ†æ”¯ master ä¸Šçš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ° master åˆ†æ”¯ï¼Œä½¿ç”¨ <code>git merge dev</code></p></blockquote><h4 id="äºŒã€cherry-pick-æ‘˜æ¨±æ¡ƒ"><a href="#äºŒã€cherry-pick-æ‘˜æ¨±æ¡ƒ" class="headerlink" title="äºŒã€cherry-pick æ‘˜æ¨±æ¡ƒ"></a>äºŒã€cherry-pick æ‘˜æ¨±æ¡ƒ</h4><p>åœºæ™¯ï¼šé€‚åˆéƒ¨åˆ†æäº¤åœ¨ä¸åŒåˆ†æ”¯ä¹‹é—´çš„mergeï¼›</p><ol><li>å…ˆåˆ‡æ¢åˆ°ä¸»åˆ†æ”¯Aï¼›</li><li>åœ¨IDEAä¸­æ‰“å¼€GITè¯•å›¾ï¼Œé€‰æ‹©Logæ¡†ï¼›</li></ol><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20211223153710.png" alt=""></p><ol start="3"><li>é€‰ä¸­éœ€è¦mergeè¿‡æ¥çš„åˆ†æ”¯æäº¤è®°å½•ï¼Œç‚¹å‡»æ¨±æ¡ƒğŸ’å›¾æ ‡ï¼Œå³å¯mergeè¿›å½“å‰åˆ†æ”¯ï¼Œå¦‚æœå½“å‰çš„logæ˜¯ä¸€æ¬¡æäº¤å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€‰æ‹©åªmergeéƒ¨åˆ†æ–‡ä»¶ï¼›</li><li>ç„¶ååœ¨å½“å‰çš„åˆ†æ”¯æäº¤ï¼Œå¹¶pushè¿›masterå³å¯ï¼Œæœ¬æ¬¡éƒ¨åˆ†æäº¤è®°å½•åˆå¹¶å®Œæˆï¼›</li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>HttpClientè·³è¿‡Httpsè¯ä¹¦è®¤è¯</title>
    <url>/post/f0330bfd.html</url>
    <content><![CDATA[<blockquote><p>HttpClientè·³è¿‡Httpsè¯ä¹¦è®¤è¯ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€é”™è¯¯åŸå› "><a href="#ä¸€ã€é”™è¯¯åŸå› " class="headerlink" title="ä¸€ã€é”™è¯¯åŸå› "></a>ä¸€ã€é”™è¯¯åŸå› </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.ssl.Alerts.getSSLException(Alerts.java:<span class="number">192</span>)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:<span class="number">1949</span>)</span><br><span class="line">	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:<span class="number">302</span>)</span><br><span class="line">	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:<span class="number">296</span>)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:<span class="number">1509</span>)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:<span class="number">216</span>)</span><br><span class="line">	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:<span class="number">979</span>)</span><br><span class="line">	at sun.security.ssl.Handshaker.process_record(Handshaker.java:<span class="number">914</span>)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:<span class="number">1062</span>)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:<span class="number">1375</span>)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:<span class="number">1403</span>)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:<span class="number">1387</span>)</span><br><span class="line">	at org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:<span class="number">396</span>)</span><br><span class="line">	at org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:<span class="number">355</span>)</span><br><span class="line">	at org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:<span class="number">142</span>)</span><br><span class="line">	at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:<span class="number">373</span>)</span><br><span class="line">	at org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:<span class="number">394</span>)</span><br><span class="line">	at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:<span class="number">237</span>)</span><br><span class="line">	at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:<span class="number">185</span>)</span><br><span class="line">	at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:<span class="number">89</span>)</span><br><span class="line">	at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:<span class="number">110</span>)</span><br><span class="line">	at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:<span class="number">185</span>)</span><br><span class="line">	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:<span class="number">83</span>)</span><br><span class="line">	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:<span class="number">108</span>)</span><br><span class="line">	at com.cyj.demo.Demo02.main(Demo02.java:<span class="number">48</span>)</span><br><span class="line">Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:<span class="number">387</span>)</span><br><span class="line">	at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:<span class="number">292</span>)</span><br><span class="line">	at sun.security.validator.Validator.validate(Validator.java:<span class="number">260</span>)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:<span class="number">324</span>)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:<span class="number">229</span>)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:<span class="number">124</span>)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:<span class="number">1491</span>)</span><br><span class="line">	... <span class="number">20</span> more</span><br><span class="line">Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.provider.certpath.SunCertPathBuilder.build(SunCertPathBuilder.java:<span class="number">141</span>)</span><br><span class="line">	at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:<span class="number">126</span>)</span><br><span class="line">	at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:<span class="number">280</span>)</span><br><span class="line">	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:<span class="number">382</span>)</span><br><span class="line">	... <span class="number">26</span> more</span><br></pre></td></tr></table></figure><h3 id="äºŒã€åŸå› åˆ†æ"><a href="#äºŒã€åŸå› åˆ†æ" class="headerlink" title="äºŒã€åŸå› åˆ†æ"></a>äºŒã€åŸå› åˆ†æ</h3><p>httpså¤šäº†ä¸€ä¸ªsslè¯ä¹¦éªŒè¯ï¼Œå¯ä»¥è¯´httpsæ˜¯èº«æŠ«SSLå¤–å£³çš„httpã€‚å› ä¸ºhttpå­˜åœ¨å¦‚ä¸‹ç¼ºé™·ï¼š</p><p>1ï¼‰é€šä¿¡ä½¿ç”¨æ˜æ–‡ï¼Œå†…å®¹å¯èƒ½è¢«çªƒå¬(é‡è¦å¯†ç æ³„éœ²)ï¼›</p><p>2ï¼‰ä¸éªŒè¯é€šä¿¡æ–¹èº«ä»½ï¼Œæœ‰å¯èƒ½é­é‡ä¼ªè£…(è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ )ï¼›</p><p>3ï¼‰æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæœ‰å¯èƒ½å·²é­ç¯¡æ”¹(è¿è¥å•†åŠ«æŒ)ï¼›</p><p>è€Œhttpsæ˜¯åˆ©ç”¨SSL/TLSå»ºç«‹å…¨ä¿¡é“ï¼ŒåŠ å¯†æ•°æ®åŒ…ã€‚HTTPSä½¿ç”¨çš„ä¸»è¦ç›®çš„æ˜¯æä¾›å¯¹ç½‘ç«™æœåŠ¡å™¨çš„èº«ä»½è®¤è¯ï¼ŒåŒæ—¶ä¿æŠ¤äº¤æ¢æ•°æ®çš„éšç§ä¸å®Œæ•´æ€§ã€‚</p><h3 id="ä¸‰ã€ä»£ç è§£å†³"><a href="#ä¸‰ã€ä»£ç è§£å†³" class="headerlink" title="ä¸‰ã€ä»£ç è§£å†³"></a>ä¸‰ã€ä»£ç è§£å†³</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºHttpClientå¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maxTotal    æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maxPerRoute è·¯ç”±åŸºç¡€çš„è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maxRoute    ç›®æ ‡ä¸»æœºçš„æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hostname    ç›®æ ‡ä¸»æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port        ç«¯å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> CloseableHttpClient</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CloseableHttpClient <span class="title">createHttpClient</span><span class="params">(<span class="keyword">int</span> maxTotal,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                       <span class="keyword">int</span> maxPerRoute, <span class="keyword">int</span> maxRoute, String hostname, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚é‡è¯•å¤„ç†</span></span><br><span class="line">        HttpRequestRetryHandler httpRequestRetryHandler = (exception, executionCount, context) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (executionCount &gt;= <span class="number">5</span>) &#123;<span class="comment">// å¦‚æœå·²ç»é‡è¯•äº†5æ¬¡ï¼Œå°±æ”¾å¼ƒ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> NoHttpResponseException) &#123;<span class="comment">// å¦‚æœæœåŠ¡å™¨ä¸¢æ‰äº†è¿æ¥ï¼Œé‚£ä¹ˆå°±é‡è¯•</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> SSLHandshakeException) &#123;<span class="comment">// ä¸è¦é‡è¯•SSLæ¡æ‰‹å¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> InterruptedIOException) &#123;<span class="comment">// è¯»å–è¶…æ—¶ï¼Œé‚£ä¹ˆå°±é‡è¯•</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> UnknownHostException) &#123;<span class="comment">// ç›®æ ‡æœåŠ¡å™¨ä¸å¯è¾¾</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ConnectTimeoutException) &#123;<span class="comment">// è¿æ¥è¶…æ—¶ï¼Œé‚£ä¹ˆå°±é‡è¯•</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> SSLException) &#123;<span class="comment">// SSLæ¡æ‰‹å¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            HttpClientContext clientContext = HttpClientContext</span><br><span class="line">                    .adapt(context);</span><br><span class="line">            HttpRequest request = clientContext.getRequest();</span><br><span class="line">            <span class="comment">// å¦‚æœè¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå°±å†æ¬¡å°è¯•</span></span><br><span class="line">            <span class="keyword">if</span> (!(request <span class="keyword">instanceof</span> HttpEntityEnclosingRequest)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SSLContext sslContext = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1ã€ä¿¡ä»»æ‰€æœ‰è¯ä¹¦</span></span><br><span class="line">            sslContext = <span class="keyword">new</span> SSLContextBuilder().loadTrustMaterial(<span class="keyword">null</span>, (TrustStrategy) (chain, authType) -&gt; <span class="keyword">true</span>).build();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> sslContext != <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 2ã€</span></span><br><span class="line">        Registry&lt;ConnectionSocketFactory&gt; registry = RegistryBuilder</span><br><span class="line">                .&lt;ConnectionSocketFactory&gt;create().register(<span class="string">"http"</span>, PlainConnectionSocketFactory.INSTANCE)</span><br><span class="line">                .register(<span class="string">"https"</span>, <span class="keyword">new</span> SSLConnectionSocketFactory(sslContext)).build();</span><br><span class="line">        cm = <span class="keyword">new</span> PoolingHttpClientConnectionManager(</span><br><span class="line">                registry);</span><br><span class="line">        <span class="comment">// å°†æœ€å¤§è¿æ¥æ•°å¢åŠ </span></span><br><span class="line">        cm.setMaxTotal(maxTotal);</span><br><span class="line">        <span class="comment">// å°†æ¯ä¸ªè·¯ç”±åŸºç¡€çš„è¿æ¥å¢åŠ </span></span><br><span class="line">        cm.setDefaultMaxPerRoute(maxPerRoute);</span><br><span class="line">        HttpHost httpHost = <span class="keyword">new</span> HttpHost(hostname, port);</span><br><span class="line">        <span class="comment">// å°†ç›®æ ‡ä¸»æœºçš„æœ€å¤§è¿æ¥æ•°å¢åŠ </span></span><br><span class="line">        cm.setMaxPerRoute(<span class="keyword">new</span> HttpRoute(httpHost), maxRoute);</span><br><span class="line">        SSLConnectionSocketFactory sslFactory = <span class="keyword">new</span> SSLConnectionSocketFactory(sslContext, NoopHostnameVerifier.INSTANCE);</span><br><span class="line">        <span class="keyword">return</span> HttpClients.custom()</span><br><span class="line">                .setSSLContext(sslContext)</span><br><span class="line">                .setSSLHostnameVerifier(<span class="keyword">new</span> NoopHostnameVerifier())</span><br><span class="line">                .setSSLSocketFactory(sslFactory)</span><br><span class="line">                .setConnectionManager(cm)</span><br><span class="line">                .setRetryHandler(httpRequestRetryHandler).build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Https</category>
      </categories>
      <tags>
        <tag>Https</tag>
      </tags>
  </entry>
  <entry>
    <title>Nettyä¸­ByteBufçš„copyã€duplicateã€sliceæ–¹æ³•å¯¹æ¯”</title>
    <url>/post/94c01782.html</url>
    <content><![CDATA[<blockquote><p>Nettyä¸­ByteBufçš„copyã€duplicateã€sliceæ–¹æ³•å¯¹æ¯” ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æºç å†…å®¹"><a href="#ä¸€ã€æºç å†…å®¹" class="headerlink" title="ä¸€ã€æºç å†…å®¹"></a>ä¸€ã€æºç å†…å®¹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ByteBufçš„å¯è¯»å­—èŠ‚çš„æ‹·è´ã€‚</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹è¿”å›çš„ByteBufå†…å®¹ä¸å½“å‰ByteBufå®Œå…¨ä¸ä¼šç›¸äº’å½±å“ã€‚</span></span><br><span class="line"><span class="comment"> * æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndex</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> ByteBuf <span class="title">copy</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ByteBufå¯è¯»å­—èŠ‚çš„ä¸€éƒ¨åˆ†ã€‚ </span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹è¿”å›çš„ByteBufæˆ–å½“å‰ByteBufä¼šå½±å“å½¼æ­¤çš„å†…å®¹ï¼Œ</span></span><br><span class="line"><span class="comment"> * åŒæ—¶å®ƒä»¬ç»´æŠ¤å•ç‹¬çš„ç´¢å¼•å’Œæ ‡è®°,æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndex</span></span><br><span class="line"><span class="comment"> * å¦è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè°ƒç”¨&#123;<span class="doctag">@link</span> #retainï¼ˆï¼‰&#125;ï¼Œå› æ­¤ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> ByteBuf <span class="title">duplicate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å…±äº«å½“å‰ByteBufä¿¡æ¯çš„æ–°ByteBuf,ä»–ä»¬ä½¿ç”¨ç‹¬ç«‹çš„readIndex writeIndex markIndex</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹è¿”å›çš„ByteBufæˆ–å½“å‰ByteBufä¼šå½±å“å½¼æ­¤çš„å†…å®¹ï¼ŒåŒæ—¶å®ƒä»¬ç»´æŠ¤å•ç‹¬çš„ç´¢å¼•å’Œæ ‡è®°,</span></span><br><span class="line"><span class="comment"> * æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndexï¼Œ</span></span><br><span class="line"><span class="comment"> * å¦è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè°ƒç”¨&#123;<span class="doctag">@link</span> #retainï¼ˆï¼‰&#125;ï¼Œå› æ­¤ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> ByteBuf <span class="title">slice</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€ç¤ºä¾‹è‡ªæµ‹"><a href="#äºŒã€ç¤ºä¾‹è‡ªæµ‹" class="headerlink" title="äºŒã€ç¤ºä¾‹è‡ªæµ‹"></a>äºŒã€ç¤ºä¾‹è‡ªæµ‹</h3><h4 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBufAllocator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteBufTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ByteBuf byteBuf = ByteBufAllocator.DEFAULT.buffer(<span class="number">10</span>);</span><br><span class="line">        byteBuf.writeInt(<span class="number">126</span>);</span><br><span class="line">        byteBuf.writeInt(<span class="number">127</span>);</span><br><span class="line">        byteBuf.writeBytes(<span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="number">1</span>&#125;);</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readInt="</span> + byteBuf.readInt());</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readerIndex="</span> + byteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + byteBuf.writerIndex() + <span class="string">"|capacity="</span> + byteBuf.capacity());</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//è¿”å›ByteBufçš„å¯è¯»å­—èŠ‚çš„æ‹·è´ã€‚ä¿®æ”¹è¿”å›çš„ByteBufå†…å®¹ä¸å½“å‰ByteBufå®Œå…¨ä¸ä¼šç›¸äº’å½±å“ã€‚</span></span><br><span class="line">        <span class="comment">//æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndex</span></span><br><span class="line">        System.out.println(<span class="string">"====================byteBuf.copy()=================="</span>);</span><br><span class="line">        ByteBuf cByteBuf = byteBuf.copy();</span><br><span class="line">        System.out.println(<span class="string">"cByteBuf readerIndex="</span> + cByteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + cByteBuf.writerIndex() + <span class="string">"|capacity="</span> + cByteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readerIndex="</span> + byteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + byteBuf.writerIndex() + <span class="string">"|capacity="</span> + byteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"å‘cByteBufä¸­å†™å…¥æ•°æ®"</span> + cByteBuf.setInt(<span class="number">0</span>, <span class="number">128</span>));</span><br><span class="line">        System.out.println(<span class="string">"cByteBuf="</span> + cByteBuf.getInt(<span class="number">0</span>) + <span class="string">"|cByteBuf="</span> + cByteBuf.getByte(<span class="number">4</span>));</span><br><span class="line">        System.out.println(<span class="string">"byteBuf="</span> + byteBuf.getInt(<span class="number">0</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getInt(<span class="number">4</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getByte(<span class="number">8</span>));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//è¿”å›ByteBufå¯è¯»å­—èŠ‚çš„ä¸€éƒ¨åˆ†ã€‚ ä¿®æ”¹è¿”å›çš„ByteBufæˆ–å½“å‰ByteBufä¼šå½±å“å½¼æ­¤çš„å†…å®¹ï¼Œ</span></span><br><span class="line">        <span class="comment">// åŒæ—¶å®ƒä»¬ç»´æŠ¤å•ç‹¬çš„ç´¢å¼•å’Œæ ‡è®°,æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndex</span></span><br><span class="line">        <span class="comment">//å¦è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè°ƒç”¨&#123;@link #retainï¼ˆï¼‰&#125;ï¼Œå› æ­¤ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">"====================byteBuf.slice()=================="</span>);</span><br><span class="line">        ByteBuf sByteBuf = byteBuf.slice();</span><br><span class="line">        System.out.println(<span class="string">"sByteBuf readerIndex="</span> + sByteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + sByteBuf.writerIndex() + <span class="string">"|capacity="</span> + sByteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readerIndex="</span> + byteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + byteBuf.writerIndex() + <span class="string">"|capacity="</span> + byteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"å‘sByteBufä¸­å†™å…¥æ•°æ®"</span> + sByteBuf.setInt(<span class="number">0</span>, <span class="number">128</span>));</span><br><span class="line">        System.out.println(<span class="string">"sByteBuf="</span> + sByteBuf.getInt(<span class="number">0</span>) + <span class="string">"|sByteBuf="</span> + sByteBuf.getByte(<span class="number">4</span>));</span><br><span class="line">        System.out.println(<span class="string">"byteBuf="</span> + byteBuf.getInt(<span class="number">0</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getInt(<span class="number">4</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getByte(<span class="number">8</span>));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//è¿”å›å…±äº«å½“å‰ByteBufä¿¡æ¯çš„æ–°ByteBuf,ä»–ä»¬ä½¿ç”¨ç‹¬ç«‹çš„readIndex writeIndex markIndex</span></span><br><span class="line">        <span class="comment">//ä¿®æ”¹è¿”å›çš„ByteBufæˆ–å½“å‰ByteBufä¼šå½±å“å½¼æ­¤çš„å†…å®¹ï¼ŒåŒæ—¶å®ƒä»¬ç»´æŠ¤å•ç‹¬çš„ç´¢å¼•å’Œæ ‡è®°,</span></span><br><span class="line">        <span class="comment">// æ­¤æ–¹æ³•ä¸ä¼šä¿®æ”¹å½“å‰ByteBufçš„readerIndexæˆ–writerIndexï¼Œ</span></span><br><span class="line">        <span class="comment">//å¦è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè°ƒç”¨&#123;@link #retainï¼ˆï¼‰&#125;ï¼Œå› æ­¤ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">"====================byteBuf.duplicate()=================="</span>);</span><br><span class="line">        ByteBuf dByteBuf = byteBuf.duplicate();</span><br><span class="line">        System.out.println(<span class="string">"dByteBuf readerIndex="</span> + dByteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + dByteBuf.writerIndex() + <span class="string">"|capacity="</span> + dByteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readerIndex="</span> + byteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + byteBuf.writerIndex() + <span class="string">"|capacity="</span> + byteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"å‘dByteBufä¸­å†™å…¥æ•°æ®"</span> + dByteBuf.setInt(<span class="number">0</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(<span class="string">"dByteBuf="</span> + dByteBuf.getInt(<span class="number">0</span>) + <span class="string">"|dByteBuf="</span> + dByteBuf.getInt(<span class="number">4</span>) + <span class="string">"|dByteBuf="</span> + dByteBuf.getByte(<span class="number">8</span>));</span><br><span class="line">        System.out.println(<span class="string">"byteBuf="</span> + byteBuf.getInt(<span class="number">0</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getInt(<span class="number">4</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getByte(<span class="number">8</span>));</span><br><span class="line">        dByteBuf.writeBytes(<span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="number">2</span>&#125;);</span><br><span class="line">        System.out.println(<span class="string">"dByteBuf readerIndex="</span> + dByteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + dByteBuf.writerIndex() + <span class="string">"|capacity="</span> + dByteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"byteBuf readerIndex="</span> + byteBuf.readerIndex() + <span class="string">"| writeIndex="</span> + byteBuf.writerIndex() + <span class="string">"|capacity="</span> + byteBuf.capacity());</span><br><span class="line">        System.out.println(<span class="string">"dByteBuf="</span> + dByteBuf.getInt(<span class="number">0</span>) + <span class="string">"|dByteBuf="</span> + dByteBuf.getInt(<span class="number">4</span>) + <span class="string">"|dByteBuf="</span> + dByteBuf.getByte(<span class="number">8</span>) + <span class="string">"|dByteBuf="</span> + dByteBuf.getByte(<span class="number">9</span>));</span><br><span class="line">        System.out.println(<span class="string">"byteBuf="</span> + byteBuf.getInt(<span class="number">0</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getInt(<span class="number">4</span>) + <span class="string">"|byteBuf="</span> + byteBuf.getByte(<span class="number">8</span>) + <span class="string">"|byteBuf="</span> + dByteBuf.getByte(<span class="number">9</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">byteBuf readInt=<span class="number">126</span></span><br><span class="line">byteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">====================byteBuf.copy()==================</span><br><span class="line">cByteBuf readerIndex=<span class="number">0</span>| writeIndex=<span class="number">5</span>|capacity=<span class="number">5</span></span><br><span class="line">byteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">å‘cByteBufä¸­å†™å…¥æ•°æ®PooledUnsafeDirectByteBuf(ridx: <span class="number">0</span>, widx: <span class="number">5</span>, cap: <span class="number">5</span>)</span><br><span class="line">cByteBuf=<span class="number">128</span>|cByteBuf=<span class="number">1</span></span><br><span class="line">byteBuf=<span class="number">126</span>|byteBuf=<span class="number">127</span>|byteBuf=<span class="number">1</span></span><br><span class="line">====================byteBuf.slice()==================</span><br><span class="line">sByteBuf readerIndex=<span class="number">0</span>| writeIndex=<span class="number">5</span>|capacity=<span class="number">5</span></span><br><span class="line">byteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">å‘sByteBufä¸­å†™å…¥æ•°æ®UnpooledSlicedByteBuf(ridx: <span class="number">0</span>, widx: <span class="number">5</span>, cap: <span class="number">5</span>/<span class="number">5</span>, unwrapped: PooledUnsafeDirectByteBuf(ridx: <span class="number">4</span>, widx: <span class="number">9</span>, cap: <span class="number">10</span>))</span><br><span class="line">sByteBuf=<span class="number">128</span>|sByteBuf=<span class="number">1</span></span><br><span class="line">byteBuf=<span class="number">126</span>|byteBuf=<span class="number">128</span>|byteBuf=<span class="number">1</span></span><br><span class="line">====================byteBuf.duplicate()==================</span><br><span class="line">dByteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">byteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">å‘dByteBufä¸­å†™å…¥æ•°æ®UnpooledDuplicatedByteBuf(ridx: <span class="number">4</span>, widx: <span class="number">9</span>, cap: <span class="number">10</span>, unwrapped: PooledUnsafeDirectByteBuf(ridx: <span class="number">4</span>, widx: <span class="number">9</span>, cap: <span class="number">10</span>))</span><br><span class="line">dByteBuf=<span class="number">100</span>|dByteBuf=<span class="number">128</span>|dByteBuf=<span class="number">1</span></span><br><span class="line">byteBuf=<span class="number">100</span>|byteBuf=<span class="number">128</span>|byteBuf=<span class="number">1</span></span><br><span class="line">dByteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">10</span>|capacity=<span class="number">10</span></span><br><span class="line">byteBuf readerIndex=<span class="number">4</span>| writeIndex=<span class="number">9</span>|capacity=<span class="number">10</span></span><br><span class="line">dByteBuf=<span class="number">100</span>|dByteBuf=<span class="number">128</span>|dByteBuf=<span class="number">1</span>|dByteBuf=<span class="number">2</span></span><br><span class="line">byteBuf=<span class="number">100</span>|byteBuf=<span class="number">128</span>|byteBuf=<span class="number">1</span>|byteBuf=<span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€å¸¸ç”¨æ–¹æ³•"><a href="#ä¸‰ã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="ä¸‰ã€å¸¸ç”¨æ–¹æ³•"></a>ä¸‰ã€å¸¸ç”¨æ–¹æ³•</h3><p>1ã€<strong>duplicate()</strong>ï¼šç›´æ¥æ‹·è´æ•´ä¸ªbufferï¼ŒåŒ…æ‹¬readerIndexã€capacityã€writerIndexã€‚<br>2ã€<strong>slice()</strong>ï¼šæ‹·è´bufferä¸­å·²ç»å†™å…¥æ•°æ®çš„éƒ¨åˆ†ã€‚<br>3ã€<strong>copy()</strong>ï¼šæ–¹æ³•ä¼šè¿›è¡Œå†…å­˜å¤åˆ¶å·¥ä½œï¼Œæ•ˆç‡å¾ˆä½ã€‚</p><p>duplicateå’Œcopyeè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å±äºæµ…æ‹·è´å®ƒå’ŒåŸbufferæ˜¯å…±äº«æ•°æ®çš„ã€‚æ‰€ä»¥è¯´è°ƒç”¨è¿™äº›æ–¹æ³•æ¶ˆè€—æ˜¯å¾ˆä½çš„ï¼Œ<br>å¹¶æ²¡æœ‰å¼€è¾Ÿæ–°çš„ç©ºé—´å»å­˜å‚¨ï¼Œä½†æ˜¯ä¿®æ”¹åä¼šå½±å“åŸbufferã€‚è¿™å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æºByteBufè°ƒç”¨release() ä¹‹åï¼Œ<br>ä¸€æ—¦å¼•ç”¨è®¡æ•°ä¸ºé›¶ï¼Œå°±å˜å¾—ä¸èƒ½è®¿é—®äº†ï¼›åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒæºByteBufçš„æ‰€æœ‰æµ…å±‚å¤åˆ¶å®ä¾‹ä¹Ÿä¸èƒ½è¿›è¡Œè¯»å†™äº†ï¼›å¦‚æœå¼ºè¡Œå¯¹æµ…å±‚å¤åˆ¶å®ä¾‹è¿›è¡Œè¯»å†™ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚å› æ­¤ï¼Œåœ¨è°ƒç”¨æµ…å±‚å¤åˆ¶å®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ä¸€æ¬¡retain() æ–¹æ³•æ¥å¢åŠ å¼•ç”¨ï¼Œè¡¨ç¤ºå®ƒä»¬å¯¹åº”çš„åº•å±‚å†…å­˜å¤šäº†ä¸€æ¬¡å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°ä¸º2ã€‚åœ¨æµ…å±‚å¤åˆ¶å®ä¾‹ç”¨å®Œåï¼Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡release()æ–¹æ³•ï¼Œå°†å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œè¿™æ ·å°±ä¸å½±å“æºByteBufçš„å†…å­˜é‡Šæ”¾ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20211213111512.png" alt="Netty ByteBuf å­—èŠ‚æ“ä½œ"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title>Jmeterå·¥å…·ç»“æœåˆ†æ</title>
    <url>/post/b65a13e2.html</url>
    <content><![CDATA[<blockquote><p>Jmeterå‹æµ‹å·¥å…·ç»“æœåˆ†æ ~</p></blockquote><a id="more"></a><h4 id="ä¸€ã€èšåˆæŠ¥å‘Š"><a href="#ä¸€ã€èšåˆæŠ¥å‘Š" class="headerlink" title="ä¸€ã€èšåˆæŠ¥å‘Š"></a>ä¸€ã€èšåˆæŠ¥å‘Š</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20211203143329.png" alt=""></p><blockquote><p><strong>#Samples</strong>ï¼šè¡¨ç¤ºä½ è¿™æ¬¡æµ‹è¯•ä¸­ä¸€å…±å‘å‡ºäº†å¤šå°‘ä¸ªè¯·æ±‚ï¼Œå¦‚æœæ¨¡æ‹Ÿ10ä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·è¿­ä»£10æ¬¡ï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¾ç¤º100</p><p><strong>Average</strong>ï¼šå¹³å‡å“åº”æ—¶é—´â€”â€”é»˜è®¤æƒ…å†µä¸‹æ˜¯å•ä¸ªRequest çš„å¹³å‡å“åº”æ—¶é—´ï¼Œå½“ä½¿ç”¨äº† Transaction Controller æ—¶ï¼Œä¹Ÿå¯ä»¥ä»¥Transaction ä¸ºå•ä½æ˜¾ç¤ºå¹³å‡å“åº”æ—¶é—´</p><p><strong>Median</strong>ï¼šä¸­ä½æ•°ï¼Œä¹Ÿå°±æ˜¯50ï¼… ç”¨æˆ·çš„å“åº”æ—¶é—´</p><p><strong>90% Line</strong>ï¼š90ï¼… ç”¨æˆ·çš„å“åº”æ—¶é—´</p><p><strong>Min</strong>ï¼šæœ€å°å“åº”æ—¶é—´</p><p><strong>Max</strong>ï¼šæœ€å¤§å“åº”æ—¶é—´</p><p><strong>Error%</strong>ï¼šæœ¬æ¬¡æµ‹è¯•ä¸­å‡ºç°é”™è¯¯çš„è¯·æ±‚çš„æ•°é‡/è¯·æ±‚çš„æ€»æ•°</p><p><strong>Throughput(QPS)</strong>ï¼šååé‡â€”â€”é»˜è®¤æƒ…å†µä¸‹è¡¨ç¤ºæ¯ç§’å®Œæˆçš„è¯·æ±‚æ•°ï¼ˆRequest per Secondï¼‰ï¼Œå½“ä½¿ç”¨äº† Transaction Controller æ—¶ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºç±»ä¼¼ LoadRunnerçš„ Transaction per Second æ•°ï¼Œå¦‚æœæ˜¯1.0ï¼Œå³æ¯ç§’1ä¸ªè¯·æ±‚</p><p><strong>KB/Sec</strong>ï¼šæ¯ç§’ä»æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°çš„æ•°æ®é‡ï¼Œç›¸å½“äºLoadRunnerä¸­çš„Throughput/Sec</p></blockquote><h4 id="äºŒã€å¯Ÿçœ‹ç»“æœæ ‘"><a href="#äºŒã€å¯Ÿçœ‹ç»“æœæ ‘" class="headerlink" title="äºŒã€å¯Ÿçœ‹ç»“æœæ ‘"></a>äºŒã€å¯Ÿçœ‹ç»“æœæ ‘</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20211203144221.png" alt=""></p><blockquote><p><strong>Thread Name</strong>: çº¿ç¨‹ç»„åç§°</p><p><strong>Sample Start</strong>: å¯åŠ¨å¼€å§‹æ—¶é—´</p><p><strong>Load time</strong>: åŠ è½½æ—¶é•¿</p><p><strong>Latency</strong>: ç­‰å¾…æ—¶é•¿</p><p><strong>Size in bytes</strong>:å‘é€çš„æ•°æ®æ€»å¤§å°</p><p><strong>Headers size in bytes</strong>:å‘é€å¤´å¤§å°</p><p><strong>Body size in bytes</strong>:å‘é€æ•°æ®çš„å…¶ä½™éƒ¨åˆ†å¤§å°</p><p><strong>Sample Count</strong>:å‘é€ç»Ÿè®¡</p><p><strong>Error Count</strong>:äº¤äº’é”™è¯¯ç»Ÿè®¡</p><p><strong>Response code</strong>è¿”å›ç </p></blockquote><h4 id="ä¸‰ã€çº¿ç¨‹ç»„"><a href="#ä¸‰ã€çº¿ç¨‹ç»„" class="headerlink" title="ä¸‰ã€çº¿ç¨‹ç»„"></a>ä¸‰ã€çº¿ç¨‹ç»„</h4><p><strong>çº¿ç¨‹æ•°</strong>ï¼šè™šæ‹Ÿç”¨æˆ·æ•°ã€‚ä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·å ç”¨ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹ã€‚è®¾ç½®å¤šå°‘è™šæ‹Ÿç”¨æˆ·æ•°åœ¨è¿™é‡Œä¹Ÿå°±æ˜¯è®¾ç½®å¤šå°‘ä¸ªçº¿ç¨‹æ•°ã€‚</p><p><strong>å‡†å¤‡æ—¶é•¿Ramp-Up Period(in seconds)ï¼‰</strong>ï¼š è®¾ç½®çš„è™šæ‹Ÿç”¨æˆ·æ•°éœ€è¦å¤šé•¿æ—¶é—´å…¨éƒ¨å¯åŠ¨ã€‚å¦‚æœçº¿ç¨‹æ•°ä¸º20 ï¼Œå‡†å¤‡æ—¶é•¿ä¸º10 ï¼Œé‚£ä¹ˆéœ€è¦10ç§’é’Ÿå¯åŠ¨20ä¸ªçº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿå¯åŠ¨2ä¸ªçº¿ç¨‹ã€‚</p><p><strong>å¾ªç¯æ¬¡æ•°</strong>ï¼šæ¯ä¸ªçº¿ç¨‹å‘é€è¯·æ±‚çš„æ¬¡æ•°ã€‚å¦‚æœçº¿ç¨‹æ•°ä¸º20 ï¼Œå¾ªç¯æ¬¡æ•°ä¸º100 ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹å‘é€100æ¬¡è¯·æ±‚ã€‚æ€»è¯·æ±‚æ•°ä¸º20*100=2000 ã€‚å¦‚æœå‹¾é€‰äº†â€œæ°¸è¿œâ€ï¼Œé‚£ä¹ˆæ‰€æœ‰çº¿ç¨‹ä¼šä¸€ç›´å‘é€è¯·æ±‚ï¼Œä¸€åˆ°é€‰æ‹©åœæ­¢è¿è¡Œè„šæœ¬ã€‚</p><h4 id="å››ã€ååé‡å®šæ—¶å™¨"><a href="#å››ã€ååé‡å®šæ—¶å™¨" class="headerlink" title="å››ã€ååé‡å®šæ—¶å™¨"></a>å››ã€ååé‡å®šæ—¶å™¨</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20240119180723046.png" alt=""></p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/202401201929958.png" alt=""></p><p>ä½œç”¨ï¼šæ§åˆ¶ QPS ï¼Œä¿è¯å¹¶å‘ç¨³å®šåœ¨ä¸€å®šçš„æ•°å€¼å†…ã€‚</p><p>å¦‚ä¸Šï¼šååé‡è®¾ç½®çš„æ˜¯ä¸€åˆ†é’Ÿ 600 æ¬¡ï¼ˆä¸€ç§’ 10 æ¬¡ï¼‰ï¼Œçº¿ç¨‹æ•°è®¾ç½®çš„ 20 æ¬¡ï¼Œ20 * 10 = 200 QPSï¼›</p><p>è¿™æ ·è®¾ç½®å‚æ•°åï¼Œä¿è¯QPSç¨³å®šåœ¨ 200 QPSã€‚</p><h4 id="äº”ã€æ¥å£å‹æµ‹æ¨¡æ¿"><a href="#äº”ã€æ¥å£å‹æµ‹æ¨¡æ¿" class="headerlink" title="äº”ã€æ¥å£å‹æµ‹æ¨¡æ¿"></a>äº”ã€æ¥å£å‹æµ‹æ¨¡æ¿</h4><p>æ¥å£å‹æµ‹æ¨¡æ¿æ–‡ä»¶ <a href="/download/æ¥å£å‹æµ‹æ¨¡æ¿.jmx">â†“ç‚¹å‡»ä¸‹è½½â†“</a></p><h4 id="å…­ã€TPS-QPS"><a href="#å…­ã€TPS-QPS" class="headerlink" title="å…­ã€TPS\QPS"></a>å…­ã€TPS\QPS</h4><p><a href="https://www.cnblogs.com/data2value/p/6220859.html" target="_blank" rel="noopener">ã€Šååé‡ï¼ˆTPSï¼‰ã€QPSã€å¹¶å‘æ•°ã€å“åº”æ—¶é—´ï¼ˆRTï¼‰æ¦‚å¿µã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>QPS</category>
      </categories>
      <tags>
        <tag>Jmeter</tag>
        <tag>QPS</tag>
      </tags>
  </entry>
  <entry>
    <title>log4j2åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«</title>
    <url>/post/48969847.html</url>
    <content><![CDATA[<blockquote><p>log4j2å®ç°åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå“‡å¡ï¼ å¥½å‰å®³ ~</p></blockquote><a id="more"></a><h3 id="log4j2"><a href="#log4j2" class="headerlink" title="log4j2"></a>log4j2</h3><h4 id="pomåæ ‡"><a href="#pomåæ ‡" class="headerlink" title="pomåæ ‡"></a>pomåæ ‡</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shuaizi.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¾èµ–çš„pomåæ ‡:</span></span><br><span class="line"><span class="comment"> * &lt;dependency&gt;</span></span><br><span class="line"><span class="comment"> * &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment"> * &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/13 15:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api</span>(value = <span class="string">"log4j2æ—¥å¿—æ¥å£"</span>, tags = &#123;<span class="string">"æ—¥å¿—æ¥å£"</span>&#125;)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4j2Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"è·å–å½“å‰ç³»ç»Ÿlog4j2æ—¥å¿—çº§åˆ«"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/logger/level"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLoggerLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LoggerContext ctx = (LoggerContext) LogManager.getContext(<span class="keyword">false</span>);</span><br><span class="line">        Configuration config = ctx.getConfiguration();</span><br><span class="line">        LoggerConfig loggerConfig = config.getLoggerConfig(LogManager.ROOT_LOGGER_NAME);</span><br><span class="line">        <span class="keyword">return</span> loggerConfig.getLevel().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"ä¿®æ”¹å½“å‰ç³»ç»Ÿlog4j2æ—¥å¿—çº§åˆ«"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/root/&#123;level&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateRootLog4j2Level</span><span class="params">(@PathVariable(<span class="string">"level"</span>)</span> @<span class="title">ApiParam</span><span class="params">(<span class="string">"ä¿®æ”¹debugçº§åˆ«çš„æ—¶å€™ä¼ debug,infoçº§åˆ«çš„æ—¶å€™ä¼ info"</span>)</span> String levelName) </span>&#123;</span><br><span class="line">        LoggerContext ctx = (LoggerContext) LogManager.getContext(<span class="keyword">false</span>);</span><br><span class="line">        Configuration config = ctx.getConfiguration();</span><br><span class="line">        LoggerConfig loggerConfig = config.getLoggerConfig(LogManager.ROOT_LOGGER_NAME);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"debug"</span>.equals(levelName)) &#123;</span><br><span class="line">            loggerConfig.setLevel(Level.DEBUG);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">""</span>.equals(levelName)) &#123;</span><br><span class="line">            loggerConfig.setLevel(Level.INFO);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            loggerConfig.setLevel(Level.INFO);</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ä¿®æ”¹rootçš„log4j2&#123;"</span> + levelName + <span class="string">"&#125;çº§åˆ«æˆåŠŸ"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>log4j2</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸‰ç§å·¥å‚æ¨¡å¼</title>
    <url>/post/2c61f458.html</url>
    <content><![CDATA[<blockquote><p>â€œè®¾è®¡æ¨¡å¼â€ è¿™ä¸ªæœ¯è¯­æœ€åˆå¹¶ä¸æ˜¯å‡ºç°åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œè€Œæ˜¯è¢«ç”¨äºå»ºç­‘é¢†åŸŸçš„è®¾è®¡ä¸­ã€‚ç›´åˆ° 1990 å¹´ï¼Œè½¯ä»¶å·¥ç¨‹ç•Œæ‰å¼€å§‹ç ”è®¨è®¾è®¡æ¨¡å¼çš„è¯é¢˜ ~</p></blockquote><a id="more"></a><h3 id="è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µä¸æ„ä¹‰"><a href="#è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µä¸æ„ä¹‰" class="headerlink" title="è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µä¸æ„ä¹‰"></a>è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µä¸æ„ä¹‰</h3><h4 id="1ã€æ¦‚å¿µ"><a href="#1ã€æ¦‚å¿µ" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h4><p><strong>è½¯ä»¶è®¾è®¡æ¨¡å¼</strong>ï¼ˆSoftware Design Patternï¼‰ï¼Œåˆç§°è®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚å®ƒæè¿°äº†åœ¨è½¯ä»¶è®¾è®¡è¿‡ç¨‹ä¸­çš„ä¸€äº›ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ä¸€ç³»åˆ—å¥—è·¯ï¼Œæ˜¯å‰è¾ˆä»¬çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œå…·æœ‰ä¸€å®šçš„æ™®éæ€§ï¼Œå¯ä»¥åå¤ä½¿ç”¨ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€ä»£ç çš„å¯è¯»æ€§å’Œä»£ç çš„å¯é æ€§ã€‚</p><h4 id="2ã€æ„ä¹‰"><a href="#2ã€æ„ä¹‰" class="headerlink" title="2ã€æ„ä¹‰"></a>2ã€æ„ä¹‰</h4><p>è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…è¿ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…æ€§ã€ç»§æ‰¿æ€§å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚æ­£ç¡®ä½¿ç”¨è®¾è®¡æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚</p><ul><li>å¯ä»¥æé«˜ç¨‹åºå‘˜çš„æ€ç»´èƒ½åŠ›ã€ç¼–ç¨‹èƒ½åŠ›å’Œè®¾è®¡èƒ½åŠ›ã€‚</li><li>ä½¿ç¨‹åºè®¾è®¡æ›´åŠ æ ‡å‡†åŒ–ã€ä»£ç ç¼–åˆ¶æ›´åŠ å·¥ç¨‹åŒ–ï¼Œä½¿è½¯ä»¶å¼€å‘æ•ˆç‡å¤§å¤§æé«˜ï¼Œä»è€Œç¼©çŸ­è½¯ä»¶çš„å¼€å‘å‘¨æœŸã€‚</li><li>ä½¿è®¾è®¡çš„ä»£ç å¯é‡ç”¨æ€§é«˜ã€å¯è¯»æ€§å¼ºã€å¯é æ€§é«˜ã€çµæ´»æ€§å¥½ã€å¯ç»´æŠ¤æ€§å¼ºã€‚</li></ul><p>å½“ç„¶ï¼Œè½¯ä»¶è®¾è®¡æ¨¡å¼åªæ˜¯ä¸€ä¸ªå¼•å¯¼ã€‚åœ¨å…·ä½“çš„è½¯ä»¶å¹µå‘ä¸­ï¼Œå¿…é¡»æ ¹æ®è®¾è®¡çš„åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹å’Œè¦æ±‚æ¥æ°å½“é€‰æ‹©ã€‚å¯¹äºç®€å•çš„ç¨‹åºå¼€å‘ï¼Œè‹›èƒ½å†™ä¸€ä¸ªç®€å•çš„ç®—æ³•è¦æ¯”å¼•å…¥æŸç§è®¾è®¡æ¨¡å¼æ›´åŠ å®¹æ˜“ã€‚ä½†å¯¹å¤§é¡¹ç›®çš„å¼€å‘æˆ–è€…æ¡†æ¶è®¾è®¡ï¼Œç”¨è®¾è®¡æ¨¡å¼æ¥ç»„ç»‡ä»£ç æ˜¾ç„¶æ›´å¥½ã€‚</p><hr><p>ä»Šå¤©å°±å¼€å§‹æ€»ç»“ä¸€ä¸‹ï¼Œå¼€å‘ä¸­æœ€å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼š<font color="red"><strong>å·¥å‚æ¨¡å¼</strong></font></p><p>æŒ‰å®é™…ä¸šåŠ¡åœºæ™¯åˆ’åˆ†ï¼Œå·¥å‚æ¨¡å¼æœ‰ 3 ç§ä¸åŒçš„å®ç°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ã€‚</p><h3 id="ä¸€ã€ç®€å•å·¥å‚æ¨¡å¼"><a href="#ä¸€ã€ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ä¸€ã€ç®€å•å·¥å‚æ¨¡å¼"></a>ä¸€ã€ç®€å•å·¥å‚æ¨¡å¼</h3><p>æˆ‘ä»¬æŠŠè¢«åˆ›å»ºçš„å¯¹è±¡ç§°ä¸ºâ€œäº§å“â€ï¼ŒæŠŠåˆ›å»ºäº§å“çš„å¯¹è±¡ç§°ä¸ºâ€œå·¥å‚â€ã€‚å¦‚æœè¦åˆ›å»ºçš„äº§å“ä¸å¤šï¼Œåªè¦ä¸€ä¸ªå·¥å‚ç±»å°±å¯ä»¥å®Œæˆï¼Œè¿™ç§æ¨¡å¼å«â€œç®€å•å·¥å‚æ¨¡å¼â€ã€‚</p><p>åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­åˆ›å»ºå®ä¾‹çš„æ–¹æ³•é€šå¸¸ä¸ºé™æ€ï¼ˆstaticï¼‰æ–¹æ³•ï¼Œå› æ­¤ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰åˆå«ä½œé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆStatic Factory Method Patternï¼‰ã€‚</p><h4 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/8/23 20:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åˆ›å»ºä¸€ä¸ªé¢æ¡çš„åŸºç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">INoodles</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æè¿°æ¯ç§é¢æ¡å•¥æ ·çš„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/8/23 21:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¹²æ‰£é¢å…·ä½“å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GankouNoodles</span> <span class="keyword">extends</span> <span class="title">INoodles</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¹²æ‰£é¢"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/8/23 20:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å…°å·æ‹‰é¢å…·ä½“å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LzNoodles</span> <span class="keyword">extends</span> <span class="title">INoodles</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å…°å·æ‹‰é¢"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/8/23 21:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç®€å•å·¥å‚ç±»ï¼Œè´Ÿè´£ï¼šæ ¹æ®ä¼ å…¥çš„å…¥å‚åˆ›å»ºé‚£ä¸ªå…·ä½“çš„å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleNoodlesFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_LZ = <span class="number">1</span>;<span class="comment">//å…°å·æ‹‰é¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_GK = <span class="number">3</span>;<span class="comment">//å¹²æ‰£é¢</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> INoodles <span class="title">createNoodles</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> TYPE_LZ:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> LzNoodles();</span><br><span class="line">            <span class="keyword">case</span> TYPE_GK:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> GankouNoodles();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> GankouNoodles();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/8/23 21:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:ç®€å•å·¥å‚æ¨¡å¼ï¼Œæµ‹è¯•ç±»ï¼Œæ ¹æ®å·¥å‚çš„æšä¸¾æ¥é€‰æ‹©åˆ›å»ºé‚£ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        INoodles noodles = SimpleNoodlesFactory.createNoodles(SimpleNoodlesFactory.TYPE_GK);</span><br><span class="line">        noodles.desc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>ä¼˜ç‚¹å’Œç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ol><li>å·¥å‚ç±»åŒ…å«å¿…è¦çš„é€»è¾‘åˆ¤æ–­ï¼Œå¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“çš„å®ä¾‹ã€‚å®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„èŒè´£ï¼Œå¾ˆæ–¹ä¾¿çš„åˆ›å»ºå‡ºç›¸åº”çš„äº§å“ã€‚å·¥å‚å’Œäº§å“çš„èŒè´£åŒºåˆ†æ˜ç¡®ã€‚</li><li>å®¢æˆ·ç«¯æ— éœ€çŸ¥é“æ‰€åˆ›å»ºå…·ä½“äº§å“çš„ç±»åï¼Œåªéœ€çŸ¥é“å‚æ•°å³å¯ã€‚</li><li>ä¹Ÿå¯ä»¥å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢å’Œæ·»åŠ æ–°çš„å…·ä½“äº§å“ç±»ã€‚</li></ol><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ol><li>ç®€å•å·¥å‚æ¨¡å¼çš„å·¥å‚ç±»å•ä¸€ï¼Œè´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼ŒèŒè´£è¿‡é‡ï¼Œä¸€æ—¦å¼‚å¸¸ï¼Œæ•´ä¸ªç³»ç»Ÿå°†å—å½±å“ã€‚ä¸”å·¥å‚ç±»ä»£ç ä¼šéå¸¸è‡ƒè‚¿ï¼Œè¿èƒŒé«˜èšåˆåŸåˆ™ã€‚</li><li>ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°ï¼ˆå¼•å…¥æ–°çš„å·¥å‚ç±»ï¼‰ï¼Œå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç†è§£éš¾åº¦</li><li>ç³»ç»Ÿæ‰©å±•å›°éš¾ï¼Œä¸€æ—¦å¢åŠ æ–°äº§å“ä¸å¾—ä¸ä¿®æ”¹å·¥å‚é€»è¾‘ï¼Œåœ¨äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œå¯èƒ½é€ æˆé€»è¾‘è¿‡äºå¤æ‚</li><li>ç®€å•å·¥å‚æ¨¡å¼ä½¿ç”¨äº† static å·¥å‚æ–¹æ³•ï¼Œé€ æˆå·¥å‚è§’è‰²æ— æ³•å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚</li><li>ç®€å•å·¥å‚æ¨¡å¼æ¯å¢åŠ ä¸€ä¸ªäº§å“å°±è¦å¢åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»å’Œä¸€ä¸ªå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</li></ol><h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><p>å¯¹äºäº§å“ç§ç±»ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µï¼Œè€ƒè™‘ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ã€‚ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼çš„å®¢æˆ·ç«¯åªéœ€è¦ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºæ‰€éœ€äº§å“ã€‚</p><h3 id="äºŒã€å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#äºŒã€å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="äºŒã€å·¥å‚æ–¹æ³•æ¨¡å¼"></a>äºŒã€å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>â€œå·¥å‚æ–¹æ³•æ¨¡å¼â€æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„è¿›ä¸€æ­¥æŠ½è±¡åŒ–ï¼Œå…¶å¥½å¤„æ˜¯å¯ä»¥ä½¿ç³»ç»Ÿåœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„æƒ…å†µä¸‹å¼•è¿›æ–°çš„äº§å“ï¼Œå³æ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p><h4 id="ä»£ç ç¤ºä¾‹-1"><a href="#ä»£ç ç¤ºä¾‹-1" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ol><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³• newProduct() æ¥åˆ›å»ºäº§å“ã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºäººç±»æŠ½è±¡å·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractHumanFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œé‡‡ç”¨äº†æ³›å‹ï¼Œå¯¹createHumançš„è¾“å…¥å‚æ•°äº§ç”Ÿä¸¤å±‚é™åˆ¶</span></span><br><span class="line">    <span class="comment">// 1.å¿…é¡»æ˜¯Classç±»å‹</span></span><br><span class="line">    <span class="comment">// 2.å¿…é¡»æ˜¯Humançš„å®ç°ç±»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> &lt;T extends Human&gt; <span class="function">T <span class="title">createHuman</span><span class="params">(Class&lt;T&gt; c)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºäººç±»å…·ä½“å·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HumanFactory</span> <span class="keyword">extends</span> <span class="title">AbstractHumanFactory</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> &lt;T extends Human&gt; <span class="function">T <span class="title">createHuman</span><span class="params">(Class&lt;T&gt; tClass)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªç”Ÿäº§çš„äººç§</span></span><br><span class="line">        Human human = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//äº§ç”Ÿä¸€ä¸ªäººç§</span></span><br><span class="line">            human = (T) Class.forName(tClass.getName()).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"äººç§ç”Ÿæˆé”™è¯¯ï¼"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) human;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæŠ½è±¡äº§å“</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ²¡ä¸ªäººç§çš„çš®è‚¤éƒ½æœ‰ç›¸åº”çš„é¢œè‰²</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äººç±»ä¼šè¯´è¯</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é»‘è‰²äººç§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackHuman</span> <span class="keyword">implements</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é»‘è‰²äººç§çš„çš®è‚¤é¢œè‰²æ˜¯é»‘è‰²çš„ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é»‘äººä¼šè¯´è¯ï¼Œä¸€èˆ¬äººå¬ä¸æ‡‚ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é»„è‰²äººç§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YellowHuman</span> <span class="keyword">implements</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é»„è‰²äººç§çš„çš®è‚¤é¢œè‰²æ˜¯é»„è‰²çš„ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é»„è‰²äººç§ä¼šè¯´è¯ï¼Œä¸€èˆ¬è¯´çš„ éƒ½æ˜¯åŒå­—èŠ‚ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç™½è‰²äººç§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteHuman</span> <span class="keyword">implements</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç™½è‰²äººç§çš„çš®è‚¤é¢œè‰²æ˜¯ç™½è‰²çš„ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç™½è‰²äººç§ä¼šè¯´è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯å•å­—èŠ‚ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥å‚æ–¹æ³•æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/8 15:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NvWaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å£°æ˜é˜´é˜³å…«å¦ç‚‰</span></span><br><span class="line">        AbstractHumanFactory humanFactory = <span class="keyword">new</span> HumanFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¥³å¨²ç¬¬ä¸€æ¬¡é€ äººï¼Œç«å€™ä¸è¶³ï¼Œäºæ˜¯ç™½äººäº§ç”Ÿäº†</span></span><br><span class="line">        System.out.println(<span class="string">"é€ å‡ºæ¥çš„ç¬¬ä¸€æ‰¹äººæ˜¯ç™½è‰²äººç§"</span>);</span><br><span class="line">        Human whiteHuman = humanFactory.createHuman(WhiteHuman<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        whiteHuman.getColor();</span><br><span class="line">        whiteHuman.talk();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¥³å¨²ç¬¬äºŒæ¬¡é€ äººï¼Œ ç«å€™è¿‡è¶³ï¼Œ äºæ˜¯é»‘äººäº§ç”Ÿäº†</span></span><br><span class="line">        System.out.println(<span class="string">"é€ å‡ºçš„ç¬¬äºŒæ‰¹äººæ˜¯é»‘è‰²äººç§"</span>);</span><br><span class="line">        Human blackHuman = humanFactory.createHuman(BlackHuman<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        blackHuman.getColor();</span><br><span class="line">        blackHuman.talk();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰æ¬¡é€ äººï¼Œ ç«å€™åˆšåˆšå¥½ï¼Œ äºæ˜¯é»„è‰²äººç§äº§ç”Ÿäº†</span></span><br><span class="line">        System.out.println(<span class="string">"é€ å‡ºçš„ç¬¬ä¸‰æ‰¹äººæ˜¯é»„è‰²äººç§"</span>);</span><br><span class="line">        Human yellowHuman = humanFactory.createHuman(YellowHuman<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        yellowHuman.getColor();</span><br><span class="line">        yellowHuman.talk();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜ç‚¹å’Œç¼ºç‚¹-1"><a href="#ä¼˜ç‚¹å’Œç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>ä¼˜ç‚¹å’Œç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>ç”¨æˆ·åªéœ€è¦çŸ¥é“å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— é¡»çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ã€‚</li><li>çµæ´»æ€§å¢å¼ºï¼Œå¯¹äºæ–°äº§å“çš„åˆ›å»ºï¼Œåªéœ€å¤šå†™ä¸€ä¸ªç›¸åº”çš„å·¥å‚ç±»ã€‚</li><li>å…¸å‹çš„è§£è€¦æ¡†æ¶ã€‚é«˜å±‚æ¨¡å—åªéœ€è¦çŸ¥é“äº§å“çš„æŠ½è±¡ç±»ï¼Œæ— é¡»å…³å¿ƒå…¶ä»–å®ç°ç±»ï¼Œæ»¡è¶³è¿ªç±³ç‰¹æ³•åˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™å’Œé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</li></ul><h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦</li><li>å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦</li><li>æŠ½è±¡äº§å“åªèƒ½ç”Ÿäº§ä¸€ç§äº§å“ï¼Œæ­¤å¼Šç«¯å¯ä½¿ç”¨<strong>æŠ½è±¡å·¥å‚æ¨¡å¼</strong>è§£å†³ã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><ul><li>å®¢æˆ·åªçŸ¥é“åˆ›å»ºäº§å“çš„å·¥å‚åï¼Œè€Œä¸çŸ¥é“å…·ä½“çš„äº§å“åã€‚å¦‚ TCL ç”µè§†å·¥å‚ã€æµ·ä¿¡ç”µè§†å·¥å‚ç­‰ã€‚</li><li>åˆ›å»ºå¯¹è±¡çš„ä»»åŠ¡ç”±å¤šä¸ªå…·ä½“å­å·¥å‚ä¸­çš„æŸä¸€ä¸ªå®Œæˆï¼Œè€ŒæŠ½è±¡å·¥å‚åªæä¾›åˆ›å»ºäº§å“çš„æ¥å£ã€‚</li><li>å®¢æˆ·ä¸å…³å¿ƒåˆ›å»ºäº§å“çš„ç»†èŠ‚ï¼Œåªå…³å¿ƒäº§å“çš„å“ç‰Œ</li></ul><h3 id="ä¸‰ã€æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#ä¸‰ã€æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="ä¸‰ã€æŠ½è±¡å·¥å‚æ¨¡å¼"></a>ä¸‰ã€æŠ½è±¡å·¥å‚æ¨¡å¼</h3><p>æŠ½è±¡å·¥å‚ï¼ˆAbstractFactoryï¼‰æ¨¡å¼çš„å®šä¹‰ï¼šæ˜¯ä¸€ç§ä¸ºè®¿é—®ç±»æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œä¸”è®¿é—®ç±»æ— é¡»æŒ‡å®šæ‰€è¦äº§å“çš„å…·ä½“ç±»å°±èƒ½å¾—åˆ°åŒæ—çš„ä¸åŒç­‰çº§çš„äº§å“çš„æ¨¡å¼ç»“æ„ã€‚</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆæœ¬ï¼Œ<u>å·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç­‰çº§çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç­‰çº§çš„äº§å“</u>ã€‚</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œä¹Ÿç§°ä¸ºå·¥å‚çš„å·¥å‚ï¼Œæœ‰ä¸€ä¸ªå·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚ã€‚å½“ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨è¶…çº§å·¥å‚åˆ›å»ºå·¥å‚ï¼Œç„¶åä½¿ç”¨åˆ›å»ºçš„å·¥å‚åˆ›å»ºå¯¹è±¡ã€‚</p><h4 id="ä»£ç ç¤ºä¾‹-2"><a href="#ä»£ç ç¤ºä¾‹-2" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><p>æŠ½è±¡å·¥å‚æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ã€‚</p><ol><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œå®ƒåŒ…å«å¤šä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³• newProduct()ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒç­‰çº§çš„äº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcrete Factoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¤šä¸ªæŠ½è±¡äº§å“ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ã€‚</li></ol><p>æˆ‘ä»¬å°†è¦åˆ›å»ºå½¢çŠ¶å’Œæ‰“å°æœºã€‚å¯¹äºå½¢çŠ¶ï¼Œæˆ‘ä»¬ä¼šæœ‰åœ†å½¢ï¼ŒçŸ©å½¢å’Œæ­£æ–¹å½¢ã€‚å¯¹äºæ‰“å°æœºï¼Œæˆ‘ä»¬å°†æœ‰çº¸å¼ æ‰“å°æœºï¼Œç½‘ç»œæ‰“å°æœºå’Œå±å¹•æ‰“å°æœºã€‚</p><h5 id="1ã€åˆ›å»ºé¢œè‰²ç›¸å…³çš„ç±»"><a href="#1ã€åˆ›å»ºé¢œè‰²ç›¸å…³çš„ç±»" class="headerlink" title="1ã€åˆ›å»ºé¢œè‰²ç›¸å…³çš„ç±»"></a>1ã€åˆ›å»ºé¢œè‰²ç›¸å…³çš„ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¢œè‰²æŠ½è±¡äº§å“ï¼šåˆ›å»ºé¢œè‰²çš„æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¢œè‰²å…·ä½“äº§å“ï¼šå®ç°é¢œè‰²çš„å…·ä½“å®ç°ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Red</span> <span class="keyword">implements</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"çº¢è‰²é¢œè‰²"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Green</span> <span class="keyword">implements</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç»¿è‰²é¢œè‰²"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blue</span> <span class="keyword">implements</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è“è‰²é¢œè‰²"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2ã€åˆ›å»ºå½¢çŠ¶ç›¸å…³çš„ç±»"><a href="#2ã€åˆ›å»ºå½¢çŠ¶ç›¸å…³çš„ç±»" class="headerlink" title="2ã€åˆ›å»ºå½¢çŠ¶ç›¸å…³çš„ç±»"></a>2ã€åˆ›å»ºå½¢çŠ¶ç›¸å…³çš„ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½¢çŠ¶æŠ½è±¡äº§å“ï¼šåˆ›å»ºå½¢çŠ¶çš„æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å½¢çŠ¶å…·ä½“äº§å“</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é•¿æ–¹å½¢å®ç°ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é•¿æ–¹å½¢"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£æ–¹å½¢å®ç°ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ­£æ–¹å½¢"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ†å®ç°ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åœ†å½¢"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3ã€åˆ›å»ºæŠ½è±¡å·¥å‚ç±»"><a href="#3ã€åˆ›å»ºæŠ½è±¡å·¥å‚ç±»" class="headerlink" title="3ã€åˆ›å»ºæŠ½è±¡å·¥å‚ç±»"></a>3ã€åˆ›å»ºæŠ½è±¡å·¥å‚ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»æ¥è·å–æ‰“å°æœºå’Œå½¢çŠ¶å¯¹è±¡çš„å·¥å‚ä¸º Color å’Œ Shape å¯¹è±¡åˆ›å»ºæŠ½è±¡ç±»æ¥è·å–å·¥å‚ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Color <span class="title">getColor</span><span class="params">(String color)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Shape <span class="title">getShape</span><span class="params">(String shape)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4ã€åˆ›å»ºé¢œè‰²çš„å…·ä½“å·¥å‚ç±»"><a href="#4ã€åˆ›å»ºé¢œè‰²çš„å…·ä½“å·¥å‚ç±»" class="headerlink" title="4ã€åˆ›å»ºé¢œè‰²çš„å…·ä½“å·¥å‚ç±»"></a>4ã€åˆ›å»ºé¢œè‰²çš„å…·ä½“å·¥å‚ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ‰©å±•äº† é¢œè‰²çš„ AbstractFactory çš„å·¥å‚ç±»ï¼ŒåŸºäºç»™å®šçš„ä¿¡æ¯ç”Ÿæˆå®ä½“ç±»çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorFactory</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shape <span class="title">getShape</span><span class="params">(String shapeType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Color <span class="title">getColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (color == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">"RED"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Red();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">"GREEN"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Green();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (color.equalsIgnoreCase(<span class="string">"BLUE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Blue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5ã€åˆ›å»ºå½¢çŠ¶çš„å…·ä½“å·¥å‚ç±»"><a href="#5ã€åˆ›å»ºå½¢çŠ¶çš„å…·ä½“å·¥å‚ç±»" class="headerlink" title="5ã€åˆ›å»ºå½¢çŠ¶çš„å…·ä½“å·¥å‚ç±»"></a>5ã€åˆ›å»ºå½¢çŠ¶çš„å…·ä½“å·¥å‚ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ‰©å±•äº† å½¢çŠ¶ çš„AbstractFactory çš„å·¥å‚ç±»ï¼ŒåŸºäºç»™å®šçš„ä¿¡æ¯ç”Ÿæˆå®ä½“ç±»çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Shape <span class="title">getShape</span><span class="params">(String shapeType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (shapeType == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">"CIRCLE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Circle();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">"RECTANGLE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Rectangle();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeType.equalsIgnoreCase(<span class="string">"SQUARE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Square();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Color <span class="title">getColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6ã€åˆ›å»ºè¶…çº§å·¥å‚ç±»"><a href="#6ã€åˆ›å»ºè¶…çº§å·¥å‚ç±»" class="headerlink" title="6ã€åˆ›å»ºè¶…çº§å·¥å‚ç±»"></a>6ã€åˆ›å»ºè¶…çº§å·¥å‚ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå·¥å‚åˆ›é€ å™¨/ç”Ÿæˆå™¨ç±»ï¼Œé€šè¿‡ä¼ é€’å½¢çŠ¶æˆ–é¢œè‰²ä¿¡æ¯æ¥è·å–å·¥å‚ã€‚é€šè¿‡å·¥å‚æ¥åˆ›å»ºå…·ä½“çš„å·¥å‚ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbstractFactory <span class="title">getFactory</span><span class="params">(String choice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (choice.equalsIgnoreCase(<span class="string">"SHAPE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ShapeFactory();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice.equalsIgnoreCase(<span class="string">"COLOR"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ColorFactory();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="7ã€æµ‹è¯•è¿è¡Œ"><a href="#7ã€æµ‹è¯•è¿è¡Œ" class="headerlink" title="7ã€æµ‹è¯•è¿è¡Œ"></a>7ã€æµ‹è¯•è¿è¡Œ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡å·¥å‚æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/8 16:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å½¢çŠ¶å·¥å‚</span></span><br><span class="line">        AbstractFactory shapeFactory = FactoryProducer.getFactory(<span class="string">"SHAPE"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å½¢çŠ¶ä¸º Circle çš„å¯¹è±¡</span></span><br><span class="line">        Shape shape1 = shapeFactory.getShape(<span class="string">"CIRCLE"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Circle çš„ draw æ–¹æ³•</span></span><br><span class="line">        shape1.draw();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å½¢çŠ¶ä¸º Rectangle çš„å¯¹è±¡</span></span><br><span class="line">        Shape shape2 = shapeFactory.getShape(<span class="string">"RECTANGLE"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Rectangle çš„ draw æ–¹æ³•</span></span><br><span class="line">        shape2.draw();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å½¢çŠ¶ä¸º Square çš„å¯¹è±¡</span></span><br><span class="line">        Shape shape3 = shapeFactory.getShape(<span class="string">"SQUARE"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Square çš„ draw æ–¹æ³•</span></span><br><span class="line">        shape3.draw();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–é¢œè‰²å·¥å‚</span></span><br><span class="line">        AbstractFactory colorFactory = FactoryProducer.getFactory(<span class="string">"COLOR"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–é¢œè‰²ä¸º Red çš„å¯¹è±¡</span></span><br><span class="line">        Color color1 = colorFactory.getColor(<span class="string">"RED"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Red çš„ fill æ–¹æ³•</span></span><br><span class="line">        color1.fill();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–é¢œè‰²ä¸º Green çš„å¯¹è±¡</span></span><br><span class="line">        Color color2 = colorFactory.getColor(<span class="string">"Green"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Green çš„ fill æ–¹æ³•</span></span><br><span class="line">        color2.fill();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–é¢œè‰²ä¸º Blue çš„å¯¹è±¡</span></span><br><span class="line">        Color color3 = colorFactory.getColor(<span class="string">"BLUE"</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ Blue çš„ fill æ–¹æ³•</span></span><br><span class="line">        color3.fill();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜ç‚¹å’Œç¼ºç‚¹-2"><a href="#ä¼˜ç‚¹å’Œç¼ºç‚¹-2" class="headerlink" title="ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>ä¼˜ç‚¹å’Œç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚</li><li>å¯ä»¥åœ¨ç±»çš„å†…éƒ¨å¯¹äº§å“æ—ä¸­ç›¸å…³è”çš„å¤šç­‰çº§äº§å“å…±åŒç®¡ç†ï¼Œè€Œä¸å¿…ä¸“é—¨å¼•å…¥å¤šä¸ªæ–°çš„ç±»æ¥è¿›è¡Œç®¡ç†ã€‚</li><li>æŠ½è±¡å·¥å‚å¢å¼ºäº†ç¨‹åºçš„å¯æ‰©å±•æ€§ï¼Œå½“å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹åŸä»£ç ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li></ul><h5 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>å½“äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ã€‚</li></ul><h4 id="åº”ç”¨åœºæ™¯-2"><a href="#åº”ç”¨åœºæ™¯-2" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><ul><li>å½“éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€ç³»åˆ—ç›¸äº’å…³è”æˆ–ç›¸äº’ä¾èµ–çš„äº§å“æ—æ—¶ï¼Œå¦‚ç”µå™¨å·¥å‚ä¸­çš„ç”µè§†æœºã€æ´—è¡£æœºã€ç©ºè°ƒç­‰ã€‚</li><li>ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº§å“æ—ï¼Œä½†æ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„æŸä¸€æ—äº§å“ã€‚å¦‚æœ‰äººåªå–œæ¬¢ç©¿æŸä¸€ä¸ªå“ç‰Œçš„è¡£æœå’Œé‹ã€‚</li><li>ç³»ç»Ÿä¸­æä¾›äº†äº§å“çš„ç±»åº“ï¼Œä¸”æ‰€æœ‰äº§å“çš„æ¥å£ç›¸åŒï¼Œå®¢æˆ·ç«¯ä¸ä¾èµ–äº§å“å®ä¾‹çš„åˆ›å»ºç»†èŠ‚å’Œå†…éƒ¨ç»“æ„ã€‚</li></ul><h3 id="å››ã€å‚è€ƒèµ„æ–™"><a href="#å››ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å››ã€å‚è€ƒèµ„æ–™"></a>å››ã€å‚è€ƒèµ„æ–™</h3><p><a href="http://c.biancheng.net/design_pattern/" target="_blank" rel="noopener">ã€ŠJavaè®¾è®¡æ¨¡å¼ï¼š23ç§è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼ˆè¶…çº§è¯¦ç»†ï¼‰ã€‹</a><br><a href="https://www.runoob.com/design-pattern/design-pattern-intro.html" target="_blank" rel="noopener">ã€ŠJavaè®¾è®¡æ¨¡å¼ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠèŠSpringäº‹åŠ¡å¤±æ•ˆçš„12ç§åœºæ™¯</title>
    <url>/post/8570e6fb.html</url>
    <content><![CDATA[<blockquote><p>æ¥å§ï¼ŒèŠèŠäº‹åŠ¡å¤±æ•ˆçš„ä¸€äº›åœºæ™¯ï¼Œè¯´ä¸å®šä½ å·²ç»ä¸­æ‹›äº†ã€‚ä¸ä¿¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€åœºæ™¯å…¨å›¾"><a href="#ä¸€ã€åœºæ™¯å…¨å›¾" class="headerlink" title="ä¸€ã€åœºæ™¯å…¨å›¾"></a>ä¸€ã€åœºæ™¯å…¨å›¾</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210922163221.jpeg" alt=""></p><h3 id="äºŒã€ä¸¾ä¾‹è¯´æ˜"><a href="#äºŒã€ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="äºŒã€ä¸¾ä¾‹è¯´æ˜"></a>äºŒã€ä¸¾ä¾‹è¯´æ˜</h3><p>â€‹ ä¸Šé¢åˆ—ä¸¾äº†æœ‰12ç§åœºæ™¯ï¼Œè¿™é‡Œå’±ä»¬åªæ‹¿å…¶ä¸­çš„å‡ ä¸ªä¸æ€ä¹ˆå¥½ç†è§£çš„åœºæ™¯ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ã€‚</p><h4 id="1ã€æ–¹æ³•ç”¨finalä¿®é¥°"><a href="#1ã€æ–¹æ³•ç”¨finalä¿®é¥°" class="headerlink" title="1ã€æ–¹æ³•ç”¨finalä¿®é¥°"></a>1ã€æ–¹æ³•ç”¨finalä¿®é¥°</h4><p>å°†äº‹åŠ¡æ–¹æ³•å®šä¹‰æˆfinalçš„ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆçš„ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¦‚æœä½ çœ‹è¿‡springäº‹åŠ¡çš„æºç ï¼Œå¯èƒ½ä¼šçŸ¥é“springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ–¹æ³•æ˜¯staticçš„ï¼ŒåŒæ ·æ— æ³•é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå˜æˆäº‹åŠ¡æ–¹æ³•ã€‚</p><h4 id="2ã€æ–¹æ³•å†…éƒ¨è°ƒç”¨"><a href="#2ã€æ–¹æ³•å†…éƒ¨è°ƒç”¨" class="headerlink" title="2ã€æ–¹æ³•å†…éƒ¨è°ƒç”¨"></a>2ã€æ–¹æ³•å†…éƒ¨è°ƒç”¨</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªServiceç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Transactional</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(UserModel userModel)</span> </span>&#123; </span><br><span class="line">        userMapper.insertUser(userModel); </span><br><span class="line">        <span class="comment">// ç›´æ¥è°ƒå–</span></span><br><span class="line">        updateStatus(userModel); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Transactional</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStatus</span><span class="params">(UserModel userModel)</span> </span>&#123; </span><br><span class="line">        doSameThing(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•updateStatusã€‚updateStatusæ–¹æ³•æ‹¥æœ‰äº‹åŠ¡çš„èƒ½åŠ›æ˜¯å› ä¸º <strong>spring aopç”Ÿæˆä»£ç†äº†å¯¹è±¡</strong>ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ç›´æ¥è°ƒç”¨äº†thiså¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥updateStatusæ–¹æ³•ä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</p><p>å¦‚æœçœŸçš„éœ€è¦æ€ä¹ˆåŠï¼Ÿ</p><h5 id="1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"><a href="#1-æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•" class="headerlink" title="1.æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•"></a>1.<strong>æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•</strong></h5><h5 id="2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"><a href="#2-åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±" class="headerlink" title="2.åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±"></a>2.<strong>åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±</strong></h5><h5 id="3-é€šè¿‡AopContentç±»"><a href="#3-é€šè¿‡AopContentç±»" class="headerlink" title="3.é€šè¿‡AopContentç±»"></a>3.<strong>é€šè¿‡AopContentç±»</strong></h5><h4 id="3ã€å¤šçº¿ç¨‹è°ƒç”¨"><a href="#3ã€å¤šçº¿ç¨‹è°ƒç”¨" class="headerlink" title="3ã€å¤šçº¿ç¨‹è°ƒç”¨"></a>3ã€å¤šçº¿ç¨‹è°ƒç”¨</h4><p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„ã€‚å¦‚æœspringäº‹åŠ¡ç”¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œä¼šæœ‰é—®é¢˜å—?</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j </span><br><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper; </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> RoleService roleService; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Transactional</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(UserModel userModel)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">        userMapper.insertUser(userModel); </span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123; </span><br><span class="line">            roleService.doOtherThing(); </span><br><span class="line">        &#125;).start(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleService</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Transactional</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doOtherThing</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        System.out.println(<span class="string">"ä¿å­˜roleè¡¨æ•°æ®"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œè°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•doOtherThingï¼Œä½†æ˜¯äº‹åŠ¡æ–¹æ³•doOtherThingæ˜¯åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚</p><p>è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ã€‚å¦‚æœæƒ³doOtherThingæ–¹æ³•ä¸­æŠ›äº†å¼‚å¸¸ï¼Œaddæ–¹æ³•ä¹Ÿå›æ»šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>å¦‚æœçœ‹è¿‡springäº‹åŠ¡æºç çš„æœ‹å‹ï¼Œå¯èƒ½ä¼šçŸ¥é“springçš„äº‹åŠ¡æ˜¯é€šè¿‡æ•°æ®åº“è¿æ¥æ¥å®ç°çš„ã€‚å½“å‰çº¿ç¨‹ä¸­ä¿å­˜äº†ä¸€ä¸ªmapï¼Œkeyæ˜¯æ•°æ®æºï¼Œvalueæ˜¯æ•°æ®åº“è¿æ¥ã€‚</p><p>æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»šã€‚å¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‹¿åˆ°çš„æ•°æ®åº“è¿æ¥è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚</p><h4 id="4ã€è¡¨ä¸æ”¯æŒäº‹åŠ¡"><a href="#4ã€è¡¨ä¸æ”¯æŒäº‹åŠ¡" class="headerlink" title="4ã€è¡¨ä¸æ”¯æŒäº‹åŠ¡"></a>4ã€è¡¨ä¸æ”¯æŒäº‹åŠ¡</h4><p>å‘¨æ‰€å‘¨çŸ¥ï¼Œåœ¨mysql5ä¹‹å‰ï¼Œé»˜è®¤çš„æ•°æ®åº“å¼•æ“æ˜¯myisamã€‚</p><p>å®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ï¼šç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå¯¹äºæŸ¥å¤šå†™å°‘çš„å•è¡¨æ“ä½œï¼Œæ€§èƒ½æ¯”innodbæ›´å¥½ã€‚</p><p>myisamå¥½ç”¨ï¼Œä½†æœ‰ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜æ˜¯ï¼šä¸æ”¯æŒäº‹åŠ¡ã€‚</p><p>å¦‚æœåªæ˜¯å•è¡¨æ“ä½œè¿˜å¥½ï¼Œä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚ä½†å¦‚æœéœ€è¦è·¨å¤šå¼ è¡¨æ“ä½œï¼Œç”±äºå…¶ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ææœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µã€‚</p><p>æ­¤å¤–ï¼Œmyisamè¿˜ä¸æ”¯æŒè¡Œé”å’Œå¤–é”®ã€‚</p><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸå¼ è¡¨çš„äº‹åŠ¡ä¸€ç›´éƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¸ä¸€å®šæ˜¯springäº‹åŠ¡çš„é”…ï¼Œæœ€å¥½ç¡®è®¤ä¸€ä¸‹ä½ ä½¿ç”¨çš„é‚£å¼ è¡¨ï¼Œæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚</p><h3 id="ä¸‰ã€-å¤§äº‹åŠ¡é—®é¢˜"><a href="#ä¸‰ã€-å¤§äº‹åŠ¡é—®é¢˜" class="headerlink" title="ä¸‰ã€ å¤§äº‹åŠ¡é—®é¢˜"></a>ä¸‰ã€ å¤§äº‹åŠ¡é—®é¢˜</h3><p>åœ¨ä½¿ç”¨springäº‹åŠ¡æ—¶ï¼Œæœ‰ä¸ªè®©äººéå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§äº‹åŠ¡é—®é¢˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸Š@Transactionalæ³¨è§£ï¼Œå¡«åŠ äº‹åŠ¡åŠŸèƒ½ã€‚ä½†@Transactionalæ³¨è§£ï¼Œå¦‚æœè¢«åŠ åˆ°æ–¹æ³•ä¸Šï¼Œæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ•´ä¸ªæ–¹æ³•éƒ½åŒ…å«åœ¨äº‹åŠ¡å½“ä¸­äº†ã€‚ä½†æ˜¯è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„queryæ–¹æ³•ä¹Ÿè¢«åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ã€‚å¦‚æœqueryæ–¹æ³•éå¸¸å¤šï¼Œè°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†æŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡éå¸¸è€—æ—¶ï¼Œè€Œä»é€ æˆå¤§äº‹åŠ¡é—®é¢˜ã€‚</p><p>å¦‚ä½•è§£å†³ï¼Ÿ</p><p>ä¸Šé¢èŠçš„è¿™äº›å†…å®¹éƒ½æ˜¯åŸºäº@Transactionalæ³¨è§£çš„ï¼Œä¸»è¦è¯´çš„æ˜¯å®ƒçš„äº‹åŠ¡é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šå£°æ˜å¼äº‹åŠ¡ã€‚</p><p>å…¶å®ï¼Œspringè¿˜æä¾›äº†å¦å¤–ä¸€ç§åˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ï¼Œå³é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç å®ç°çš„äº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼šç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span> </span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate; </span><br><span class="line"> </span><br><span class="line">... </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="keyword">final</span> User user)</span> </span>&#123; </span><br><span class="line">      queryData1(); </span><br><span class="line">      queryData2(); </span><br><span class="line">      transactionTemplate.execute((status) =&gt; &#123; </span><br><span class="line">         addData1(); </span><br><span class="line">         updateData2(); </span><br><span class="line">         <span class="keyword">return</span> Boolean.TRUE; </span><br><span class="line">      &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨springä¸­ä¸ºäº†æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ï¼šTransactionTemplateï¼Œåœ¨å®ƒçš„executeæ–¹æ³•ä¸­ï¼Œå°±å®ç°äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚</p><p>ç›¸è¾ƒäº@Transactionalæ³¨è§£å£°æ˜å¼äº‹åŠ¡ï¼Œæˆ‘æ›´å»ºè®®å¤§å®¶ä½¿ç”¨ï¼ŒåŸºäºTransactionTemplateçš„ç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><ul><li>é¿å…ç”±äºspring aopé—®é¢˜ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚</li><li>èƒ½å¤Ÿæ›´å°ç²’åº¦çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ï¼Œæ›´ç›´è§‚ã€‚</li></ul><p>å»ºè®®åœ¨é¡¹ç›®ä¸­å°‘ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡ã€‚ä½†å¹¶ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ç”¨å®ƒï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸ç»å¸¸å˜åŠ¨ï¼Œä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡ä¹Ÿæ— å¦¨ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åƒä¸‡è¦å°å¿ƒäº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»å…¸ç¬”è®°æ•´ç†</title>
    <url>/post/6d2214c4.html</url>
    <content><![CDATA[<blockquote><p>Redisã€RabbitMqã€TCPã€Springã€Mysqlã€Linuxæ€ç»´å¯¼å‘å›¾æ•´ç† ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€RabbitMQ"><a href="#ä¸€ã€RabbitMQ" class="headerlink" title="ä¸€ã€RabbitMQ"></a>ä¸€ã€RabbitMQ</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102609.png" alt="RabbitMq"></p><h3 id="äºŒã€LINUX"><a href="#äºŒã€LINUX" class="headerlink" title="äºŒã€LINUX"></a>äºŒã€LINUX</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102625.png" alt="Linux"></p><h3 id="ä¸‰ã€Mysql"><a href="#ä¸‰ã€Mysql" class="headerlink" title="ä¸‰ã€Mysql"></a>ä¸‰ã€Mysql</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102643.png" alt="Mysql"></p><h3 id="å››ã€Spring"><a href="#å››ã€Spring" class="headerlink" title="å››ã€Spring"></a>å››ã€Spring</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102633.png" alt="Springç¬”è®°"></p><h3 id="äº”ã€TCP-IP"><a href="#äº”ã€TCP-IP" class="headerlink" title="äº”ã€TCP\IP"></a>äº”ã€TCP\IP</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102637.png" alt="TCP:IP"></p><h3 id="å…­ã€Redis"><a href="#å…­ã€Redis" class="headerlink" title="å…­ã€Redis"></a>å…­ã€Redis</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210817102652.png" alt="Redis"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Mind map</category>
      </categories>
      <tags>
        <tag>Mind map</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPåè®®è®°å½•</title>
    <url>/post/e3c11488.html</url>
    <content><![CDATA[<blockquote><p>TCPåè®®è®°å½• ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€TCPåè®®æŠ¥æ–‡æ ¼å¼"><a href="#ä¸€ã€TCPåè®®æŠ¥æ–‡æ ¼å¼" class="headerlink" title="ä¸€ã€TCPåè®®æŠ¥æ–‡æ ¼å¼"></a>ä¸€ã€TCPåè®®æŠ¥æ–‡æ ¼å¼</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210723105315.jpeg" alt="TCPåè®®æŠ¥æ–‡æ ¼å¼"></p><p>å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å­—æ®µæœ‰ï¼š</p><p>ï¼ˆ1ï¼‰åºå·ï¼ˆsequence numberï¼‰ï¼šSeqåºå·ï¼Œå 32ä½ï¼Œç”¨æ¥æ ‡è¯†ä»TCPæºç«¯å‘ç›®çš„ç«¯å‘é€çš„å­—èŠ‚æµï¼Œå‘èµ·æ–¹å‘é€æ•°æ®æ—¶å¯¹æ­¤è¿›è¡Œæ ‡è®°ã€‚</p><p>ï¼ˆ2ï¼‰ç¡®è®¤å·ï¼ˆacknowledgement numberï¼‰ï¼šAckåºå·ï¼Œå 32ä½ï¼Œåªæœ‰ACKæ ‡å¿—ä½ä¸º1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼ŒAck=Seq+1ã€‚</p><p>ï¼ˆ3ï¼‰æ ‡å¿—ä½ï¼ˆFlagsï¼‰ï¼šå…±6ä¸ªï¼Œå³URGã€ACKã€PSHã€RSTã€SYNã€FINç­‰ã€‚å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>URG</td><td>ç´§æ€¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆã€‚ä¸º1ï¼Œè¡¨ç¤ºæŸä¸€ä½éœ€è¦è¢«ä¼˜å…ˆå¤„ç†</td></tr><tr><td>ACK</td><td>ç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆï¼Œä¸€èˆ¬ç½®ä¸º1ã€‚</td></tr><tr><td>PSH</td><td>æç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºç«‹å³ä»TCPç¼“å†²åŒºæŠŠæ•°æ®è¯»èµ°ã€‚</td></tr><tr><td>RST</td><td>å¯¹æ–¹è¦æ±‚é‡æ–°å»ºç«‹è¿æ¥ï¼Œå¤ä½ã€‚</td></tr><tr><td>SYN</td><td>è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨å…¶åºåˆ—å·çš„å­—æ®µè¿›è¡Œåºåˆ—å·çš„åˆå§‹å€¼è®¾å®šã€‚å»ºç«‹è¿æ¥ï¼Œè®¾ç½®ä¸º1</td></tr><tr><td>FIN</td><td>å¸Œæœ›æ–­å¼€è¿æ¥ã€‚</td></tr></tbody></table><h3 id="äºŒã€TCP-IPåè®®åˆ†å±‚"><a href="#äºŒã€TCP-IPåè®®åˆ†å±‚" class="headerlink" title="äºŒã€TCP/IPåè®®åˆ†å±‚"></a>äºŒã€TCP/IPåè®®åˆ†å±‚</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210723105327.jpg" alt="TCP/IPåè®®åˆ†å±‚"></p><h3 id="ä¸‰ã€TCPä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰ã€TCPä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰ã€TCPä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰ã€TCPä¸‰æ¬¡æ¡æ‰‹</h3><p>æ‰€è°“ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰å³å»ºç«‹TCPè¿æ¥ï¼Œå°±æ˜¯æŒ‡å»ºç«‹ä¸€ä¸ªTCPè¿æ¥æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ€»å…±å‘é€3ä¸ªåŒ…ä»¥ç¡®è®¤è¿æ¥çš„å»ºç«‹ã€‚åœ¨socketç¼–ç¨‹ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹ç”±å®¢æˆ·ç«¯æ‰§è¡Œconnectæ¥è§¦å‘ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210723105330.png" alt="TCPä¸‰æ¬¡æ¡æ‰‹"></p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†æ ‡å¿—ä½SYNç½®ä¸º1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Jï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒClientè¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…Serverç¡®è®¤ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°æ•°æ®åŒ…åç”±æ ‡å¿—ä½SYN=1çŸ¥é“Clientè¯·æ±‚å»ºç«‹è¿æ¥ï¼ŒServerå°†æ ‡å¿—ä½SYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œack=J+1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Kï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Clientä»¥ç¡®è®¤è¿æ¥è¯·æ±‚ï¼ŒServerè¿›å…¥SYN_RCVDçŠ¶æ€ã€‚</p><p>ï¼ˆ3ï¼‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientæ”¶åˆ°ç¡®è®¤åï¼Œæ£€æŸ¥ackæ˜¯å¦ä¸ºJ+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™å°†æ ‡å¿—ä½ACKç½®ä¸º1ï¼Œack=K+1ï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒServeræ£€æŸ¥ackæ˜¯å¦ä¸ºK+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™è¿æ¥å»ºç«‹æˆåŠŸï¼ŒClientå’ŒServerè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒéšåClientä¸Serverä¹‹é—´å¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯</p><p>1ã€å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€SYNåŒ…ï¼ˆSYN=iï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥åˆ°SYN-SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤</p><p>2ã€æœåŠ¡å™¨æ”¶åˆ°SYNåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=i+1ï¼‰,åŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆSYN=kï¼‰,å³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN-RECVçŠ¶æ€</p><p>3ã€å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤æŠ¥ACKï¼ˆack=k+1ï¼‰,æ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¼€å§‹ä¼ é€æ•°æ®ã€‚</p><p><strong>SYNæ”»å‡»</strong>ï¼š</p><p>åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒServerå‘é€SYN-ACKä¹‹åï¼Œæ”¶åˆ°Clientçš„ACKä¹‹å‰çš„TCPè¿æ¥ç§°ä¸ºåŠè¿æ¥ï¼ˆhalf-open connectï¼‰ï¼Œæ­¤æ—¶Serverå¤„äºSYN_RCVDçŠ¶æ€ï¼Œå½“æ”¶åˆ°ACKåï¼ŒServerè½¬å…¥ESTABLISHEDçŠ¶æ€ã€‚SYNæ”»å‡»å°±æ˜¯Clientåœ¨çŸ­æ—¶é—´å†…ä¼ªé€ å¤§é‡ä¸å­˜åœ¨çš„IPåœ°å€ï¼Œå¹¶å‘Serverä¸æ–­åœ°å‘é€SYNåŒ…ï¼ŒServerå›å¤ç¡®è®¤åŒ…ï¼Œå¹¶ç­‰å¾…Clientçš„ç¡®è®¤ï¼Œç”±äºæºåœ°å€æ˜¯ä¸å­˜åœ¨çš„ï¼Œå› æ­¤ï¼ŒServeréœ€è¦ä¸æ–­é‡å‘ç›´è‡³è¶…æ—¶ï¼Œè¿™äº›ä¼ªé€ çš„SYNåŒ…å°†äº§æ—¶é—´å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œå¯¼è‡´æ­£å¸¸çš„SYNè¯·æ±‚å› ä¸ºé˜Ÿåˆ—æ»¡è€Œè¢«ä¸¢å¼ƒï¼Œä»è€Œå¼•èµ·ç½‘ç»œå µå¡ç”šè‡³ç³»ç»Ÿç˜«ç—ªã€‚SYNæ”»å‡»æ—¶ä¸€ç§å…¸å‹çš„DDOSæ”»å‡»ï¼Œæ£€æµ‹SYNæ”»å‡»çš„æ–¹å¼éå¸¸ç®€å•ï¼Œå³å½“Serverä¸Šæœ‰å¤§é‡åŠè¿æ¥çŠ¶æ€ä¸”æºIPåœ°å€æ˜¯éšæœºçš„ï¼Œåˆ™å¯ä»¥æ–­å®šé­åˆ°SYNæ”»å‡»äº†ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥è®©ä¹‹ç°è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">netstat -nap | grep SYN_RECV</span></span><br></pre></td></tr></table></figure><h3 id="å››ã€TCPå››æ¬¡æŒ¥æ‰‹"><a href="#å››ã€TCPå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››ã€TCPå››æ¬¡æŒ¥æ‰‹"></a>å››ã€TCPå››æ¬¡æŒ¥æ‰‹</h3><p>æ‰€è°“å››æ¬¡æŒ¥æ‰‹ï¼ˆFour-Way Wavehandï¼‰å³ç»ˆæ­¢TCPè¿æ¥ï¼Œå°±æ˜¯æŒ‡æ–­å¼€ä¸€ä¸ªTCPè¿æ¥æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ€»å…±å‘é€4ä¸ªåŒ…ä»¥ç¡®è®¤è¿æ¥çš„æ–­å¼€ã€‚åœ¨socketç¼–ç¨‹ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹ç”±å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯ä»»ä¸€æ–¹æ‰§è¡Œcloseæ¥è§¦å‘ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210723105333.png" alt="TCPå››æ¬¡æŒ¥æ‰‹"></p><p>ç”±äºTCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤ï¼Œæ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»è¦å•ç‹¬è¿›è¡Œå…³é—­ï¼Œè¿™ä¸€åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆæ•°æ®å‘é€ä»»åŠ¡åï¼Œå‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸€æ–¹å‘çš„è¿æ¥ï¼Œæ”¶åˆ°ä¸€ä¸ªFINåªæ˜¯æ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨äº†ï¼Œå³ä¸ä¼šå†æ”¶åˆ°æ•°æ®äº†ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªTCPè¿æ¥ä¸Šä»ç„¶èƒ½å¤Ÿå‘é€æ•°æ®ï¼Œç›´åˆ°è¿™ä¸€æ–¹å‘ä¹Ÿå‘é€äº†FINã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹åˆ™æ‰§è¡Œè¢«åŠ¨å…³é—­ï¼Œä¸Šå›¾æè¿°çš„å³æ˜¯å¦‚æ­¤ã€‚</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šClientå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­Clientåˆ°Serverçš„æ•°æ®ä¼ é€ï¼ŒClientè¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šServeræ”¶åˆ°FINåï¼Œå‘é€ä¸€ä¸ªACKç»™Clientï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ˆä¸SYNç›¸åŒï¼Œä¸€ä¸ªFINå ç”¨ä¸€ä¸ªåºå·ï¼‰ï¼ŒServerè¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚</p><p>ï¼ˆ3ï¼‰ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šServerå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­Serveråˆ°Clientçš„æ•°æ®ä¼ é€ï¼ŒServerè¿›å…¥LAST_ACKçŠ¶æ€ã€‚</p><p>ï¼ˆ4ï¼‰ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šClientæ”¶åˆ°FINåï¼ŒClientè¿›å…¥TIME_WAITçŠ¶æ€ï¼Œæ¥ç€å‘é€ä¸€ä¸ªACKç»™Serverï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ŒServerè¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚</p><h3 id="äº”ã€ç»å…¸é—®é¢˜"><a href="#äº”ã€ç»å…¸é—®é¢˜" class="headerlink" title="äº”ã€ç»å…¸é—®é¢˜"></a>äº”ã€ç»å…¸é—®é¢˜</h3><h4 id="ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ"><a href="#ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ" class="headerlink" title="ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ"></a>ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</h4><p>è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚è€Œå…³é—­è¿æ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œå·±æ–¹ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³closeï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ã€‚</p><h4 id="ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME-WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL-æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´-æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ"><a href="#ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME-WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL-æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´-æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ" class="headerlink" title="ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ"></a>ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ</h4><p>åŸå› æœ‰äºŒï¼š<br>ä¸€ã€ä¿è¯TCPåè®®çš„å…¨åŒå·¥è¿æ¥èƒ½å¤Ÿå¯é å…³é—­<br>äºŒã€ä¿è¯è¿™æ¬¡è¿æ¥çš„é‡å¤æ•°æ®æ®µä»ç½‘ç»œä¸­æ¶ˆå¤±</p><p>å…ˆè¯´ç¬¬ä¸€ç‚¹ï¼Œå¦‚æœClientç›´æ¥CLOSEDäº†ï¼Œé‚£ä¹ˆç”±äºIPåè®®çš„ä¸å¯é æ€§æˆ–è€…æ˜¯å…¶å®ƒç½‘ç»œåŸå› ï¼Œå¯¼è‡´Serveræ²¡æœ‰æ”¶åˆ°Clientæœ€åå›å¤çš„ACKã€‚é‚£ä¹ˆServerå°±ä¼šåœ¨è¶…æ—¶ä¹‹åç»§ç»­å‘é€FINï¼Œæ­¤æ—¶ç”±äºClientå·²ç»CLOSEDäº†ï¼Œå°±æ‰¾ä¸åˆ°ä¸é‡å‘çš„FINå¯¹åº”çš„è¿æ¥ï¼Œæœ€åServerå°±ä¼šæ”¶åˆ°RSTè€Œä¸æ˜¯ACKï¼ŒServerå°±ä¼šä»¥ä¸ºæ˜¯è¿æ¥é”™è¯¯æŠŠé—®é¢˜æŠ¥å‘Šç»™é«˜å±‚ã€‚è¿™æ ·çš„æƒ…å†µè™½ç„¶ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯å´å¯¼è‡´TCPåè®®ä¸ç¬¦åˆå¯é è¿æ¥çš„è¦æ±‚ã€‚æ‰€ä»¥ï¼ŒClientä¸æ˜¯ç›´æ¥è¿›å…¥CLOSEDï¼Œè€Œæ˜¯è¦ä¿æŒTIME_WAITï¼Œå½“å†æ¬¡æ”¶åˆ°FINçš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿è¯å¯¹æ–¹æ”¶åˆ°ACKï¼Œæœ€åæ­£ç¡®çš„å…³é—­è¿æ¥ã€‚</p><p>å†è¯´ç¬¬äºŒç‚¹ï¼Œå¦‚æœClientç›´æ¥CLOSEDï¼Œç„¶ååˆå†å‘Serverå‘èµ·ä¸€ä¸ªæ–°è¿æ¥ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯è¿™ä¸ªæ–°è¿æ¥ä¸åˆšå…³é—­çš„è¿æ¥çš„ç«¯å£å·æ˜¯ä¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´æœ‰å¯èƒ½æ–°è¿æ¥å’Œè€è¿æ¥çš„ç«¯å£å·æ˜¯ç›¸åŒçš„ã€‚ä¸€èˆ¬æ¥è¯´ä¸ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ç‰¹æ®Šæƒ…å†µå‡ºç°ï¼šå‡è®¾æ–°è¿æ¥å’Œå·²ç»å…³é—­çš„è€è¿æ¥ç«¯å£å·æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå‰ä¸€æ¬¡è¿æ¥çš„æŸäº›æ•°æ®ä»ç„¶æ»ç•™åœ¨ç½‘ç»œä¸­ï¼Œè¿™äº›å»¶è¿Ÿæ•°æ®åœ¨å»ºç«‹æ–°è¿æ¥ä¹‹åæ‰åˆ°è¾¾Serverï¼Œç”±äºæ–°è¿æ¥å’Œè€è¿æ¥çš„ç«¯å£å·æ˜¯ä¸€æ ·çš„ï¼Œåˆå› ä¸ºTCPåè®®åˆ¤æ–­ä¸åŒè¿æ¥çš„ä¾æ®æ˜¯socket pairï¼Œäºæ˜¯ï¼ŒTCPåè®®å°±è®¤ä¸ºé‚£ä¸ªå»¶è¿Ÿçš„æ•°æ®æ˜¯å±äºæ–°è¿æ¥çš„ï¼Œè¿™æ ·å°±å’ŒçœŸæ­£çš„æ–°è¿æ¥çš„æ•°æ®åŒ…å‘ç”Ÿæ··æ·†äº†ã€‚æ‰€ä»¥TCPè¿æ¥è¿˜è¦åœ¨TIME_WAITçŠ¶æ€ç­‰å¾…2å€MSLï¼Œè¿™æ ·å¯ä»¥ä¿è¯æœ¬æ¬¡è¿æ¥çš„æ‰€æœ‰æ•°æ®éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootå®‰è£…Jaråˆ°Mavenæœ¬åœ°ä»“åº“</title>
    <url>/post/64582e15.html</url>
    <content><![CDATA[<blockquote><p>SpringBootå®‰è£…Jaråˆ°Mavenæœ¬åœ°ä»“åº“ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€é€šè¿‡mavenå‘½ä»¤å°†Jaræ‰“å…¥æœ¬åœ°ä»“åº“"><a href="#ä¸€ã€é€šè¿‡mavenå‘½ä»¤å°†Jaræ‰“å…¥æœ¬åœ°ä»“åº“" class="headerlink" title="ä¸€ã€é€šè¿‡mavenå‘½ä»¤å°†Jaræ‰“å…¥æœ¬åœ°ä»“åº“"></a>ä¸€ã€é€šè¿‡mavenå‘½ä»¤å°†Jaræ‰“å…¥æœ¬åœ°ä»“åº“</h3><h4 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn install:install-file -Dfile=(jaråŒ…çš„ä½ç½®) -DgroupId=groupId(åˆ†ç»„) -DartifactId=artifactId(jaråç§°) -Dversion=version(ç‰ˆæœ¬å·) -Dpackaging=jar</span><br></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn install:install-file -Dfile=C:\Users\test-core.jar -DgroupId=org.shuaizi -DartifactId=core -Dversion=1.0.0.RELEASE -DpomFile=C:\Users\Desktop\pom.xml -Dpackaging=jar</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>-DpomFile=C:\Users\Desktop\pom.xml</code>æ˜¯æŒ‡å®šå£°æ˜pomæ–‡ä»¶ï¼Œå¦‚æœä¸æŒ‡å®šæœ‰å¯èƒ½ä¼šé—®é¢˜ï¼šå¯¼å…¥çš„é¡¹ç›®æ— æ³•æ‰¾åˆ°<code>Jar</code>é‡Œé¢ä¾èµ–çš„é¢å¤–çš„<code>Jar</code>ã€‚</p><h4 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>åˆ†ç»„<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jarå<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>ç‰ˆæœ¬å·<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="äºŒã€åœ¨æœ¬é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å¼•å…¥"><a href="#äºŒã€åœ¨æœ¬é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å¼•å…¥" class="headerlink" title="äºŒã€åœ¨æœ¬é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å¼•å…¥"></a>äºŒã€åœ¨æœ¬é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å¼•å…¥</h3><h4 id="1ã€åœ¨resourcesä¸‹é¢æ–°å»ºlibæ–‡ä»¶å¤¹æˆ–è€…jaræ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠjaråŒ…æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹"><a href="#1ã€åœ¨resourcesä¸‹é¢æ–°å»ºlibæ–‡ä»¶å¤¹æˆ–è€…jaræ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠjaråŒ…æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹" class="headerlink" title="1ã€åœ¨resourcesä¸‹é¢æ–°å»ºlibæ–‡ä»¶å¤¹æˆ–è€…jaræ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠjaråŒ…æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹"></a>1ã€åœ¨resourcesä¸‹é¢æ–°å»ºlibæ–‡ä»¶å¤¹æˆ–è€…jaræ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠjaråŒ…æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210603102318.png" alt=""></p><h4 id="2ã€å¢åŠ pomæ–‡ä»¶"><a href="#2ã€å¢åŠ pomæ–‡ä»¶" class="headerlink" title="2ã€å¢åŠ pomæ–‡ä»¶"></a>2ã€å¢åŠ pomæ–‡ä»¶</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    	    <span class="comment">&lt;!-- @author Mr.Jia @date 2021/6/3 10:18  groupIdã€artifactIdã€version å‡å¯è‡ªå®šä¹‰ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ckfinder<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- @author Mr.Jia @date 2021/6/3 10:19  è·¯å¾„ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/jar/json-lib-2.3-jdk15.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3ã€å¦‚æœæŠŠé¡¹ç›®æ‰“æˆjarï¼ŒåŒæ—¶æŠŠæœ¬åœ°jaråŒ…ä¹Ÿå¼•å…¥è¿›å»"><a href="#3ã€å¦‚æœæŠŠé¡¹ç›®æ‰“æˆjarï¼ŒåŒæ—¶æŠŠæœ¬åœ°jaråŒ…ä¹Ÿå¼•å…¥è¿›å»" class="headerlink" title="3ã€å¦‚æœæŠŠé¡¹ç›®æ‰“æˆjarï¼ŒåŒæ—¶æŠŠæœ¬åœ°jaråŒ…ä¹Ÿå¼•å…¥è¿›å»"></a>3ã€å¦‚æœæŠŠé¡¹ç›®æ‰“æˆjarï¼ŒåŒæ—¶æŠŠæœ¬åœ°jaråŒ…ä¹Ÿå¼•å…¥è¿›å»</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            mavenæ‰“åŒ…æ—¶ä¼šå°†å¤–éƒ¨å¼•å…¥çš„jaråŒ…ï¼ˆæ¯”å¦‚åœ¨æ ¹ç›®å½•ä¸‹æˆ–resourceæ–‡ä»¶ä¸‹æ–°åŠ å¤–éƒ¨jaråŒ…ï¼‰æ‰“åŒ…åˆ°é¡¹ç›®jarï¼Œ</span></span><br><span class="line"><span class="comment">            åœ¨æœåŠ¡å™¨ä¸Šé¡¹ç›®æ‰èƒ½è¿è¡Œï¼Œä¸åŠ æ­¤é…ç½®ï¼Œæœ¬åœ°å¯ä»¥è¿è¡Œï¼Œ</span></span><br><span class="line"><span class="comment">            å› ä¸ºæœ¬åœ°å¯ä»¥å†libä¸‹æ‰¾åˆ°å¤–éƒ¨åŒ…ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸Šjarä¸­æ˜¯æ²¡æœ‰çš„ã€‚</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Maven</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaç±»åŠ è½½é¡ºåºã€åŒäº²å§”æ´¾æœºåˆ¶</title>
    <url>/post/94bf0674.html</url>
    <content><![CDATA[<blockquote><p>Javaç±»åŠ è½½é¡ºåºã€åŒäº²å§”æ´¾æœºåˆ¶ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹"><a href="#ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹"></a>ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹</h3><p>ç±»åŠ è½½ä¸€å…±åˆ†ä¸ºä¸ƒä¸ªè¿‡ç¨‹ï¼Œä»–ä»¬çš„å…·ä½“çš„é¡ºåºæ˜¯ï¼š<strong>åŠ è½½-&gt;éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ-&gt;åˆå§‹åŒ–</strong>ã€‚</p><ul><li>åŠ è½½ï¼ˆLoadingï¼‰</li><li>éªŒè¯ï¼ˆVerificationï¼‰</li><li>å‡†å¤‡ï¼ˆPreparationï¼‰</li><li>è§£æï¼ˆResolutionï¼‰</li><li>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</li><li>ä½¿ç”¨ï¼ˆUsingï¼‰</li><li>å¸è½½ï¼ˆUnloadingï¼‰</li></ul><h3 id="äºŒã€ç±»åŠ è½½å™¨"><a href="#äºŒã€ç±»åŠ è½½å™¨" class="headerlink" title="äºŒã€ç±»åŠ è½½å™¨"></a>äºŒã€ç±»åŠ è½½å™¨</h3><p>åœ¨<code>JVM</code>åŠ è½½classæ–‡ä»¶ä¸»è¦ç”±ç±»åŠ è½½å™¨å®Œæˆ,ä¸åŒç±»åº“ä¸‹çš„classåŠ è½½çš„åŠ è½½å™¨ä¹Ÿä¸ç›¸åŒï¼Œ<code>JVM</code>ä¸­æœ‰ä»¥ä¸‹<strong>å››</strong>ç§ç±»åŠ è½½å™¨:</p><ol><li><strong><code>BootstrapClassLoader</code></strong>ï¼šå¼•å¯¼ç±»åŠ è½½å™¨: è´Ÿè´£åŠ è½½æ”¯æ’‘<code>JVM</code>è¿è¡Œçš„ä½äºJREçš„libç›®å½•ä¸‹çš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚<code>rt.jar</code>ã€<code>charsets.jar</code> ç­‰ã€‚</li><li><strong><code>ExtClassLoader</code></strong>ï¼šæ‹“å±•ç±»åŠ è½½å™¨: è´Ÿè´£åŠ è½½æ”¯æ’‘<code>JVM</code>è¿è¡Œçš„ä½äº<code>JRE</code>çš„libç›®å½•ä¸‹çš„extæ‰©å±•ç›®å½•ä¸­çš„JARç±»åŒ…,ä»¥ä¸Šä¸¤ç§å‡åŠ è½½<code>JRE</code>ä¸­çš„ã€‚</li><li><strong><code>AppClassLoader</code></strong>ï¼šåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨:è´Ÿè´£åŠ è½½<code>ClassPath</code>è·¯å¾„ä¸‹çš„ç±»åŒ…ï¼Œä¸»è¦å°±æ˜¯åŠ è½½è‡ªå·±å†™çš„ç±»ã€‚</li><li><strong><code>CustomClassLoader</code></strong>ï¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨: è´Ÿè´£åŠ è½½ç”¨æˆ·è‡ªå®šä¹‰è·¯å¾„ä¸‹çš„ç±»åŒ…ã€‚</li></ol><h3 id="ä¸‰ã€åŒäº²å§”æ´¾æœºåˆ¶"><a href="#ä¸‰ã€åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="ä¸‰ã€åŒäº²å§”æ´¾æœºåˆ¶"></a>ä¸‰ã€åŒäº²å§”æ´¾æœºåˆ¶</h3><h4 id="1ã€JDK9-ä¹‹å‰çš„åŒäº²å§”æ´¾æ¨¡å¼"><a href="#1ã€JDK9-ä¹‹å‰çš„åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="1ã€JDK9 ä¹‹å‰çš„åŒäº²å§”æ´¾æ¨¡å¼"></a>1ã€<code>JDK9</code> ä¹‹å‰çš„åŒäº²å§”æ´¾æ¨¡å¼</h4><p><code>JDK9</code> ä¹‹å‰çš„ Java åº”ç”¨éƒ½æ˜¯ç”±ã€Œå¯åŠ¨ç±»åŠ è½½å™¨ã€ã€ã€Œæ‰©å±•ç±»åŠ è½½å™¨ã€ã€ã€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆæ¥å®ŒæˆåŠ è½½çš„ï¼Œå¦‚æœæœ‰éœ€è¦è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ã€‚</p><blockquote><p>è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åœºæ™¯ï¼šå…¸å‹çš„å¦‚å¢åŠ é™¤äº†ç£ç›˜ä½ç½®ä¹‹å¤–çš„ Class æ–‡ä»¶æ¥æºï¼Œæˆ–è€…é€šè¿‡ç±»åŠ è½½å™¨å®ç°ç±»çš„éš”ç¦»ã€é‡è½½ç­‰åŠŸèƒ½ã€‚</p></blockquote><h5 id="å·¥ä½œè¿‡ç¨‹"><a href="#å·¥ä½œè¿‡ç¨‹" class="headerlink" title="å·¥ä½œè¿‡ç¨‹"></a><strong>å·¥ä½œè¿‡ç¨‹</strong></h5><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚<strong>å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</strong>å»å®Œæˆï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</p><h5 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a><strong>å¥½å¤„</strong></h5><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210602163208.png" alt=""></p><h4 id="2-JDK9-çš„åŒäº²å§”æ´¾æ¨¡å¼"><a href="#2-JDK9-çš„åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="2. JDK9 çš„åŒäº²å§”æ´¾æ¨¡å¼"></a>2. <code>JDK9</code> çš„åŒäº²å§”æ´¾æ¨¡å¼</h4><p><code>JDK9</code> ä¹‹åçš„ Java åº”ç”¨éƒ½æ˜¯ç”±ã€Œå¯åŠ¨ç±»åŠ è½½å™¨ã€ã€ã€Œå¹³å°ç±»åŠ è½½å™¨ã€ã€ã€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆæ¥å®ŒæˆåŠ è½½çš„ï¼Œå¦‚æœæœ‰éœ€è¦è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ã€‚</p><p>å½“å¹³å°åŠåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œè¦å…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210602163442.png" style="zoom:80%"><h3 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h3><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210602163739.png" style="zoom:80%"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBooté™æ€èµ„æºè®°å½•</title>
    <url>/post/8116169e.html</url>
    <content><![CDATA[<blockquote><p>SpringBoot é™æ€èµ„æºï¼ˆè¸©å‘ï¼‰ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€é™æ€èµ„æºåŠ è½½"><a href="#ä¸€ã€é™æ€èµ„æºåŠ è½½" class="headerlink" title="ä¸€ã€é™æ€èµ„æºåŠ è½½"></a>ä¸€ã€é™æ€èµ„æºåŠ è½½</h3><ol><li>å…ˆæŸ¥çœ‹æºç ï¼Œé€šè¿‡æŸ¥çœ‹<code>WebMvcAutoConfiguration</code>ç±»æ‰¾åˆ°<code>addResourceHandlers()</code>æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">		logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">	CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache()</span><br><span class="line">			.getCachecontrol().toHttpCacheControl();</span><br><span class="line">	<span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">		customizeResourceHandlerRegistration(registry</span><br><span class="line">				.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">				.addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">				.setCachePeriod(getSeconds(cachePeriod))</span><br><span class="line">				.setCacheControl(cacheControl));</span><br><span class="line">	&#125;</span><br><span class="line">	String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">	<span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">		customizeResourceHandlerRegistration(</span><br><span class="line">				registry.addResourceHandler(staticPathPattern)</span><br><span class="line">						.addResourceLocations(getResourceLocations(</span><br><span class="line">						<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">						.setCachePeriod(getSeconds(cachePeriod))</span><br><span class="line">						.setCacheControl(cacheControl));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç„¶åé€šè¿‡<code>this.resourceProperties.getStaticLocations()</code>æ‰¾åˆ°é»˜è®¤çš„é…ç½®é¡¹ï¼Œå¦‚ä¸‹ä»£ç ï¼š</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123;</span><br><span class="line">			<span class="string">"classpath:/META-INF/resources/"</span>, <span class="string">"classpath:/resources/"</span>,</span><br><span class="line">			<span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span> &#125;;</span><br></pre></td></tr></table></figure><p>é™æ€èµ„æºåŠ è½½é¡ºåºï¼š<strong>META/resources &gt; resources &gt; static &gt; public</strong>ï¼Œå»é‡Œé¢æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åº”çš„èµ„æºï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ã€‚</p><p>ä¸Šé¢ä»‹ç»çš„æ˜¯<code>SpringBoot</code>æä¾›çš„é»˜è®¤çš„èµ„æºç›®å½•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ºå•¥æŠŠæ–‡ä»¶æ”¾åˆ°staticä¸‹ï¼Œæ–‡ä»¶å°±èƒ½è®¿é—®çš„åŸå› ã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™æœ‰ç‰¹æ®Šéœ€æ±‚ä¸éœ€è¦ç”¨ä»–çš„ç›®å½•ï¼Œä¸‹é¢æˆ‘ä»¬è¿›è¡Œè‡ªå®šä¹‰èµ„æºç›®å½•ã€‚</p><h3 id="äºŒã€è‡ªå®šä¹‰èµ„æºæ–‡ä»¶ç›®å½•"><a href="#äºŒã€è‡ªå®šä¹‰èµ„æºæ–‡ä»¶ç›®å½•" class="headerlink" title="äºŒã€è‡ªå®šä¹‰èµ„æºæ–‡ä»¶ç›®å½•"></a>äºŒã€è‡ªå®šä¹‰èµ„æºæ–‡ä»¶ç›®å½•</h3><h4 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h4><p>é€šè¿‡é…ç½®æ–‡ä»¶ç›´æ¥é…ç½®ã€‚</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é™æ€æ–‡ä»¶è¯·æ±‚åŒ¹é…æ–¹å¼</span></span><br><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/**</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹é»˜è®¤çš„é™æ€å¯»å€èµ„æºç›®å½•</span></span><br><span class="line"><span class="meta">spring.resources.static-locations</span>= <span class="string">classpath:/templates/,classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ç¼“å­˜</span></span><br><span class="line"><span class="meta">spring.resources.chain.cache</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># Enable the Spring Resource Handling chain. Disabled by default</span></span><br><span class="line"><span class="meta">spring.resources.chain.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># èµ„æºç¼“å­˜æ—¶é—´ï¼Œå•ä½ç§’ï¼Œ30å¤©</span></span><br><span class="line"><span class="meta">spring.resources.cache-period</span>=<span class="string">2592000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯gzipå‹ç¼©</span></span><br><span class="line"><span class="meta">spring.resources.chain.gzipped</span>=<span class="string">true </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰ˆæœ¬å·</span></span><br><span class="line"><span class="comment"># å¼€å¯ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="meta">spring.resources.chain.strategy.fixed.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># æŒ‡å®šè¦åº”ç”¨çš„ç‰ˆæœ¬çš„è·¯å¾„ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤ä¸º:[/**]</span></span><br><span class="line"><span class="meta">spring.resources.chain.strategy.fixed.paths</span>=<span class="string">/static  </span></span><br><span class="line"><span class="meta">spring.resources.chain.strategy.fixed.version</span>=<span class="string">1.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ MD5 ä½œä¸ºç‰ˆæœ¬å·</span></span><br><span class="line"><span class="meta">spring.resources.chain.strategy.content.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># æŒ‡å®šè¦åº”ç”¨çš„ç‰ˆæœ¬çš„è·¯å¾„ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼Œé»˜è®¤ä¸º:[/**]</span></span><br><span class="line"><span class="meta">spring.resources.chain.strategy.content.paths</span>=<span class="string">/**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šSessionçš„è¿½è¸ªæ¨¡å¼(cookie, url, ssl)</span></span><br><span class="line"><span class="meta">server.session.tracking-modes</span>=<span class="string">cookie</span></span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h4><p>é€šè¿‡å®ç°<code>WebMvcConfigurer</code>è¿›è¡Œé…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourcesStaticConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registration)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// addResourceHandleræ˜¯æŒ‡ä½ æƒ³åœ¨urlè¯·æ±‚çš„è·¯å¾„</span></span><br><span class="line">        <span class="comment">// è®¿é—® http://127.0.0.1:8077/webTa/gateway/file/83a393c423544cb88d8859e3218c3bf6.jpg </span></span><br><span class="line">        <span class="comment">// æˆ–è€… http://127.0.0.1:8077/webTa/static/83a393c423544cb88d8859e3218c3bf6.jpg</span></span><br><span class="line">        <span class="comment">// ä¾¿å¯è®¿é—®staticæ–‡ä»¶å¤¹ä¸‹å’Œ/static/upload/ æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚</span></span><br><span class="line">        ResourceHandlerRegistration registration = registry.addResourceHandler(<span class="string">"/static/**"</span>, <span class="string">"/gateway/file/**"</span>);</span><br><span class="line">        <span class="comment">// addResourceLocationsæ˜¯å›¾ç‰‡å­˜æ”¾çš„çœŸå®è·¯å¾„ï¼Œè¿™é‡Œè§£æçš„å°±æ˜¯staticæ–‡ä»¶å¤¹ä¸‹å’Œ/static/upload/æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºã€‚</span></span><br><span class="line">        registration.addResourceLocations(<span class="string">"classpath:/static/"</span>, <span class="string">"file:/static/upload/"</span>);</span><br><span class="line">        <span class="comment">// ä¸‹é¢æ˜¯å…¼å®¹windowç³»ç»Ÿæ·»åŠ çš„è§£æè§„åˆ™</span></span><br><span class="line">        String osName = <span class="string">"os.name"</span>;</span><br><span class="line">        String win = <span class="string">"win"</span>;</span><br><span class="line">        <span class="keyword">if</span> (System.getProperty(osName).toLowerCase().startsWith(win)) &#123;</span><br><span class="line">            registration.addResourceLocations(<span class="string">"file:///D:/static/upload/"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€é™æ€èµ„æºé¢å¤–é…ç½®"><a href="#ä¸‰ã€é™æ€èµ„æºé¢å¤–é…ç½®" class="headerlink" title="ä¸‰ã€é™æ€èµ„æºé¢å¤–é…ç½®"></a>ä¸‰ã€é™æ€èµ„æºé¢å¤–é…ç½®</h3><h4 id="1-é™æ€èµ„æºæ·»åŠ å›ºå®šç‰ˆæœ¬å·"><a href="#1-é™æ€èµ„æºæ·»åŠ å›ºå®šç‰ˆæœ¬å·" class="headerlink" title="1.é™æ€èµ„æºæ·»åŠ å›ºå®šç‰ˆæœ¬å·"></a>1.é™æ€èµ„æºæ·»åŠ å›ºå®šç‰ˆæœ¬å·</h4><p>é€šè¿‡<code>.resourceChain(true)</code>å¯ä»¥å¼€å¯ç¼“å­˜ï¼Œé™æ€æ–‡ä»¶å°±å¯ä»¥ç¼“å­˜åˆ°æµè§ˆå™¨æœ¬åœ°ã€‚åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœåŠ¡å™¨é™æ€æ–‡ä»¶ä¿®æ”¹ï¼Œæµè§ˆå™¨ç«¯åœ¨æœªè¿‡æœŸä¹‹å‰æ˜¯ä¸ä¼šé‡æ–°åŠ è½½æ–‡ä»¶çš„ã€‚æ­¤æ—¶éœ€è¦é€šè¿‡ç‰ˆæœ¬å·æ¥æ§åˆ¶ã€‚spring bootç‰ˆæœ¬å·æ”¯æŒä¸¤ç§ï¼Œä¸€ç§æ˜¯æ–‡ä»¶md5ï¼Œå¦ä¸€ç§æ˜¯å›ºå®šç‰ˆæœ¬å·ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è®¾é™æ€èµ„æºå­˜æ”¾åœ¨ classpath:/staticï¼Œä¸”æ˜ å°„çš„ url ä¸º /staticã€‚</span></span><br><span class="line">   registry.addResourceHandler(<span class="string">"/static/**"</span>).addResourceLocations(<span class="string">"classpath:/static"</span>)</span><br><span class="line">           <span class="comment">// resourceChain(false) çš„ä½œç”¨ï¼šæ˜¯å¦å¼€å¯ç¼“å­˜</span></span><br><span class="line">           .resourceChain(<span class="keyword">false</span>)</span><br><span class="line">           <span class="comment">// æ·»åŠ  VersionResourceResolver ï¼Œä¸”æŒ‡å®šç‰ˆæœ¬å·</span></span><br><span class="line">           .addResolver(<span class="keyword">new</span> VersionResourceResolver()</span><br><span class="line">               .addFixedVersionStrategy(<span class="string">"1.0.0"</span>, <span class="string">"/**"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-é™æ€èµ„æºæ·»åŠ MD5ä½œä¸ºç‰ˆæœ¬å·"><a href="#2-é™æ€èµ„æºæ·»åŠ MD5ä½œä¸ºç‰ˆæœ¬å·" class="headerlink" title="2.é™æ€èµ„æºæ·»åŠ MD5ä½œä¸ºç‰ˆæœ¬å·"></a>2.é™æ€èµ„æºæ·»åŠ MD5ä½œä¸ºç‰ˆæœ¬å·</h4><p>md5æ–¹å¼ï¼Œspring bootå¯åŠ¨æ—¶ä¼šè®¡ç®—æ¯ä¸ªé™æ€æ–‡ä»¶çš„md5å€¼å¹¶ç¼“å­˜ï¼Œæµè§ˆå™¨è®¿é—®æ—¶æ¯ä¸ªé™æ€æ–‡ä»¶åç¼€å‰åŠ ä¸Šmd5å€¼ä½œä¸ºç‰ˆæœ¬å·ï¼Œå¦‚æœæœåŠ¡å™¨md5å€¼æ”¹å˜åˆ™æµè§ˆå™¨é‡æ–°åŠ è½½ã€‚ï¼ˆéœ€è¦é‡å¯åº”ç”¨æ‰ä¼šé‡æ–°ç”Ÿæˆmd5ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/static/**"</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">"classpath:/static/"</span>)</span><br><span class="line">                .resourceChain(<span class="keyword">false</span>)</span><br><span class="line">                .addResolver(<span class="keyword">new</span> VersionResourceResolver()</span><br><span class="line">                    .addContentVersionStrategy(<span class="string">"/**"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-å¼€å¯gzip-å‹ç¼©"><a href="#3-å¼€å¯gzip-å‹ç¼©" class="headerlink" title="3.å¼€å¯gzip å‹ç¼©"></a>3.å¼€å¯gzip å‹ç¼©</h4><p>ä¸ºäº†é™ä½ä¼ è¾“çš„æ•°æ®é‡ï¼Œå¯ä»¥å¯¹èµ„æºè¿›è¡Œå‹ç¼©ã€‚</p><p><strong>PS ï¼š è¯·æ±‚å¤´ä¸­çš„ Content-Encoding è¦åŒ…å« gzip</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">   registry.addResourceHandler(<span class="string">"/static/**"</span>)</span><br><span class="line">           .addResourceLocations(<span class="string">"classpath:/static/"</span>)</span><br><span class="line">           .resourceChain(<span class="keyword">false</span>)</span><br><span class="line">           .addResolver(<span class="keyword">new</span> EncodedResourceResolver())</span><br><span class="line">           .addResolver(<span class="keyword">new</span> VersionResourceResolver().addContentVersionStrategy(<span class="string">"/**"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ã€è¸©å‘"><a href="#å››ã€è¸©å‘" class="headerlink" title="å››ã€è¸©å‘"></a>å››ã€è¸©å‘</h3><ol><li>åœ¨è®¡ç®—æœºï¼Œé’ˆå¯¹<code>/static/upload</code>ä¼šè§£ææˆæ–‡ä»¶ï¼Œ<code>/static/upload/</code>æ‰ä¼šè§£ææˆæ–‡ä»¶å¤¹ã€‚æœ€åä»¥æ–œæ ç»“å°¾çš„ï¼Œæ‰è¢«è®¤å®šä¸ºæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</li><li>å¦‚æœå®šä¹‰<code>addResourceLocations</code>å›¾ç‰‡å­˜æ”¾çš„çœŸå®è·¯å¾„ä¸ºï¼š<code>&quot;file:/static/&quot;</code>ï¼Œä½†æ˜¯å®é™…æƒ³è®¿é—®<code>/static/upload/</code>é‡Œé¢çš„ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œé‚£ä¹ˆè®¿é—®è·¯å¾„å°±è¦å¢åŠ æ–‡ä»¶å¤¹çš„åç§°ã€‚æ¯”å¦‚ <code>http://127.0.0.1:8077/webTa/static/upload/83a393c423544cb88d8859e3218c3bf6.jpg</code> ã€‚</li></ol><h3 id="äº”ã€èµ„æ–™"><a href="#äº”ã€èµ„æ–™" class="headerlink" title="äº”ã€èµ„æ–™"></a>äº”ã€èµ„æ–™</h3><p><a href="https://blog.csdn.net/u010811939/article/details/86300048" target="_blank" rel="noopener">ã€ŠSpring Boot é™æ€èµ„æºå¤„ç†ã€‹</a><br><a href="https://www.cnblogs.com/iiot/p/9647653.html" target="_blank" rel="noopener">ã€ŠSpring boot web é™æ€èµ„æºç¼“å­˜é…ç½®ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ç¨‹çš„å‡ ç§çŠ¶æ€</title>
    <url>/post/bb12c453.html</url>
    <content><![CDATA[<blockquote><p>çº¿ç¨‹çš„å‡ ç§çŠ¶æ€ ~</p></blockquote><a id="more"></a><p>çº¿ç¨‹åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼ŒçŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ã€‚çº¿ç¨‹ä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p><ol><li><strong>åˆå§‹(NEW)</strong>ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•ã€‚</li><li><strong>è¿è¡Œ(RUNNABLE)</strong>ï¼šJavaçº¿ç¨‹ä¸­å°†å°±ç»ªï¼ˆreadyï¼‰å’Œè¿è¡Œä¸­ï¼ˆrunningï¼‰ä¸¤ç§çŠ¶æ€ç¬¼ç»Ÿçš„ç§°ä¸ºâ€œè¿è¡Œâ€ã€‚<br>çº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹(æ¯”å¦‚mainçº¿ç¨‹ï¼‰è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…è¢«çº¿ç¨‹è°ƒåº¦é€‰ä¸­ï¼Œè·å–CPUçš„ä½¿ç”¨æƒï¼Œæ­¤æ—¶å¤„äºå°±ç»ªçŠ¶æ€ï¼ˆreadyï¼‰ã€‚å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åœ¨è·å¾—CPUæ—¶é—´ç‰‡åå˜ä¸ºè¿è¡Œä¸­çŠ¶æ€ï¼ˆrunningï¼‰ã€‚</li><li><strong>é˜»å¡(BLOCKED)</strong>ï¼šè¡¨ç¤ºçº¿ç¨‹é˜»å¡äºé”ã€‚</li><li><strong>ç­‰å¾…(WAITING)</strong>ï¼šè¿›å…¥è¯¥çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰ã€‚</li><li><strong>è¶…æ—¶ç­‰å¾…(TIMED_WAITING)</strong>ï¼šè¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´åè‡ªè¡Œè¿”å›ã€‚</li><li><strong>ç»ˆæ­¢(TERMINATED)</strong>ï¼šè¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</li></ol><p><strong>æºç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a thread which has not yet started.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        NEW,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a runnable thread.  A thread in the runnable</span></span><br><span class="line"><span class="comment">         * state is executing in the Java virtual machine but it may</span></span><br><span class="line"><span class="comment">         * be waiting for other resources from the operating system</span></span><br><span class="line"><span class="comment">         * such as processor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        RUNNABLE,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a thread blocked waiting for a monitor lock.</span></span><br><span class="line"><span class="comment">         * A thread in the blocked state is waiting for a monitor lock</span></span><br><span class="line"><span class="comment">         * to enter a synchronized block/method or</span></span><br><span class="line"><span class="comment">         * reenter a synchronized block/method after calling</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@link</span> Object#wait() Object.wait&#125;.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        BLOCKED,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a waiting thread.</span></span><br><span class="line"><span class="comment">         * A thread is in the waiting state due to calling one of the</span></span><br><span class="line"><span class="comment">         * following methods:</span></span><br><span class="line"><span class="comment">         * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> Object#wait() Object.wait&#125; with no timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #join() Thread.join&#125; with no timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#park() LockSupport.park&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;A thread in the waiting state is waiting for another thread to</span></span><br><span class="line"><span class="comment">         * perform a particular action.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">         * on an object is waiting for another thread to call</span></span><br><span class="line"><span class="comment">         * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on</span></span><br><span class="line"><span class="comment">         * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">         * is waiting for a specified thread to terminate.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a waiting thread with a specified waiting time.</span></span><br><span class="line"><span class="comment">         * A thread is in the timed waiting state due to calling one of</span></span><br><span class="line"><span class="comment">         * the following methods with a specified positive waiting time:</span></span><br><span class="line"><span class="comment">         * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #sleep Thread.sleep&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> Object#wait(long) Object.wait&#125; with timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #join(long) Thread.join&#125; with timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#parkNanos LockSupport.parkNanos&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#parkUntil LockSupport.parkUntil&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TIMED_WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a terminated thread.</span></span><br><span class="line"><span class="comment">         * The thread has completed execution.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>HashMapåº•å±‚åŸç†è¯¦è§£(JDK1.8)</title>
    <url>/post/96aa5774.html</url>
    <content><![CDATA[<blockquote><p>HashMapåº•å±‚åŸç†è¯¦è§£(JDK1.8) ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€HashMapçš„å­˜å‚¨è¿‡ç¨‹"><a href="#ä¸€ã€HashMapçš„å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="ä¸€ã€HashMapçš„å­˜å‚¨è¿‡ç¨‹"></a>ä¸€ã€HashMapçš„å­˜å‚¨è¿‡ç¨‹</h3><p><code>JDK1.8 ä¹‹å‰</code> <code>HashMap</code> ç”± <strong>æ•°ç»„+é“¾è¡¨</strong> ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ <code>HashMap</code> çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çª<strong>(ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨çš„<code>hashCode</code>æ–¹æ³•è®¡ç®—çš„å“ˆå¸Œç å€¼ä¸€è‡´å¯¼è‡´è®¡ç®—çš„æ•°ç»„ç´¢å¼•å€¼ç›¸åŒ)</strong> è€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ï¼›</p><p><code>JDK1.8 ä»¥å</code>åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆæˆ–è€…çº¢é»‘æ ‘çš„è¾¹ç•Œå€¼ï¼Œé»˜è®¤ä¸º 8ï¼‰å¹¶ä¸”å½“å‰æ•°ç»„çš„é•¿åº¦å¤§äº64æ—¶ï¼Œæ­¤æ—¶æ­¤ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰æ•°æ®æ”¹ä¸ºä½¿ç”¨çº¢é»‘æ ‘å­˜å‚¨ï¼Œå³ <strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>ã€‚</p><blockquote><p>æ•°ç»„ï¼š<br>æ•°ç»„å…·æœ‰éå†å¿«ï¼Œå¢åˆ æ…¢çš„ç‰¹ç‚¹ã€‚æ•°ç»„åœ¨å †ä¸­æ˜¯ä¸€å—è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œéå†æ—¶æ•°ç»„çš„é¦–åœ°å€æ˜¯çŸ¥é“çš„ï¼ˆé¦–åœ°å€=é¦–åœ°å€+å…ƒç´ å­—èŠ‚æ•° * ä¸‹æ ‡ï¼‰ï¼Œæ‰€ä»¥éå†å¿«ï¼ˆæ•°ç»„éå†çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1) ï¼‰ï¼›å¢åˆ æ…¢æ˜¯å› ä¸ºï¼Œå½“åœ¨ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œä¼šé€ æˆè¯¥å…ƒç´ åé¢æ‰€æœ‰å…ƒç´ åœ°å€çš„æ”¹å˜ï¼Œæ‰€ä»¥å¢åˆ æ…¢ï¼ˆå¢åˆ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n) ï¼‰ã€‚</p><p>é“¾è¡¨ï¼š<br>é“¾è¡¨å…·æœ‰å¢åˆ å¿«ï¼Œéå†æ…¢çš„ç‰¹ç‚¹ã€‚é“¾è¡¨ä¸­å„å…ƒç´ çš„å†…å­˜ç©ºé—´æ˜¯ä¸è¿ç»­çš„ï¼Œä¸€ä¸ªèŠ‚ç‚¹è‡³å°‘åŒ…å«èŠ‚ç‚¹æ•°æ®ä¸åç»§èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œåªéœ€ä¿®æ”¹è¯¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ä¸åç»§èŠ‚ç‚¹å³å¯ï¼Œé“¾è¡¨åœ¨æ’å…¥åˆ é™¤æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ä½†æ˜¯åœ¨éå†æ—¶ï¼Œget(n)å…ƒç´ æ—¶ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå¼€å§‹ï¼Œä¾æ¬¡æ‹¿åˆ°åé¢å…ƒç´ çš„åœ°å€ï¼Œè¿›è¡Œéå†ï¼Œç›´åˆ°éå†åˆ°ç¬¬nä¸ªå…ƒç´ ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(n) ï¼‰ï¼Œæ‰€ä»¥æ•ˆç‡æä½ã€‚</p></blockquote><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>1.å­˜å–æ— åºçš„ï¼›</p><p>2.é”®å’Œå€¼ä½ç½®éƒ½å¯ä»¥æ˜¯nullï¼Œä½†æ˜¯é”®ä½ç½®åªèƒ½æ˜¯ä¸€ä¸ªnullï¼›</p><p>3.é”®ä½ç½®æ˜¯å”¯ä¸€çš„ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„æ§åˆ¶é”®çš„ï¼›</p><p>4.<code>jdk1.8</code>å‰æ•°æ®ç»“æ„æ˜¯ï¼šé“¾è¡¨ + æ•°ç»„ï¼› <code>jdk1.8</code>ä¹‹åæ˜¯ ï¼š é“¾è¡¨ + æ•°ç»„ + çº¢é»‘æ ‘ï¼›</p><p>5.é˜ˆå€¼(è¾¹ç•Œå€¼) &gt; 8 å¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64ï¼Œæ‰å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå˜ä¸ºçº¢é»‘æ ‘çš„ç›®çš„æ˜¯ä¸ºäº†é«˜æ•ˆçš„æŸ¥è¯¢ï¼›</p><h4 id="Putæ‰§â¾è¿‡ç¨‹"><a href="#Putæ‰§â¾è¿‡ç¨‹" class="headerlink" title="Putæ‰§â¾è¿‡ç¨‹"></a>Putæ‰§â¾è¿‡ç¨‹</h4><h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ol><li><p>å…ˆé€šè¿‡hashå€¼è®¡ç®—å‡ºkeyæ˜ å°„åˆ°å“ªä¸ªæ¡¶ï¼›</p></li><li><p>å¦‚æœæ¡¶ä¸Šæ²¡æœ‰ç¢°æ’å†²çªï¼Œåˆ™ç›´æ¥æ’å…¥ï¼›</p></li><li><p>å¦‚æœå‡ºç°ç¢°æ’å†²çªäº†ï¼Œåˆ™éœ€è¦å¤„ç†å†²çªï¼š</p><p>aï¼šå¦‚æœè¯¥æ¡¶ä½¿ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥æ•°æ®ï¼›</p><p>bï¼šå¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ã€‚å¦‚æœé“¾çš„é•¿åº¦è¾¾åˆ°ä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾è½¬å˜ä¸ºçº¢é»‘æ ‘ï¼›</p></li><li><p>å¦‚æœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„é”®ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼valueï¼›</p></li><li><p>å¦‚æœsizeå¤§äºé˜ˆå€¼thresholdï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚</p></li></ol><h5 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»è¦è°ƒç”¨putValæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1ï¼‰transient Node&lt;K,V&gt;[] table; è¡¨ç¤ºå­˜å‚¨Mapé›†åˆä¸­å…ƒç´ çš„æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">    2ï¼‰(tab = table) == null è¡¨ç¤ºå°†ç©ºçš„tableèµ‹å€¼ç»™tab,ç„¶ååˆ¤æ–­tabæ˜¯å¦ç­‰äºnullï¼Œç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯null</span></span><br><span class="line"><span class="comment">    3ï¼‰(n = tab.length) == 0 è¡¨ç¤ºå°†æ•°ç»„çš„é•¿åº¦0èµ‹å€¼ç»™n,ç„¶ååˆ¤æ–­næ˜¯å¦ç­‰äº0ï¼Œnç­‰äº0</span></span><br><span class="line"><span class="comment">    	ç”±äºifåˆ¤æ–­ä½¿ç”¨åŒæˆ–ï¼Œæ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œåˆ™æ‰§è¡Œä»£ç  n = (tab = resize()).length; è¿›è¡Œæ•°ç»„åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="comment">    	å¹¶å°†åˆå§‹åŒ–å¥½çš„æ•°ç»„é•¿åº¦èµ‹å€¼ç»™n.</span></span><br><span class="line"><span class="comment">    4ï¼‰æ‰§è¡Œå®Œn = (tab = resize()).lengthï¼Œæ•°ç»„tabæ¯ä¸ªç©ºé—´éƒ½æ˜¯null</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1ï¼‰i = (n - 1) &amp; hash è¡¨ç¤ºè®¡ç®—æ•°ç»„çš„ç´¢å¼•èµ‹å€¼ç»™iï¼Œå³ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­</span></span><br><span class="line"><span class="comment">    2ï¼‰p = tab[i = (n - 1) &amp; hash]è¡¨ç¤ºè·å–è®¡ç®—å‡ºçš„ä½ç½®çš„æ•°æ®èµ‹å€¼ç»™èŠ‚ç‚¹p</span></span><br><span class="line"><span class="comment">    3) (p = tab[i = (n - 1) &amp; hash]) == null åˆ¤æ–­èŠ‚ç‚¹ä½ç½®æ˜¯å¦ç­‰äºnullï¼Œå¦‚æœä¸ºnullï¼Œåˆ™æ‰§è¡Œä»£ç ï¼štab[i] = newNode(hash, key, value, null);æ ¹æ®é”®å€¼å¯¹åˆ›å»ºæ–°çš„èŠ‚ç‚¹æ”¾å…¥è¯¥ä½ç½®çš„æ¡¶ä¸­</span></span><br><span class="line"><span class="comment">        å°ç»“ï¼šå¦‚æœå½“å‰æ¡¶æ²¡æœ‰å“ˆå¸Œç¢°æ’å†²çªï¼Œåˆ™ç›´æ¥æŠŠé”®å€¼å¯¹æ’å…¥ç©ºé—´ä½ç½®</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å­˜å…¥åˆ°æ¡¶ä¸­</span></span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// æ‰§è¡Œelseè¯´æ˜tab[i]ä¸ç­‰äºnullï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å·²ç»æœ‰å€¼äº†ã€‚</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ¯”è¾ƒæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ (æ•°ç»„ä¸­çš„ç»“ç‚¹)çš„hashå€¼å’Œkeyæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">        1ï¼‰p.hash == hash ï¼šp.hashè¡¨ç¤ºåŸæ¥å­˜åœ¨æ•°æ®çš„hashå€¼  hashè¡¨ç¤ºåæ·»åŠ æ•°æ®çš„hashå€¼ æ¯”è¾ƒä¸¤ä¸ªhashå€¼æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">        è¯´æ˜ï¼špè¡¨ç¤ºtab[i]ï¼Œå³ newNode(hash, key, value, null)æ–¹æ³•è¿”å›çš„Nodeå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">                    Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) </span></span><br><span class="line"><span class="comment">                    &#123;</span></span><br><span class="line"><span class="comment">                        return new Node&lt;&gt;(hash, key, value, next);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                    è€Œåœ¨Nodeç±»ä¸­å…·æœ‰æˆå‘˜å˜é‡hashç”¨æ¥è®°å½•ç€ä¹‹å‰æ•°æ®çš„hashå€¼çš„</span></span><br><span class="line"><span class="comment">        2ï¼‰(k = p.key) == key ï¼šp.keyè·å–åŸæ¥æ•°æ®çš„keyèµ‹å€¼ç»™k  key è¡¨ç¤ºåæ·»åŠ æ•°æ®çš„key æ¯”è¾ƒä¸¤ä¸ªkeyçš„åœ°å€å€¼æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">        3ï¼‰key != null &amp;&amp; key.equals(k)ï¼šèƒ½å¤Ÿæ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜ä¸¤ä¸ªkeyçš„åœ°å€å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå…ˆåˆ¤æ–­åæ·»åŠ çš„keyæ˜¯å¦ç­‰äºnullï¼Œå¦‚æœä¸ç­‰äºnullå†è°ƒç”¨equalsæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªkeyçš„å†…å®¹æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                	è¯´æ˜ï¼šä¸¤ä¸ªå…ƒç´ å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„å€¼ä¹Ÿç›¸ç­‰</span></span><br><span class="line"><span class="comment">                	å°†æ—§çš„å…ƒç´ æ•´ä½“å¯¹è±¡èµ‹å€¼ç»™eï¼Œç”¨eæ¥è®°å½•</span></span><br><span class="line"><span class="comment">                */</span> </span><br><span class="line">                e = p;</span><br><span class="line">        <span class="comment">// hashå€¼ä¸ç›¸ç­‰æˆ–è€…keyä¸ç›¸ç­‰ï¼›åˆ¤æ–­pæ˜¯å¦ä¸ºçº¢é»‘æ ‘ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            <span class="comment">// æ”¾å…¥æ ‘ä¸­</span></span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// è¯´æ˜æ˜¯é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            	1)å¦‚æœæ˜¯é“¾è¡¨çš„è¯éœ€è¦éå†åˆ°æœ€åèŠ‚ç‚¹ç„¶åæ’å…¥</span></span><br><span class="line"><span class="comment">            	2)é‡‡ç”¨å¾ªç¯éå†çš„æ–¹å¼ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰é‡å¤çš„key</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                	1)e = p.next è·å–pçš„ä¸‹ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™e</span></span><br><span class="line"><span class="comment">                	2)(e = p.next) == null åˆ¤æ–­p.nextæ˜¯å¦ç­‰äºnullï¼Œç­‰äºnullï¼Œè¯´æ˜pæ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ°è¾¾äº†é“¾è¡¨çš„å°¾éƒ¨ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°é‡å¤çš„key,åˆ™è¯´æ˜HashMapæ²¡æœ‰åŒ…å«è¯¥é”®å°†è¯¥é”®å€¼å¯¹æ’å…¥é“¾è¡¨ä¸­ã€‚</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    	1ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹æ’å…¥åˆ°å°¾éƒ¨</span></span><br><span class="line"><span class="comment">                    	 p.next = newNode(hash, key, value, null);</span></span><br><span class="line"><span class="comment">                    	 Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) </span></span><br><span class="line"><span class="comment">                    	 &#123;</span></span><br><span class="line"><span class="comment">                                return new Node&lt;&gt;(hash, key, value, next);</span></span><br><span class="line"><span class="comment">                         &#125;</span></span><br><span class="line"><span class="comment">                         æ³¨æ„ç¬¬å››ä¸ªå‚æ•°nextæ˜¯nullï¼Œå› ä¸ºå½“å‰å…ƒç´ æ’å…¥åˆ°é“¾è¡¨æœ«å°¾äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹è‚¯å®šæ˜¯								null</span></span><br><span class="line"><span class="comment">                         2ï¼‰è¿™ç§æ·»åŠ æ–¹å¼ä¹Ÿæ»¡è¶³é“¾è¡¨æ•°æ®ç»“æ„çš„ç‰¹ç‚¹ï¼Œæ¯æ¬¡å‘åæ·»åŠ æ–°çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    1)èŠ‚ç‚¹æ·»åŠ å®Œæˆä¹‹ååˆ¤æ–­æ­¤æ—¶èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤§äºTREEIFY_THRESHOLDä¸´ç•Œå€¼8ï¼Œå¦‚æœå¤§äºåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment">                    2ï¼‰int binCount = 0 ï¼šè¡¨ç¤ºforå¾ªç¯çš„åˆå§‹åŒ–å€¼ã€‚ä»0å¼€å§‹è®¡æ•°ã€‚è®°å½•ç€éå†èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚å€¼æ˜¯0è¡¨ç¤ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ1è¡¨ç¤ºç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚ã€‚ã€‚ã€‚7è¡¨ç¤ºç¬¬å…«ä¸ªèŠ‚ç‚¹ï¼ŒåŠ ä¸Šæ•°ç»„ä¸­çš„çš„ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ªæ•°æ˜¯9</span></span><br><span class="line"><span class="comment">                    	TREEIFY_THRESHOLD - 1 --ã€‹8 - 1 ---ã€‹7</span></span><br><span class="line"><span class="comment">                    	å¦‚æœbinCountçš„å€¼æ˜¯7(åŠ ä¸Šæ•°ç»„ä¸­çš„çš„ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ªæ•°æ˜¯9)</span></span><br><span class="line"><span class="comment">                    	TREEIFY_THRESHOLD - 1ä¹Ÿæ˜¯7ï¼Œæ­¤æ—¶è½¬æ¢çº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        <span class="comment">//è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="comment">// è·³å‡ºå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                 </span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                	æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜e = p.next ä¸æ˜¯nullï¼Œä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç»§ç»­åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’					  å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="comment">// ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯</span></span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                		è¦æ·»åŠ çš„å…ƒç´ å’Œé“¾è¡¨ä¸­çš„å­˜åœ¨çš„å…ƒç´ çš„keyç›¸ç­‰äº†ï¼Œåˆ™è·³å‡ºforå¾ªç¯ã€‚ä¸ç”¨å†ç»§ç»­æ¯”è¾ƒäº†</span></span><br><span class="line"><span class="comment">                		ç›´æ¥æ‰§è¡Œä¸‹é¢çš„ifè¯­å¥å»æ›¿æ¢å» if (e != null) </span></span><br><span class="line"><span class="comment">                	*/</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                	è¯´æ˜æ–°æ·»åŠ çš„å…ƒç´ å’Œå½“å‰èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">                	ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹</span></span><br><span class="line"><span class="comment">        	ä¹Ÿå°±æ˜¯è¯´é€šè¿‡ä¸Šé¢çš„æ“ä½œæ‰¾åˆ°äº†é‡å¤çš„é”®ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯æŠŠè¯¥é”®çš„å€¼å˜ä¸ºæ–°çš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼</span></span><br><span class="line"><span class="comment">        	è¿™é‡Œå®Œæˆäº†putæ–¹æ³•çš„ä¿®æ”¹åŠŸèƒ½</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="comment">// è®°å½•eçš„value</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="comment">// onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull</span></span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                <span class="comment">//ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼</span></span><br><span class="line">                <span class="comment">//e.value è¡¨ç¤ºæ—§å€¼  valueè¡¨ç¤ºæ–°å€¼ </span></span><br><span class="line">                e.value = value;</span><br><span class="line">            <span class="comment">// è®¿é—®åå›è°ƒ</span></span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="comment">// è¿”å›æ—§å€¼</span></span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹è®°å½•æ¬¡æ•°</span></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å®é™…å¤§å°æ˜¯å¦å¤§äºthresholdé˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡åˆ™æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="comment">// æ’å…¥åå›è°ƒ</span></span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Getæ‰§è¡Œè¿‡ç¨‹"><a href="#Getæ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Getæ‰§è¡Œè¿‡ç¨‹"></a>Getæ‰§è¡Œè¿‡ç¨‹</h4><h5 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ol><li><p>é€šè¿‡hashå€¼è·å–è¯¥keyæ˜ å°„åˆ°çš„æ¡¶</p></li><li><p>æ¡¶ä¸Šçš„keyå°±æ˜¯è¦æŸ¥æ‰¾çš„key,åˆ™ç›´æ¥æ‰¾åˆ°å¹¶è¿”å›</p></li><li><p>æ¡¶ä¸Šçš„keyä¸æ˜¯è¦æ‰¾çš„key,åˆ™æŸ¥çœ‹åç»­çš„èŠ‚ç‚¹ï¼š</p><p>a.å¦‚æœåç»­èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ ¹æ®keyè·å–valueï¼›O(logn)</p><p>b.å¦‚æœåç»­èŠ‚ç‚¹æ˜¯é“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡å¾ªç¯éå†é“¾è¡¨æ ¹æ®keyè·å–valueï¼›O(n)</p></li></ol><h5 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getæ–¹æ³•ä¸»è¦è°ƒç”¨çš„æ˜¯getNodeæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="comment">//å¦‚æœå“ˆå¸Œè¡¨ä¸ä¸ºç©ºå¹¶ä¸”keyå¯¹åº”çš„æ¡¶ä¸Šä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        	åˆ¤æ–­æ•°ç»„å…ƒç´ æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">        	æ ¹æ®ç´¢å¼•çš„ä½ç½®æ£€æŸ¥ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">        	æ³¨æ„ï¼šæ€»æ˜¯æ£€æŸ¥ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰åç»­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œæ˜¯çš„è¯è°ƒç”¨çº¢é»‘æ ‘ä¸­çš„getTreeNodeæ–¹æ³•è·å–èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">// ä¸æ˜¯çº¢é»‘æ ‘çš„è¯ï¼Œé‚£å°±æ˜¯é“¾è¡¨ç»“æ„äº†ï¼Œé€šè¿‡å¾ªç¯çš„æ–¹æ³•åˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¯¥key</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//çº¢é»‘æ ‘èŠ‚ç‚¹è°ƒç”¨çš„æ˜¯getTreeNodeæ–¹æ³•é€šè¿‡æ ‘å½¢èŠ‚ç‚¹çš„findæ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line"> <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">getTreeNode</span><span class="params">(<span class="keyword">int</span> h, Object k)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ((parent != <span class="keyword">null</span>) ? root() : <span class="keyword">this</span>).find(h, k, <span class="keyword">null</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">find</span><span class="params">(<span class="keyword">int</span> h, Object k, Class&lt;?&gt; kc)</span> </span>&#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; p = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> ph, dir; K pk;</span><br><span class="line">                TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q;</span><br><span class="line">                <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">                    p = pl;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">                    p = pr;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((pk = p.key) == k || (k != <span class="keyword">null</span> &amp;&amp; k.equals(pk)))</span><br><span class="line">                    <span class="keyword">return</span> p;<span class="comment">//æ‰¾åˆ°ä¹‹åç›´æ¥è¿”å›</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (pl == <span class="keyword">null</span>)</span><br><span class="line">                    p = pr;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (pr == <span class="keyword">null</span>)</span><br><span class="line">                    p = pl;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((kc != <span class="keyword">null</span> ||</span><br><span class="line">                          (kc = comparableClassFor(k)) != <span class="keyword">null</span>) &amp;&amp;</span><br><span class="line">                         (dir = compareComparables(kc, k, pk)) != <span class="number">0</span>)</span><br><span class="line">                    p = (dir &lt; <span class="number">0</span>) ? pl : pr;</span><br><span class="line">                <span class="comment">//é€’å½’æŸ¥æ‰¾</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((q = pr.find(h, k, kc)) != <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> q;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    p = pl;</span><br><span class="line">            &#125; <span class="keyword">while</span> (p != <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€æ‰©å®¹æœºåˆ¶"><a href="#äºŒã€æ‰©å®¹æœºåˆ¶" class="headerlink" title="äºŒã€æ‰©å®¹æœºåˆ¶"></a>äºŒã€æ‰©å®¹æœºåˆ¶</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>HashMap</code> åˆå§‹å®¹é‡æ˜¯16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚è¿™é‡Œå¹¶æ²¡æœ‰é»˜è®¤é˜ˆå€¼ï¼ŒåŸå› æ˜¯é˜ˆå€¼å¯ç”±å®¹é‡ä¹˜ä¸Šè´Ÿè½½å› å­è®¡ç®—è€Œæ¥ï¼ˆæ³¨é‡Šä¸­æœ‰è¯´æ˜ï¼‰ï¼Œå³<code>threshold = capacity * loadFactor</code>ã€‚åœ¨ <code>HashMap</code> ä¸­ï¼Œæ¡¶æ•°ç»„çš„é•¿åº¦å‡æ˜¯2çš„å¹‚ï¼Œé˜ˆå€¼å¤§å°ä¸ºæ¡¶æ•°ç»„é•¿åº¦ä¸è´Ÿè½½å› å­çš„ä¹˜ç§¯ã€‚å½“ <code>HashMap</code> ä¸­çš„é”®å€¼å¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œæ‰©å®¹ã€‚<code>HashMap</code> çš„æ‰©å®¹æœºåˆ¶ä¸å…¶ä»–å˜é•¿é›†åˆçš„å¥—è·¯ä¸å¤ªä¸€æ ·ï¼Œ<code>HashMap</code> æŒ‰å½“å‰æ¡¶æ•°ç»„é•¿åº¦çš„2å€è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼ä¹Ÿå˜ä¸ºåŸæ¥çš„2å€ï¼ˆ å¦‚æœè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé˜ˆå€¼æº¢å‡ºå½’é›¶ï¼Œåˆ™æŒ‰é˜ˆå€¼å…¬å¼é‡æ–°è®¡ç®—ï¼‰ã€‚æ‰©å®¹ä¹‹åï¼Œè¦é‡æ–°è®¡ç®—é”®å€¼å¯¹çš„ä½ç½®ï¼Œå¹¶æŠŠå®ƒä»¬ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ä¸Šå»ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    <span class="comment">//å¾—åˆ°å½“å‰æ•°ç»„</span></span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="comment">//å¦‚æœå½“å‰æ•°ç»„ç­‰äºnullé•¿åº¦è¿”å›0ï¼Œå¦åˆ™è¿”å›å½“å‰æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="comment">// å½“å‰é˜€å€¼ç‚¹ é»˜è®¤æ˜¯12(16*0.75)</span></span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœè€çš„æ•°ç»„é•¿åº¦å¤§äº0</span></span><br><span class="line">    <span class="comment">// å¼€å§‹è®¡ç®—æ‰©å®¹åçš„å¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            <span class="comment">// ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼</span></span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span></span><br><span class="line"><span class="comment">        	1) (newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY æ‰©å¤§åˆ°2å€ä¹‹åå®¹é‡è¦å°äºæœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="comment">        	2ï¼‰oldCap &gt;= DEFAULT_INITIAL_CAPACITY åŸæ•°ç»„é•¿åº¦å¤§äºç­‰äºæ•°ç»„åˆå§‹åŒ–é•¿åº¦16</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            <span class="comment">// é˜ˆå€¼æ‰©å¤§ä¸€å€</span></span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è€é˜ˆå€¼ç‚¹å¤§äº0 ç›´æ¥èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// è€é˜ˆå€¼èµ‹å€¼ç»™æ–°çš„æ•°ç»„é•¿åº¦</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼16</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY; </span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¡ç®—æ–°çš„resizeæœ€å¤§ä¸Šé™</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ–°çš„é˜€å€¼ é»˜è®¤åŸæ¥æ˜¯12 ä¹˜ä»¥2ä¹‹åå˜ä¸º24</span></span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="comment">//åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">    <span class="comment">//newCapæ˜¯æ–°çš„æ•°ç»„é•¿åº¦--ã€‹32</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ—§æ•°ç»„æ˜¯å¦ç­‰äºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span></span><br><span class="line">        <span class="comment">//éå†æ—§çš„å“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶ï¼Œé‡æ–°è®¡ç®—æ¡¶é‡Œå…ƒç´ çš„æ–°ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//åŸæ¥çš„æ•°æ®èµ‹å€¼ä¸ºnull ä¾¿äºGCå›æ”¶</span></span><br><span class="line">                oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­æ•°ç»„æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå¼•ç”¨</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="comment">//æ²¡æœ‰ä¸‹ä¸€ä¸ªå¼•ç”¨ï¼Œè¯´æ˜ä¸æ˜¯é“¾è¡¨ï¼Œå½“å‰æ¡¶ä¸Šåªæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œç›´æ¥æ’å…¥</span></span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    <span class="comment">//è¯´æ˜æ˜¯çº¢é»‘æ ‘æ¥å¤„ç†å†²çªçš„ï¼Œåˆ™è°ƒç”¨ç›¸å…³æ–¹æ³•æŠŠæ ‘åˆ†å¼€</span></span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// é‡‡ç”¨é“¾è¡¨å¤„ç†å†²çª</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="comment">//é€šè¿‡ä¸Šè¿°è®²è§£çš„åŸç†æ¥è®¡ç®—èŠ‚ç‚¹çš„æ–°ä½ç½®</span></span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="comment">// åŸç´¢å¼•</span></span><br><span class="line">                        next = e.next;</span><br><span class="line">                     	<span class="comment">//è¿™é‡Œæ¥åˆ¤æ–­å¦‚æœç­‰äºtrue eè¿™ä¸ªèŠ‚ç‚¹åœ¨resizeä¹‹åä¸éœ€è¦ç§»åŠ¨ä½ç½®</span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// åŸç´¢å¼•+oldCap</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æºç æ€»å…±åšäº†3ä»¶äº‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>è®¡ç®—æ–°æ¡¶æ•°ç»„çš„å®¹é‡ newCap å’Œæ–°é˜ˆå€¼ newThr</li><li>æ ¹æ®è®¡ç®—å‡ºçš„ newCap åˆ›å»ºæ–°çš„æ¡¶æ•°ç»„ï¼Œæ¡¶æ•°ç»„ table ä¹Ÿæ˜¯åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–çš„</li><li>å°†é”®å€¼å¯¹èŠ‚ç‚¹é‡æ–°æ˜ å°„åˆ°æ–°çš„æ¡¶æ•°ç»„é‡Œã€‚å¦‚æœèŠ‚ç‚¹æ˜¯ <code>TreeNode</code> ç±»å‹ï¼Œåˆ™éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘ã€‚å¦‚æœæ˜¯æ™®é€šèŠ‚ç‚¹ï¼Œåˆ™èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„ã€‚</li></ol><h3 id="ä¸‰ã€å¸¸è§é¢è¯•é¢˜"><a href="#ä¸‰ã€å¸¸è§é¢è¯•é¢˜" class="headerlink" title="ä¸‰ã€å¸¸è§é¢è¯•é¢˜"></a>ä¸‰ã€å¸¸è§é¢è¯•é¢˜</h3><ol><li><p><strong>é¢è¯•é¢˜ï¼šHashMapä¸­hashå‡½æ•°æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿè¿˜æœ‰å“ªäº›hashå‡½æ•°çš„å®ç°æ–¹å¼ï¼Ÿ</strong></p><p>å¯¹äºkeyçš„hashCodeåšhashæ“ä½œï¼Œæ— ç¬¦å·å³ç§»16ä½ç„¶ååšå¼‚æˆ–è¿ç®—ã€‚<br>è¿˜æœ‰å¹³æ–¹å–ä¸­æ³•ï¼Œä¼ªéšæœºæ•°æ³•å’Œå–ä½™æ•°æ³•ã€‚è¿™ä¸‰ç§æ•ˆç‡éƒ½æ¯”è¾ƒä½ã€‚è€Œæ— ç¬¦å·å³ç§»16ä½å¼‚æˆ–è¿ç®—æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚</p></li><li><p><strong>é¢è¯•é¢˜ï¼šå½“ä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸ç­‰æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ</strong></p><p>ä¼šäº§ç”Ÿå“ˆå¸Œç¢°æ’ï¼Œè‹¥keyå€¼å†…å®¹ç›¸åŒåˆ™æ›¿æ¢æ—§çš„value.ä¸ç„¶è¿æ¥åˆ°é“¾è¡¨åé¢ï¼Œé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘å­˜å‚¨ã€‚</p></li><li><p><strong>é¢è¯•é¢˜ï¼šä½•æ—¶å‘ç”Ÿå“ˆå¸Œç¢°æ’å’Œä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’,å¦‚ä½•è§£å†³å“ˆå¸Œç¢°æ’ï¼Ÿ</strong></p><p>åªè¦ä¸¤ä¸ªå…ƒç´ çš„keyè®¡ç®—çš„å“ˆå¸Œç å€¼ç›¸åŒå°±ä¼šå‘ç”Ÿå“ˆå¸Œç¢°æ’ã€‚jdk8å‰ä½¿ç”¨é“¾è¡¨è§£å†³å“ˆå¸Œç¢°æ’ã€‚jdk8ä¹‹åä½¿ç”¨é“¾è¡¨+çº¢é»‘æ ‘è§£å†³å“ˆå¸Œç¢°æ’ã€‚</p></li><li><p><strong>é¢è¯•é¢˜ï¼šå¦‚æœä¸¤ä¸ªé”®çš„hashcodeç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ</strong></p><p>hashcodeç›¸åŒï¼Œé€šè¿‡equalsæ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒã€‚<br>ç›¸åŒï¼šåˆ™æ–°çš„valueè¦†ç›–ä¹‹å‰çš„value<br>ä¸ç›¸åŒï¼šåˆ™å°†æ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­</p></li><li><p><strong>é¢è¯•é¢˜ï¼š1.8ä¸ºä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘ï¼Ÿè¿™æ ·ç»“æ„çš„è¯ä¸æ˜¯æ›´éº»çƒ¦äº†å—ï¼Œä¸ºä½•é˜ˆå€¼å¤§äº8æ¢æˆçº¢é»‘æ ‘ï¼Ÿ</strong></p><p><code>JDK 1.8</code> ä»¥å‰ <code>HashMap</code> çš„å®ç°æ˜¯ æ•°ç»„+é“¾è¡¨ï¼Œå³ä½¿å“ˆå¸Œå‡½æ•°å–å¾—å†å¥½ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å…ƒç´ ç™¾åˆ†ç™¾å‡åŒ€åˆ†å¸ƒã€‚å½“ <code>HashMap</code> ä¸­æœ‰å¤§é‡çš„å…ƒç´ éƒ½å­˜æ”¾åˆ°åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œè¿™ä¸ªæ¡¶ä¸‹æœ‰ä¸€æ¡é•¿é•¿çš„é“¾è¡¨ï¼Œè¿™ä¸ªæ—¶å€™ <code>HashMap</code> å°±ç›¸å½“äºä¸€ä¸ªå•é“¾è¡¨ï¼Œå‡å¦‚å•é“¾è¡¨æœ‰ n ä¸ªå…ƒç´ ï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <code>O(n)</code>ï¼Œå®Œå…¨å¤±å»äº†å®ƒçš„ä¼˜åŠ¿ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ<code>JDK 1.8</code> ä¸­å¼•å…¥äº† çº¢é»‘æ ‘ï¼ˆæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º <code>O(logn)</code>ï¼‰æ¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚ å½“é“¾è¡¨é•¿åº¦å¾ˆå°çš„æ—¶å€™ï¼Œå³ä½¿éå†ï¼Œé€Ÿåº¦ä¹Ÿéå¸¸å¿«ï¼Œä½†æ˜¯å½“é“¾è¡¨é•¿åº¦ä¸æ–­å˜é•¿ï¼Œè‚¯å®šä¼šå¯¹æŸ¥è¯¢æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥æ‰éœ€è¦è½¬æˆæ ‘ã€‚</p></li></ol><h3 id="å››ã€å‚è€ƒèµ„æ–™"><a href="#å››ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å››ã€å‚è€ƒèµ„æ–™"></a>å››ã€å‚è€ƒèµ„æ–™</h3><p><a href="https://blog.csdn.net/qq_41822345/article/details/104436909" target="_blank" rel="noopener">ã€ŠHashMapæœ€æ–°æ€»ç»“ï¼ˆJDK1.8ï¼‰ã€‹</a><br><a href="https://www.toutiao.com/article/6727624027327693316/?group_id=6727624027327693316" target="_blank" rel="noopener">ã€ŠHashMapæºç åˆ†æï¼ˆjdk1.8ï¼Œä¿è¯ä½ èƒ½çœ‹æ‡‚ï¼‰ã€‹</a><br><a href="https://juejin.cn/post/6844904090711900168" target="_blank" rel="noopener">ã€Šä¸€ä¸ªHashMapèƒ½è·Ÿé¢è¯•å®˜æ‰¯ä¸ŠåŠä¸ªå°æ—¶ã€‹</a><br><a href="http://www.tianxiaobo.com/2018/01/18/HashMap-%E6%BA%90%E7%A0%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90-JDK1-8/#37-%E6%80%BB%E7%BB%93" target="_blank" rel="noopener">ã€ŠHashMap æºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Container</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jvmå †æº¢å‡ºå’Œæ ˆæº¢å‡º</title>
    <url>/post/79459fb9.html</url>
    <content><![CDATA[<blockquote><p>Jvmå †æº¢å‡ºå’Œæ ˆæº¢å‡ºä»‹ç» ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€å †æº¢å‡º"><a href="#ä¸€ã€å †æº¢å‡º" class="headerlink" title="ä¸€ã€å †æº¢å‡º"></a>ä¸€ã€å †æº¢å‡º</h3><h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>åœ¨<code>jvm</code>è¿è¡Œ<code>java</code>ç¨‹åºæ—¶ï¼Œå¦‚æœç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„å†…å­˜å¤§äºç³»ç»Ÿçš„å †æœ€å¤§å†…å­˜(<code>-Xmx</code>)ï¼Œå°±ä¼šå‡ºç°å †æº¢å‡ºé—®é¢˜ã€‚</p><h4 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»‹ç»:æ‰§è¡Œè¯¥æ®µä»£ç éœ€è¦å¤§äº10må†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadOverflow</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">			Byte[] bytes = <span class="keyword">new</span> Byte[<span class="number">1</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">			list.add(bytes);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"æˆåŠŸ"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®è¯¥ç¨‹åºçš„jvmå‚æ•°ä¿¡æ¯</span></span><br><span class="line">-Xms1m -Xmx10m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">åˆå§‹å †å†…å­˜å’Œæœ€å¤§å¯ä»¥å †å†…å­˜ Gcè¯¦ç»†æ—¥å¿—ä¿¡æ¯</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>1ã€æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤§å¯¹è±¡çš„åˆ†é…ï¼Œæœ€æœ‰å¯èƒ½çš„æ˜¯å¤§æ•°ç»„åˆ†é…</p><p>2ã€é€šè¿‡<code>jmap</code>å‘½ä»¤ï¼ŒæŠŠå †å†…å­˜dumpä¸‹æ¥ï¼Œä½¿ç”¨matå·¥å…·åˆ†æä¸€ä¸‹ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜</p><p>3ã€å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ˜æ˜¾çš„å†…å­˜æ³„éœ²ï¼Œä½¿ç”¨ <code>-Xmx</code> åŠ å¤§å †å†…å­˜</p><p>4ã€è¿˜æœ‰ä¸€ç‚¹å®¹æ˜“è¢«å¿½ç•¥ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¤§é‡çš„è‡ªå®šä¹‰çš„ <code>Finalizable</code> å¯¹è±¡ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ¡†æ¶å†…éƒ¨æä¾›çš„ï¼Œè€ƒè™‘å…¶å­˜åœ¨çš„å¿…è¦æ€§</p><h3 id="äºŒã€æ ˆæº¢å‡º"><a href="#äºŒã€æ ˆæº¢å‡º" class="headerlink" title="äºŒã€æ ˆæº¢å‡º"></a>äºŒã€æ ˆæº¢å‡º</h3><h4 id="åŸå› -1"><a href="#åŸå› -1" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå‡ºç° <code>StackOverflowError</code></p><p>è™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ·±åº¦æ—¶ï¼Œæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œå‡ºç° <code>OutOfMemoryError</code></p><h4 id="æŠ¥é”™-1"><a href="#æŠ¥é”™-1" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.OutOfMemoryError : unable to create <span class="keyword">new</span> <span class="keyword">native</span> Thread</span><br></pre></td></tr></table></figure><h4 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿæ ˆå†…å­˜æº¢å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackOverflowTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å½’è°ƒç”¨è‡ªå·±ï¼Œç›´åˆ°æ ˆæº¢å‡º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(String.format(<span class="string">"è°ƒç”¨æ·±åº¦ï¼š%dï¼Œidï¼š%s"</span>, count, UUID.randomUUID().toString()));</span><br><span class="line">        count++;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•-1"><a href="#è§£å†³æ–¹æ³•-1" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>1ã€é€šè¿‡ <code>-Xss</code>é™ä½ ä¸€ä¸ªçº¿ç¨‹å †æ ˆçš„æœ€å¤§å†…å­˜å®¹é‡</p><h3 id="ä¸‰ã€æ°¸ä¹…ä»£-å…ƒç©ºé—´æº¢å‡º"><a href="#ä¸‰ã€æ°¸ä¹…ä»£-å…ƒç©ºé—´æº¢å‡º" class="headerlink" title="ä¸‰ã€æ°¸ä¹…ä»£/å…ƒç©ºé—´æº¢å‡º"></a>ä¸‰ã€æ°¸ä¹…ä»£/å…ƒç©ºé—´æº¢å‡º</h3><h4 id="åŸå› -2"><a href="#åŸå› -2" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>æ°¸ä¹…ä»£æ˜¯ <code>HotSot</code> è™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å…·ä½“å®ç°ï¼Œå­˜æ”¾äº†è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€JITç¼–è¯‘åçš„ä»£ç ç­‰ã€‚</p><p><code>JDK8</code>åï¼Œå…ƒç©ºé—´æ›¿æ¢äº†æ°¸ä¹…ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œè¿˜æœ‰å…¶å®ƒç»†èŠ‚å˜åŒ–ï¼š</p><p><strong>å­—ç¬¦ä¸²å¸¸é‡ç”±æ°¸ä¹…ä»£è½¬ç§»åˆ°å †ä¸­ã€æ°¸ä¹…ä»£ç›¸å…³çš„<code>JVM</code>å‚æ•°å·²ç§»é™¤ã€‚</strong>å‡ºç°æ°¸ä¹…ä»£æˆ–å…ƒç©ºé—´çš„æº¢å‡ºçš„åŸå› å¯èƒ½æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><p>1ã€åœ¨<code>Java7</code>ä¹‹å‰ï¼Œé¢‘ç¹çš„é”™è¯¯ä½¿ç”¨<code>String.intern</code>æ–¹æ³•</p><p>2ã€ç”Ÿæˆäº†å¤§é‡çš„ä»£ç†ç±»ï¼Œå¯¼è‡´æ–¹æ³•åŒºè¢«æ’‘çˆ†ï¼Œæ— æ³•å¸è½½</p><p>3ã€åº”ç”¨é•¿æ—¶é—´è¿è¡Œï¼Œæ²¡æœ‰é‡å¯</p><h4 id="æŠ¥é”™-2"><a href="#æŠ¥é”™-2" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: PermGen space java.lang.OutOfMemoryError: Metaspace</span><br></pre></td></tr></table></figure><h4 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MetaspaceTest</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">          List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">          <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">               list.add(String.valueOf(i++).intern());</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•-2"><a href="#è§£å†³æ–¹æ³•-2" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>æ°¸ä¹…ä»£/å…ƒç©ºé—´ æº¢å‡ºçš„åŸå› æ¯”è¾ƒç®€å•ï¼Œè§£å†³æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><p>1ã€æ£€æŸ¥æ˜¯å¦æ°¸ä¹…ä»£ç©ºé—´æˆ–è€…å…ƒç©ºé—´è®¾ç½®çš„è¿‡å°ï¼Œé€šè¿‡å‘½ä»¤è¡Œè®¾ç½® <code>-XX: MaxMetaSpaceSize</code> å¢åŠ  <code>metaspace</code> å¤§å°</p><p>2ã€æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨å¤§é‡çš„åå°„æ“ä½œ</p><p>3ã€dumpä¹‹åé€šè¿‡ mat æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤§é‡ç”±äºåå°„ç”Ÿæˆçš„ä»£ç†ç±»</p><p>4ã€æ”¾å¤§æ‹›ï¼Œé‡å¯<code>JVM</code></p><p>5ã€ä¸ºæœåŠ¡å™¨åˆ†é…æ›´å¤šçš„å†…å­˜</p><h3 id="å››ã€å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²"><a href="#å››ã€å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²" class="headerlink" title="å››ã€å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²"></a>å››ã€å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²</h3><p><strong>å†…å­˜æº¢å‡º</strong>ï¼šç”³è¯·å†…å­˜ç©ºé—´,è¶…å‡ºæœ€å¤§å †å†…å­˜ç©ºé—´ã€‚<strong>ç¨‹åºæ— æ³•ç”³è¯·åˆ°å¯ç”¨çš„å†…å­˜</strong></p><p>æƒ…å†µï¼šæ­»å¾ªç¯</p><p><strong>å†…å­˜æ³„éœ²</strong>ï¼šå…¶å®åŒ…å«å†…å­˜æº¢å‡º,å †å†…å­˜ç©ºé—´è¢«æ— ç”¨å¯¹è±¡å ç”¨æ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå¯¼è‡´å ç”¨å†…å­˜ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜æ³„éœ²ã€‚<strong>ç¨‹åºå ç”¨çš„å†…å­˜æ— æ³•é‡Šæ”¾</strong></p><p>æƒ…å†µï¼šé™æ€staticä¿®é¥°å¯¹è±¡ã€é€’å½’</p><p>è§£å†³ï¼šå‡å°‘å¸¸é‡çš„å®šä¹‰(å…·ä½“çœ‹æœåŠ¡å™¨å†…å­˜æƒ…å†µ)</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Synchronizedå’ŒLock</title>
    <url>/post/879be548.html</url>
    <content><![CDATA[<blockquote><p>Synchronizedå’ŒLock ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Synchronized"><a href="#ä¸€ã€Synchronized" class="headerlink" title="ä¸€ã€Synchronized"></a>ä¸€ã€Synchronized</h3><h4 id="å®ä¾‹ç”¨æ³•"><a href="#å®ä¾‹ç”¨æ³•" class="headerlink" title="å®ä¾‹ç”¨æ³•"></a>å®ä¾‹ç”¨æ³•</h4><ol><li><p>å½“synchronizedä½œç”¨åœ¨<strong>æ™®é€šæ–¹æ³•</strong>æ—¶ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>å½“synchronizedä½œç”¨åœ¨<strong>é™æ€æ–¹æ³•</strong>æ—¶ï¼Œé”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">someStaticMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>å½“synchronizedä½œç”¨åœ¨<strong>ä»£ç å—</strong>æ—¶ï¼Œé”æ˜¯æ‹¬å·æ‹¬èµ·æ¥çš„å¯¹è±¡ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (someObject) &#123;</span><br><span class="line">        <span class="comment">// ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h4><h5 id="1ã€é”å®šä»£ç å—æ—¶"><a href="#1ã€é”å®šä»£ç å—æ—¶" class="headerlink" title="1ã€é”å®šä»£ç å—æ—¶"></a>1ã€é”å®šä»£ç å—æ—¶</h5><p>åº•å±‚ä½¿ç”¨æŒ‡ä»¤ç æ–¹å¼æ¥æ§åˆ¶é”çš„ï¼Œæ˜¯åˆ©ç”¨ <strong>monitorenter å’Œ monitorexit è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤</strong>ã€‚å®ƒä»¬åˆ†åˆ«ä½äºåŒæ­¥ä»£ç å—çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å½“ jvm æ‰§è¡Œåˆ° monitorenter æŒ‡ä»¤æ—¶ï¼Œå½“å‰çº¿ç¨‹è¯•å›¾è·å– monitor å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¦‚æœæœªåŠ é”æˆ–è€…å·²ç»è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ï¼Œå°±æŠŠé”çš„è®¡æ•°å™¨ + 1ï¼›å½“æ‰§è¡Œ monitorexit æŒ‡ä»¤æ—¶ï¼Œé”è®¡æ•°å™¨ - 1ï¼›å½“é”è®¡æ•°å™¨ä¸º 0 æ—¶ï¼Œè¯¥é”å°±è¢«é‡Šæ”¾äº†ã€‚å¦‚æœè·å– monitor å¯¹è±¡å¤±è´¥ï¼Œè¯¥çº¿ç¨‹åˆ™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210430171745.png" style="zoom:33%"><h5 id="2ã€é”å®šæ–¹æ³•æ—¶"><a href="#2ã€é”å®šæ–¹æ³•æ—¶" class="headerlink" title="2ã€é”å®šæ–¹æ³•æ—¶"></a>2ã€é”å®šæ–¹æ³•æ—¶</h5><p>å³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼Œå®ƒå®ç°åœ¨<strong>æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œ</strong>ä¹‹ä¸­ã€‚JVM å¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± ä¸­çš„æ–¹æ³•è¡¨ç»“æ„ (method_info Structure) ä¸­çš„ <strong>ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦åŒæ­¥æ–¹æ³•</strong>ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼š æ£€æŸ¥æ–¹æ³•çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰ <code>monitor</code>ï¼ˆè™šæ‹Ÿæœºè§„èŒƒä¸­ç”¨çš„æ˜¯ç®¡ç¨‹ä¸€è¯ï¼‰ï¼Œ ç„¶åå†æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åå†æ–¹æ³•å®Œæˆ (æ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆ) æ—¶é‡Šæ”¾ <code>monitor</code>ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210430171745.png" style="zoom:33%"><p>ä¸¤ç§åŒæ­¥æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯æ–¹æ³•çš„åŒæ­¥æ˜¯ä¸€ç§éšå¼çš„æ–¹å¼æ¥å®ç°ï¼Œæ— éœ€é€šè¿‡å­—èŠ‚ç æ¥å®Œæˆã€‚ä¸¤ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œæ˜¯<code>JVM</code>é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥åŸè¯­<code>mutex</code>æ¥å®ç°ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€ç­‰å¾…é‡æ–°è°ƒåº¦ï¼Œä¼šå¯¼è‡´â€œç”¨æˆ·æ€å’Œå†…æ ¸æ€â€ä¸¤ä¸ªæ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</p><p>åœ¨ <strong>JDK1.6 ä¹‹å‰</strong>ï¼Œsynchronized æ˜¯ä¸€ä¸ªé‡é‡çº§é”ï¼Œæ€§èƒ½æ¯”è¾ƒå·®ã€‚ä» JDK1.6 å¼€å§‹ï¼Œä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œsynchronized è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”çš„æ¦‚å¿µã€‚</p><p>æ‰€ä»¥<strong>ä» JDK1.6 å¼€å§‹</strong>ï¼Œé”ä¸€å…±ä¼šæœ‰å››ç§çŠ¶æ€ï¼Œé”çš„çŠ¶æ€æ ¹æ®ç«äº‰æ¿€çƒˆç¨‹åº¦ä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯: æ— é”çŠ¶æ€-&gt;åå‘é”çŠ¶æ€-&gt;è½»é‡çº§é”çŠ¶æ€-&gt;é‡é‡çº§é”çŠ¶æ€ã€‚è¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€é”ç«äº‰çš„æƒ…å†µé€æ­¥å‡çº§ã€‚ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ï¼Œé”å¯ä»¥å‡çº§ä½†æ˜¯ä¸èƒ½é™çº§ã€‚</p><h3 id="äºŒã€Lock"><a href="#äºŒã€Lock" class="headerlink" title="äºŒã€Lock"></a>äºŒã€Lock</h3><h4 id="å®ä¾‹ç”¨æ³•-1"><a href="#å®ä¾‹ç”¨æ³•-1" class="headerlink" title="å®ä¾‹ç”¨æ³•"></a>å®ä¾‹ç”¨æ³•</h4><p><strong>Lock æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œä¸€ä¸ªæ˜¯ ReentrantLock, å¦ä¸¤ä¸ªæ˜¯ ReentrantReadWriteLock ç±»ä¸­çš„ä¸¤ä¸ªé™æ€å†…éƒ¨ç±» ReadLock å’Œ WriteLockã€‚</strong>ä¸€èˆ¬ä½¿ç”¨ReentrantLockç±»åšä¸ºé”ã€‚åœ¨åŠ é”å’Œè§£é”å¤„éœ€è¦é€šè¿‡<code>lock()</code>å’Œ<code>unlock()</code>æ˜¾ç¤ºæŒ‡å‡ºã€‚æ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨finallyå—ä¸­å†™unlock()ä»¥é˜²æ­»é”ã€‚</p><h4 id="åº•å±‚åŸç†-1"><a href="#åº•å±‚åŸç†-1" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h4><ul><li>lock çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ª <strong>int ç±»å‹çŠ¶æ€å€¼ï¼ˆç”¨äºé”çš„çŠ¶æ€å˜æ›´ï¼‰</strong>ï¼Œä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼ˆç”¨äºå­˜å‚¨ç­‰å¾…ä¸­çš„çº¿ç¨‹ï¼‰</li><li>lock è·å–é”çš„è¿‡ç¨‹ï¼šæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ <strong>CAS æ¥è·å–çŠ¶æ€å€¼ä¿®æ”¹</strong>ï¼Œå¦‚æœå½“åœºæ²¡è·å–åˆ°ï¼Œä¼šå°†è¯¥çº¿ç¨‹æ”¾åœ¨çº¿ç¨‹<strong>ç­‰å¾…é“¾è¡¨</strong>ä¸­ã€‚</li><li>lock é‡Šæ”¾é”çš„è¿‡ç¨‹ï¼šä¿®æ”¹<strong>çŠ¶æ€å€¼</strong>ï¼Œè°ƒæ•´ç­‰å¾…é“¾è¡¨ã€‚</li></ul><blockquote><p><strong>1.unsafeç±»</strong></p><p>Unsafeç±»ä½¿javaæ‹¥æœ‰äº†åƒCè¯­è¨€çš„æŒ‡é’ˆä¸€æ ·æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼ˆæ“ä½œå¯¹è±¡çš„å†…å­˜ç©ºé—´å³èƒ½å¤Ÿæ“ä½œå¯¹è±¡é‡Œé¢çš„å†…å®¹ï¼›ä½†æ˜¯è¿™ä¸ªUnSafeç±»ä¸å¤ªå®‰å…¨ï¼›å¦‚æœä½¿ç”¨ä¸å½“ä¼šå‡ºç°ä¸€äº›æ¯”è¾ƒå±é™©çš„äº‹æƒ…ï¼›æ‰€ä»¥javaå®˜æ–¹å¹¶ä¸æ¨èä½¿ç”¨ï¼›å¹¶ä¸”åœ¨jdkå½“ä¸­ä¹Ÿæ— æ³•æ‰¾åˆ°æ­¤ç±»ï¼›åªèƒ½å¤Ÿé€šè¿‡åå°„çš„æ–¹å¼æ‰èƒ½å¤Ÿæ‰¾åˆ°è¯¥ç±»ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†æŒ‡é’ˆçš„é—®é¢˜ã€‚ è¿‡æ¸¡çš„ä½¿ç”¨Unsafeç±»ä¼šä½¿å¾—å‡ºé”™çš„å‡ ç‡å˜å¤§ï¼Œå› æ­¤Javaå®˜æ–¹å¹¶ä¸å»ºè®®ä½¿ç”¨çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿå‡ ä¹æ²¡æœ‰ã€‚ Unsafeå¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾—ã€‚</p><p><strong>2.CASæ¦‚è¿°å’Œä½œç”¨</strong></p><p>CASçš„å…¨ç§°æ˜¯ Compare And Swapï¼ˆæ¯”è¾ƒå†äº¤æ¢ï¼‰ã€‚ï¼ˆç¡®åˆ‡ä¸€ç‚¹ç§°ä¹‹ä¸ºï¼šæ¯”è¾ƒå¹¶ä¸”ç›¸åŒå†åšäº¤æ¢ï¼‰ æ˜¯ç°ä»£CPUå¹¿æ³›æ”¯æŒçš„ä¸€ç§å¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®è¿›è¡Œæ“ä½œçš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ã€‚</p><p><strong>3.CASçš„ä½œç”¨æ˜¯ï¼šCASå¯ä»¥å°†æ¯”è¾ƒå’Œäº¤æ¢è½¬æ¢ä¸ºåŸå­æ“ä½œï¼Œè¿™ä¸ªåŸå­æ“ä½œç›´æ¥ç”±å¤„ç†å™¨CPUä¿è¯ã€‚</strong> CASå¯ä»¥ä¿è¯å…±äº«å˜é‡èµ‹å€¼æ—¶çš„åŸå­æ“ä½œï¼› <strong>CASåœ¨æ“ä½œæ—¶ä¾èµ–ä¸‰ä¸ªå€¼ï¼›å†…å­˜ä¸­çš„å€¼Vã€æ—§çš„é¢„ä¼°å€¼Xã€è¦ä¿®æ”¹çš„æ–°å€¼Bï¼Œ</strong>å¦‚æœæ—§çš„é¢„ä¼°å€¼Xç­‰äºå†…å­˜ä¸­çš„å€¼Vï¼Œå°±å°†æ–°çš„å€¼Bä¿å­˜åˆ°å†…å­˜ä¸­ï¼›æ›¿æ¢è¿™ä¸ªå†…å­˜ä¸­çš„å€¼Vï¼›</p></blockquote><p>åº•å±‚æ˜¯CASä¹è§‚é”+è‡ªæ—‹ï¼Œä¾èµ–AbstractQueuedSynchronizerç±»ï¼ŒæŠŠæ‰€æœ‰çš„è¯·æ±‚çº¿ç¨‹æ„æˆä¸€ä¸ªCLHé˜Ÿåˆ—ã€‚è€Œå¯¹è¯¥é˜Ÿåˆ—çš„æ“ä½œå‡é€šè¿‡Lock-Freeï¼ˆCASï¼‰æ“ä½œã€‚</p><blockquote><p><strong>1.å®šä¹‰</strong></p><p>AQSï¼ˆAbstractQuenedSynchronizer ï¼‰ï¼Œ<strong>æŠ½è±¡çš„é˜Ÿåˆ—å¼åŒæ­¥å™¨</strong>ã€‚</p><p><strong>2.AQS çš„æ ¸å¿ƒæ€æƒ³</strong></p><p>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—<strong>çº¿ç¨‹é˜»å¡ç­‰å¾…</strong>ä»¥åŠ<strong>è¢«å”¤é†’</strong>æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ <strong>CLH é˜Ÿåˆ—é”ï¼ˆCLH é”æ˜¯ä¸€ä¸ªè‡ªæ—‹é”ã€‚èƒ½ç¡®ä¿æ— é¥¥é¥¿æ€§ã€‚æä¾›å…ˆæ¥å…ˆæœåŠ¡çš„å…¬å¹³æ€§ï¼‰</strong>å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°<strong>é˜Ÿåˆ—</strong>ä¸­ã€‚</p><p>AQS æ˜¯å°†æ¯ä¸€æ¡è¯·æ±‚å…±äº«èµ„æºçš„<strong>çº¿ç¨‹</strong>å°è£…æˆä¸€ä¸ª CLH é”é˜Ÿåˆ—çš„ä¸€ä¸ª<strong>ç»“ç‚¹ï¼ˆNodeï¼‰</strong>ï¼Œæ¥å®ç°é”çš„åˆ†é…ã€‚</p><p><strong>3.å®ç°</strong></p><p>AQS åŸºäº <strong>CLH é˜Ÿåˆ—</strong>ï¼Œç”¨ <strong>volatile ä¿®é¥°å…±äº«å˜é‡ state</strong>ï¼Œçº¿ç¨‹é€šè¿‡ CAS å»æ”¹å˜çŠ¶æ€ç¬¦ï¼ŒæˆåŠŸåˆ™è·å–é”æˆåŠŸï¼Œå¤±è´¥åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p></blockquote><h3 id="ä¸‰ã€åŒºåˆ«"><a href="#ä¸‰ã€åŒºåˆ«" class="headerlink" title="ä¸‰ã€åŒºåˆ«"></a>ä¸‰ã€åŒºåˆ«</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210502193043.png" alt=""></p><h3 id="å››ã€ä¼˜ç§€èµ„æ–™"><a href="#å››ã€ä¼˜ç§€èµ„æ–™" class="headerlink" title="å››ã€ä¼˜ç§€èµ„æ–™"></a>å››ã€ä¼˜ç§€èµ„æ–™</h3><p><a href="https://zhuanlan.zhihu.com/p/477313563" target="_blank" rel="noopener">ã€Šsychronizedå®ç°åŸç†ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>lock</category>
        <category>MultiThread</category>
      </categories>
      <tags>
        <tag>lock</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlçš„é‚£äº›æ—¥å¿—æ–‡ä»¶</title>
    <url>/post/15e0b332.html</url>
    <content><![CDATA[<blockquote><p>MySQLçš„é‚£äº›æ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ç« æœ«å°¾æœ‰å½©è›‹å“¦ ~ ~</p></blockquote><a id="more"></a><p><code>MySQL</code>ä¸­æœ‰å…­ç§æ—¥å¿—æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>é‡åšæ—¥å¿—ï¼ˆredo logï¼‰</strong>ã€<strong>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</strong>ã€<strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰</strong>ã€<strong>é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰</strong>ã€<strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow query logï¼‰</strong>ã€<strong>ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆgeneral logï¼‰</strong>ã€<strong>ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰</strong>ã€‚å…¶ä¸­<strong>é‡åšæ—¥å¿—ï¼ˆredo logï¼‰</strong>å’Œ<strong>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</strong>ä¸äº‹åŠ¡æ“ä½œæ¯æ¯ç›¸å…³ï¼Œ<strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰</strong>ä¹Ÿä¸äº‹åŠ¡æ“ä½œæœ‰ä¸€å®šçš„å…³ç³»ï¼Œè¿™ä¸‰ç§æ—¥å¿—ï¼Œå¯¹ç†è§£MySQLä¸­çš„äº‹åŠ¡æ“ä½œæœ‰ç€é‡è¦çš„æ„ä¹‰ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210426161729.png" alt="Mysqlæ¶æ„"></p><h3 id="ä¸€ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin-logï¼‰"><a href="#ä¸€ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin-logï¼‰" class="headerlink" title="ä¸€ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰"></a>ä¸€ã€äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbin logï¼‰</h3><p><strong><font face="æ¥·ä½“" color="#FF0000" size="4">äºŒè¿›åˆ¶æ—¥å¿—ï¼šbinary logã€‚ç®€ç§°binLogã€‚è®°å½•äº†å¯¹Mysqlæ•°æ®åº“æ‰§è¡Œæ›´æ”¹çš„æ‰€æœ‰æ“ä½œï¼Œä½†æ˜¯ä¸åŒ…æ‹¬SELECT å’Œ SHOWè¿™ç±»æ“ä½œã€‚</font></strong></p><p><code>binlog</code> æˆ‘ä»¬å¯ä»¥ç†è§£ä½å­˜å‚¨ç€å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰æ›´æ–°è¯­å¥SQLè¯­å¥ã€‚ä¸»è¦çš„ä¸¤ä¸ªä½œç”¨ï¼šå¤åˆ¶å’Œæ¢å¤æ•°æ®ã€‚</p><p><strong>ä¸»ä»å¤åˆ¶</strong>ï¼šåœ¨ Master ç«¯å¼€å¯ <code>binlog</code>ï¼Œç„¶åå°† <code>binlog</code>æ¨é€åˆ°å„ä¸ª Slave ä»ç«¯ï¼ŒSlave ç«¯é‡æ”¾ <code>binlog</code> ä»è€Œè¾¾åˆ°ä¸»ä»æ•°æ®ä¸€è‡´ã€‚</p><p><strong>æ•°æ®æ¢å¤</strong>ï¼šé€šè¿‡ä½¿ç”¨ mysqlbinlog å·¥å…·æ¥æ¢å¤æ•°æ®ã€‚</p><h3 id="äºŒã€å›æ»šæ—¥å¿—ï¼ˆundo-logï¼‰"><a href="#äºŒã€å›æ»šæ—¥å¿—ï¼ˆundo-logï¼‰" class="headerlink" title="äºŒã€å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰"></a>äºŒã€å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</h3><p><strong><font face="æ¥·ä½“" color="#FF0000" size="4">ä¿å­˜äº†äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºå›æ»šï¼ŒåŒæ—¶å¯ä»¥æä¾›å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ä¸‹çš„è¯»ï¼ˆMVCCï¼‰ã€‚</font></strong></p><p>undo logä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š<strong>å›æ»š</strong>å’Œ<strong>å¤šç‰ˆæœ¬æ§åˆ¶(MVCC)</strong></p><p>åœ¨æ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ä»…è®°å½•äº†<code>redo log</code>ï¼Œè¿˜è®°å½•<code>undo log</code>ï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´äº‹åŠ¡å¤±è´¥æˆ–å›æ»šäº†ï¼Œå¯ä»¥ç”¨<code>undo log</code>è¿›è¡Œå›æ»š</p><p><code>undo log</code>ä¸»è¦å­˜å‚¨çš„ä¹Ÿæ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦<code>insert</code>ä¸€æ¡æ•°æ®äº†ï¼Œé‚£<code>undo log</code>ä¼šè®°å½•çš„ä¸€æ¡å¯¹åº”çš„<code>delete</code>æ—¥å¿—ã€‚æˆ‘ä»¬è¦<code>update</code>ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒä¼šè®°å½•ä¸€æ¡å¯¹åº”<strong>ç›¸å</strong>çš„updateè®°å½•ã€‚</p><p>è¿™ä¹Ÿåº”è¯¥å®¹æ˜“ç†è§£ï¼Œæ¯•ç«Ÿå›æ»šå˜›ï¼Œè·Ÿéœ€è¦ä¿®æ”¹çš„æ“ä½œç›¸åå°±å¥½ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°å›æ»šçš„ç›®çš„ã€‚å› ä¸ºæ”¯æŒå›æ»šæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½ä¿è¯ï¼šâ€œ<strong>ä¸€ä¸ªäº‹åŠ¡åŒ…å«å¤šä¸ªæ“ä½œï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œ</strong>â€ã€‚ã€åŸå­æ€§ã€‘</p><p>å› ä¸º<code>undo log</code>å­˜å‚¨ç€ä¿®æ”¹ä¹‹å‰çš„æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ª<strong>å‰ç‰ˆæœ¬</strong>ï¼ŒMVCCå®ç°çš„æ˜¯è¯»å†™ä¸é˜»å¡ï¼Œè¯»çš„æ—¶å€™åªè¦è¿”å›å‰ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®å°±è¡Œäº†ã€‚</p><h3 id="ä¸‰ã€é‡åšæ—¥å¿—ï¼ˆredo-logï¼‰"><a href="#ä¸‰ã€é‡åšæ—¥å¿—ï¼ˆredo-logï¼‰" class="headerlink" title="ä¸‰ã€é‡åšæ—¥å¿—ï¼ˆredo logï¼‰"></a>ä¸‰ã€é‡åšæ—¥å¿—ï¼ˆredo logï¼‰</h3><p><strong><font face="æ¥·ä½“" color="#FF0000" size="4">ç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œé˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯mysqlæœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§ã€‚</font></strong></p><p>ä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼š<br>ã€€ã€€ äº‹åŠ¡å¼€å§‹ä¹‹åå°±äº§ç”Ÿredo logï¼Œredo logçš„è½ç›˜å¹¶ä¸æ˜¯éšç€äº‹åŠ¡çš„æäº¤æ‰å†™å…¥çš„ï¼Œè€Œæ˜¯åœ¨äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾¿å¼€å§‹å†™å…¥redo logæ–‡ä»¶ä¸­ã€‚<br>ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼š<br>ã€€ã€€ å½“å¯¹åº”äº‹åŠ¡çš„è„é¡µå†™å…¥åˆ°ç£ç›˜ä¹‹åï¼Œredo logçš„ä½¿å‘½ä¹Ÿå°±å®Œæˆäº†ï¼Œé‡åšæ—¥å¿—å ç”¨çš„ç©ºé—´å°±å¯ä»¥é‡ç”¨ï¼ˆè¢«è¦†ç›–ï¼‰ã€‚</p><p><code>redo log</code>çš„å­˜åœ¨ä¸ºäº†ï¼šå½“æˆ‘ä»¬ä¿®æ”¹çš„æ—¶å€™ï¼Œå†™å®Œå†…å­˜äº†ï¼Œä½†æ•°æ®è¿˜æ²¡çœŸæ­£å†™åˆ°ç£ç›˜çš„æ—¶å€™ã€‚æ­¤æ—¶æˆ‘ä»¬çš„æ•°æ®åº“æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®<code>redo log</code>æ¥å¯¹æ•°æ®è¿›è¡Œæ¢å¤ã€‚å› ä¸º<code>redo log</code>æ˜¯é¡ºåºIOï¼Œæ‰€ä»¥<strong>å†™å…¥çš„é€Ÿåº¦å¾ˆå¿«</strong>ï¼Œå¹¶ä¸”<code>redo log</code>è®°è½½çš„æ˜¯ç‰©ç†å˜åŒ–ï¼ˆxxxxé¡µåšäº†xxxä¿®æ”¹ï¼‰ï¼Œæ–‡ä»¶çš„ä½“ç§¯å¾ˆå°ï¼Œ<strong>æ¢å¤é€Ÿåº¦å¾ˆå¿«</strong>ã€‚</p><blockquote><p><code>Mysql</code>ä¸æ˜¯æ¯æ¬¡æ•°æ®æ›´æ”¹éƒ½ç«‹åˆ»å†™åˆ°ç£ç›˜ï¼Œè€Œæ˜¯ä¼šå…ˆå°†ä¿®æ”¹åçš„ç»“æœæš‚å­˜åœ¨å†…å­˜ä¸­,å½“ä¸€æ®µæ—¶é—´åï¼Œå†ä¸€æ¬¡æ€§å°†å¤šä¸ªä¿®æ”¹å†™åˆ°ç£ç›˜ä¸Šï¼Œå‡å°‘ç£ç›˜ioæˆæœ¬ï¼ŒåŒæ—¶æé«˜æ“ä½œé€Ÿåº¦ã€‚è¿™ç§<strong>å…ˆå†™æ—¥å¿—å†å†™ç£ç›˜</strong>çš„æŠ€æœ¯å°±æ˜¯ MySQLçš„<code>LWAL(write-ahead logging)æŠ€æœ¯</code>ä¿è¯äº‹åŠ¡ã€‚</p></blockquote><h3 id="å››ã€é”™è¯¯æ—¥å¿—ï¼ˆerror-logï¼‰"><a href="#å››ã€é”™è¯¯æ—¥å¿—ï¼ˆerror-logï¼‰" class="headerlink" title="å››ã€é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰"></a>å››ã€é”™è¯¯æ—¥å¿—ï¼ˆerror logï¼‰</h3><p>ä¸»è¦è®°å½•MySQLæœåŠ¡å®ä¾‹æ¯æ¬¡å¯åŠ¨ã€åœæ­¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠMySQLå®ä¾‹è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„è­¦å‘Šæˆ–è€…é”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚è¿æ¥MySQLè¿æ¥å¤±è´¥ã€æŸ¥è¯¢å‘½ä»¤é”™è¯¯ã€SQLæ‰§è¡Œæµç¨‹ç­‰ç­‰ã€‚</p><h3 id="äº”ã€æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow-query-logï¼‰"><a href="#äº”ã€æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow-query-logï¼‰" class="headerlink" title="äº”ã€æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow query logï¼‰"></a>äº”ã€æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow query logï¼‰</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å®šä½SQLè¯­å¥æŸ¥è¯¢å¿«ä¸æ…¢è€Œè®°å½•çš„ä¸€ç§æ—¥å¿—æ–‡ä»¶ã€‚å½“æŸä¸€æ¡SQLè¯­å¥æŸ¥è¯¢æ—¶é—´è¶…è¿‡ä¸€ä¸ªå›ºå®šçš„é˜ˆå€¼ï¼Œè¿™æ¡SQLè¯­å¥å°†è¢«å®šä¹‰ä¸ºæ…¢æŸ¥è¯¢çš„SQLè¯­å¥ï¼Œè¢«è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨MySQLæ…¢æŸ¥è¯¢æ—¥å¿—å¯ä»¥æœ‰æ•ˆçš„è·Ÿè¸ª æ‰§è¡Œæ—¶é—´è¿‡é•¿ æˆ–è€… æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢è¯­å¥ã€‚</p><ul><li>æ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢ä¸æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql root@127.0.0.1:(none)&gt; show variables like '%slow%';</span><br><span class="line">+<span class="comment">---------------------------+-------------------------------+</span></span><br><span class="line">| Variable_name             | Value                         |</span><br><span class="line">+<span class="comment">---------------------------+-------------------------------+</span></span><br><span class="line">| slow_query_log            | ON                            |</span><br><span class="line">| slow_query_log_file       | /var/lib/mysql/mysql.slow.log |</span><br><span class="line">+<span class="comment">---------------------------+-------------------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span></span><br><span class="line"><span class="built_in">Time</span>: <span class="number">0.014</span>s</span><br></pre></td></tr></table></figure><ul><li>æ…¢æŸ¥è¯¢æ—¶é—´é˜ˆå€¼</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql root@127.0.0.1:(none)&gt; show variables like '%long_query_time%';</span><br><span class="line">+<span class="comment">-----------------+----------+</span></span><br><span class="line">| Variable_name   | Value    |</span><br><span class="line">+<span class="comment">-----------------+----------+</span></span><br><span class="line">| long_query_time | 3.000000 |</span><br><span class="line">+<span class="comment">-----------------+----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span></span><br><span class="line"><span class="built_in">Time</span>: <span class="number">0.013</span></span><br></pre></td></tr></table></figure><h3 id="å…­ã€å½©è›‹"><a href="#å…­ã€å½©è›‹" class="headerlink" title="å…­ã€å½©è›‹"></a>å…­ã€å½©è›‹</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210426161645.png" alt="Mysqlæ‰§è¡Œæ›´æ–°è¯­å¥æµç¨‹"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringAopåŸç†</title>
    <url>/post/a49369ea.html</url>
    <content><![CDATA[<blockquote><p>SpringAopåŸç† ~</p></blockquote><a id="more"></a><h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>Spring AOPå…¨ç§°ä¸º <code>Spring Aspect-Oriented Programming</code> ï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒAOPä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®é™…ä¸Šæ˜¯ç¼–ç¨‹æ€æƒ³ã€‚å‡¡æ˜¯ç¬¦åˆAOPæ€æƒ³çš„æŠ€æœ¯ï¼Œéƒ½å¯ä»¥çœ‹æˆæ˜¯AOPçš„å®ç°ã€‚æ˜¯è¿è¡Œæ—¶ç»‡å…¥çš„ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç»‡å…¥åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯<strong>ä»£ç†å¯¹è±¡</strong>ã€‚ä»£ç†å¯¹è±¡åˆå¯ä»¥åˆ†ä¸º <strong>é™æ€ä»£ç†</strong> å’Œ <strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p><ul><li><strong>é™æ€ä»£ç†</strong>ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–ç‰¹å®šå·¥å…·è‡ªåŠ¨ç”Ÿæˆæºä»£ç ï¼Œå†å¯¹å…¶ç¼–è¯‘ã€‚åœ¨ç¨‹åºè¿è¡Œå‰ï¼Œä»£ç†ç±»çš„.classæ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†ã€‚</li><li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿ç”¨åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºè€Œæˆã€‚</li></ul><p>Spring AOP ä½¿ç”¨<strong>åŠ¨æ€ä»£ç†</strong>æŠ€æœ¯åœ¨è¿è¡ŒæœŸé—´ç»‡å…¥å¢å¼ºçš„ä»£ç ï¼Œä¸»è¦æœ‰ä¸¤ç§ä»£ç†æœºåˆ¶ï¼š<code>åŸºäºJDKçš„åŠ¨æ€ä»£ç†</code>ã€<code>åŸºäºcglibçš„åŠ¨æ€ä»£ç†</code>ã€‚</p><p>JDKæœ¬èº«åªæä¾›æ¥å£çš„ä»£ç†ï¼Œè€Œä¸æ”¯æŒç±»çš„ä»£ç†ã€‚</p><blockquote><p><code>AOP</code> æ€æƒ³ï¼š åŸºäºä»£ç†æ€æƒ³ï¼Œå¯¹åŸæ¥ç›®æ ‡å¯¹è±¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåœ¨ä¸ä¿®æ”¹åŸå¯¹è±¡ä»£ç æƒ…å†µä¸‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨å¢å¼ºåŠŸèƒ½çš„ä»£ç ï¼Œä»è€Œå¯¹åŸæœ‰ä¸šåŠ¡æ–¹æ³•è¿›è¡Œå¢å¼º ï¼</p></blockquote><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><p>ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚æ¯”å¦‚Aå¯¹è±¡è¦åšä¸€ä»¶äº‹æƒ…ï¼Œåœ¨æ²¡æœ‰ä»£ç†å‰ï¼Œè‡ªå·±æ¥åšï¼Œåœ¨å¯¹Aä»£ç†åï¼Œç”±Açš„ä»£ç†ç±»Bæ¥åšã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210426113023.png" alt=""></p><h4 id="ä¸€ã€é™æ€ä»£ç†æ¨¡å¼"><a href="#ä¸€ã€é™æ€ä»£ç†æ¨¡å¼" class="headerlink" title="ä¸€ã€é™æ€ä»£ç†æ¨¡å¼"></a>ä¸€ã€é™æ€ä»£ç†æ¨¡å¼</h4><p>é™æ€ä»£ç†å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰å°±å·²ç»å­˜åœ¨ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä»£ç†ç±»å’ŒåŸå§‹ç±»çš„å…³ç³»åœ¨<strong>è¿è¡Œå‰</strong>å°±å·²ç»ç¡®å®šã€‚</p><p>é™æ€ä»£ç†è™½ç„¶ä¿è¯äº†ä¸šåŠ¡ç±»åªéœ€å…³æ³¨é€»è¾‘æœ¬èº«ï¼Œä»£ç†å¯¹è±¡çš„ä¸€ä¸ªæ¥å£åªæœåŠ¡äºä¸€ç§ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœè¦ä»£ç†çš„æ–¹æ³•å¾ˆå¤šï¼ŒåŠ¿å¿…è¦ä¸ºæ¯ä¸€ç§æ–¹æ³•éƒ½è¿›è¡Œä»£ç†ã€‚</p><p>å†è€…ï¼Œå¦‚æœå¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰çš„ä»£ç†ç±»ä¹Ÿè¦å®ç°æ­¤æ–¹æ³•ã€‚å¢åŠ äº†ä»£ç çš„ç»´æŠ¤æˆæœ¬ã€‚é‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚</p><h4 id="äºŒã€åŠ¨æ€ä»£ç†æ¨¡å¼"><a href="#äºŒã€åŠ¨æ€ä»£ç†æ¨¡å¼" class="headerlink" title="äºŒã€åŠ¨æ€ä»£ç†æ¨¡å¼"></a>äºŒã€åŠ¨æ€ä»£ç†æ¨¡å¼</h4><p>åŠ¨æ€ä»£ç†ç±»çš„æºç æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´é€šè¿‡JVMåå°„ç­‰æœºåˆ¶åŠ¨æ€ç”Ÿæˆï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»çš„å…³ç³»æ˜¯<strong>è¿è¡Œæ—¶</strong>æ‰ç¡®å®šçš„ã€‚</p><p>åŠ¨æ€ä»£ç†ä¹Ÿåˆ†ä¸ºä¸¤ç±»ï¼šåŸºäºæ¥å£çš„ä»£ç†å’ŒåŸºäºç»§æ‰¿çš„ä»£ç†ï¼Œä¸¤ç±»å®ç°çš„ä»£è¡¨æ˜¯ï¼š<strong>JDKä»£ç†</strong> ä¸ <strong>CGlibä»£ç†</strong>ã€‚</p><h5 id="ï¼ˆ1ï¼‰JDKä»£ç†æ¨¡å¼"><a href="#ï¼ˆ1ï¼‰JDKä»£ç†æ¨¡å¼" class="headerlink" title="ï¼ˆ1ï¼‰JDKä»£ç†æ¨¡å¼"></a>ï¼ˆ1ï¼‰JDKä»£ç†æ¨¡å¼</h5><p>ã€€ã€€JDKåŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠjava.lang.reflectåŒ…ä¸‹çš„ä¸¤ä¸ªç±»ï¼šProxyç±»å’ŒInvocationHandleræ¥å£ã€‚</p><p>ã€€ã€€JDKä»£ç†å®ç°çš„ä¸‰ä¸ªè¦ç‚¹ï¼š</p><p>ã€€ã€€â‘  é€šè¿‡Java.lang.reflect.Proxyç±»æ¥åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼›</p><p>ã€€ã€€â‘¡ ä»£ç†ç±»è¦å®ç°InvocationHandleræ¥å£ï¼›</p><p>ã€€ã€€â‘¢ JDKä»£ç†åªèƒ½åŸºäºæ¥å£è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ï¼›</p><h5 id="ï¼ˆ2ï¼‰CGLibä»£ç†æ¨¡å¼"><a href="#ï¼ˆ2ï¼‰CGLibä»£ç†æ¨¡å¼" class="headerlink" title="ï¼ˆ2ï¼‰CGLibä»£ç†æ¨¡å¼"></a>ï¼ˆ2ï¼‰CGLibä»£ç†æ¨¡å¼</h5><p>ã€€CGLibé‡‡ç”¨éå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼ˆ<code>ASM</code>ä¸€ä¸ªçŸ­å°ç²¾æ‚çš„å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰æ¥æ“ä½œå­—èŠ‚ç ç”Ÿæˆæ–°çš„ç±»ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•å»æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çš„çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶é¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½éœ€è¦å¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»å¢å¼ºï¼Œç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼å°±æ²¡æ³•å®ç°ã€‚é‡‡ç”¨CglibåŠ¨æ€ä»£ç†å¯ä»¥å¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»äº§ç”Ÿä»£ç†ï¼Œ<strong>å®é™…ä¸Šæ˜¯ç”Ÿæˆäº†ç›®æ ‡ç±»çš„å­ç±»æ¥å¢å¼ºã€‚</strong></p><p>ã€€CGLibå’ŒJDKçš„åŸç†ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡æ–¹æ³•å»åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚</p><h3 id="Spring-å¦‚ä½•åˆ‡æ¢ä½¿ç”¨"><a href="#Spring-å¦‚ä½•åˆ‡æ¢ä½¿ç”¨" class="headerlink" title="Spring å¦‚ä½•åˆ‡æ¢ä½¿ç”¨"></a>Spring å¦‚ä½•åˆ‡æ¢ä½¿ç”¨</h3><p>1ã€<strong>è‹¥ç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼ŒSpringé»˜è®¤ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†ã€‚</strong></p><p>ã€€ã€€ä¼˜ç‚¹ï¼šå› ä¸ºæœ‰æ¥å£ï¼Œæ‰€ä»¥ä½¿ç³»ç»Ÿæ›´åŠ æ¾è€¦åˆï¼›</p><p>ã€€ã€€ç¼ºç‚¹ï¼šä¸ºæ¯ä¸€ä¸ªç›®æ ‡ç±»åˆ›å»ºæ¥å£ï¼›</p><p>2ã€<strong>è‹¥ç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ŒSpringä½¿ç”¨CGLibè¿›è¡ŒåŠ¨æ€ä»£ç†ã€‚</strong></p><p>ã€€ã€€ä¼˜ç‚¹ï¼šå› ä¸ºä»£ç†ç±»ä¸ç›®æ ‡ç±»æ˜¯ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥ä¸éœ€è¦æœ‰æ¥å£çš„å­˜åœ¨ã€‚</p><p>ã€€ã€€ç¼ºç‚¹ï¼šå› ä¸ºæ²¡æœ‰ä½¿ç”¨æ¥å£ï¼Œæ‰€ä»¥ç³»ç»Ÿçš„è€¦åˆæ€§æ²¡æœ‰ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†å¥½ã€‚</p><p>3ã€<strong>è‹¥ç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œä½†æ˜¯å¼ºåˆ¶cglibä»£ç†ï¼Œåˆ™ä½¿ç”¨cglibä»£ç†</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// å¼ºåˆ¶ä½¿ç”¨cglibä»£ç†</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = tree)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopDemoApplication</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SpringApplication.run(AopDemoApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>Aop</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisäº”ç§æ•°æ®ç»“æ„</title>
    <url>/post/55f0c398.html</url>
    <content><![CDATA[<blockquote><p>Redisäº”ç§æ•°æ®ç»“æ„ä»‹ç» ~</p></blockquote><a id="more"></a><p>åœ¨ Redis ä¸­ä¸€å…±æœ‰5ç§æ•°æ®ç»“æ„ï¼Œä¾æ¬¡å­¦ä¹ è®°å½•ä¸€ä¸‹åº•å±‚çš„æ•°æ®ç»“æ„ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210428162648.png" alt=""></p><h3 id="1ã€Stringï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰"><a href="#1ã€Stringï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰" class="headerlink" title="1ã€Stringï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰"></a>1ã€Stringï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</h3><h4 id="æ¦‚å¿µä»‹ç»"><a href="#æ¦‚å¿µä»‹ç»" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p>æ˜¯redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚Redis é‡Œçš„å­—ç¬¦ä¸²æ˜¯åŠ¨æ€å­—ç¬¦ä¸²ï¼Œä¼šæ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è°ƒæ•´ã€‚å¦‚æœé•¿åº¦ä¸å¤Ÿåˆ™è‡ªåŠ¨æ‰©å®¹ã€‚è‡³äºå¦‚ä½•æ‰©å®¹ï¼Œæ–¹æ³•å¤§è‡´å¦‚ä¸‹ï¼šå½“ length å°äº 1M çš„æ—¶å€™ï¼Œæ‰©å®¹è§„åˆ™å°†ç›®å‰çš„å­—ç¬¦ä¸²ç¿»å€ï¼›å¦‚æœ length å¤§äº 1M çš„è¯ï¼Œåˆ™æ¯æ¬¡åªä¼šæ‰©å®¹ 1Mï¼Œç›´åˆ°è¾¾åˆ° 512Mã€‚</p><h4 id="å®æˆ˜åœºæ™¯"><a href="#å®æˆ˜åœºæ™¯" class="headerlink" title="å®æˆ˜åœºæ™¯"></a>å®æˆ˜åœºæ™¯</h4><ol><li><p>ç¼“å­˜ï¼š ç»å…¸ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠå¸¸ç”¨ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²ï¼Œå›¾ç‰‡æˆ–è€…è§†é¢‘ç­‰ä¿¡æ¯æ”¾åˆ°redisä¸­ï¼Œredisä½œä¸ºç¼“å­˜å±‚ï¼ŒmysqlåšæŒä¹…åŒ–å±‚ï¼Œé™ä½mysqlçš„è¯»å†™å‹åŠ›ã€‚</p></li><li><p>è®¡æ•°å™¨ï¼šredisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªï¼ŒåŒæ—¶æ•°æ®å¯ä»¥ä¸€æ­¥è½åœ°åˆ°å…¶ä»–çš„æ•°æ®æºã€‚</p></li><li><p>sessionï¼šå¸¸è§æ–¹æ¡ˆspring session + rediså®ç°sessionå…±äº«ï¼Œ</p></li></ol><h3 id="2ã€Hash-ï¼ˆå­—å…¸ï¼‰"><a href="#2ã€Hash-ï¼ˆå­—å…¸ï¼‰" class="headerlink" title="2ã€Hash ï¼ˆå­—å…¸ï¼‰"></a>2ã€Hash ï¼ˆå­—å…¸ï¼‰</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210428162655.png" alt=""></p><h4 id="æ¦‚å¿µä»‹ç»-1"><a href="#æ¦‚å¿µä»‹ç»-1" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p>æ•£åˆ—ï¼Œhashå†…å®¹ç”±fieldå’Œä¸ä¹‹å…³è”çš„valueç»„æˆmapé”®å€¼å¯¹ç»„æˆ <strong>key</strong>ã€<strong>field</strong> å’Œ <strong>value</strong>æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</p><p>Redisä¸­çš„å­—å…¸ç›¸å½“äºJavaçš„HashMapï¼Œå…¶å†…éƒ¨ç»“æ„ä¸HashMapä¹Ÿæ˜¯ä¸€è‡´çš„ï¼ŒåŒæ ·æ˜¯æ•°ç»„+é“¾è¡¨çš„äºŒç»´ç»“æ„ï¼Œåœ¨ä¸€ç»´å‘ç”Ÿç¢°æ’çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ç¢°æ’çš„å…ƒç´ æŠŠé“¾è¡¨ä¸²æ¥èµ·æ¥ã€‚</p><h4 id="å®æˆ˜åœºæ™¯-1"><a href="#å®æˆ˜åœºæ™¯-1" class="headerlink" title="å®æˆ˜åœºæ™¯"></a>å®æˆ˜åœºæ™¯</h4><p>è®°å½•ä¸šåŠ¡ä¸­çš„ä¸åŒç”¨æˆ·/ä¸åŒå•†å“/ä¸åŒåœºæ™¯çš„ä¿¡æ¯ï¼šå¦‚æŸä¸ªç”¨æˆ·çš„åç§°ï¼Œæˆ–è€…ç”¨æˆ·çš„å†å²è¡Œä¸ºã€‚</p><h3 id="3ã€Listï¼ˆé“¾è¡¨-ï¼‰"><a href="#3ã€Listï¼ˆé“¾è¡¨-ï¼‰" class="headerlink" title="3ã€Listï¼ˆé“¾è¡¨ ï¼‰"></a>3ã€Listï¼ˆé“¾è¡¨ ï¼‰</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210428163124.png" alt=""></p><h4 id="æ¦‚å¿µä»‹ç»-2"><a href="#æ¦‚å¿µä»‹ç»-2" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p><code>Redis</code> é‡Œçš„ List æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œç”±äºé“¾è¡¨æœ¬èº«æ’å…¥å’Œåˆ é™¤æ¯”è¾ƒå—ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œæ‰€ä»¥å¸¸å¸¸è¢«ç”¨åšå¼‚æ­¥é˜Ÿåˆ—ã€‚Redis é‡Œçš„ List è®¾è®¡éå¸¸ç‰›ï¼Œå½“æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œæ•°æ®ç»“æ„æ˜¯å‹ç¼©é“¾è¡¨ï¼Œè€Œå½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™å°±æˆä¸ºäº†å¿«é€Ÿé“¾è¡¨ã€‚</p><h4 id="å®æˆ˜åœºæ™¯-2"><a href="#å®æˆ˜åœºæ™¯-2" class="headerlink" title="å®æˆ˜åœºæ™¯"></a>å®æˆ˜åœºæ™¯</h4><ol><li><code>timeline</code>ï¼šä¾‹å¦‚å¾®åšçš„æ—¶é—´è½´ï¼Œæœ‰äººå‘å¸ƒå¾®åšï¼Œç”¨lpushåŠ å…¥æ—¶é—´è½´ï¼Œå±•ç¤ºæ–°çš„åˆ—è¡¨ä¿¡æ¯ã€‚</li></ol><h3 id="4ã€Set-ï¼ˆ-é›†åˆï¼‰"><a href="#4ã€Set-ï¼ˆ-é›†åˆï¼‰" class="headerlink" title="4ã€Set ï¼ˆ é›†åˆï¼‰"></a>4ã€Set ï¼ˆ é›†åˆï¼‰</h3><h4 id="æ¦‚å¿µä»‹ç»-3"><a href="#æ¦‚å¿µä»‹ç»-3" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p>Redis ä¸­çš„ set æ˜¯ä¸€ä¸ªæ— åº Mapï¼Œç”±äº Go ä¸­æ²¡æœ‰ set ç»“æ„ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ç±»æ¯” Java ä¸­çš„ HashSet æ¦‚å¿µã€‚Redis çš„ set åº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ª Map ç»“æ„ï¼Œä¸åŒäº Java çš„æ˜¯ï¼šalue æ˜¯ä¸€ä¸ª NULLã€‚ç”±äº set çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ç”¨äºå»é‡é€»è¾‘ï¼Œè¿™ä¸€ç‚¹åœ¨ Java ä¸­ä¹Ÿç»å¸¸ä½¿ç”¨ã€‚</p><h4 id="å®æˆ˜åœºæ™¯-3"><a href="#å®æˆ˜åœºæ™¯-3" class="headerlink" title="å®æˆ˜åœºæ™¯"></a>å®æˆ˜åœºæ™¯</h4><p>æ´»åŠ¨æŠ½å¥–å»é‡</p><h3 id="5ã€Sorted-Set-ï¼ˆæœ‰åºé›†åˆï¼‰"><a href="#5ã€Sorted-Set-ï¼ˆæœ‰åºé›†åˆï¼‰" class="headerlink" title="5ã€Sorted Set ï¼ˆæœ‰åºé›†åˆï¼‰"></a>5ã€Sorted Set ï¼ˆæœ‰åºé›†åˆï¼‰</h3><h4 id="æ¦‚å¿µä»‹ç»-4"><a href="#æ¦‚å¿µä»‹ç»-4" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p><code>Redis</code> ä¸­çš„ <code>zset</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼ˆè·³è·ƒåˆ—è¡¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬äº†è§£åˆ°çš„è·³è¡¨ï¼Œåº•å±‚ç”±äº set çš„ç‰¹æ€§ä¿è¯äº† value å”¯ä¸€ï¼ŒåŒæ—¶ä¹Ÿç»™äº† value ä¸€ä¸ªå¾—åˆ†ï¼Œæ‰€è°“çš„æœ‰åºå…¶å®å°±æ˜¯æ ¹æ®è¿™ä¸ªå¾—åˆ†æ¥æ’åºã€‚è‡³äºè·³è·ƒè¡¨å¦‚ä½•æ’å…¥ï¼Œå…¶å®å†…éƒ¨é‡‡ç”¨äº†ä¸€ä¸ªéšæœºç­–ç•¥ã€‚</p><h4 id="å®æˆ˜åœºæ™¯-4"><a href="#å®æˆ˜åœºæ™¯-4" class="headerlink" title="å®æˆ˜åœºæ™¯"></a>å®æˆ˜åœºæ™¯</h4><p>æ¦œå•ï¼Œæ€»æ¦œï¼Œçƒ­æ¦œ</p><h3 id="6ã€ä¼˜ç§€èµ„æ–™"><a href="#6ã€ä¼˜ç§€èµ„æ–™" class="headerlink" title="6ã€ä¼˜ç§€èµ„æ–™"></a>6ã€ä¼˜ç§€èµ„æ–™</h3><p><a href="https://www.zhihu.com/question/433475778/answer/1612399018" target="_blank" rel="noopener">ã€Šç»™ä½ ä¸€ä¸ªäº¿çš„keysï¼ŒRediså¦‚ä½•ç»Ÿè®¡ï¼Ÿã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ç´¢å¼•å¤±æ•ˆåœºæ™¯ä»¥åŠåŸç†</title>
    <url>/post/8aeb2b52.html</url>
    <content><![CDATA[<blockquote><p>ç´¢å¼•å¤±æ•ˆåœºæ™¯ä»¥åŠåŸç† ~</p></blockquote><a id="more"></a><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><h4 id="1ã€ç´¢å¼•çš„ä¼˜ç‚¹"><a href="#1ã€ç´¢å¼•çš„ä¼˜ç‚¹" class="headerlink" title="1ã€ç´¢å¼•çš„ä¼˜ç‚¹"></a>1ã€ç´¢å¼•çš„ä¼˜ç‚¹</h4><ul><li>å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼›</li><li>å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºæˆ–å‡å°‘ä½¿ç”¨ä¸´æ—¶è¡¨æ’åºï¼›</li><li>ç´¢å¼•å¯ä»¥éšæœºI/Oå˜ä¸ºé¡ºåºI/Oï¼›</li></ul><h4 id="2ã€ç´¢å¼•çš„ç¼ºç‚¹"><a href="#2ã€ç´¢å¼•çš„ç¼ºç‚¹" class="headerlink" title="2ã€ç´¢å¼•çš„ç¼ºç‚¹"></a>2ã€ç´¢å¼•çš„ç¼ºç‚¹</h4><ul><li>éœ€è¦å ç”¨ç£ç›˜ç©ºé—´ï¼Œå› æ­¤å†—ä½™ä½æ•ˆçš„ç´¢å¼•å°†å ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ï¼›</li><li>é™ä½DMLæ€§èƒ½ï¼Œå¯¹äºæ•°æ®çš„ä»»æ„å¢åˆ æ”¹éƒ½éœ€è¦è°ƒæ•´å¯¹åº”çš„ç´¢å¼•ï¼Œç”šè‡³å‡ºç°ç´¢å¼•åˆ†è£‚ï¼›</li><li>ç´¢å¼•ä¼šäº§ç”Ÿç›¸åº”çš„ç¢ç‰‡ï¼Œäº§ç”Ÿç»´æŠ¤å¼€é”€ï¼›</li></ul><h4 id="3ã€é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ"><a href="#3ã€é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="3ã€é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ"></a>3ã€é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ</h4><ul><li>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼›</li><li>ç»§ç»­ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„ç»†åˆ†ï¼›</li><li>æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„ç»†åˆ†ï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•ï¼›</li><li>å•é”®/ç»„åˆç´¢å¼•çš„é€‰æ‹©é—®é¢˜ï¼Œé«˜å¹¶å‘ä¸‹æ½œåœ¨åˆ›é€ ç»„åˆç´¢å¼•ï¼›</li><li>æŸ¥è¯¢ä¸­æ’åºçš„åˆ’åˆ†ï¼Œæ’åºé€šè¿‡ç´¢å¼•è®¿é—®æ˜¾ç€æé«˜æ’åºé€Ÿåº¦ï¼›</li><li>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–åˆ†ç»„é•¿åº¦ï¼›</li></ul><h4 id="4ã€ä¸é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ"><a href="#4ã€ä¸é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="4ã€ä¸é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ"></a>4ã€ä¸é€‚åˆå»ºç«‹ç´¢å¼•çš„æƒ…å†µ</h4><ul><li>è¡¨è®°å½•å¤ªå°‘ï¼›</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨ï¼›</li><li>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå‡åŒ€çš„è¡¨åˆ†åŒºï¼Œåªåº”è¯¥ä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•ï¼ˆå¦‚æœæŸä¸ªæ•°æ®ç±»åŒ…å«å¤ªå¤šçš„é‡å¤æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼‰ï¼›</li><li>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ï¼ˆä¼šåŠ é‡IOè´Ÿæ‹…ï¼‰ï¼›</li><li>whereæ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸åˆ›å»ºç´¢å¼•ï¼›</li></ul><h3 id="ç´¢å¼•çš„åˆ†ç±»"><a href="#ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="ç´¢å¼•çš„åˆ†ç±»"></a>ç´¢å¼•çš„åˆ†ç±»</h3><ol><li>æ™®é€šç´¢å¼•ï¼šæœ€åŸºæœ¬çš„ç´¢å¼•ï¼Œå®ƒæ²¡æœ‰ä»»ä½•é™åˆ¶</li><li>å”¯ä¸€ç´¢å¼•ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä¸”ä¸èƒ½ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ã€‚</li><li>ä¸»é”®ç´¢å¼•ï¼šç‰¹æ®Šçš„ç´¢å¼•ï¼Œå”¯ä¸€çš„æ ‡è¯†ä¸€æ¡è®°å½•ï¼Œä¸èƒ½ä¸ºç©ºï¼Œä¸€èˆ¬ç”¨primary keyæ¥çº¦æŸã€‚</li><li>è”åˆç´¢å¼•ï¼šåœ¨å¤šä¸ªå­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œèƒ½å¤ŸåŠ é€ŸæŸ¥è¯¢åˆ°é€Ÿåº¦</li></ol><h3 id="ç´¢å¼•å¤±æ•ˆåœºæ™¯"><a href="#ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="headerlink" title="ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆåœºæ™¯</h3><ol><li><p>åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨ORï¼›ï¼ˆ <strong>æ³¨æ„ï¼š</strong>è¦æƒ³ä½¿ç”¨orï¼Œåˆæƒ³è®©ç´¢å¼•ç”Ÿæ•ˆï¼Œåªèƒ½å°†oræ¡ä»¶ä¸­çš„æ¯ä¸ªåˆ—éƒ½åŠ ä¸Šç´¢å¼•ï¼‰(<em>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå°½é‡å°‘ç”¨orçš„åŸå› </em>)</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210422224829.png" alt=""></p></li><li><p>æœ€ä½³å·¦å‰ç¼€åŸåˆ™â€”â€”å¦‚æœæ˜¯å¤åˆç´¢å¼•ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€åŸåˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢è¦ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—;</p></li><li><p>mysqlä¸­likeæŸ¥è¯¢æ˜¯ä»¥%å¼€å¤´ï¼Œç´¢å¼•ä¼šå¤±æ•ˆå˜æˆå…¨è¡¨æ‰«æï¼Œè¦†ç›–ç´¢å¼•ï¼›</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210422224846.png" alt=""></p></li><li><p>éœ€è¦ç±»å‹è½¬æ¢;</p></li><li><p>whereä¸­ç´¢å¼•åˆ—æœ‰è¿ç®—;</p></li><li><p>whereä¸­ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°;</p></li><li><p>å¦‚æœmysqlè§‰å¾—å…¨è¡¨æ‰«ææ›´å¿«æ—¶ï¼ˆæ•°æ®å°‘ï¼‰;</p></li><li><p>å¦‚æœåˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥,å¦åˆ™ä¸ä½¿ç”¨ç´¢å¼•;</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210422224902.png" alt=""></p></li></ol><h3 id="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Handler_read%'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br><code>handler_read_key</code>:è¿™ä¸ªå€¼è¶Šé«˜è¶Šå¥½ï¼Œè¶Šé«˜è¡¨ç¤ºä½¿ç”¨ç´¢å¼•æŸ¥è¯¢åˆ°çš„æ¬¡æ•°<br><code>handler_read_rnd_next</code>:è¿™ä¸ªå€¼è¶Šé«˜ï¼Œè¯´æ˜æŸ¥è¯¢ä½æ•ˆ</p></blockquote><h3 id="ä¼˜ç§€èµ„æ–™"><a href="#ä¼˜ç§€èµ„æ–™" class="headerlink" title="ä¼˜ç§€èµ„æ–™"></a>ä¼˜ç§€èµ„æ–™</h3><p><a href="https://developer.aliyun.com/article/831250" target="_blank" rel="noopener">ã€ŠMySQLç´¢å¼•è¯¦è§£ï¼ˆä¸€æ–‡ææ‡‚ï¼‰ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Sql</category>
      </categories>
      <tags>
        <tag>Sql</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè°ƒä¼˜ä¹‹explainæ‰§è¡Œè®¡åˆ’è¯¦è§£</title>
    <url>/post/f40ffcc5.html</url>
    <content><![CDATA[<blockquote><p>explainæ‰§è¡Œè®¡åˆ’è®°å½• ~</p></blockquote><a id="more"></a><h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h3><p>explainæ˜¾ç¤ºäº†mysqlå¦‚ä½•ä½¿ç”¨ç´¢å¼•æ¥å¤„ç†selectè¯­å¥ä»¥åŠè¿æ¥è¡¨ã€‚å¯ä»¥å¸®åŠ©é€‰æ‹©æ›´å¥½çš„ç´¢å¼•å’Œå†™å‡ºæ›´ä¼˜åŒ–çš„æŸ¥è¯¢è¯­å¥ã€‚</p><p>ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨selectè¯­å¥å‰åŠ ä¸Šexplainå°±å¯ä»¥äº†(MySQL 5.6å¼€å§‹ï¼Œä¸ä»…ä»…æ”¯æŒselect )</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210422181311.png" alt=""></p><h3 id="å„åˆ—å«ä¹‰"><a href="#å„åˆ—å«ä¹‰" class="headerlink" title="å„åˆ—å«ä¹‰"></a>å„åˆ—å«ä¹‰</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>æ ‡è¯†selectï¼Œidåˆ—æ•°å­—è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼Œå¦‚æœè¯´æ•°å­—ä¸€æ ·å¤§ï¼Œé‚£ä¹ˆå°±ä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œï¼Œidåˆ—ä¸ºnullçš„å°±è¡¨æ˜¯è¿™æ˜¯ä¸€ä¸ªç»“æœé›†ï¼Œä¸éœ€è¦ä½¿ç”¨å®ƒæ¥è¿›è¡ŒæŸ¥è¯¢ã€‚</p><h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p>ç”¨æ¥è¡¨ç¤ºæŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦æ˜¯ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢ã€‚</p><p>å¸¸ç”¨çš„å€¼ï¼š</p><ul><li><code>SIMPLE</code>:ç®€å• SELECT (ä¸ä½¿ç”¨ UNION æˆ–å­æŸ¥è¯¢)</li><li><code>PRIMARY</code>:æœ€å¤–é¢çš„ SELECT</li><li><code>UNION</code>:UNION ä¸­çš„ç¬¬äºŒä¸ªå’Œéšåçš„ SELECT è¯­å¥</li><li><code>DEPENDENT UNION</code>: UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„ SELECT è¯­å¥,å–å†³äºå¤–é¢çš„æŸ¥è¯¢</li><li><code>UNION RESULT</code>: UNION çš„ç»“æœ</li><li><code>SUBQUERY</code>:å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT</li><li><code>DEPENDENT SUBQUERY</code>:å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT ,å–å†³äºå¤–é¢çš„æŸ¥è¯¢</li><li><code>DERIVED</code>:å¯¼å‡ºè¡¨(æ´¾ç”Ÿè¡¨)çš„ SELECT ( FROM å­å¥çš„å­æŸ¥è¯¢)</li><li><code>UNCACHEABLE SUBQUERY</code>ï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª select è¯­å¥ï¼ŒåŒæ—¶æ„å‘³ç€ select ä¸­çš„æŸäº›ç‰¹æ€§é˜»æ­¢ç»“æœè¢«ç¼“å­˜äºä¸€ä¸ª Item_cache ä¸­</li><li><code>UNCACHEABLE UNION</code>ï¼šæ»¡è¶³æ­¤æŸ¥è¯¢æ˜¯ UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…éšåçš„æŸ¥è¯¢ï¼ŒåŒæ—¶æ„å‘³ç€ select ä¸­çš„æŸäº›ç‰¹æ€§é˜»æ­¢ç»“æœè¢«ç¼“å­˜äºä¸€ä¸ª Item_cache ä¸­</li></ul><h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><ol><li>è¾“å‡ºçš„è¡Œæ‰€å¼•ç”¨çš„è¡¨ã€‚</li><li>æ˜¾ç¤ºçš„æŸ¥è¯¢è¡¨åï¼Œå¦‚æœæŸ¥è¯¢ä½¿ç”¨äº†åˆ«åï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯åˆ«åï¼Œå¦‚æœä¸æ¶‰åŠå¯¹æ•°æ®è¡¨çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™æ˜¾ç¤ºä¸º nullï¼Œå¦‚æœæ˜¾ç¤ºä¸ºå°–æ‹¬å·æ‹¬èµ·æ¥çš„<derived n>å°±è¡¨ç¤ºè¿™ä¸ªæ˜¯ä¸´æ—¶è¡¨ï¼Œåè¾¹çš„Nå°±æ˜¯æ‰§è¡Œè®¡åˆ’ä¸­çš„idï¼Œè¡¨ç¤ºç»“æœæ¥è‡ªäºè¿™ä¸ªæŸ¥è¯¢äº§ç”Ÿã€‚å¦‚æœæ˜¯å°–æ‹¬å·æ‹¬èµ·æ¥çš„&lt;union M,N&gt;ï¼Œä¸<derived n>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œè¡¨ç¤ºè¿™ä¸ªç»“æœæ¥è‡ªäºunionæŸ¥è¯¢çš„idä¸ºM,Nçš„ç»“æœé›†ã€‚</derived></derived></li></ol><h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><ul><li>ä¾æ¬¡ä»å¥½åˆ°å·®ï¼š<code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>fulltext</code> &gt; <code>ref_or_null</code> &gt; <code>unique_subquery</code> &gt; <code>index_subquery</code> &gt; <code>range</code> &gt; <code>index_merge</code> &gt; <code>index</code> &gt; <code>ALL</code></li><li>é™¤äº†allä¹‹å¤–ï¼Œå…¶ä»–çš„typeéƒ½å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œé™¤äº†index_mergeä¹‹å¤–ï¼Œå…¶ä»–çš„typeåªå¯ä»¥ç”¨åˆ°ä¸€ä¸ªç´¢å¼•</li><li>æœ€å¸¸ç”¨çš„ä»å¥½åˆ°å·®ä¾æ¬¡æ˜¯ï¼š<code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>range</code> &gt; <code>index</code> &gt; <code>all</code></li><li><strong>ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°<code>range</code>çº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°<code>ref</code></strong>ã€‚</li><li><code>system</code> ï¼šè¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥å¿½ç•¥ä¸è®¡</li><li><code>const</code> ï¼šè¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconstç”¨äºæ¯”è¾ƒprimary key æˆ–è€…uniqueç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚</li><li><code>eq_ref</code> ï¼šå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚ä½¿ç”¨è¿™ç§ç´¢å¼•ï¼ŒMySQLçŸ¥é“æœ€å¤šåªè¿”å›ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚</li><li><code>ref</code> ï¼šå®ƒæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼ˆæœ‰æ—¶ä¹Ÿå«åšç´¢å¼•æŸ¥æ‰¾ï¼‰ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä»–åº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚æŠŠå®ƒå«åšrefæ˜¯å› ä¸ºç´¢å¼•è¦è·ŸæŸä¸ªå‚è€ƒå€¼ç›¸æ¯”è¾ƒã€‚æ­¤ç±»ç´¢å¼•è®¿é—®åªæœ‰å½“ä½¿ç”¨éå”¯ä¸€æ€§ç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•çš„éå”¯ä¸€æ€§å‰ç¼€æ—¶æ‰ä¼šå‘ç”Ÿã€‚</li><li><code>range</code> ï¼šèŒƒå›´æ‰«æå°±æ˜¯ä¸€ä¸ªæœ‰é™åˆ¶çš„ç´¢å¼•æ‰«æï¼Œkeyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºç°betweenã€&lt; ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ï¼Œè¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</li><li><code>index</code> ï¼šè¿™ä¸ªè·Ÿå…¨è¡¨æ‰«æä¸€æ ·ï¼Œåªæ˜¯MySQLæ‰«æè¡¨æ—¶æŒ‰ç´¢å¼•æ¬¡åºè¿›è¡Œè€Œä¸æ˜¯è¡Œã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯é¿å…äº†æ’åºï¼›æœ€å¤§ä¼˜ç‚¹æ˜¯è¦æ‰¿æ‹…æŒ‰ç´¢å¼•æ¬¡åºè¯»å–æ•´ä¸ªè¡¨çš„å¼€é”€ã€‚å¦‚æœåœ¨EXTRAåˆ—ä¸­çœ‹åˆ°using index,è¯´æ˜MySQLæ­£åœ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå®ƒæ¯”æŒ‰ç´¢å¼•æ¬¡åºå…¨è¡¨æ‰«æçš„å¼€é”€è¦å°‘çš„å¤šã€‚</li><li><code>all</code> ï¼šå…¨è¡¨æ‰«æï¼Œå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</li></ul><h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><p>æŸ¥è¯¢å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•éƒ½ä¼šåœ¨è¿™é‡Œåˆ—å‡ºæ¥ã€‚</p><h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>æŸ¥è¯¢çœŸæ­£ä½¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œselect_typeä¸ºindex_mergeæ—¶ï¼Œè¿™é‡Œå¯èƒ½å‡ºç°ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œå…¶ä»–çš„select_typeè¿™é‡Œåªä¼šå‡ºç°ä¸€ä¸ªã€‚</p><h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p>ç”¨äºå¤„ç†æŸ¥è¯¢çš„ç´¢å¼•é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œå¦‚æœæ˜¯å•åˆ—ç´¢å¼•ï¼Œé‚£å°±æ•´ä¸ªç´¢å¼•é•¿åº¦ç®—è¿›å»ï¼Œå¦‚æœæ˜¯å¤šåˆ—ç´¢å¼•ï¼Œé‚£ä¹ˆæŸ¥è¯¢ä¸ä¸€å®šéƒ½èƒ½ä½¿ç”¨åˆ°æ‰€æœ‰çš„åˆ—ï¼Œå…·ä½“ä½¿ç”¨åˆ°äº†å¤šå°‘ä¸ªåˆ—çš„ç´¢å¼•ï¼Œè¿™é‡Œå°±ä¼šè®¡ç®—è¿›å»ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„åˆ—ï¼Œè¿™é‡Œä¸ä¼šè®¡ç®—è¿›å»ã€‚ç•™æ„ä¸‹è¿™ä¸ªåˆ—çš„å€¼ï¼Œç®—ä¸€ä¸‹ä½ çš„å¤šåˆ—ç´¢å¼•æ€»é•¿åº¦å°±çŸ¥é“æœ‰æ²¡æœ‰ä½¿ç”¨åˆ°æ‰€æœ‰çš„åˆ—äº†ã€‚è¦æ³¨æ„ï¼Œmysqlçš„ICPç‰¹æ€§ä½¿ç”¨åˆ°çš„ç´¢å¼•ä¸ä¼šè®¡å…¥å…¶ä¸­ã€‚å¦å¤–ï¼Œkey_lenåªè®¡ç®—whereæ¡ä»¶ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦ï¼Œè€Œæ’åºå’Œåˆ†ç»„å°±ç®—ç”¨åˆ°äº†ç´¢å¼•ï¼Œä¹Ÿä¸ä¼šè®¡ç®—åˆ°key_lenä¸­ã€‚</p><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>æ˜¾ç¤ºä½¿ç”¨å“ªä¸ªåˆ—æˆ–å¸¸æ•°ä¸keyä¸€èµ·ä»è¡¨ä¸­é€‰æ‹©è¡Œã€‚</p><h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p>æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯æˆ–è€…ç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ï¼Œè¿™é‡Œæ˜¯æ‰§è¡Œè®¡åˆ’ä¸­ä¼°ç®—çš„æ‰«æè¡Œæ•°ï¼Œä¸æ˜¯ç²¾ç¡®å€¼ã€‚</p><h4 id="filtered"><a href="#filtered" class="headerlink" title="filtered"></a>filtered</h4><p>è¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œ filtered çš„å€¼è¶Šå¤§è¶Šå¥½ã€‚</p><h4 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h4><ol><li><code>Using filesort</code>ï¼ˆä¹æ­»ä¸€ç”Ÿï¼‰ï¼š<ul><li>è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€ã€‚</li></ul></li><li><code>Using temporary</code>ï¼ˆåæ­»æ— ç”Ÿï¼‰ï¼š<ul><li>ä½¿ç”¨äº†ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºæ’åºorder byå’Œåˆ†ç»„æŸ¥è¯¢group byã€‚</li></ul></li><li><code>Using index</code>ï¼ˆå‘è´¢äº†ï¼‰ï¼š<ul><li>è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ã€‚å¦‚æœåŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚</li></ul></li><li><code>Using where</code> ï¼š<ul><li>è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤</li></ul></li><li><code>Using join buffer</code> ï¼š<ul><li>è¡¨æ˜ä½¿ç”¨äº†è¿æ¥ç¼“å­˜,æ¯”å¦‚è¯´åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¤šè¡¨joinçš„æ¬¡æ•°éå¸¸å¤šï¼Œé‚£ä¹ˆå°†é…ç½®æ–‡ä»¶ä¸­çš„ç¼“å†²åŒºçš„join bufferè°ƒå¤§ä¸€äº›ã€‚</li><li>è¡¨ç¤º SQL æ“ä½œä½¿ç”¨äº†å…³è”æŸ¥è¯¢æˆ–è€…å­æŸ¥è¯¢ï¼Œä¸”éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯è®¡ç®—ã€‚</li></ul></li><li><code>impossible where</code> ï¼š<ul><li>whereå­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„</li></ul></li><li><code>select tables optimized away</code> ï¼š<ul><li>åœ¨æ²¡æœ‰GROUPBYå­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–MIN/MAXæ“ä½œæˆ–è€…å¯¹äºMyISAMå­˜å‚¨å¼•æ“ä¼˜åŒ–COUNT(*)æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚</li></ul></li><li><code>distinct</code> ï¼š<ul><li>ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œ</li></ul></li><li><code>Using index condition</code> ï¼š<ul><li>è¡¨ç¤ºå·²ç»ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ã€‚</li><li>è¡¨ç¤º SQL æ“ä½œå‘½ä¸­äº†ç´¢å¼•ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„åˆ—æ•°æ®éƒ½åœ¨ç´¢å¼•æ ‘ä¸Šï¼Œè¿˜éœ€è¦è®¿é—®å®é™…çš„è¡Œè®°å½•ã€‚</li></ul></li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Sql</category>
      </categories>
      <tags>
        <tag>Sql</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlçš„Sqlè¯­å¥çš„æ‰§è¡Œé¡ºåº</title>
    <url>/post/2ea7f979.html</url>
    <content><![CDATA[<blockquote><p>MySqlçš„Sqlè¯­å¥çš„æ‰§è¡Œé¡ºåº ~</p></blockquote><a id="more"></a><h3 id="SQLæŸ¥è¯¢ä¸­ç”¨åˆ°çš„å…³é”®è¯"><a href="#SQLæŸ¥è¯¢ä¸­ç”¨åˆ°çš„å…³é”®è¯" class="headerlink" title="SQLæŸ¥è¯¢ä¸­ç”¨åˆ°çš„å…³é”®è¯"></a>SQLæŸ¥è¯¢ä¸­ç”¨åˆ°çš„å…³é”®è¯</h3><p>â€‹ selectã€distinctã€fromã€joinã€onã€whereã€group byã€havingã€sumã€countã€maxã€avgã€order byã€limit</p><h3 id="SQLæ‰§è¡Œé¡ºåº"><a href="#SQLæ‰§è¡Œé¡ºåº" class="headerlink" title="SQLæ‰§è¡Œé¡ºåº"></a>SQLæ‰§è¡Œé¡ºåº</h3><table><thead><tr><th align="center"><strong>é¡ºåº</strong></th><th align="center"><strong>å…³é”®è¯</strong></th><th align="center"><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td align="center">1</td><td align="center"><strong>from</strong></td><td align="center">éœ€è¦ä»å“ªä¸ªæ•°æ®è¡¨æ£€ç´¢æ•°æ®</td></tr><tr><td align="center">2</td><td align="center"><strong>on</strong></td><td align="center">å…³è”æ¡ä»¶</td></tr><tr><td align="center">3</td><td align="center"><strong>join</strong></td><td align="center">å¯¹éœ€è¦å…³è”æŸ¥è¯¢çš„è¡¨è¿›è¡Œå…³è”</td></tr><tr><td align="center">4</td><td align="center"><strong>where</strong></td><td align="center">è¿‡æ»¤è¡¨ä¸­æ•°æ®çš„æ¡ä»¶</td></tr><tr><td align="center">5</td><td align="center"><strong>group by</strong></td><td align="center">å¼€å§‹ä½¿ç”¨selectä¸­çš„åˆ«åï¼Œåé¢çš„è¯­å¥ä¸­éƒ½å¯ä»¥ä½¿ç”¨åˆ«å</td></tr><tr><td align="center">6</td><td align="center"><strong>sumã€countã€maxã€avg</strong></td><td align="center">è®¡ç®—èšåˆå‡½æ•°</td></tr><tr><td align="center">7</td><td align="center"><strong>having</strong></td><td align="center">å¯¹ä¸Šé¢å·²ç»åˆ†ç»„çš„æ•°æ®è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶</td></tr><tr><td align="center">8</td><td align="center"><strong>select</strong></td><td align="center">æŸ¥çœ‹ç»“æœé›†ä¸­çš„å“ªä¸ªåˆ—æˆ–åˆ—çš„è®¡ç®—ç»“æœ</td></tr><tr><td align="center">9</td><td align="center"><strong>distinct</strong></td><td align="center">å¯¹ç»“æœé›†é‡å¤å€¼å»é‡</td></tr><tr><td align="center">10</td><td align="center"><strong>order by</strong></td><td align="center">æŒ‰ç…§ä»€ä¹ˆæ ·çš„é¡ºåºæ¥æŸ¥çœ‹è¿”å›çš„æ•°æ®</td></tr><tr><td align="center">11</td><td align="center"><strong>limit</strong></td><td align="center">æˆªå–å‡ºç›®æ ‡é¡µæ•°æ®</td></tr></tbody></table><h3 id="å…·ä½“å«ä¹‰"><a href="#å…·ä½“å«ä¹‰" class="headerlink" title="å…·ä½“å«ä¹‰"></a>å…·ä½“å«ä¹‰</h3><ul><li><p><strong>from</strong>ï¼šéœ€è¦ä»å“ªä¸ªæ•°æ®è¡¨æ£€ç´¢æ•°æ®</p></li><li><p><strong>join</strong>ï¼šå¯¹éœ€è¦å…³è”æŸ¥è¯¢çš„è¡¨è¿›è¡Œå…³è”</p><p>å…³è”æŸ¥è¯¢æ—¶ï¼Œæ•°æ®åº“ä¼šé€‰æ‹©ä¸€ä¸ªé©±åŠ¨è¡¨ï¼Œç„¶åç”¨æ­¤è¡¨çš„è®°å½•å»å…³è”å…¶ä»–è¡¨<br>â€‹ left joinä¸€èˆ¬ä»¥å·¦è¡¨ä¸ºé©±åŠ¨è¡¨ï¼ˆright joinä¸€èˆ¬ä¸ºå³è¡¨ï¼‰,inner joinä¸€èˆ¬ä»¥ç»“æœé›†å°‘çš„è¡¨ä¸ºé©±åŠ¨è¡¨,left joinæŸäº›æƒ…å†µä¸‹ä¼šè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼˜åŒ–ä¸ºinner join</p><ul><li>é©±åŠ¨è¡¨é€‰æ‹©åŸåˆ™ï¼šåœ¨å¯¹æœ€ç»ˆç»“æœé›†æ²¡å½±å“çš„å‰æä¸‹ï¼Œä¼˜å…ˆé€‰æ‹©ç»“æœé›†æœ€å°‘çš„é‚£å¼ è¡¨ä½œä¸ºé©±åŠ¨è¡¨</li><li>åœ¨<strong>ä½¿ç”¨ç´¢å¼•å…³è”</strong>çš„æƒ…å†µä¸‹ï¼Œæœ‰<code>Index Nested-Loop join</code>å’Œ<code>Batched Key Access join</code>ä¸¤ç§ç®—æ³•</li><li>åœ¨<strong>æœªä½¿ç”¨ç´¢å¼•å…³è”</strong>çš„æƒ…å†µä¸‹ï¼Œæœ‰<code>Simple Nested-Loop join</code>å’Œ<code>Block Nested-Loop join</code>ä¸¤ç§ç®—æ³•</li><li><code>Simple Nested-Loop join</code>ï¼ˆSNLJï¼Œç®€å•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰ç®—æ³•ï¼šæ ¹æ®onæ¡ä»¶ï¼Œä»é©±åŠ¨è¡¨å–ä¸€æ¡æ•°æ®ï¼Œç„¶åå…¨è¡¨æ‰«é¢è¢«é©±åŠ¨è¡¨ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„è®°å½•æ”¾å…¥æœ€ç»ˆç»“æœé›†ä¸­ã€‚è¿™æ ·é©±åŠ¨è¡¨çš„æ¯æ¡è®°å½•éƒ½ä¼´éšç€è¢«é©±åŠ¨è¡¨çš„ä¸€æ¬¡å…¨è¡¨æ‰«æ<ul><li>åŒ¹é…æ¬¡æ•°ï¼šå¤–å±‚è¡¨è¡Œæ•°*å†…å±‚è¡¨è¡Œæ•°</li></ul></li><li><code>Index Nested-Loop Join</code>ï¼ˆINLJï¼Œç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥ï¼‰ç®—æ³•ï¼šç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥æ˜¯åŸºäºç´¢å¼•è¿›è¡Œè¿æ¥çš„ç®—æ³•ï¼Œç´¢å¼•æ˜¯åŸºäºå†…å±‚è¡¨çš„ï¼Œé€šè¿‡å¤–å±‚è¡¨åŒ¹é…æ¡ä»¶ç›´æ¥ä¸å†…å±‚è¡¨ç´¢å¼•è¿›è¡ŒåŒ¹é…ï¼Œé¿å…å’Œå†…å±‚è¡¨çš„æ¯æ¡è®°å½•è¿›è¡Œæ¯”è¾ƒï¼Œ ä»è€Œåˆ©ç”¨ç´¢å¼•çš„æŸ¥è¯¢å‡å°‘äº†å¯¹å†…å±‚è¡¨çš„åŒ¹é…æ¬¡æ•°<ul><li>åŒ¹é…æ¬¡æ•°ï¼šå¤–å±‚è¡¨è¡Œæ•°*å†…å±‚è¡¨ç´¢å¼•é«˜åº¦</li></ul></li><li><code>Block Nested-Loop Join</code>ï¼ˆBNLJï¼Œç¼“å­˜å—åµŒå¥—å¾ªç¯è¿æ¥ï¼‰ç®—æ³•ï¼šç¼“å­˜å—åµŒå¥—å¾ªç¯è¿æ¥é€šè¿‡ä¸€æ¬¡æ€§ç¼“å­˜å¤šæ¡æ•°æ®ï¼ŒæŠŠå‚ä¸æŸ¥è¯¢çš„åˆ—ç¼“å­˜åˆ°Join Buffer é‡Œï¼Œç„¶åæ‹¿join bufferé‡Œçš„æ•°æ®æ‰¹é‡ä¸å†…å±‚è¡¨çš„æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œå‡å°‘äº†å†…å±‚å¾ªç¯çš„æ¬¡æ•°ï¼ˆéå†ä¸€æ¬¡å†…å±‚è¡¨å°±å¯ä»¥æ‰¹é‡åŒ¹é…ä¸€æ¬¡Join Bufferé‡Œé¢çš„å¤–å±‚è¡¨æ•°æ®ï¼‰ã€‚<br>å½“ä¸ä½¿ç”¨<code>Index Nested-Loop Join</code>çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨<code>Block Nested-Loop Join</code></li><li><code>Batched Key Access join</code>ï¼ˆBKAJï¼‰ç®—æ³•ï¼šå’ŒSNLJç®—æ³•ç±»ä¼¼ï¼Œä½†ç”¨äºè¢«joinè¡¨ä¸Šæœ‰ç´¢å¼•å¯ä»¥åˆ©ç”¨ï¼Œé‚£ä¹ˆåœ¨è¡Œæäº¤ç»™è¢«joinçš„è¡¨ä¹‹å‰ï¼Œå¯¹è¿™äº›è¡ŒæŒ‰ç…§ç´¢å¼•å­—æ®µè¿›è¡Œæ’åºï¼Œå› æ­¤å‡å°‘äº†éšæœºIOï¼Œæ’åºè¿™æ‰æ˜¯ä¸¤è€…æœ€å¤§çš„åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœè¢«joinçš„è¡¨æ²¡ç”¨ç´¢å¼•å‘¢ï¼Ÿé‚£å°±ä½¿ç”¨BNLJäº†</li><li>ä»€ä¹ˆæ˜¯<code>Join Buffer</code>?<ul><li><code>Join Buffer</code>ä¼šç¼“å­˜æ‰€æœ‰å‚ä¸æŸ¥è¯¢çš„åˆ—è€Œä¸æ˜¯åªæœ‰Joinçš„åˆ—ã€‚</li><li>å¯ä»¥é€šè¿‡è°ƒæ•´<code>join_buffer_size</code>ç¼“å­˜å¤§å°</li><li><code>join_buffer_size</code>çš„é»˜è®¤å€¼æ˜¯256Kï¼Œ<code>join_buffer_size</code>çš„æœ€å¤§å€¼åœ¨<code>MySQL 5.1.22</code>ç‰ˆæœ¬å‰æ˜¯<code>4G</code>ï¼Œè€Œä¹‹åçš„ç‰ˆæœ¬æ‰èƒ½åœ¨64ä½æ“ä½œç³»ç»Ÿä¸‹ç”³è¯·å¤§äº<code>4G</code>çš„<code>Join Buffer</code>ç©ºé—´ã€‚</li><li>ä½¿ç”¨<code>Block Nested-Loop Join</code>ç®—æ³•éœ€è¦å¼€å¯ä¼˜åŒ–å™¨ç®¡ç†é…ç½®çš„<code>optimizer_switch</code>çš„è®¾ç½®<code>block_nested_loop</code>ä¸º<code>on</code>ï¼Œé»˜è®¤ä¸ºå¼€å¯ã€‚</li></ul></li><li>åœ¨é€‰æ‹©Joinç®—æ³•æ—¶ï¼Œä¼šæœ‰ä¼˜å…ˆçº§ï¼Œç†è®ºä¸Šä¼šä¼˜å…ˆåˆ¤æ–­èƒ½å¦ä½¿ç”¨INLJã€BNLJï¼š<br>Index Nested-LoopJoin &gt; Block Nested-Loop Join &gt; Simple Nested-Loop Join</li><li>æ³¨ï¼šå¯ä»¥ä½¿ç”¨explainæŸ¥æ‰¾é©±åŠ¨è¡¨ï¼Œç»“æœçš„ç¬¬ä¸€å¼ è¡¨å³ä¸ºé©±åŠ¨è¡¨ï¼Œä½†æ‰§è¡Œè®¡åˆ’åœ¨çœŸæ­£æ‰§è¡Œæ—¶å¯èƒ½å‘ç”Ÿæ”¹å˜</li></ul></li><li><p><strong>on</strong>ï¼šå…³è”æ¡ä»¶</p></li><li><p><strong>where</strong>ï¼šè¿‡æ»¤è¡¨ä¸­æ•°æ®çš„æ¡ä»¶</p><ul><li>æ‰§è¡Œé¡ºåºï¼šè‡ªä¸‹è€Œä¸Šã€ä»å³åˆ°å·¦</li><li>æ³¨ï¼šå¯¹æ•°æ®åº“è®°å½•ç”Ÿæ•ˆï¼Œæ— æ³•å¯¹èšåˆç»“æœç”Ÿæ•ˆï¼Œå¯ä»¥è¿‡æ»¤æ‰æœ€å¤§æ•°é‡è®°å½•çš„æ¡ä»¶å¿…é¡»å†™åœ¨whereå­å¥æœ«å°¾ï¼Œä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼ˆsumã€countã€maxã€avgï¼‰</li></ul></li><li><p><strong>group by</strong>ï¼šå¦‚ä½•å°†ä¸Šé¢è¿‡æ»¤å‡ºçš„æ•°æ®åˆ†ç»„</p><ul><li>æ‰§è¡Œé¡ºåºï¼šä»å·¦å¾€å³</li><li>æ³¨ï¼šå°½é‡åœ¨group byä¹‹å‰ä½¿ç”¨whereè¿‡æ»¤ï¼Œé¿å…ä¹‹åä½¿ç”¨havingè¿‡æ»¤</li></ul></li><li><p><strong>avg</strong>ï¼šæ±‚å¹³å‡å€¼</p></li><li><p><strong>having</strong>ï¼šå¯¹ä¸Šé¢å·²ç»åˆ†ç»„çš„æ•°æ®è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶</p><ul><li><p>æ³¨ï¼šå¯¹èšåˆç»“æœè¿‡æ»¤ï¼Œå› æ­¤å¾ˆè€—èµ„æºï¼Œå¯ä»¥ä½¿ç”¨èšåˆå‡½æ•°</p></li><li><p>ä¾‹ï¼šç­›é€‰ç»Ÿè®¡äººå£æ•°é‡å¤§äº100Wçš„åœ°åŒº</p><p>select region, sum(population), sum(area) from bbc group by region having sum(population)&gt;1000000ï¼Œä¸èƒ½ç”¨whereç­›é€‰è¶…è¿‡100Wçš„åœ°åŒºï¼Œå› ä¸ºä¸å­˜åœ¨è¿™æ ·çš„ä¸€æ¡è®°å½•</p></li></ul></li><li><p><strong>select</strong>ï¼šæŸ¥çœ‹ç»“æœé›†ä¸­çš„å“ªä¸ªåˆ—æˆ–åˆ—çš„è®¡ç®—ç»“æœ</p></li><li><p><strong>distinct</strong>ï¼šå¯¹ç»“æœé›†é‡å¤å€¼å»é‡</p></li><li><p><strong>order by</strong>ï¼šæŒ‰ç…§ä»€ä¹ˆæ ·çš„é¡ºåºæ¥æŸ¥çœ‹è¿”å›çš„æ•°æ®</p><ul><li>æ‰§è¡Œé¡ºåºï¼šä»å·¦åˆ°å³</li><li>æ³¨ï¼šå¾ˆè€—èµ„æº</li></ul></li><li><p><strong>limit</strong>ï¼šæˆªå–å‡ºç›®æ ‡é¡µæ•°æ®</p></li></ul><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://www.cnblogs.com/yyjie/p/7788428.html" target="_blank" rel="noopener">ã€Šå…³äºSQLå’ŒMySQLçš„è¯­å¥æ‰§è¡Œé¡ºåºã€‹</a><br><a href="https://www.cnblogs.com/loong-hon/p/13470263.html" target="_blank" rel="noopener">ã€ŠSQLè¯­å¥æ‰§è¡Œé¡ºåº ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Sql</category>
      </categories>
      <tags>
        <tag>Sql</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>Rediså¤šèŠ‚ç‚¹çš„Redlockç®—æ³•</title>
    <url>/post/b2f8602.html</url>
    <content><![CDATA[<blockquote><p>Rediså¤šèŠ‚ç‚¹çš„Redlockç®—æ³• ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Redlockå‡ºç°çš„èƒŒæ™¯"><a href="#ä¸€ã€Redlockå‡ºç°çš„èƒŒæ™¯" class="headerlink" title="ä¸€ã€Redlockå‡ºç°çš„èƒŒæ™¯"></a>ä¸€ã€Redlockå‡ºç°çš„èƒŒæ™¯</h3><p>åœ¨å•Matster-Slaveçš„Redisç³»ç»Ÿä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹Clientå‘Masterè·å–é”ä¹‹ååŒæ­¥ç»™Slaveï¼Œå¦‚æœ<strong>Clientè·å–é”æˆåŠŸä¹‹åMasterèŠ‚ç‚¹æŒ‚æ‰</strong>ï¼Œå¹¶ä¸”<strong>æœªå°†è¯¥é”åŒæ­¥åˆ°Slave</strong>ï¼Œä¹‹ååœ¨Sentinelçš„å¸®åŠ©ä¸‹Slaveå‡çº§ä¸ºMasterä½†æ˜¯å¹¶æ²¡æœ‰ä¹‹å‰æœªåŒæ­¥çš„é”çš„ä¿¡æ¯ï¼Œæ­¤æ—¶å¦‚æœæœ‰æ–°çš„Clientè¦åœ¨æ–°Masterè·å–é”ï¼Œé‚£ä¹ˆå°†<strong>å¯èƒ½å‡ºç°ä¸¤ä¸ªClientæŒæœ‰åŒä¸€æŠŠé”çš„é—®é¢˜</strong>ã€‚å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šæ¶‰åŠåˆ°Redlockç®—æ³•ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210421231529.jpg" alt=""></p><h3 id="äºŒã€Redlockç®—æ³•è¿‡ç¨‹"><a href="#äºŒã€Redlockç®—æ³•è¿‡ç¨‹" class="headerlink" title="äºŒã€Redlockç®—æ³•è¿‡ç¨‹"></a>äºŒã€Redlockç®—æ³•è¿‡ç¨‹</h3><p>åœ¨Redisçš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰<strong>Nä¸ªå®Œå…¨äº’ç›¸ç‹¬ç«‹çš„RedisèŠ‚ç‚¹</strong>ï¼Œåœ¨Nä¸ªRediså®ä¾‹ä¸Šä½¿ç”¨ä¸åœ¨Rediså•å®ä¾‹ä¸‹ç›¸åŒæ–¹æ³•è·å–é”å’Œé‡Šæ”¾é”ã€‚</p><p>ç°åœ¨å‡è®¾æœ‰5ä¸ªRedisä¸»èŠ‚ç‚¹(<strong>å¤§äº3çš„å¥‡æ•°ä¸ª</strong>)ï¼Œè¿™æ ·åŸºæœ¬ä¿è¯ä»–ä»¬ä¸ä¼šåŒæ—¶éƒ½å®•æ‰ï¼Œè·å–é”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><ol><li><p>è·å–å½“å‰Unixæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½</p></li><li><p>ä¾æ¬¡å°è¯•ä»5ä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„keyå’Œå…·æœ‰å”¯ä¸€æ€§çš„valueè·å–é”å½“å‘Redisè¯·æ±‚è·å–é”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”è¯¥å°äºé”çš„å¤±æ•ˆæ—¶é—´ï¼Œè¿™æ ·å¯ä»¥é¿å…å®¢æˆ·ç«¯æ­»ç­‰</p></li><li><p>å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚å½“ä¸”ä»…å½“ä»åŠæ•°ä»¥ä¸Šçš„RedisèŠ‚ç‚¹å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸ</p></li><li><p>å¦‚æœå–åˆ°äº†é”ï¼Œkeyçš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ <strong>è¿™ä¸ªå¾ˆé‡è¦</strong></p></li><li><p>å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨åŠæ•°ä»¥ä¸Šå®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨æ‰€æœ‰çš„Rediså®ä¾‹ä¸Šè¿›è¡Œè§£é”ï¼Œæ— è®ºRediså®ä¾‹æ˜¯å¦åŠ é”æˆåŠŸï¼Œå› ä¸ºå¯èƒ½æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ä¸¢å¤±äº†ä½†æ˜¯å®é™…æˆåŠŸäº†ï¼Œæ¯•ç«Ÿå¤šé‡Šæ”¾ä¸€æ¬¡ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</p></li></ol><p>ä¸Šè¿°çš„5ä¸ªæ­¥éª¤æ˜¯Redlockç®—æ³•çš„é‡è¦è¿‡ç¨‹ï¼</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçº¿ç¨‹æ± åŸç†</title>
    <url>/post/52aa52dd.html</url>
    <content><![CDATA[<blockquote><p>Javaçº¿ç¨‹æ± è¯¦è§£ä¸åŸç†ä»‹ç»ï¼Œè®°å½• ~ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿"><a href="#ä¸€ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿" class="headerlink" title="ä¸€ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿"></a>ä¸€ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿</h3><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¯èƒ½ä¼šç›´æ¥åˆ›å»ºä¸€ä¸ª</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><p>åœ¨ä¸šåŠ¡é‡è¾ƒå°‘çš„æƒ…å†µï¼Œè¿™æ ·ä¹Ÿæ²¡ä»€ä¹ˆå¤ªå¤§é—®é¢˜ã€‚</p><p><strong>å¦‚æœä»»åŠ¡é¢‘ç¹çš„è¯</strong></p><ol><li><p>é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ˜¯ååˆ†æ¶ˆè€—æ€§èƒ½çš„ï¼Œç”šè‡³å¯èƒ½åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ‰€ç”¨æ—¶é—´å¤§äºä»»åŠ¡æœ¬èº«æ‰§è¡Œæ‰€ç”¨æ—¶é—´ã€‚</p></li><li><p>å¦‚æœä¸šåŠ¡é‡éå¸¸å¤§ï¼Œå¯èƒ½ä¼šå ç”¨è¿‡å¤šçš„èµ„æºï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ç”±äºèµ„æºä¸è¶³è€Œå®•æœºã€‚</p><p><u>è¿™é‡Œå°±å¯ä»¥å¼•å…¥çº¿ç¨‹æ± ã€‚ çº¿ç¨‹æ± ï¼Œå°±æ˜¯ç»´æŠ¤äº†è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œå½“éœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œç›´æ¥è°ƒç”¨å…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œå³å¯ã€‚</u></p></li></ol><h4 id="çº¿ç¨‹æ± çš„ä¼˜ç‚¹"><a href="#çº¿ç¨‹æ± çš„ä¼˜ç‚¹" class="headerlink" title="çº¿ç¨‹æ± çš„ä¼˜ç‚¹"></a><strong>çº¿ç¨‹æ± çš„ä¼˜ç‚¹</strong></h4><ol><li>é™ä½æ€§èƒ½æ¶ˆè€—ï¼šé‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼ŒèŠ‚çœäº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li><li>æç¤ºä»»åŠ¡æ•ˆç‡ï¼šä»»åŠ¡æ¥äº†åˆ†é…ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç«‹å³å¹²æ´»ï¼Œè€Œä¸ç”¨ç­‰å¾…çº¿ç¨‹é‡æ–°åˆ›å»ºã€‚</li><li>æ›´å¥½çš„ç®¡æ§ï¼šçº¿ç¨‹æ± å¯ä»¥æ§åˆ¶çº¿ç¨‹æ•°ï¼Œé¿å…è¿‡å¤šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œäº¦æ›´æ–¹ä¾¿è°ƒä¼˜å’Œç›‘æ§ã€‚</li></ol><h3 id="äºŒã€çº¿ç¨‹æ± å‚æ•°è§£é‡Š"><a href="#äºŒã€çº¿ç¨‹æ± å‚æ•°è§£é‡Š" class="headerlink" title="äºŒã€çº¿ç¨‹æ± å‚æ•°è§£é‡Š"></a>äºŒã€çº¿ç¨‹æ± å‚æ•°è§£é‡Š</h3><p>å…ˆçœ‹çœ‹çº¿ç¨‹æ± æ ¸å¿ƒæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,  // ç»´æŠ¤çº¿ç¨‹çš„æœ€å°æ ¸å¿ƒçº¿ç¨‹æ•°é‡.</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize, // ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§çº¿ç¨‹æ•°é‡.</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime, // éæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´.</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit, // éæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´çš„æ—¶é—´å•ä½.</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue, // ä»»åŠ¡é˜Ÿåˆ—.</span></span></span><br><span class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory, // çº¿ç¨‹å·¥å‚ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹.</span></span></span><br><span class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler // æ‹’ç»ç­–ç•¥.</span></span></span><br><span class="line"><span class="function"><span class="params">                             )</span> </span>&#123;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ä»‹ç»ä¸‹å‚æ•°</p><ol><li><strong>corePoolSize</strong>ï¼ˆç»´æŠ¤çº¿ç¨‹çš„æœ€å°æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼‰ï¼šå½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè‹¥çº¿ç¨‹æ± å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºcorePoolSizeï¼Œå³ä¾¿æ­¤æ—¶å­˜åœ¨ç©ºé—²çº¿ç¨‹ï¼Œä¹Ÿä¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºcorePoolSizeæ—¶ï¼Œï¼ˆé™¤äº†åˆ©ç”¨æäº¤æ–°ä»»åŠ¡æ¥åˆ›å»ºå’Œå¯åŠ¨çº¿ç¨‹ï¼ˆæŒ‰éœ€æ„é€ ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ prestartCoreThread() æˆ– prestartAllCoreThreads() æ–¹æ³•æ¥æå‰å¯åŠ¨çº¿ç¨‹æ± ä¸­çš„åŸºæœ¬çº¿ç¨‹ã€‚ï¼‰</li><li><strong>maximumPoolSize</strong>ï¼ˆçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼‰ï¼šçº¿ç¨‹æ± æ‰€å…è®¸çš„æœ€å¤§çº¿ç¨‹ä¸ªæ•°ã€‚å½“é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼Œåˆ™çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦å¤–ï¼Œå¯¹äºæ— ç•Œé˜Ÿåˆ—ï¼Œå¯å¿½ç•¥è¯¥å‚æ•°ã€‚</li><li><strong>keepAliveTime</strong>ï¼ˆéæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²æ—¶é—´ï¼‰å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹ä¼šæ ¹æ®keepAliveTimeçš„å€¼è¿›è¡Œæ´»æ€§æ£€æŸ¥ï¼Œçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¦‚æœè¶…è¿‡çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li><li><strong>unit</strong> çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½</li><li><strong>workQueue</strong> ä»»åŠ¡é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨çš„é˜»å¡é˜Ÿåˆ—ï¼‰ï¼šç”¨äºä¼ è¾“å’Œä¿å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚<ol><li>çº¿ç¨‹æ± é‡Œçš„ <code>BlockingQueue</code>ï¼Œ<strong>é˜»å¡é˜Ÿåˆ—</strong>ï¼Œäº‹å®ä¸Šåœ¨æ¶ˆè´¹è€…ç”Ÿäº§è€…é—®é¢˜é‡Œçš„ç®¡ç¨‹æ³•å®ç°ï¼Œæˆ‘ä»¬çš„ç­–ç•¥ä¹Ÿæ˜¯ç±»ä¼¼é˜»å¡é˜Ÿåˆ—çš„ï¼Œç”¨å®ƒæ¥åšä¸€ä¸ªç¼“å­˜æ± çš„ä½œç”¨ã€‚</li><li><strong>é˜»å¡é˜Ÿåˆ—</strong>ï¼šä»»æ„æ—¶åˆ»ï¼Œä¸ç®¡å¹¶å‘æœ‰å¤šé«˜ï¼Œæ°¸è¿œä¿è¯<strong>åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›è¡Œé˜Ÿåˆ—çš„å…¥é˜Ÿæˆ–å‡ºé˜Ÿæ“ä½œ</strong>ã€‚ä¹Ÿå°±æ„å‘³ç€ä»–æ˜¯èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>é˜»å¡é˜Ÿåˆ—åˆ†ä¸ºæœ‰ç•Œå’Œæ— ç•Œé˜Ÿåˆ—ï¼Œç†è®ºä¸Šæ¥è¯´ä¸€ä¸ªæ˜¯é˜Ÿåˆ—çš„sizeæœ‰å›ºå®šï¼Œå¦ä¸€ä¸ªæ˜¯æ— ç•Œçš„ã€‚å¯¹äºæœ‰ç•Œé˜Ÿåˆ—æ¥è¯´ï¼Œå¦‚æœé˜Ÿåˆ—å­˜æ»¡ï¼Œåªèƒ½å‡ºé˜Ÿäº†ï¼Œå…¥é˜Ÿæ“ä½œå°±åªèƒ½é˜»å¡ã€‚</li><li>åœ¨ <code>java</code>å¹¶å‘åŒ…é‡Œï¼Œé˜»å¡é˜Ÿåˆ—çš„å®ç°æœ‰å¾ˆå¤šï¼š<ol><li><strong><code>ArrayBlockingQueue</code></strong>ï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li><li><strong><code>LinkedBlockingQueue</code></strong>ï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆå¤§å°é»˜è®¤å€¼ä¸º<code>Integer.MAX_VALUE</code>ï¼‰ï¼›</li><li><code>PriorityBlockingQueue</code>ï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li><li><code>DelayQueue</code>ï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li><li><code>SynchronousQueue</code>ï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œç›¸å½“äºåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼›</li><li><code>LinkedTransferQueue</code>ï¼šé“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li><li><code>LinkedBlockingDeque</code>ï¼šé“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li></ol></li></ol></li><li><strong>threadFactory</strong>ï¼ˆçº¿ç¨‹å·¥å‚ï¼‰ ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ã€‚threadFactoryåˆ›å»ºçš„çº¿ç¨‹ä¹Ÿæ˜¯é‡‡ç”¨new Thread()æ–¹å¼ï¼ŒthreadFactoryåˆ›å»ºçš„çº¿ç¨‹åéƒ½å…·æœ‰ç»Ÿä¸€çš„é£æ ¼ï¼špool-m-thread-nï¼ˆmä¸ºçº¿ç¨‹æ± çš„ç¼–å·ï¼Œnä¸ºçº¿ç¨‹æ± å†…çš„çº¿ç¨‹ç¼–å·ï¼‰ã€‚</li><li><strong>RejectedExecutionHandler handler</strong>ï¼ˆçº¿ç¨‹æ‹’ç»ç­–ç•¥ï¼‰ï¼šå½“çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡äº†ï¼Œå†åŠ å…¥çº¿ç¨‹ä¼šæ‰§è¡Œæ­¤ç­–ç•¥ã€‚<br>A. <code>ThreadPoolExecutor.AbortPolicy</code>ï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡º<code>RejectedExecutionException</code>å¼‚å¸¸<strong>ï¼ˆé»˜è®¤ï¼‰</strong>ã€‚<br>B. <code>ThreadPoolExecutor.DiscardPolicy</code>ï¼šä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚<br>C. <code>ThreadPoolExecutor.DiscardOldestPolicy</code>ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°æäº¤è¢«æ‹’ç»çš„ä»»åŠ¡<br>D. <code>ThreadPoolExecutor.CallerRunsPolicy</code>ï¼šç”±è°ƒç”¨çº¿ç¨‹ï¼ˆæäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼‰å¤„ç†è¯¥ä»»åŠ¡</li></ol><h3 id="ä¸‰ã€çº¿ç¨‹æ± æ‰§è¡ŒåŸç†"><a href="#ä¸‰ã€çº¿ç¨‹æ± æ‰§è¡ŒåŸç†" class="headerlink" title="ä¸‰ã€çº¿ç¨‹æ± æ‰§è¡ŒåŸç†"></a>ä¸‰ã€çº¿ç¨‹æ± æ‰§è¡ŒåŸç†</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210420095431.png" alt=""></p><p>å½“ä¸€ä¸ªä»»åŠ¡é€šè¿‡execute(Runnable)æ–¹æ³•æ·»åŠ åˆ°çº¿ç¨‹æ± æ—¶ï¼š</p><ol><li><p>å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡å°äº<code>corePoolSize</code>ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿè¦åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚</p></li><li><p>å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡ç­‰äº <code>corePoolSize</code>ï¼Œä½†æ˜¯ç¼“å†²é˜Ÿåˆ— <code>workQueue</code>æœªæ»¡ï¼Œé‚£ä¹ˆä»»åŠ¡è¢«æ”¾å…¥ç¼“å†²é˜Ÿåˆ—ã€‚</p></li><li><p>å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡å¤§äº<code>corePoolSize</code>ï¼Œç¼“å†²é˜Ÿåˆ— <code>workQueue</code>æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„æ•°é‡å°äº<code>maximumPoolSize</code>ï¼Œå»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚</p></li><li><p>å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„æ•°é‡å¤§äº<code>corePoolSize</code>ï¼Œç¼“å†²é˜Ÿåˆ— <code>workQueue</code>æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„æ•°é‡ç­‰äº<code>maximumPoolSize</code>ï¼Œé‚£ä¹ˆé€šè¿‡ handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†æ­¤ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯ï¼šå¤„ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¸ºï¼šæ ¸å¿ƒçº¿ç¨‹<code>corePoolSize</code>ã€ä»»åŠ¡é˜Ÿåˆ—<code>workQueue</code>ã€æœ€å¤§çº¿ç¨‹<code>maximumPoolSize</code>ï¼Œå¦‚æœä¸‰è€…éƒ½æ»¡äº†ï¼Œä½¿ç”¨<code>handler</code>æ‹’ç»ç­–ç•¥å¤„ç†è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚</p></li></ol><p>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº <code>corePoolSize</code>æ—¶ï¼Œå¦‚æœæŸçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡<code>keepAliveTime</code>ï¼Œçº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚è¿™æ ·ï¼Œçº¿ç¨‹æ± å¯ä»¥åŠ¨æ€çš„è°ƒæ•´æ± ä¸­çš„çº¿ç¨‹æ•°ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210823111652.png" alt=""></p><h3 id="å››ã€çº¿ç¨‹æ± å¤§å°é…ç½®"><a href="#å››ã€çº¿ç¨‹æ± å¤§å°é…ç½®" class="headerlink" title="å››ã€çº¿ç¨‹æ± å¤§å°é…ç½®"></a>å››ã€çº¿ç¨‹æ± å¤§å°é…ç½®</h3><h4 id="1ã€é—®é¢˜å½±å“"><a href="#1ã€é—®é¢˜å½±å“" class="headerlink" title="1ã€é—®é¢˜å½±å“"></a>1ã€é—®é¢˜å½±å“</h4><ul><li>å¦‚æœè®¾ç½®çš„çº¿ç¨‹æ± æ•°é‡å¤ªå°ï¼ŒåŒä¸€æ—¶é—´æœ‰å¤§é‡ä»»åŠ¡/è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚/ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç”šè‡³ä¼šå‡ºç°ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åä»»åŠ¡/è¯·æ±‚æ— æ³•å¤„ç†çš„æƒ…å†µï¼ŒCPUæ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚</li><li>å¦‚æœè®¾ç½®çº¿ç¨‹æ•°é‡å¤ªå¤§ï¼Œå¤§é‡çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶åœ¨äº‰å– CPU èµ„æºï¼Œä¼šå¯¼è‡´å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¢åŠ çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“äº†æ•´ä½“æ‰§è¡Œæ•ˆç‡ã€‚</li></ul><h4 id="2ã€æœ€ä½³å®è·µ"><a href="#2ã€æœ€ä½³å®è·µ" class="headerlink" title="2ã€æœ€ä½³å®è·µ"></a>2ã€æœ€ä½³å®è·µ</h4><p>é€‚ç”¨é¢è¾ƒå¹¿çš„å…¬å¼ï¼š</p><ul><li><strong>CPU å¯†é›†å‹ä»»åŠ¡(N+1)</strong>ï¼š ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</li><li><strong>I/O å¯†é›†å‹ä»»åŠ¡(2N)</strong>ï¼š ä»»åŠ¡åº”ç”¨ä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚</li></ul><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisçš„æŒä¹…åŒ–</title>
    <url>/post/195f683a.html</url>
    <content><![CDATA[<blockquote><p>Redisçš„æŒä¹…åŒ–ï¼ŒRDBå’ŒAOF ~</p></blockquote><a id="more"></a><p>ç”±äºRedisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå³æ–­ç”µæˆ–è€…é‡å¯æ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å»é…ç½®redisçš„æŒä¹…åŒ–ã€‚redis æŒä¹…åŒ–åˆ†ä¸º rdb å’Œ aofï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼ã€‚</p><h3 id="ä¸€ã€RDB-ï¼ˆRedis-DataBaseï¼‰"><a href="#ä¸€ã€RDB-ï¼ˆRedis-DataBaseï¼‰" class="headerlink" title="ä¸€ã€RDB  ï¼ˆRedis DataBaseï¼‰"></a>ä¸€ã€RDB ï¼ˆRedis DataBaseï¼‰</h3><h4 id="1ã€åŸºæœ¬æ€æƒ³"><a href="#1ã€åŸºæœ¬æ€æƒ³" class="headerlink" title="1ã€åŸºæœ¬æ€æƒ³"></a>1ã€åŸºæœ¬æ€æƒ³</h4><p>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¿«ç…§ï¼Œè¿›è¡Œæ¢å¤æ—¶ï¼Œç›´æ¥å°†å¿«ç…§æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç§°ä¸ºå¿«ç…§ï¼ˆsnapshotï¼‰ã€‚</p><p>redis ä¼šå•ç‹¬ fork ä¸€ä¸ªå­è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–ï¼Œå­è¿›ç¨‹éå†hash tableï¼Œåˆ©ç”¨copy on writeï¼ˆå†™æ—¶å¤åˆ¶çš„æ€æƒ³ï¼‰ï¼ŒæŠŠæ•°æ®ä¿å­˜ä¸‹æ¥ï¼Œå†™åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†å†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä»£æ›¿ä¸Šæ¬¡çš„ä¸´æ—¶æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• I/O æ“ä½œçš„ã€‚è¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹æ•°æ®çš„å¼ºä¸€è‡´æ€§å¾ˆæ•æ„Ÿçš„è¯ï¼Œrdb æ–¹å¼å¯èƒ½æ¯” aofæœºåˆ¶æ›´åŠ é«˜æ•ˆï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œè€Œä¸”å†™æ“ä½œæ¯”è¾ƒå¤šï¼Œå¿…ç„¶ä¼šå¼•èµ·å¤§é‡çš„ç£ç›˜ioæ“ä½œï¼Œå¯èƒ½ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</p><h4 id="2ã€è§¦å‘æœºåˆ¶"><a href="#2ã€è§¦å‘æœºåˆ¶" class="headerlink" title="2ã€è§¦å‘æœºåˆ¶"></a>2ã€è§¦å‘æœºåˆ¶</h4><ol><li><p>save å‘½ä»¤</p><p>å½“å®¢æˆ·ç«¯å‘Redis serverå‘é€saveå‘½ä»¤è¯·æ±‚è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼Œç”±äºRedisæ˜¯ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰,saveå‘½ä»¤ä¼šé˜»å¡Redis serverå¤„ç†å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç›´åˆ°æ•°æ®åŒæ­¥å®Œæˆã€‚</p></li><li><p>bgsaveå‘½ä»¤</p><p>ä¸saveå‘½ä»¤ä¸åŒï¼Œbgsaveæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå½“æ‰§è¡Œbgsaveå‘½ä»¤ä¹‹åï¼ŒRedisä¸»è¿›ç¨‹ä¼šfork ä¸€ä¸ªå­è¿›ç¨‹å°†æ•°æ®ä¿å­˜åˆ°rdbæ–‡ä»¶ä¸­ï¼ŒåŒæ­¥å®Œæ•°æ®ä¹‹åï¼Œå¯¹åŸæœ‰æ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œç„¶åé€šçŸ¥ä¸»è¿›ç¨‹è¡¨ç¤ºåŒæ­¥å®Œæˆã€‚</p></li><li><p>è‡ªåŠ¨è§¦å‘</p><p>é™¤äº†æ‰‹åŠ¨è§¦å‘RDBæŒä¹…åŒ–ï¼ŒRediså†…éƒ¨è¿˜å­˜åœ¨è‡ªåŠ¨è§¦å‘æœºåˆ¶ï¼Œ</p></li></ol><h4 id="3ã€RDBä¼˜ç¼ºç‚¹"><a href="#3ã€RDBä¼˜ç¼ºç‚¹" class="headerlink" title="3ã€RDBä¼˜ç¼ºç‚¹"></a>3ã€RDBä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p><ol><li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼åœ¨æ¢å¤æ•°æ®çš„æ—¶å€™æ¯” aof å¿«ã€‚</li><li>ç”±äºä¸»è¿›ç¨‹ä¸è¿›è¡Œ I/O æ“ä½œï¼Œä¿®æ”¹æ“ä½œæ¯” aof å¿«ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›è¡Œæ“ä½œã€‚å¦‚æœredisæ„å¤–å®•æœºäº†ï¼Œé‚£ä¹ˆå¯èƒ½æœ€åä¸€æ¬¡çš„å¤‡ä»½æ•°æ®å°±æ²¡æœ‰äº†ã€‚</li><li>æ¯æ¬¡ä¿å­˜ RDB çš„æ—¶å€™ï¼ŒRedis éƒ½è¦ fork() å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ç”±å­è¿›ç¨‹æ¥è¿›è¡Œå®é™…çš„æŒä¹…åŒ–å·¥ä½œã€‚ åœ¨æ•°æ®é›†æ¯”è¾ƒåºå¤§æ—¶ï¼Œ fork() å¯èƒ½ä¼šéå¸¸è€—æ—¶ï¼Œé€ æˆæœåŠ¡å™¨åœ¨æŸæŸæ¯«ç§’å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯</li></ol><h3 id="äºŒã€AOFï¼ˆAppend-Only-Fileï¼‰"><a href="#äºŒã€AOFï¼ˆAppend-Only-Fileï¼‰" class="headerlink" title="äºŒã€AOFï¼ˆAppend Only Fileï¼‰"></a>äºŒã€AOFï¼ˆAppend Only Fileï¼‰</h3><h4 id="1ã€åŸºæœ¬æ€æƒ³-1"><a href="#1ã€åŸºæœ¬æ€æƒ³-1" class="headerlink" title="1ã€åŸºæœ¬æ€æƒ³"></a>1ã€åŸºæœ¬æ€æƒ³</h4><p>ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°† Redisæ‰§è¡Œè¿‡çš„æŒ‡ä»¤å…¨éƒ¨è®°å½•ä¸‹æ¥ï¼ˆè¯»æ“ä½œä¸è®°å½•ï¼‰ï¼Œåªè¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ä¸­ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså†æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå°†æ—¥å¿—æ–‡ä»¶ä¸­æ‰€æœ‰çš„æŒ‡ä»¤ ä»åˆ°åˆ°å°¾çš„å†æ¬¡æ‰§è¡Œä¸€éã€‚è¿™ä¸ªæ—¶å€™ä¹Ÿæ˜¯ forkå­è¿›ç¨‹å»åšã€‚</p><p>aofæ¨¡å¼ä¿å­˜çš„æ–‡ä»¶æ˜¯appendonly.aof æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ ä½¿ç”¨ vim è§‚çœ‹é‡Œè¾¹çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å†…å®¹ï¼Œå¯è¯»æ€§éå¸¸çš„å¥½ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒflushdbï¼Œåªè¦æ–°çš„ aof æ²¡æœ‰è¢«ä¿å­˜ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ ç§»é™¤aofæ–‡ä»¶æœ«å°¾çš„ flushdb å°±å¯ä»¥æ’¤é”€è¿™ä¸ªæ“ä½œã€‚</p><p>å¦‚æœ append.aof æ–‡ä»¶å†…å®¹æ ¼å¼é”™è¯¯ï¼Œé‚£ä¹ˆæ­¤æ—¶æ˜¯æ‰“ä¸å¼€ redisçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ redis-aof-checkæ¥æ¢å¤ã€‚</p><h4 id="2ã€è§¦å‘æœºåˆ¶-1"><a href="#2ã€è§¦å‘æœºåˆ¶-1" class="headerlink" title="2ã€è§¦å‘æœºåˆ¶"></a>2ã€è§¦å‘æœºåˆ¶</h4><ol><li><p>æ‰‹åŠ¨è§¦å‘ æ‰§è¡Œbgrewriteaofå‘½ä»¤ã€‚</p></li><li><p>æ ¹æ®é…ç½®è‡ªåŠ¨è§¦å‘</p></li></ol><h4 id="3ã€AOFä¼˜ç¼ºç‚¹"><a href="#3ã€AOFä¼˜ç¼ºç‚¹" class="headerlink" title="3ã€AOFä¼˜ç¼ºç‚¹"></a>3ã€AOFä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>é»˜è®¤å¼€å¯ æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå°±ç®—ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆä¹Ÿåªä¼šä¸¢å¤±æœ€åä¸€ç§’çš„æ•°æ®</li><li>æ¯æ¬¡é‡å¯éƒ½ä¼šå» åŠ è½½å’Œæ‰§è¡Œ aofæ–‡ä»¶ï¼Œæ‰€ä»¥è¯´å®ƒçš„æ•°æ®å®Œæ•´æ€§è¦æ¯” rdbå¥½ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç›¸å¯¹äº rdbçš„ä¿å­˜æ–¹å¼ï¼Œaofçš„æ–‡ä»¶å¤§å°è¿œè¿œå¤§äº rdbæ–‡ä»¶ï¼ˆaof æ–‡ä»¶é»˜è®¤é‡‡å–æ— é™å¢åŠ ï¼Œä¸è¿‡ä¹Ÿä¸ç”¨æ‹…å¿ƒè¿‡å¤§ï¼Œå¦‚æœå¤ªå¤§äº†redisä¹Ÿä¼šè¿›è¡Œé‡å†™çš„ï¼Œä¸è¦æ€•ï¼Œrediséƒ½æƒ³åˆ°äº†ï¼ï¼‰ï¼Œä¿®å¤é€Ÿåº¦ä¹Ÿæ…¢</li><li>aof çš„æ•ˆç‡æ¯” rdbé«˜ï¼Œæ¯•ç«Ÿæ˜¯ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¶‰åŠ I/O äº†ã€‚</li></ul><h3 id="ä¸‰ã€RDB-VS-AOF-å¯¹æ¯”"><a href="#ä¸‰ã€RDB-VS-AOF-å¯¹æ¯”" class="headerlink" title="ä¸‰ã€RDB  VS  AOF å¯¹æ¯”"></a>ä¸‰ã€RDB VS AOF å¯¹æ¯”</h3><p>é€šå¸¸ï¼Œå¦‚æœä½ è¦æƒ³æä¾›å¾ˆé«˜çš„æ•°æ®ä¿éšœæ€§ï¼Œé‚£ä¹ˆå»ºè®®ä½ <strong>åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–æ–¹å¼</strong>ã€‚å¦‚æœä½ å¯ä»¥æ¥å—ç¾éš¾å¸¦æ¥çš„å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä»…ä½¿ç”¨RDBã€‚å¾ˆå¤šç”¨æˆ·ä»…ä½¿ç”¨äº†AOFï¼Œä½†æ˜¯æˆ‘ä»¬å»ºè®®ï¼Œæ—¢ç„¶RDBå¯ä»¥æ—¶ä¸æ—¶çš„ç»™æ•°æ®åšä¸ªå®Œæ•´çš„å¿«ç…§ï¼Œå¹¶ä¸”æä¾›æ›´å¿«çš„é‡å¯ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯ä¹Ÿä½¿ç”¨RDBã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Vuexä½¿ç”¨</title>
    <url>/post/a47b42bc.html</url>
    <content><![CDATA[<blockquote><p>vuexå¦‚ä½•ä½¿ç”¨ ~</p></blockquote><a id="more"></a><h4 id="ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨Vuex"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨Vuex" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨Vuex"></a>ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨Vuex</h4><p>å®˜æ–¹è§£é‡Šï¼šVuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚</p><h5 id="å•å‘æ•°æ®æµ"><a href="#å•å‘æ•°æ®æµ" class="headerlink" title="å•å‘æ•°æ®æµ"></a>å•å‘æ•°æ®æµ</h5><p>å•å‘æ•°æ®æµåªèƒ½ä»ä¸€ä¸ªæ–¹å‘æ¥ä¿®æ”¹çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯å•å‘æ•°æ®æµçš„æç®€ç¤ºæ„ï¼š</p><ul><li>State é©±åŠ¨åº”ç”¨çš„æ•°æ®æº</li><li>View ä»¥å£°æ˜çš„æ–¹å¼å°†stateæ˜ å°„åˆ°è¯•å›¾</li><li>Action å“åº”åœ¨viewä¸Šçš„ç”¨æˆ·è¾“å…¥å¯¼è‡´çš„çŠ¶æ€å˜åŒ–</li></ul><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210419220445.png" style="zoom:33%"><p>ä¸¾ä¸ªæ —å­ï¼šå¦‚ä¸€ä¸ªçˆ¶ç»„ä»¶æœ‰ä¸¤ä¸ªå­ç»„ä»¶ï¼Œåˆ†åˆ«ä¸º1å’Œ2ã€‚çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œä¸¤ä¸ªç»„ä»¶éƒ½æ¥æ”¶åˆ°äº†çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œåœ¨ç»„ä»¶1ä¸­ä¿®æ”¹çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œå­ç»„ä»¶2å’Œçˆ¶ç»„ä»¶çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™å°±æ˜¯å•å‘çš„æ•°æ®æµï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥æ”¹å˜çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚ä½†æ˜¯å¦‚æœçˆ¶ç»„ä»¶æ”¹å˜ç›¸åº”çš„æ•°æ®ï¼Œä¸¤ä¸ªå­ç»„ä»¶çš„æ•°æ®ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ã€‚</p><h5 id="åŒå‘æ•°æ®æµ"><a href="#åŒå‘æ•°æ®æµ" class="headerlink" title="åŒå‘æ•°æ®æµ"></a>åŒå‘æ•°æ®æµ</h5><p>ç”±MVVMæ¡†æ¶å®ç°ï¼ŒMVVMçš„ç»„æˆï¼šViewï¼ŒViewModelï¼ŒModelã€‚å…¶ä¸­View å’Œ Modelä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œè¦é€šè¿‡ViewModelæ¥è¿›è¡Œé€šä¿¡ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼šä¾‹å¦‚ï¼Œå½“Modeléƒ¨åˆ†æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç”±äºvueä¸­Data Bindingå°†åº•å±‚æ•°æ®å’ŒDomå±‚è¿›è¡Œäº†ç»‘å®šï¼ŒViewModelé€šçŸ¥Viewå±‚æ›´æ–°è§†å›¾ï¼›å½“åœ¨è§†å›¾ Viewæ•°æ®å‘ç”Ÿå˜åŒ–ä¹Ÿä¼šåŒæ­¥åˆ°Modelä¸­ã€‚Viewå’ŒModelä¹‹é—´çš„åŒæ­¥å®Œå…¨æ˜¯è‡ªåŠ¨çš„ï¼Œä¸éœ€è¦äººæ‰‹åŠ¨çš„æ“ä½œDOM</p><h5 id="Vuexçš„ä½¿ç”¨åœºæ™¯"><a href="#Vuexçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Vuexçš„ä½¿ç”¨åœºæ™¯"></a>Vuexçš„ä½¿ç”¨åœºæ™¯</h5><ul><li>è´­ç‰©è½¦</li><li>æ•°æ®å­—å…¸</li><li>ç™»å½•æ³¨å†Œ</li></ul><h4 id="äºŒã€Vuexåˆå§‹åŒ–æ­¥éª¤"><a href="#äºŒã€Vuexåˆå§‹åŒ–æ­¥éª¤" class="headerlink" title="äºŒã€Vuexåˆå§‹åŒ–æ­¥éª¤"></a>äºŒã€Vuexåˆå§‹åŒ–æ­¥éª¤</h4><p>ç¬¬ä¸€æ­¥ï¼šå®‰è£…Vuex</p><p><code>npm install vuex --save</code></p><p>ç¬¬äºŒæ­¥ï¼šåœ¨main.jsä¸­åŠ å…¥Vuex</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.vue"</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">"./router"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">"vuex"</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line">Vue.prototype.$store = store</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;  <span class="comment">// ç™»å½•åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (store.state.userInfo || to.path === <span class="string">"/login"</span>) &#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next(&#123;</span><br><span class="line">            path: <span class="string">"/login"</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    store,</span><br><span class="line">    router,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(<span class="string">"#app"</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šåœ¨srcç›®å½•ä¸­æ–°å»ºstoreæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºstore.jsæ–‡ä»¶ã€‚index.jsä¸­ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">"vuex"</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">"./state"</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">"./mutations"</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">"./getters"</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">"./actions"</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="comment">// storeæ˜¯ä¸€ä¸ªä»“åº“, é‡Œé¢å­˜å‚¨ç€æˆ‘ä»¬è¦è¿›è¡Œç®¡ç†çš„å˜é‡,å’Œå¯¹äºå˜é‡æ‰€æœ‰çš„ç›¸å…³æ“ä½œ.</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state,</span><br><span class="line">    getters,</span><br><span class="line">    actions,</span><br><span class="line">    mutations</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><h4 id="ä¸‰ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”State"><a href="#ä¸‰ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”State" class="headerlink" title="ä¸‰ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”State"></a>ä¸‰ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”State</h4><p>Stateï¼šæ„æ€ä¸ºâ€œçŠ¶æ€â€ï¼Œæ˜¯VuexçŠ¶æ€ç®¡ç†çš„æ•°æ®æº</p><p>stateå­˜æ”¾æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜æ”¾äº†å…¨éƒ¨çš„åº”ç”¨å±‚çº§çš„çŠ¶æ€ï¼Œä¸»è¦æ˜¯å­˜æ”¾ç»„ä»¶ä¹‹é—´ä¼ é€’çš„å˜é‡ï¼Œç±»ä¼¼äºç»„ä»¶ä¸­çš„data</p><p>ç¬¬å››æ­¥ï¼šåœ¨storeæ–‡ä»¶å¤¹ä¸­æ–°å»ºstate.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    userInfo: <span class="string">""</span>, <span class="comment">// ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    userStatus: <span class="string">""</span>, <span class="comment">// 0 -&gt; æ™®é€š 1 -&gt; vip 2-&gt; é«˜çº§vip</span></span><br><span class="line">    vipLevel: <span class="string">""</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="stateç”¨æ³•"><a href="#stateç”¨æ³•" class="headerlink" title="stateç”¨æ³•"></a>stateç”¨æ³•</h5><ul><li><p>ç›´æ¥ä½¿ç”¨å’Œè®¡ç®—å±æ€§ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; $store.state.userInfo &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;&#123;&#123; userInfo &#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        userInfo() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.userInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><ul><li>mapStateè¾…åŠ©å‡½æ•°</li></ul><p>ä½œç”¨ï¼šå¯ä»¥è·å–å¤šä¸ªstateçš„å€¼ï¼Œä¸ç”¨å†™é‡å¤çš„ä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; userStatus &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;&#123;&#123; vipLevel &#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">      computed: &#123;</span><br><span class="line">         ...mapState([<span class="string">"userStatus"</span>, <span class="string">"vipLevel"</span>])</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="å››ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Getter"><a href="#å››ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Getter" class="headerlink" title="å››ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Getter"></a>å››ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Getter</h4><p>Getterï¼šGetter çš„ä½œç”¨ä¸ filters æœ‰ä¸€äº›ç›¸ä¼¼ï¼Œå¯ä»¥å°† State è¿›è¡Œè¿‡æ»¤åè¾“å‡ºã€‚</p><p>Gettersç›¸å½“äºvueä¸­çš„è®¡ç®—å±æ€§ï¼Œé€šè¿‡gettersè¿›ä¸€æ­¥å¤„ç†ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œè€Œä¸”å…è®¸ä¼ å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯stateã€‚</p><p>å¹¶ä¸”å°±åƒè®¡ç®—å±æ€§ä¸€æ ·ï¼Œgetterçš„è¿”å›å€¼ä¼šæ ¹æ®å®ƒçš„ä¾èµ–è¢«ç¼“å­˜èµ·æ¥ï¼Œä¸”åªæœ‰å½“å®ƒçš„ä¾èµ–å€¼å‘ç”Ÿæ”¹å˜æ‰ä¼šé‡æ–°è®¡ç®—ã€‚</p><p>ç¬¬äº”æ­¥ï¼šåœ¨storeæ–‡ä»¶å¤¹ä¸­æ–°å»ºgetter.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    memberInfo(state) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (state.userStatus) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"æ™®é€šä¼šå‘˜"</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"vipä¼šå‘˜"</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`é«˜çº§V<span class="subst">$&#123;state.vipLevel&#125;</span>ä¼šå‘˜`</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"æ™®é€šä¼šå‘˜"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Getterç”¨æ³•"><a href="#Getterç”¨æ³•" class="headerlink" title="Getterç”¨æ³•"></a>Getterç”¨æ³•</h5><ul><li>ç›´æ¥ä½¿ç”¨å’Œè®¡ç®—å±æ€§ä½¿ç”¨</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; $store.getters.userInfo &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;&#123;&#123; userInfo &#125;&#125;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        userInfo() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.userInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><ul><li>mapStateè¾…åŠ©å‡½æ•°</li></ul><p>ä½œç”¨ï¼šå¯ä»¥è·å–å¤šä¸ªstateçš„å€¼ï¼Œä¸ç”¨å†™é‡å¤çš„ä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; memberInfo &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp">import &#123; mapGetters &#125; from "vuex";</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">   export default &#123;</span></span><br><span class="line"><span class="regexp">      computed: &#123;</span></span><br><span class="line"><span class="regexp">         ...mapGetters(["memberInfo"])</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">   &#125;;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><h4 id="äº”ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Mutations"><a href="#äº”ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Mutations" class="headerlink" title="äº”ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Mutations"></a>äº”ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Mutations</h4><p>ç¬¬å…­æ­¥ï¼šåœ¨storeæ–‡ä»¶å¤¹ä¸­æ–°å»ºmutations.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    login(state, v) &#123;</span><br><span class="line">        state.userInfo = v</span><br><span class="line">    &#125;,</span><br><span class="line">    setMemberInfo(state, v) &#123;</span><br><span class="line">        state.userStatus = v.userStatus</span><br><span class="line">        state.vipLevel = v.vipLevel</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…­ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Actions"><a href="#å…­ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Actions" class="headerlink" title="å…­ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Actions"></a>å…­ã€Vuexæ ¸å¿ƒæ¦‚å¿µâ€”Actions</h4><p>ç¬¬ä¸ƒæ­¥ï¼šåœ¨storeæ–‡ä»¶å¤¹ä¸­æ–°å»ºactions.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">"any-promise"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    buyVip(&#123; commit &#125;, e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// mock api äº¤äº’</span></span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// ä¿®æ”¹æœ¬åœ°state</span></span><br><span class="line">                commit(<span class="string">"setMemberInfo"</span>, &#123;</span><br><span class="line">                    userStatus: e.userStatus,</span><br><span class="line">                    vipLevel: e.vipLevel</span><br><span class="line">                &#125;)</span><br><span class="line">                resolve(<span class="string">"è´­ä¹°æˆåŠŸ"</span>)</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    getFreeVip(&#123; commit, state &#125;) &#123;</span><br><span class="line">        <span class="comment">// mock api äº¤äº’</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (state.userStatus === <span class="number">0</span>) &#123;</span><br><span class="line">                    commit(<span class="string">"setMemberInfo"</span>, &#123;</span><br><span class="line">                        userStatus: <span class="number">1</span>,</span><br><span class="line">                        vipLevel: <span class="number">0</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    resolve(<span class="string">"åˆ†äº«æˆåŠŸï¼Œæ‚¨å·²è·å¾—ä¸€ä¸ªæœˆçš„é«˜çº§vipä¼šå‘˜"</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resolve(<span class="string">"åˆ†äº«æˆåŠŸ"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•é˜²æ­¢Redisè„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Ÿ</title>
    <url>/post/6bcc7fe0.html</url>
    <content><![CDATA[<blockquote><p>å¦‚ä½•é˜²æ­¢Redisè„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤± ~</p></blockquote><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯è„‘è£‚"><a href="#ä»€ä¹ˆæ˜¯è„‘è£‚" class="headerlink" title="ä»€ä¹ˆæ˜¯è„‘è£‚"></a>ä»€ä¹ˆæ˜¯è„‘è£‚</h3><p>æ‰€è°“çš„é›†ç¾¤è„‘è£‚å°±æ˜¯ï¼Œç”±äºredis masterèŠ‚ç‚¹å’Œredis salveèŠ‚ç‚¹å’Œ <strong>Sentinelï¼ˆå“¨å…µï¼‰</strong>å¤„äºä¸åŒçš„ç½‘ç»œåˆ†åŒºï¼Œä½¿å¾—sentinelæ²¡æœ‰èƒ½å¤Ÿå¿ƒè·³æ„ŸçŸ¥åˆ°masterï¼Œæ‰€ä»¥é€šè¿‡é€‰ä¸¾çš„æ–¹å¼æå‡äº†ä¸€ä¸ªsalveä¸ºmasterï¼Œè¿™æ ·å°±å­˜åœ¨äº†ä¸¤ä¸ªmasterï¼Œå°±åƒå¤§è„‘åˆ†è£‚äº†ä¸€æ ·ï¼Œè¿™æ ·ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿˜åœ¨old masteré‚£é‡Œå†™å…¥æ•°æ®ï¼Œæ–°èŠ‚ç‚¹æ— æ³•åŒæ­¥æ•°æ®ï¼Œå½“ç½‘ç»œæ¢å¤åï¼Œsentinelä¼šå°†old masteré™ä¸ºsalveï¼Œè¿™æ—¶å†ä»æ–°masteråŒæ­¥æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´å¤§é‡æ•°æ®ä¸¢å¤±ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210415223127.png" style="zoom:33%"><h3 id="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè„‘è£‚ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±"><a href="#ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè„‘è£‚ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè„‘è£‚ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±"></a>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè„‘è£‚ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</h3><p>ä¸»ä»åˆ‡æ¢åï¼Œä»åº“ä¸€æ—¦å‡çº§ä¸ºæ–°ä¸»åº“ï¼Œå“¨å…µå°±ä¼šè®©åŸä¸»åº“æ‰§è¡Œ slave of å‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“é‡æ–°è¿›è¡Œå…¨é‡åŒæ­¥ã€‚è€Œåœ¨å…¨é‡åŒæ­¥æ‰§è¡Œçš„æœ€åé˜¶æ®µï¼ŒåŸä¸»åº“éœ€è¦æ¸…ç©ºæœ¬åœ°çš„æ•°æ®ï¼ŒåŠ è½½æ–°ä¸»åº“å‘é€çš„ RDB æ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒåŸä¸»åº“åœ¨ä¸»ä»åˆ‡æ¢æœŸé—´ä¿å­˜çš„æ–°å†™æ•°æ®å°±ä¸¢å¤±äº†ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210415223132.png" style="zoom:33%"><h3 id="å¦‚ä½•åº”å¯¹è„‘è£‚é—®é¢˜"><a href="#å¦‚ä½•åº”å¯¹è„‘è£‚é—®é¢˜" class="headerlink" title="å¦‚ä½•åº”å¯¹è„‘è£‚é—®é¢˜"></a>å¦‚ä½•åº”å¯¹è„‘è£‚é—®é¢˜</h3><p>Redis å·²ç»æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹æ¥é™åˆ¶ä¸»åº“çš„è¯·æ±‚å¤„ç†ï¼Œåˆ†åˆ«æ˜¯ min-slaves-to-write å’Œ min-slaves-max-lagã€‚</p><ul><li>min-slaves-to-writeï¼šè¿™ä¸ªé…ç½®é¡¹è®¾ç½®äº†ä¸»åº“èƒ½è¿›è¡Œæ•°æ®åŒæ­¥çš„æœ€å°‘ä»åº“æ•°é‡ï¼›</li><li>min-slaves-max-lagï¼šè¿™ä¸ªé…ç½®é¡¹è®¾ç½®äº†ä¸»ä»åº“é—´è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶ï¼Œä»åº“ç»™ä¸»åº“å‘é€ ACK æ¶ˆæ¯çš„æœ€å¤§å»¶è¿Ÿï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</li></ul><blockquote><p>æ¯”å¦‚æœ‰ä¸‰ä¸ªä»åº“ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæœ€å°‘çš„salveèŠ‚ç‚¹ä¸º3ä¸ªï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æŠŠ min-slaves-to-write å’Œ min-slaves-max-lag è¿™ä¸¤ä¸ªé…ç½®é¡¹æ­é…èµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€å®šçš„é˜ˆå€¼ï¼Œå‡è®¾ä¸º N å’Œ Tã€‚è¿™ä¸¤ä¸ªé…ç½®é¡¹ç»„åˆåçš„è¦æ±‚æ˜¯ï¼Œä¸»åº“è¿æ¥çš„ä»åº“ä¸­è‡³å°‘æœ‰ N ä¸ªä»åº“ï¼Œå’Œä¸»åº“è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’ï¼Œå¦åˆ™ï¼Œä¸»åº“å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚äº†ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤§é‡æ•°æ®ä¸¢å¤±ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlä¸»ä»åŒæ­¥å»¶è¿Ÿ</title>
    <url>/post/2b202fe.html</url>
    <content><![CDATA[<blockquote><p>MySqlä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æ•°æ®åº“ä¸»ä»åŒæ­¥åŸç†"><a href="#ä¸€ã€æ•°æ®åº“ä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="ä¸€ã€æ•°æ®åº“ä¸»ä»åŒæ­¥åŸç†"></a>ä¸€ã€æ•°æ®åº“ä¸»ä»åŒæ­¥åŸç†</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210419135600.jpeg" alt=""></p><p>åˆ†ä¸ºå››æ­¥èµ°ï¼š</p><ol><li><p><u>ä¸»åº“å¯¹æ‰€æœ‰DDLå’ŒDMLäº§ç”Ÿçš„æ—¥å¿—å†™è¿›binlogï¼›</u></p></li><li><p><u>ä¸»åº“ç”Ÿæˆä¸€ä¸ª log dump çº¿ç¨‹ï¼Œç”¨æ¥ç»™ä»åº“I/Oçº¿ç¨‹è¯»å–binlogï¼›</u></p></li><li><p><u>ä»åº“çš„I/O Threadå»è¯·æ±‚ä¸»åº“çš„binlogï¼Œå¹¶å°†å¾—åˆ°çš„binlogæ—¥å¿—å†™åˆ°relay logæ–‡ä»¶ä¸­ï¼›</u></p></li><li><p><u>ä»åº“çš„SQL Threadä¼šè¯»å–relay logæ–‡ä»¶ä¸­çš„æ—¥å¿—è§£ææˆå…·ä½“æ“ä½œï¼Œå°†ä¸»åº“çš„DDLå’ŒDMLæ“ä½œäº‹ä»¶é‡æ”¾ã€‚</u></p></li></ol><blockquote><p>SQLè¯­è¨€å…±åˆ†ä¸ºä»¥ä¸‹å‡ å¤§ç±»ï¼šæŸ¥è¯¢è¯­è¨€DQLï¼Œæ§åˆ¶è¯­è¨€DCLï¼Œæ“çºµè¯­è¨€DMLï¼Œå®šä¹‰è¯­è¨€DDLã€‚äº‹åŠ¡æ§åˆ¶TCL.</p><p><strong>DQLï¼ˆData QUERY Languagesï¼‰è¯­å¥</strong>ï¼šå³æ•°æ®åº“å®šä¹‰è¯­å¥ï¼Œç”¨æ¥æŸ¥è¯¢SELECTå­å¥ï¼ŒFROMå­å¥ï¼ŒWHEREå­å¥ç»„æˆçš„æŸ¥è¯¢å—ï¼Œæ¯”å¦‚ï¼šselectâ€“fromâ€“whereâ€“grouop byâ€“havingâ€“order byâ€“limit</p><p><strong>DDLï¼ˆData Definition Languagesï¼‰è¯­å¥</strong>ï¼šå³æ•°æ®åº“å®šä¹‰è¯­å¥ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ä¸­çš„è¡¨ã€ç´¢å¼•ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰ï¼Œå¸¸ç”¨çš„è¯­å¥å…³é”®å­—æœ‰ï¼šCREATE,ALTER,DROP,TRUNCATE,COMMENT,RENAMEã€‚å¢åˆ æ”¹è¡¨çš„ç»“æ„</p><p><strong>DMLï¼ˆData Manipulation Languageï¼‰è¯­å¥</strong>ï¼šå³æ•°æ®æ“çºµè¯­å¥ï¼Œç”¨æ¥æŸ¥è¯¢ã€æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ç­‰ï¼Œå¸¸ç”¨çš„è¯­å¥å…³é”®å­—æœ‰ï¼šSELECT,INSERT,UPDATE,DELETE,MERGE,CALL,EXPLAIN PLAN,LOCK TABLE,åŒ…æ‹¬é€šç”¨æ€§çš„å¢åˆ æ”¹æŸ¥ã€‚å¢åˆ æ”¹è¡¨çš„æ•°æ®</p><p><strong>DCLï¼ˆData Control Languageï¼‰è¯­å¥</strong>ï¼šå³æ•°æ®æ§åˆ¶è¯­å¥ï¼Œç”¨äºæˆæƒ/æ’¤é”€æ•°æ®åº“åŠå…¶å­—æ®µçš„æƒé™ï¼ˆDCL is short name of Data Control Language which includes commands such as GRANT and mostly concerned with rights, permissions and other controls of the database system.ï¼‰ã€‚å¸¸ç”¨çš„è¯­å¥å…³é”®å­—æœ‰ï¼šGRANT,REVOKEã€‚</p><p><strong>TCLï¼ˆTransaction Control Languageï¼‰è¯­å¥</strong>ï¼šäº‹åŠ¡æ§åˆ¶è¯­å¥ï¼Œç”¨äºæ§åˆ¶äº‹åŠ¡ï¼Œå¸¸ç”¨çš„è¯­å¥å…³é”®å­—æœ‰ï¼šCOMMIT,ROLLBACK,SAVEPOINT,SET TRANSACTIONã€‚</p></blockquote><h3 id="äºŒã€ä¸»ä»åŒæ­¥å»¶è¿Ÿäº§ç”ŸåŸå› "><a href="#äºŒã€ä¸»ä»åŒæ­¥å»¶è¿Ÿäº§ç”ŸåŸå› " class="headerlink" title="äºŒã€ä¸»ä»åŒæ­¥å»¶è¿Ÿäº§ç”ŸåŸå› "></a>äºŒã€ä¸»ä»åŒæ­¥å»¶è¿Ÿäº§ç”ŸåŸå› </h3><ol><li><p>MySQLçš„ä¸»ä»å¤åˆ¶éƒ½æ˜¯å•çº¿ç¨‹çš„æ“ä½œï¼Œä¸»åº“å¯¹æ‰€æœ‰DDLå’ŒDMLäº§ç”Ÿçš„æ—¥å¿—å†™è¿›binlogï¼Œç”±äºbinlogæ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆé«˜ã€‚Slaveçš„SQL Threadçº¿ç¨‹å°†ä¸»åº“çš„DDLå’ŒDMLæ“ä½œäº‹ä»¶åœ¨slaveä¸­é‡æ”¾ã€‚DMLå’ŒDDLçš„IOæ“ä½œæ˜¯éšæœºçš„ï¼Œä¸æ˜¯é¡ºåºçš„ï¼Œæˆæœ¬é«˜å¾ˆå¤šã€‚</p></li><li><p>ç”±äºSQL Threadä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œå½“ä¸»åº“çš„å¹¶å‘è¾ƒé«˜æ—¶ï¼Œäº§ç”Ÿçš„DMLæ•°é‡è¶…è¿‡slaveçš„SQL Threadæ‰€èƒ½å¤„ç†çš„é€Ÿåº¦ï¼Œæˆ–è€…å½“slaveä¸­æœ‰å¤§å‹queryè¯­å¥äº§ç”Ÿäº†é”ç­‰å¾…é‚£ä¹ˆå»¶æ—¶å°±äº§ç”Ÿäº†ã€‚</p></li></ol><p>å¸¸è§åŸå› ï¼šMasterè´Ÿè½½è¿‡é«˜ã€Slaveè´Ÿè½½è¿‡é«˜ã€ç½‘ç»œå»¶è¿Ÿã€æœºå™¨æ€§èƒ½å¤ªä½ã€MySQLé…ç½®ä¸åˆç†ã€‚</p><h3 id="ä¸‰ã€åˆ¤æ–­ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•"><a href="#ä¸‰ã€åˆ¤æ–­ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•" class="headerlink" title="ä¸‰ã€åˆ¤æ–­ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•"></a>ä¸‰ã€åˆ¤æ–­ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•</h3><p>é€šè¿‡ç›‘æ§ show slave status å‘½ä»¤è¾“å‡ºçš„Seconds_Behind_Masterå‚æ•°çš„å€¼æ¥åˆ¤æ–­ï¼š</p><p>NULLï¼Œè¡¨ç¤ºio_threadæˆ–æ˜¯sql_threadæœ‰ä»»ä½•ä¸€ä¸ªå‘ç”Ÿæ•…éšœï¼›</p><p><strong>0 è¯¥å€¼ä¸ºé›¶ï¼Œè¡¨ç¤ºä¸»ä»å¤åˆ¶è‰¯å¥½ï¼›</strong></p><p>æ­£å€¼ï¼Œè¡¨ç¤ºä¸»ä»å·²ç»å‡ºç°å»¶æ—¶ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºä»åº“å»¶è¿Ÿè¶Šä¸¥é‡ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210419135651.png" alt=""></p><h3 id="å››ã€å¦‚ä½•é¿å…ä¸»ä»åŒæ­¥å»¶è¿Ÿ"><a href="#å››ã€å¦‚ä½•é¿å…ä¸»ä»åŒæ­¥å»¶è¿Ÿ" class="headerlink" title="å››ã€å¦‚ä½•é¿å…ä¸»ä»åŒæ­¥å»¶è¿Ÿ"></a>å››ã€å¦‚ä½•é¿å…ä¸»ä»åŒæ­¥å»¶è¿Ÿ</h3><h4 id="â‘ æ¶æ„æ–¹é¢"><a href="#â‘ æ¶æ„æ–¹é¢" class="headerlink" title="â‘ æ¶æ„æ–¹é¢"></a>â‘ æ¶æ„æ–¹é¢</h4><ol><li><p>ä¸šåŠ¡çš„æŒä¹…åŒ–å±‚çš„å®ç°é‡‡ç”¨åˆ†åº“æ¶æ„ï¼ŒmysqlæœåŠ¡å¯å¹³è¡Œæ‰©å±•ï¼Œåˆ†æ•£å‹åŠ›ã€‚</p></li><li><p>å•ä¸ªåº“è¯»å†™åˆ†ç¦»ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»å†™ä»è¯»ï¼Œåˆ†æ•£å‹åŠ›ã€‚è¿™æ ·ä»åº“å‹åŠ›æ¯”ä¸»åº“é«˜ï¼Œä¿æŠ¤ä¸»åº“ã€‚</p></li><li><p>æœåŠ¡çš„åŸºç¡€æ¶æ„åœ¨ä¸šåŠ¡å’Œmysqlä¹‹é—´åŠ å…¥memcacheæˆ–è€…redisçš„cacheå±‚ã€‚é™ä½mysqlçš„è¯»å‹åŠ›ã€‚</p></li><li><p>ä¸åŒä¸šåŠ¡çš„mysqlç‰©ç†ä¸Šæ”¾åœ¨ä¸åŒæœºå™¨ï¼Œåˆ†æ•£å‹åŠ›ã€‚</p></li><li><p>ä½¿ç”¨æ¯”ä¸»åº“æ›´å¥½çš„ç¡¬ä»¶è®¾å¤‡ä½œä¸ºslaveæ€»ç»“ï¼Œmysqlå‹åŠ›å°ï¼Œå»¶è¿Ÿè‡ªç„¶ä¼šå˜å°ã€‚</p></li></ol><h4 id="â‘¡ç¡¬ä»¶æ–¹é¢"><a href="#â‘¡ç¡¬ä»¶æ–¹é¢" class="headerlink" title="â‘¡ç¡¬ä»¶æ–¹é¢"></a>â‘¡ç¡¬ä»¶æ–¹é¢</h4><ol><li><p>é‡‡ç”¨å¥½æœåŠ¡å™¨ï¼Œæ¯”å¦‚4uæ¯”2uæ€§èƒ½æ˜æ˜¾å¥½ï¼Œ2uæ¯”1uæ€§èƒ½æ˜æ˜¾å¥½ã€‚</p></li><li><p>å­˜å‚¨ç”¨ssdæˆ–è€…ç›˜é˜µæˆ–è€…sanï¼Œæå‡éšæœºå†™çš„æ€§èƒ½ã€‚</p></li><li><p>ä¸»ä»é—´ä¿è¯å¤„åœ¨åŒä¸€ä¸ªäº¤æ¢æœºä¸‹é¢ï¼Œå¹¶ä¸”æ˜¯ä¸‡å…†ç¯å¢ƒã€‚</p><p>æ€»ç»“ï¼Œç¡¬ä»¶å¼ºåŠ²ï¼Œå»¶è¿Ÿè‡ªç„¶ä¼šå˜å°ã€‚ä¸€å¥è¯ï¼Œç¼©å°å»¶è¿Ÿçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯èŠ±é’±å’ŒèŠ±æ—¶é—´ã€‚</p></li></ol><h4 id="â‘¢è½¯ä»¶æ–¹é¢"><a href="#â‘¢è½¯ä»¶æ–¹é¢" class="headerlink" title="â‘¢è½¯ä»¶æ–¹é¢"></a>â‘¢è½¯ä»¶æ–¹é¢</h4><ol><li><p>sync_binlogåœ¨slaveç«¯è®¾ç½®ä¸º0</p></li><li><p>â€“logs-slave-updates ä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ›´æ–°ä¸è®°å…¥å®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p></li><li><p>ç›´æ¥ç¦ç”¨slaveç«¯çš„binlog</p></li><li><p>slaveç«¯ï¼Œå¦‚æœä½¿ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯innodbï¼Œinnodb_flush_log_at_trx_commit =2</p></li><li><p>å‡çº§MySQLç‰ˆæœ¬åˆ°5.7ï¼Œä½¿ç”¨å¹¶è¡Œå¤åˆ¶</p></li><li><p>ä¼˜åŒ–ç½‘ç»œ</p></li><li><p>å¼ºåˆ¶å°†è¯»è¯·æ±‚è·¯ç”±åˆ°ä¸»åº“å¤„ç†ã€‚æ—¢ç„¶ä½ ä»åº“çš„æ•°æ®è¿‡æœŸäº†ï¼Œé‚£å°±ç›´æ¥ä»ä¸»åº“è¯»å–ï¼Œè¿™ç§æ–¹æ¡ˆè™½ç„¶ä¼šå¢åŠ ä¸»åº“çš„å‹åŠ›ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚ Sharding-JDBC å°±æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹æ¡ˆã€‚é€šè¿‡ä½¿ç”¨ Sharding-JDBC çš„ HintManager åˆ†ç‰‡é”®å€¼ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ä¸»åº“ã€‚</span></span><br><span class="line"><span class="comment">// ç»§ç»­JDBCæ“ä½œå¯¹äºè¿™ç§æ–¹æ¡ˆï¼Œä½ å¯ä»¥å°†é‚£äº›å¿…é¡»è·å–æœ€æ–°æ•°æ®çš„è¯»è¯·æ±‚éƒ½äº¤ç»™ä¸»åº“å¤„ç†ã€‚</span></span><br><span class="line">HintManager hintManager = HintManager.getInstance();</span><br><span class="line">hintManager.setMasterRouteOnly();</span><br></pre></td></tr></table></figure></li><li><p>å»¶è¿Ÿè¯»å–ã€‚<br>å¯¹äºä¸€äº›å¯¹æ•°æ®æ¯”è¾ƒæ•æ„Ÿçš„åœºæ™¯ï¼Œä½ å¯ä»¥åœ¨å®Œæˆå†™è¯·æ±‚ä¹‹åï¼Œé¿å…ç«‹å³è¿›è¡Œè¯·æ±‚æ“ä½œã€‚æ¯”å¦‚ä½ æ”¯ä»˜æˆåŠŸä¹‹åï¼Œè·³è½¬åˆ°ä¸€ä¸ªæ”¯ä»˜æˆåŠŸçš„é¡µé¢ï¼Œå½“ä½ ç‚¹å‡»è¿”å›ä¹‹åæ‰è¿”å›è‡ªå·±çš„è´¦æˆ·ã€‚</p></li></ol><blockquote><p><strong>ä¼˜é…·çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ•°æ®åº“åˆ†ç‰‡æŠ€æœ¯ï¼Œè€ŒæŠ›å¼ƒäº†ç”±äºæ•°æ®é‡çš„è¶Šæ¥è¶Šå¤šå¯¼è‡´å¤åˆ¶å»¶è¿Ÿçš„é—®é¢˜ã€‚æŒ‰ç…§user_idè¿›è¡Œåˆ†ç‰‡ï¼Œè¿™æ ·å¿…é¡»æœ‰ä¸€ä¸ªå…¨å±€çš„è¡¨æ¥ç®¡ç†ç”¨æˆ·ä¸shardçš„å…³ç³»,æ ¹æ®user_idå¯ä»¥å¾—åˆ°share_idï¼Œç„¶åæ ¹æ®share_idå»æŒ‡å®šçš„åˆ†ç‰‡æŸ¥è¯¢æŒ‡å®šçš„æ•°æ®</p><p><strong>æ·˜å®çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¿®æ”¹æºç ï¼Œå¯¹åº”çš„æœºåˆ¶æ˜¯Transferæœºåˆ¶ï¼Œæ­¤å¤„é€šè¿‡å¯¹Binlogæ—¥å¿—é‡åšé‡‡ç”¨å¤šçº¿ç¨‹å®ç°ï¼Œä»è€Œæé«˜slaveçš„QPS</p><p><strong>å®é™…ä¸Šï¼Œå»¶è¿Ÿè¯»å–è¿™ç§æ–¹æ¡ˆæ²¡åŠæ³•å®Œå…¨é¿å…ä¸»ä»å»¶è¿Ÿï¼Œåªèƒ½è¯´å¯ä»¥å‡å°‘å‡ºç°å»¶è¿Ÿçš„æ¦‚ç‡è€Œå·²ï¼Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ã€‚æ€»çš„æ¥è¯´ï¼Œè¦æƒ³ä¸å‡ºç°å»¶è¿Ÿé—®é¢˜ï¼Œä¸€èˆ¬è¿˜æ˜¯è¦å¼ºåˆ¶å°†é‚£äº›å¿…é¡»è·å–æœ€æ–°æ•°æ®çš„è¯»è¯·æ±‚éƒ½äº¤ç»™ä¸»åº“å¤„ç†ã€‚å¦‚æœä½ çš„é¡¹ç›®çš„å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜çš„è¯ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜æ˜¯å¯ä»¥é€‰æ‹©çš„ã€‚</strong></p></blockquote><h3 id="äº”ã€è§£å†³æ•°æ®ä¸¢å¤±çš„é—®é¢˜"><a href="#äº”ã€è§£å†³æ•°æ®ä¸¢å¤±çš„é—®é¢˜" class="headerlink" title="äº”ã€è§£å†³æ•°æ®ä¸¢å¤±çš„é—®é¢˜"></a>äº”ã€è§£å†³æ•°æ®ä¸¢å¤±çš„é—®é¢˜</h3><p>ä¸»åº“å®•æœºåï¼Œæ•°æ®å¯èƒ½ä¸¢å¤±ï¼›</p><ol><li><p><strong>åŠåŒæ­¥å¤åˆ¶</strong></p><p>ä»MySQL5.5å¼€å§‹ï¼ŒMySQLå·²ç»æ”¯æŒåŠåŒæ­¥å¤åˆ¶äº†ï¼ŒåŠåŒæ­¥å¤åˆ¶ä»‹äºå¼‚æ­¥å¤åˆ¶å’ŒåŒæ­¥å¤åˆ¶ä¹‹é—´ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œäº‹åŠ¡åä¸ç«‹åˆ»è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°å¹¶å†™åˆ°relay logä¸­æ‰è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºå¼‚æ­¥å¤åˆ¶ï¼ŒåŠåŒæ­¥å¤åˆ¶æé«˜äº†æ•°æ®çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶å®ƒä¹Ÿé€ æˆäº†ä¸€ä¸ªTCP/IPå¾€è¿”è€—æ—¶çš„å»¶è¿Ÿã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210419142347.png" style="zoom:80%"></li><li><p><strong>ä¸»åº“é…ç½® sync_binlog=1ï¼Œinnodb_flush_log_at_trx_commit=1</strong></p><p>sync_binlogçš„é»˜è®¤å€¼æ˜¯0ï¼ŒMySQLä¸ä¼šå°†binlogåŒæ­¥åˆ°ç£ç›˜ï¼Œå…¶å€¼è¡¨ç¤ºæ¯å†™å¤šå°‘binlogåŒæ­¥ä¸€æ¬¡ç£ç›˜ã€‚</p><p>innodb_flush_log_at_trx_commitä¸º1è¡¨ç¤ºæ¯ä¸€æ¬¡äº‹åŠ¡æäº¤æˆ–äº‹åŠ¡å¤–çš„æŒ‡ä»¤éƒ½éœ€è¦æŠŠæ—¥å¿—flushåˆ°ç£ç›˜ã€‚</p></li></ol><blockquote><p>æ³¨æ„:å°†ä»¥ä¸Šä¸¤ä¸ªå€¼åŒæ—¶è®¾ç½®ä¸º1æ—¶ï¼Œå†™å…¥æ€§èƒ½ä¼šå—åˆ°ä¸€å®šé™åˆ¶ï¼Œåªæœ‰å¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯æ‰å»ºè®®ä½¿ç”¨ï¼Œæ¯”å¦‚æ¶‰åŠåˆ°é’±çš„è®¢å•æ”¯ä»˜ä¸šåŠ¡ï¼Œè€Œä¸”ç³»ç»ŸI/Oèƒ½åŠ›å¿…é¡»å¯ä»¥æ”¯æ’‘ï¼</p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisçš„æ·˜æ±°ç­–ç•¥</title>
    <url>/post/e0bb8399.html</url>
    <content><![CDATA[<blockquote><p>Redis æ˜¯å¦ç”¨åˆ°å®¶ï¼Œä»è¿™å°±èƒ½çœ‹å‡ºæ¥ï¼Œæ¯”å¦‚ä½  Redis åªèƒ½å­˜ 5G æ•°æ®ï¼Œå¯æ˜¯ä½ å†™äº† 10Gï¼Œé‚£ä¼šåˆ  5G çš„æ•°æ®ã€‚æ€ä¹ˆåˆ çš„ï¼Œè¿™ä¸ªé—®é¢˜æ€è€ƒè¿‡ä¹ˆï¼Ÿè¿™ä¸ªå°±ä¸»è¦çœ‹Redisçš„æ·˜æ±°ç­–ç•¥ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#ä¸€ã€å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="ä¸€ã€å†…å­˜æ·˜æ±°ç­–ç•¥"></a>ä¸€ã€å†…å­˜æ·˜æ±°ç­–ç•¥</h3><p>Redisä¸­é€šè¿‡MaxMemoryå‚æ•°æ¥è®¾å®šå†…å­˜çš„ä½¿ç”¨ä¸Šé™ï¼Œå½“Redisä½¿ç”¨å†…å­˜è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼çš„æ—¶å€™ï¼Œä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„ç­–ç•¥é€‰å–è¦åˆ é™¤çš„keyæ¥åˆ é™¤ï¼Œä» è€Œç»™æ–°çš„é”®å€¼ç•™å‡ºç©ºé—´ï¼›ç›®å‰Redisæä¾›äº†8ç§çš„æ·˜æ±°ç­–ç•¥ï¼ˆé»˜è®¤çš„æ˜¯maxmemory-policy no-envictionï¼‰ï¼Œ<font color="red"> <strong>ä¸åŒäºä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒRedis5.0ä¸ºæˆ‘ä»¬æä¾›äº†å…«ä¸ªä¸åŒçš„å†…å­˜ç½®æ¢ç­–ç•¥ã€‚å¾ˆæ—©ä¹‹å‰æä¾›äº†6ç§</strong> </font>åœ¨ Redis.conf ä¸­æœ‰ä¸€è¡Œé…ç½®ï¼š</p><ol><li><p><strong>volatile-lru</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>volatile-ttl</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>volatile-random</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>volatile-lfu</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†æŒ‘é€‰ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>allkeys-lru</strong>ï¼šä»æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼›<strong>ï¼ˆæ¨èï¼‰</strong></p></li><li><p><strong>allkeys-lfu</strong>ï¼šä»æ•°æ®é›†ä¸­æŒ‘é€‰ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>allkeys-random</strong>ï¼šä»æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼›</p></li><li><p><strong>no-enviction</strong>ï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤ç­–ç•¥ã€‚æ„æ€æ˜¯å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œå°±ä¼šæŠ¥é”™ï¼Œè¯·æ±‚å¯ä»¥ç»§ç»­è¿›è¡Œï¼Œçº¿ä¸Šä»»åŠ¡ä¹Ÿä¸èƒ½æŒç»­è¿›è¡Œï¼Œé‡‡ç”¨no-envictionç­–ç•¥å¯ä»¥ä¿è¯æ•°æ®ä¸è¢«ä¸¢å¤±ï¼›</p></li></ol><p>è¿™å…«ç§å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º4ä¸­ï¼Œ<strong>LRU</strong>ã€<strong>LFU</strong>ã€<strong>Random</strong>ã€<strong>TTL</strong>ã€‚ å½“ä½¿ç”¨volatile-lruã€volatile-randomã€volatile-ttlè¿™ä¸‰ç§ç­–ç•¥æ—¶ï¼Œå¦‚æœæ²¡æœ‰keyå¯ä»¥è¢«æ·˜æ±°ï¼Œåˆ™å’Œnoevictionä¸€æ ·è¿”å›é”™è¯¯</p><h3 id="äºŒã€å¦‚ä½•åˆ é™¤è¿‡æœŸKeyç­–ç•¥"><a href="#äºŒã€å¦‚ä½•åˆ é™¤è¿‡æœŸKeyç­–ç•¥" class="headerlink" title="äºŒã€å¦‚ä½•åˆ é™¤è¿‡æœŸKeyç­–ç•¥"></a>äºŒã€å¦‚ä½•åˆ é™¤è¿‡æœŸKeyç­–ç•¥</h3><p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“éœ€è¦æ·˜æ±°æ‰å“ªäº›è¿‡æœŸKeyï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»æ·˜æ±°è¿™äº›è¿‡æœŸkeyå‘¢ï¼Ÿæœ‰3ç§åˆ é™¤çš„æ“ä½œç­–ç•¥ï¼š</p><h4 id="1ã€å®šæ—¶åˆ é™¤"><a href="#1ã€å®šæ—¶åˆ é™¤" class="headerlink" title="1ã€å®šæ—¶åˆ é™¤"></a>1ã€å®šæ—¶åˆ é™¤</h4><p><strong>æ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨</strong>ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚</p><p>ä¼˜ç‚¹:å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ã€‚</p><p>ç¼ºç‚¹ï¼šä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚</p><h4 id="2ã€æƒ°æ€§åˆ é™¤"><a href="#2ã€æƒ°æ€§åˆ é™¤" class="headerlink" title="2ã€æƒ°æ€§åˆ é™¤"></a>2ã€æƒ°æ€§åˆ é™¤</h4><p><strong>åªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤</strong>ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸è¿‡å¤šå ç”¨CPUèµ„æºå»åšè¿‡æœŸå¤„ç†</p><p>ç¼ºç‚¹ï¼šè¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚</p><h4 id="3ã€å®šæœŸåˆ é™¤"><a href="#3ã€å®šæœŸåˆ é™¤" class="headerlink" title="3ã€å®šæœŸåˆ é™¤"></a>3ã€å®šæœŸåˆ é™¤</h4><p>é¦–å…ˆï¼šredisä¸­ï¼Œæ¯ä¸ªåº“ï¼ˆ0-15ï¼‰éƒ½æœ‰ä¸€ä¸ª<strong>expireså­—å…¸</strong>ï¼Œå®ƒä¼šä¿å­˜æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„è¿‡æœŸæ—¶é—´æ•°æ®ã€‚</p><p>å®šæœŸè¿‡æœŸæ˜¯è¯´çš„ï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„åº“ï¼ˆæ¯”å¦‚0-15å·åº“å…¶ä¸­å‡ ä¸ªåº“ï¼‰çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚</p><p>å®šæœŸåˆ é™¤æ˜¯ä¸Šé¢ä¸¤ç§æ–¹æ¡ˆçš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ¥åˆ é™¤è¿‡æœŸé”®ï¼Œå¹¶é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å½±å“ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ•ˆçš„å‡å°‘å†…å­˜çš„æµªè´¹ï¼›ä½†æ˜¯è¯¥ç­–ç•¥çš„éš¾ç‚¹åœ¨äºé—´éš”æ—¶é•¿ï¼Œè¿™ä¸ªéœ€è¦æ ¹æ®è‡ªèº«ä¸šåŠ¡æƒ…å†µæ¥è¿›è¡Œè®¾ç½®ï¼›</p><p><font color="#44448"><strong>Redisç›®å‰é‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ç­–ç•¥ã€‚</strong></font></p><blockquote><ol><li><p>ä¸ºä»€ä¹ˆä¸ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥?</p><p>å®šæ—¶åˆ é™¤ï¼Œç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥è´Ÿè´£ç›‘è§† Keyï¼Œè¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ã€‚è™½ç„¶å†…å­˜åŠæ—¶é‡Šæ”¾ï¼Œä½†æ˜¯ååˆ†æ¶ˆè€— CPU èµ„æºã€‚åœ¨å¤§å¹¶å‘è¯·æ±‚ä¸‹ï¼ŒCPU è¦å°†æ—¶é—´åº”ç”¨åœ¨å¤„ç†è¯·æ±‚ï¼Œè€Œä¸æ˜¯åˆ é™¤ Keyï¼Œå› æ­¤æ²¡æœ‰é‡‡ç”¨è¿™ä¸€ç­–ç•¥ã€‚</p></li><li><p>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤å¦‚ä½•å·¥ä½œ?</p><p>å®šæœŸåˆ é™¤ï¼ŒRedis é»˜è®¤æ¯ä¸ª 100ms æ£€æŸ¥ï¼Œæœ‰è¿‡æœŸ Key åˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒRedis ä¸æ˜¯æ¯ä¸ª 100ms å°†æ‰€æœ‰çš„ Key æ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºæŠ½å–è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœåªé‡‡ç”¨å®šæœŸåˆ é™¤ç­–ç•¥ï¼Œä¼šå¯¼è‡´å¾ˆå¤š Key åˆ°æ—¶é—´æ²¡æœ‰åˆ é™¤ã€‚äºæ˜¯ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨åœºã€‚</p><p>é‡‡ç”¨å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤å°±æ²¡å…¶ä»–é—®é¢˜äº†ä¹ˆ</p><p>ä¸æ˜¯çš„ï¼Œå¦‚æœå®šæœŸåˆ é™¤æ²¡åˆ é™¤æ‰ Keyã€‚å¹¶ä¸”ä½ ä¹Ÿæ²¡åŠæ—¶å»è¯·æ±‚ Keyï¼Œä¹Ÿå°±æ˜¯è¯´æƒ°æ€§åˆ é™¤ä¹Ÿæ²¡ç”Ÿæ•ˆã€‚è¿™æ ·ï¼ŒRedis çš„å†…å­˜ä¼šè¶Šæ¥è¶Šé«˜ã€‚é‚£ä¹ˆå°±åº”è¯¥é‡‡ç”¨å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p></li></ol></blockquote><h3 id="ä¸‰ã€å¦‚ä½•è·å–åŠè®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#ä¸‰ã€å¦‚ä½•è·å–åŠè®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="ä¸‰ã€å¦‚ä½•è·å–åŠè®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥"></a>ä¸‰ã€å¦‚ä½•è·å–åŠè®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥</h3><p>1ã€è·å–å½“å‰å†…å­˜æ·˜æ±°ç­–ç•¥ï¼šå¦‚æœé»˜è®¤æ²¡æœ‰æ›´æ”¹çš„è¯å°±æ˜¯é»˜è®¤çš„<strong>noeviction</strong>ç­–ç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config get maxmemory-policy</span><br></pre></td></tr></table></figure><p>2ã€è®¾ç½®æ·˜æ±°ç­–ç•¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config set maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure><h3 id="å››ã€é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥"><a href="#å››ã€é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥" class="headerlink" title="å››ã€é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥"></a>å››ã€é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥</h3><p>â‘  <u>å¦‚æœåˆ†ä¸ºçƒ­æ•°æ®ä¸å†·æ•°æ®, æ¨èä½¿ç”¨ allkeys-lru ç­–ç•¥</u>ï¼›</p><p>â€‹ ä¹Ÿå°±æ˜¯è¯´å…¶ä¸­ä¸€éƒ¨åˆ†keyç»å¸¸è¢«è¯»å†™. å¦‚æœä¸ç¡®å®šå…·ä½“çš„ä¸šåŠ¡ç‰¹å¾, é‚£ä¹ˆ allkeys-lru æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>â‘¡ <u>å¦‚æœéœ€è¦å¾ªç¯è¯»å†™æ‰€æœ‰çš„key, æˆ–è€…å„ä¸ªkeyçš„è®¿é—®é¢‘ç‡å·®ä¸å¤š, å¯ä»¥ä½¿ç”¨ allkeys-random ç­–ç•¥</u>ï¼›</p><p>â€‹ å³è¯»å†™æ‰€æœ‰å…ƒç´ çš„æ¦‚ç‡å·®ä¸å¤šã€‚</p><p>â‘¢ <u>å¦‚æœè¦è®© Redis æ ¹æ® TTL æ¥ç­›é€‰éœ€è¦åˆ é™¤çš„key, è¯·ä½¿ç”¨ volatile-ttl ç­–ç•¥</u>ã€‚</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210415111426.png" style="zoom:75%"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨</title>
    <url>/post/6e14acb7.html</url>
    <content><![CDATA[<blockquote><p>é¢è¯•å®˜é—®åˆ°ä½  MySqlå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨ ï¼Œå¦‚æœä¸€è„¸æ‡µé€¼çš„è¯ï¼Œå°±è¿›æ¥ç¨ä½œä¼‘æ¯ï¼Œå­¦ä¹ ä¸€ä¸‹ ~</p></blockquote><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯å›è¡¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å›è¡¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å›è¡¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å›è¡¨ï¼Ÿ</h3><p>å…ˆé€šè¿‡æ•°æ®åº“ç´¢å¼•æ‰«æå‡ºæ•°æ®æ‰€åœ¨çš„è¡Œï¼Œå†é€šè¿‡è¡Œä¸»é”®idå–å‡ºç´¢å¼•ä¸­æœªæä¾›çš„æ•°æ®ï¼Œå³åŸºäºéä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>è¡¨tblæœ‰a,b,cä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­aæ˜¯ä¸»é”®ï¼Œbä¸Šå»ºäº†ç´¢å¼•ï¼Œç„¶åç¼–å†™sqlè¯­å¥</p><hr><p>SELECT * FROM tbl WHERE a =1</p><p>è¿™æ ·ä¸ä¼šäº§ç”Ÿå›è¡¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®åœ¨açš„ç´¢å¼•æ ‘ä¸­å‡èƒ½æ‰¾åˆ°</p><hr><p>SELECT * FROM tbl WHERE b = 1</p><p>è¿™æ ·å°±ä¼šäº§ç”Ÿå›è¡¨ï¼Œå› ä¸ºwhereæ¡ä»¶æ˜¯bå­—æ®µï¼Œé‚£ä¹ˆä¼šå»bçš„ç´¢å¼•æ ‘é‡ŒæŸ¥æ‰¾æ•°æ®ï¼Œä½†bçš„ç´¢å¼•é‡Œé¢åªæœ‰a,bä¸¤ä¸ªå­—æ®µçš„å€¼ï¼Œæ²¡æœ‰cï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢ä¸ºäº†å–åˆ°cå­—æ®µï¼Œå°±è¦å–å‡ºä¸»é”®açš„å€¼ï¼Œç„¶åå»açš„ç´¢å¼•æ ‘å»æ‰¾cå­—æ®µçš„æ•°æ®ã€‚æŸ¥äº†ä¸¤ä¸ªç´¢å¼•æ ‘ï¼Œè¿™å°±å«å›è¡¨ã€‚</p><hr><h3 id="æ€ä¹ˆé¿å…å›è¡¨ï¼Ÿ"><a href="#æ€ä¹ˆé¿å…å›è¡¨ï¼Ÿ" class="headerlink" title="æ€ä¹ˆé¿å…å›è¡¨ï¼Ÿ"></a>æ€ä¹ˆé¿å…å›è¡¨ï¼Ÿ</h3><p>å°†éœ€è¦çš„å­—æ®µæ”¾åœ¨ç´¢å¼•ä¸­å»ã€‚æŸ¥è¯¢çš„æ—¶å€™å°±èƒ½é¿å…å›è¡¨ã€‚</p><p><font color="red"><strong>ä¸æ˜¯å¿…é¡»çš„å­—æ®µå°±ä¸è¦å‡ºç°åœ¨SELECTé‡Œé¢ã€‚æˆ–è€…b,cå»ºè”åˆç´¢å¼•ã€‚ä½†å…·ä½“æƒ…å†µè¦å…·ä½“åˆ†æï¼Œç´¢å¼•å­—æ®µå¤šäº†ï¼Œå­˜å‚¨å’Œæ’å…¥æ•°æ®æ—¶çš„æ¶ˆè€—ä¼šæ›´å¤§ï¼Œè¿™æ˜¯ä¸ªå¹³è¡¡é—®é¢˜ã€‚</strong></font></p><h3 id="ç´¢å¼•è¦†ç›–"><a href="#ç´¢å¼•è¦†ç›–" class="headerlink" title="ç´¢å¼•è¦†ç›–"></a>ç´¢å¼•è¦†ç›–</h3><p>ç´¢å¼•è¦†ç›–å°±æ˜¯æŸ¥è¿™ä¸ªç´¢å¼•èƒ½æŸ¥åˆ°ä½ æ‰€éœ€è¦çš„æ‰€æœ‰æ•°æ®ï¼Œä¸éœ€è¦å»å¦å¤–çš„æ•°æ®ç»“æ„å»æŸ¥ã€‚å…¶å®å°±æ˜¯ä¸ç”¨å›è¡¨ï¼ˆå’Œå›è¡¨ç›¸åï¼‰ã€‚</p><p><strong>è¦†ç›–ç´¢å¼•</strong>åˆç§°ä¹‹ä¸º<strong>ç´¢å¼•è¦†ç›–</strong>ï¼Œå³selectçš„æ•°æ®åˆ—åªä»ç´¢å¼•ä¸­å°±èƒ½å¾—åˆ°ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼Œä¹Ÿå°±æ˜¯åªéœ€æ‰«æç´¢å¼•å°±å¯ä»¥å¾—åˆ°æŸ¥è¯¢ç»“æœã€‚</p><p><u>å¸¸è§ç´¢å¼•è¦†ç›–çš„æ–¹æ³•æ˜¯ï¼šå°†è¢«æŸ¥è¯¢çš„å­—æ®µï¼Œå»ºç«‹åˆ°è”åˆç´¢å¼•é‡Œå»ã€‚</u></p><blockquote><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢åªéœ€è¦æ‰«æç´¢å¼•è€Œæ— éœ€å›è¡¨ï¼Œä¸ä»…èƒ½å¤Ÿæå¤§åœ°æé«˜æ€§èƒ½ï¼Œè€Œä¸”å‡å°‘I/Oæé«˜æ•ˆç‡ã€‚</p></blockquote><p>å½“ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢åˆ†æå™¨EXPLAINçš„Extraåˆ—å¯ä»¥çœ‹åˆ°â€œ<em>Using index</em>â€ã€‚</p><h3 id="ç´¢å¼•ä¸‹æ¨"><a href="#ç´¢å¼•ä¸‹æ¨" class="headerlink" title="ç´¢å¼•ä¸‹æ¨"></a>ç´¢å¼•ä¸‹æ¨</h3><p>5.6ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ²¡æœ‰ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ–çš„ï¼Œ5.6ç‰ˆæœ¬æ·»åŠ äº†ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ–ã€‚</p><blockquote><p>ç´¢å¼•ä¸‹æ¨ï¼š <strong>æ•°æ®åº“æ£€ç´¢æ•°æ®è¿‡ç¨‹ä¸­ä¸ºå‡å°‘å›è¡¨æ¬¡æ•°è€Œåšçš„ä¼˜åŒ–</strong></p><p>ç´¢å¼•ä¸‹æ¨ï¼šå…·ä½“æ˜¯åœ¨å¤åˆç´¢å¼•çš„æŸ¥è¯¢ä¸­ï¼Œé’ˆå¯¹ç‰¹å®šçš„è¿‡æ»¤æ¡ä»¶è€Œè¿›è¡Œå‡å°‘å›è¡¨æ¬¡æ•°è€Œåšçš„ä¼˜åŒ–ã€‚</p><p>ç´¢å¼•ä¸‹æ¨ï¼šåœ¨<strong>éä¸»é”®ç´¢å¼•</strong>ä¸Šçš„ä¼˜åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å›è¡¨çš„æ¬¡æ•°ï¼Œå¤§å¤§æå‡äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p></blockquote><p>explainè§£æç»“æœå¯ä»¥çœ‹å‡ºExtraçš„å€¼ä¸º <strong>â€œUsing index conditionâ€</strong> ï¼Œè¡¨ç¤ºå·²ç»ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210414145314.png" alt="MySqlæŸ¥è¯¢è¿‡ç¨‹"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>Springçš„äº‹åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿä¸æ•°æ®åº“çš„äº‹åŠ¡æ˜¯å¦ä¸€æ ·ï¼Ÿ</title>
    <url>/post/5c5b3589.html</url>
    <content><![CDATA[<blockquote><p>Springçš„äº‹åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿä¸æ•°æ®åº“çš„äº‹åŠ¡æ˜¯å¦ä¸€æ ·ï¼Ÿä»Šå¤©å’±ä»¬å°±å­¦é‚£ä¹ˆä¸€å°ä¸‹ ~</p></blockquote><a id="more"></a> <img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210412004840680.png" alt="æˆ‘ä»¬æ˜¯æœ€æ£’çš„ï¼"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>MySqlä¹è§‚é”å’Œæ‚²è§‚é”è¯¦è§£</title>
    <url>/post/c3c9656a.html</url>
    <content><![CDATA[<blockquote><p>åœ¨é¢è¯•çš„æ—¶å€™ï¼Œéƒ½ä¼šè¢«é—®åˆ°ä¹è§‚é”å’Œæ‚²è§‚é”çš„é—®é¢˜ï¼Œå¦‚æœä¸æ¸…æ¥šå…¶æ¦‚å¿µå’Œç”¨æ³•çš„æƒ…å†µä¸‹ ï¼Œç›¸ä¿¡å¾ˆå¤šçš„åŒå­¦æ„Ÿè§‰å¾ˆæ‡µé€¼ï¼Œä»Šå¤©å’±ä»¬å°±å°å­¦ä¸€ä¸‹ ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä¹è§‚é”"><a href="#ä¸€ã€ä¹è§‚é”" class="headerlink" title="ä¸€ã€ä¹è§‚é”"></a>ä¸€ã€ä¹è§‚é”</h3><p>ä¹è§‚é”æŒ‡çš„æ˜¯è®¤ä¸ºæ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šé€ æˆå†²çªï¼Œæ‰€ä»¥åœ¨æ•°æ®è¿›è¡Œæäº¤æ›´æ–°çš„æ—¶å€™ï¼Œæ‰ä¼šæ­£å¼å¯¹æ•°æ®çš„å†²çªä¸å¦è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°å†²çªäº†ï¼Œåˆ™è®©è¿”å›ç”¨æˆ·é”™è¯¯çš„ä¿¡æ¯ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•å»åšã€‚ä¸€èˆ¬çš„å®ç°ä¹è§‚é”çš„æ–¹å¼å°±æ˜¯ç¬¬ä¸€ç§æ˜¯<u>ä½¿ç”¨ç‰ˆæœ¬å·Version</u>ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨<u>æ—¶é—´æˆ³Timestampï¼ˆæ—¶é—´æˆ³ç²¾åº¦ï¼‰</u>ã€‚</p><blockquote><p>å¦‚ä½•è§£å†³ï¼Ÿ</p><p>ä¹è§‚é”çš„å®ç°ä¸ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·²å¼€å‘è€…å»å®ç°ï¼Œå®ç°æ–¹å¼ä¸€èˆ¬æ˜¯è®°å½•æ•°æ®ç‰ˆæœ¬ï¼Œä¸€ç§æ˜¯é€šè¿‡ç‰ˆæœ¬å·ï¼Œä¸€ç§æ˜¯é€šè¿‡æ—¶é—´æˆ³ã€‚ç»™è¡¨åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³çš„å­—æ®µï¼Œè¯»å–æ•°æ®æ—¶ï¼Œå°†ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œæ•°æ®æ›´æ–°æ—¶ï¼Œå°†ç‰ˆæœ¬å·åŠ 1ã€‚å½“æˆ‘ä»¬æäº¤æ•°æ®æ›´æ–°æ—¶ï¼Œåˆ¤æ–­å½“å‰çš„ç‰ˆæœ¬å·ä¸ç¬¬ä¸€æ¬¡è¯»å–å‡ºæ¥çš„ç‰ˆæœ¬å·æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ•°æ®è¿‡æœŸï¼Œæ‹’ç»æ›´æ–°ï¼Œè®©ç”¨æˆ·é‡æ–°æ“ä½œã€‚</p></blockquote><p><font color="red"><strong>ä¼˜åŠ¿åŠ£åŠ¿ï¼š</strong></font></p><p>ä¹è§‚é”åœ¨å¹¶å‘æ§åˆ¶çš„æ—¶å€™ï¼Œç›¸ä¿¡äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ç«äº‰(datarace)çš„æ¦‚ç‡æ˜¯æ¯”è¾ƒå°çš„ï¼Œ å› æ­¤å°½å¯èƒ½ç›´æ¥èµ°ä¸‹å»ï¼Œç›´åˆ°æœ€ç»ˆæäº¤çš„æ—¶å€™æ‰å»é”å®šï¼Œæ‰€ä»¥<u>ä¸ä¼šäº§ç”Ÿä»»ä½•é”å’Œæ­»é”</u>ã€‚ä¹è§‚é”è™½ç„¶æ²¡æœ‰ä¾èµ–æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><h3 id="äºŒã€æ‚²è§‚é”"><a href="#äºŒã€æ‚²è§‚é”" class="headerlink" title="äºŒã€æ‚²è§‚é”"></a>äºŒã€æ‚²è§‚é”</h3><p>æ‚²è§‚é”æŒ‡çš„æ˜¯å¤–ç•Œå¯¹æ•°æ®ä¿®æ”¹æŒä¿å®ˆæ€åº¦(æ‚²è§‚)ï¼Œå› æ­¤ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å¤„äºé”å®šçŠ¶æ€ã€‚ æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ ï¼ˆä¹Ÿåªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ã€‚</p><blockquote><p>å¦‚ä½•è§£å†³ï¼Ÿ</p><p>æ‚²è§‚é”çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼šå…±äº«é”ï¼ˆè¯»é”ï¼‰å’Œæ’å®ƒé”ï¼ˆå†™é”ï¼‰</p><p><strong>å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š</strong>ç”±éæ›´æ–°ï¼ˆè¯»å–ï¼‰æ“ä½œåˆ›å»ºçš„é”ã€‚å…¶ä»–ç”¨æˆ·å¯ä»¥å¹¶å‘è¯»å–æ•°æ®ï¼Œä½†ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½è·å–æ•°æ®ä¸Šçš„æ’å®ƒé”ï¼Œç›´åˆ°å·²é‡Šæ”¾æ‰€æœ‰å…±äº«é”ã€‚å…±äº«é”(Sé”)åˆç§°ä¸ºè¯»é”ï¼Œè‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠSé”ï¼Œåˆ™äº‹åŠ¡Tåªèƒ½è¯»Aï¼Œ ä¸èƒ½ä¿®æ”¹Aï¼›å…¶ä»–äº‹åŠ¡åªèƒ½å†å¯¹AåŠ Sé”ï¼Œè€Œä¸èƒ½åŠ Xé”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„Sé”ã€‚è¿™å°±ä¿è¯äº†å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»Aï¼Œä½†åœ¨Té‡Šæ”¾Aä¸Šçš„Sé”ä¹‹å‰ä¸èƒ½å¯¹Aåšä»»ä½•ä¿®æ”¹ã€‚</p><p><strong>å®ç°æ–¹å¼ï¼š</strong>æ˜¯åœ¨sqlååŠ LOCK IN SHARE MODEï¼Œæ¯”å¦‚SELECT â€¦ LOCK IN SHARE MODEï¼Œå³åœ¨ç¬¦åˆæ¡ä»¶çš„rowsä¸Šéƒ½åŠ äº†å…±äº«é”ï¼Œè¿™æ ·çš„è¯ï¼Œå…¶ä»–sessionå¯ä»¥è¯»å–è¿™äº›è®°å½•ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ·»åŠ å…±äº«é”ï¼Œä½†æ˜¯æ— æ³•ä¿®æ”¹è¿™äº›è®°å½•ç›´åˆ°ä½ è¿™ä¸ªåŠ é”çš„sessionæ‰§è¡Œå®Œæˆ(å¦åˆ™ç›´æ¥é”ç­‰å¾…è¶…æ—¶)ï¼Œ<em>ä¹Ÿå°±æ˜¯è¯»å–å®Œåæ‰èƒ½è®©å…¶ä»–çº¿ç¨‹ä¿®æ”¹</em>ã€‚</p><hr><p><strong>æ’å®ƒé”ï¼ˆå†™é”ã€ç‹¬å é”ï¼‰ï¼š</strong>åˆç§°ä¸ºå†™é”ã€ç‹¬å é”ï¼Œæ˜¯ä¸€ç§åŸºæœ¬çš„é”ç±»å‹ã€‚è‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠXé”ï¼Œåˆ™åªå…è®¸Tè¯»å–å’Œä¿®æ”¹Aï¼Œå…¶ä»–ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„é”ã€‚è¿™å°±ä¿è¯äº†å…¶ä»–äº‹åŠ¡åœ¨Té‡Šæ”¾Aä¸Šçš„é”ä¹‹å‰ä¸èƒ½å†<strong>è¯»å–å’Œä¿®æ”¹</strong>Aã€‚</p><p><strong>å®ç°æ–¹å¼ï¼š</strong>æ˜¯åœ¨sqlåé¢åŠ FOR UPDATEï¼Œæ¯”å¦‚SELECT â€¦ FOR UPDATE ï¼Œå³åœ¨ç¬¦åˆæ¡ä»¶çš„rowsä¸Šéƒ½åŠ äº†æ’å®ƒé”ï¼Œå…¶ä»–sessionä¹Ÿå°±æ— æ³•åœ¨è¿™äº›è®°å½•ä¸Šæ·»åŠ ä»»ä½•çš„Sé”æˆ–Xé”ã€‚å¦‚æœä¸å­˜åœ¨ä¸€è‡´æ€§éé”å®šè¯»çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–sessionæ˜¯æ— æ³•è¯»å–å’Œä¿®æ”¹è¿™äº›è®°å½•çš„ï¼Œä½†æ˜¯innodbæœ‰éé”å®šè¯»(å¿«ç…§è¯»å¹¶ä¸éœ€è¦åŠ é”)ï¼Œfor updateä¹‹åå¹¶ä¸ä¼šé˜»å¡å…¶ä»–sessionçš„å¿«ç…§è¯»å–æ“ä½œï¼Œé™¤äº†select â€¦lock in share modeå’Œselect â€¦ for updateè¿™ç§æ˜¾ç¤ºåŠ é”çš„æŸ¥è¯¢æ“ä½œã€‚</p><p><u>æ³¨æ„ï¼šè¦ä½¿ç”¨æ‚²è§‚é”ï¼Œæˆ‘ä»¬å¿…é¡»å…³é—­mysqlæ•°æ®åº“çš„è‡ªåŠ¨æäº¤å±æ€§ï¼Œå› ä¸ºMySQLé»˜è®¤ä½¿ç”¨auto commitæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œåï¼ŒMySQLä¼šç«‹åˆ»å°†ç»“æœè¿›è¡Œæäº¤ã€‚set autocommit=0;</u></p><p>æ•°æ®åº“ä¸­ï¼Œæ‚²è§‚é”çš„æµç¨‹ï¼š å¯¹ä»»æ„è®°å½•è¿›è¡Œä¿®æ”¹å‰ï¼Œå…ˆå°è¯•ä¸ºè¯¥è®°å½•åŠ ä¸Šæ’ä»–é”ï¼ˆexclusive lockingï¼‰ã€‚å¦‚æœåŠ é”å¤±è´¥ï¼Œè¯´æ˜è¯¥è®°å½•æ­£åœ¨è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰æŸ¥è¯¢å¯èƒ½è¦ç­‰å¾…æˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ å…·ä½“å“åº”æ–¹å¼ç”±å¼€å‘è€…æ ¹æ®å®é™…éœ€è¦å†³å®šã€‚ å¦‚æœæˆåŠŸåŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹è®°å½•åšä¿®æ”¹ï¼Œäº‹åŠ¡å®Œæˆåå°±ä¼šé‡Šæ”¾é”äº†ã€‚ å…¶é—´å¦‚æœæœ‰å…¶ä»–å¯¹è¯¥è®°å½•åšä¿®æ”¹æˆ–åŠ æ’ä»–é”çš„æ“ä½œï¼Œéƒ½ä¼šç­‰å¾…æˆ‘ä»¬è§£é”æˆ–ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote><p><font color="red"><strong>ä¼˜åŠ¿åŠ£åŠ¿ï¼š</strong></font></p><p>æ‚²è§‚å¹¶å‘æ§åˆ¶å®é™…ä¸Šæ˜¯<u>â€œå…ˆå–é”å†è®¿é—®â€</u>çš„ä¿å®ˆç­–ç•¥ï¼Œä¸ºæ•°æ®å¤„ç†çš„å®‰å…¨æä¾›äº†ä¿è¯ã€‚ä½†æ˜¯åœ¨æ•ˆç‡æ–¹é¢ï¼Œå¤„ç†åŠ é”çš„æœºåˆ¶ä¼šè®©æ•°æ®åº“äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè¿˜æœ‰<u>å¢åŠ äº§ç”Ÿæ­»é”çš„æœºä¼š</u>ï¼›å¦å¤–ï¼Œåœ¨åªè¯»å‹äº‹åŠ¡å¤„ç†ä¸­ç”±äºä¸ä¼šäº§ç”Ÿå†²çªï¼Œä¹Ÿæ²¡å¿…è¦ä½¿ç”¨é”ï¼Œè¿™æ ·åšåªèƒ½å¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼›è¿˜æœ‰ä¼šé™ä½äº†å¹¶è¡Œæ€§ï¼Œä¸€ä¸ªäº‹åŠ¡å¦‚æœé”å®šäº†æŸè¡Œæ•°æ®ï¼Œå…¶ä»–äº‹åŠ¡å°±å¿…é¡»ç­‰å¾…è¯¥äº‹åŠ¡å¤„ç†å®Œæ‰å¯ä»¥å¤„ç†é‚£è¡Œæ•°ã€‚</p><h3 id="ä¸‰ã€æ€»ç»“å½’çº³"><a href="#ä¸‰ã€æ€»ç»“å½’çº³" class="headerlink" title="ä¸‰ã€æ€»ç»“å½’çº³"></a>ä¸‰ã€æ€»ç»“å½’çº³</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210411225806824.png" alt=""></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MySql</category>
        <category>lock</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–</title>
    <url>/post/f98f7bc7.html</url>
    <content><![CDATA[<blockquote><p>Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ– ~</p></blockquote><a id="more"></a><p>Springä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œæ•´ä¸ªç¼“å­˜åˆ†ä¸ºä¸‰çº§ã€‚</p><ol><li><code>singletonObjects</code>ï¼Œä¸€çº§ç¼“å­˜ï¼Œå­˜å‚¨çš„æ˜¯æ‰€æœ‰åˆ›å»ºå¥½äº†çš„å•ä¾‹Bean<strong>ï¼ˆå•ä¾‹æ± ï¼‰</strong>ï¼›</li><li><code>earlySingletonObjects</code>ï¼Œå®Œæˆå®ä¾‹åŒ–ï¼Œä½†æ˜¯è¿˜æœªè¿›è¡Œå±æ€§æ³¨å…¥åŠåˆå§‹åŒ–çš„å¯¹è±¡<strong>ï¼ˆæ—©æœŸæ›å…‰å¯¹è±¡ï¼‰</strong>ï¼›</li><li><code>singletonFactories</code>ï¼Œæå‰æš´éœ²çš„ä¸€ä¸ªå•ä¾‹å·¥å‚ï¼ŒäºŒçº§ç¼“å­˜ä¸­å­˜å‚¨çš„å°±æ˜¯ä»è¿™ä¸ªå·¥å‚ä¸­è·å–åˆ°çš„å¯¹è±¡<strong>ï¼ˆæ—©æœŸæ›å…‰å¯¹è±¡å·¥å‚ï¼‰</strong>ï¼›</li></ol><blockquote><p><strong>å…·ä½“æ­¥éª¤ï¼š</strong></p><ol><li>æ‹¿beançš„æ—¶å€™å…ˆä»<code>singletonObjects</code>ï¼ˆâ¼€çº§ç¼“å­˜ï¼‰ä¸­è·å–ï¼›</li><li>å¦‚æœè·å–ä¸åˆ°ï¼Œå¹¶ä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œå°±ä»<code>earlySingletonObjects</code>ï¼ˆäºŒçº§ç¼“å­˜ï¼‰ä¸­è·å–ï¼›</li><li>å¦‚æœè¿˜æ˜¯è·å–ä¸åˆ°å°±ä»<code>singletonFactories</code>ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ä¸­è·å–ï¼Œç„¶åå°†è·å–åˆ°çš„å¯¹è±¡æ”¾åˆ°ï¼Œ<code>earlySingletonObjects</code>ï¼ˆäºŒçº§ç¼“å­˜ï¼‰ä¸­ï¼Œå¹¶ä¸”å°†beanå¯¹åº”çš„<code>singletonFactories</code>ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰æ¸…é™¤ã€‚</li><li>beanåˆå§‹åŒ–å®Œæ¯•ï¼Œæ”¾åˆ°<code>singletonObjects</code>ï¼ˆâ¼€çº§ç¼“å­˜ï¼‰ä¸­ï¼Œå°†beanå¯¹åº”çš„<code>earlySingletonObjects</code>ï¼ˆäºŒçº§ç¼“å­˜ï¼‰æ¸…é™¤ã€‚</li></ol></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€</title>
    <url>/post/31e3efbb.html</url>
    <content><![CDATA[<blockquote><p>Redis ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ ~</p></blockquote><a id="more"></a><h2 id="ä¸€ã€æè¿°ä»‹ç»"><a href="#ä¸€ã€æè¿°ä»‹ç»" class="headerlink" title="ä¸€ã€æè¿°ä»‹ç»"></a>ä¸€ã€æè¿°ä»‹ç»</h2><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡ <u>ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®</u> ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p><p><strong>ç¼“å­˜ç©¿é€</strong>æ˜¯æŒ‡ <u>ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®</u>ï¼Œè€Œç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚ï¼Œæˆ‘ä»¬æ•°æ®åº“çš„ id éƒ½æ˜¯1å¼€å§‹è‡ªå¢ä¸Šå»çš„ï¼Œå¦‚å‘èµ·ä¸ºidå€¼ä¸º -1 çš„æ•°æ®æˆ– id ä¸ºç‰¹åˆ«å¤§ä¸å­˜åœ¨çš„æ•°æ®ã€‚è¿™æ—¶çš„ç”¨æˆ·å¾ˆå¯èƒ½æ˜¯æ”»å‡»è€…ï¼Œæ”»å‡»ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œä¸¥é‡ä¼šå‡»å®æ•°æ®åº“ã€‚</p><p><strong>ç¼“å­˜é›ªå´©</strong>æ˜¯æŒ‡ç¼“å­˜ä¸­æ•°æ®å¤§æ‰¹é‡åˆ°è¿‡æœŸæ—¶é—´ï¼Œè€ŒæŸ¥è¯¢æ•°æ®é‡å·¨å¤§ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³downæœºã€‚å’Œç¼“å­˜å‡»ç©¿ä¸åŒçš„æ˜¯ï¼Œ ç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚</p><blockquote><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡â¼¤é‡ç¼“å­˜å¤±æ•ˆï¼Œç¼“å­˜å‡»ç©¿æ˜¯æŒ‡çƒ­ç‚¹æ•°æ®çš„ç¼“å­˜å¤±æ•ˆ</p></blockquote><h2 id="äºŒã€è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€è§£å†³æ–¹æ¡ˆ"></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h2><h4 id="1ã€ç¼“å­˜å‡»ç©¿"><a href="#1ã€ç¼“å­˜å‡»ç©¿" class="headerlink" title="1ã€ç¼“å­˜å‡»ç©¿"></a>1ã€ç¼“å­˜å‡»ç©¿</h4><ul><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸ</li><li>äº’æ–¥é”</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•æœºæ¨¡å¼å¯ä»¥ç”¨ReentrantLockï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨åˆ†å¸ƒå¼é”å¤„ç†ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Lock LOCK = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getData</span><span class="params">(String key)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        String result = getDataFromRedis(key);</span><br><span class="line">        <span class="comment">//å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œå°±å»æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è·å–é”ï¼Œè·å–æˆåŠŸä»¥åï¼Œå°±å»æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦åˆ™å°±ç­‰ä¼šå„¿å†æ¬¡æŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">            <span class="comment">//æ­¤å¤„å¦‚æœæ ¹æ®keyå€¼åŠ é”æ›´å¥½ï¼Œå³çº¿ç¨‹Aä»æ•°æ®åº“è·å–key1çš„æ•°æ®ï¼Œå¹¶ä¸å½±å“çº¿ç¨‹Bä»æ•°æ®åº“è·å–key2çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (LOCK.tryLock()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//ä»æ•°æ®åº“è·å–æ•°æ®</span></span><br><span class="line">                    result = getDataFromMySql(key);</span><br><span class="line">                    <span class="comment">//æ›´æ–°ç¼“å­˜æ•°æ®</span></span><br><span class="line">                    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        setDataToCache(key, result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                    LOCK.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ç¡ä¸€ä¼š</span></span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">                result = getData(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getDataFromRedis</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"ä»Redisè·å–ç¼“å­˜æ•°æ®ï¼Œkeyä¸ºï¼š&#123;&#125;"</span>, key);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Redis value"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getDataFromMySql</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"ä»MySqlè·å–æ•°æ®ï¼Œå‚æ•°ä¸ºï¼š&#123;&#125;"</span>, key);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"MySql value"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDataToCache</span><span class="params">(String key, String result)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"è®¾ç½®Redisç¼“å­˜,keyä¸ºï¼š&#123;&#125;ï¼Œvalueä¸ºï¼š&#123;&#125;"</span>, key, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€ç¼“å­˜ç©¿é€"><a href="#2ã€ç¼“å­˜ç©¿é€" class="headerlink" title="2ã€ç¼“å­˜ç©¿é€"></a>2ã€ç¼“å­˜ç©¿é€</h4><ul><li>æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œå¯¹è¯·æ±‚å‚æ•°è¿›â¾æ ¡éªŒï¼Œä¸åˆç†ç›´æ¥è¿”å›ã€‚å¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼ŒidåšåŸºç¡€æ ¡éªŒï¼Œid&lt;=0çš„ç›´æ¥æ‹¦æˆªã€‚</li><li>ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°†key-valueå¯¹å†™ä¸ºkey-nullï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚30ç§’ï¼ˆè®¾ç½®å¤ªé•¿ä¼šå¯¼è‡´æ­£å¸¸æƒ…å†µä¹Ÿæ²¡æ³•ä½¿ç”¨ï¼‰ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ªidæš´åŠ›æ”»å‡»ã€‚</li><li><strong>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</strong>åŸç†ä¹Ÿå¾ˆç®€å•å°±æ˜¯åˆ©ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•å¿«é€Ÿåˆ¤æ–­å‡ºä½ è¿™ä¸ªKeyæ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œä¸å­˜åœ¨ä½ returnå°±å¥½äº†ï¼Œå­˜åœ¨ä½ å°±å»æŸ¥äº†DBåˆ·æ–°Rediså†returnï¼ˆæ¨èä½¿ç”¨ï¼‰ã€‚</li><li>å¯ä»¥ä½¿ç”¨ç¼“å­˜ç©ºå€¼å¹¶ä¸”è®¾ç½®å¿«é€Ÿè¿‡æœŸçš„æ–¹å¼æ¥ä½œä¸ºä¸€ä¸ªå…œåº•çš„æ–¹æ¡ˆ(å†™æ³•å°±æ˜¯ç¼“å­˜ç©ºå¯¹è±¡ï¼Œé’ˆå¯¹ç©ºçš„æ•°æ®ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚10åˆ†é’Ÿï¼Œå¿«é€Ÿè¿‡æœŸï¼Œé˜²æ­¢å¤ªå¤šçš„ç©ºå€¼é—®é¢˜)ã€‚</li></ul><h4 id="3ã€ç¼“å­˜é›ªå´©"><a href="#3ã€ç¼“å­˜é›ªå´©" class="headerlink" title="3ã€ç¼“å­˜é›ªå´©"></a>3ã€ç¼“å­˜é›ªå´©</h4><ul><li>ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®éšæœºï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿã€‚</li><li>å¦‚æœç¼“å­˜æ•°æ®åº“æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå°†çƒ­ç‚¹æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒæå¾—ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</li><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚</li><li>åŒç¼“å­˜ï¼šæˆ‘ä»¬æœ‰ä¸¤ä¸ªç¼“å­˜ï¼Œç¼“å­˜ A å’Œç¼“å­˜ Bã€‚ç¼“å­˜ A çš„å¤±æ•ˆæ—¶é—´ä¸º 20 åˆ†é’Ÿï¼Œç¼“å­˜ B ä¸è®¾å¤±æ•ˆæ—¶é—´ã€‚è‡ªå·±åšç¼“å­˜é¢„çƒ­æ“ä½œã€‚</li></ul><blockquote><p>ä¸€èˆ¬é¿å…ä»¥ä¸Šæƒ…å†µå‘ç”Ÿæˆ‘ä»¬ä»ä¸‰ä¸ªæ—¶é—´æ®µå»åˆ†æä¸‹ï¼š</p><ul><li>äº‹å‰ï¼š<strong>Redis</strong> é«˜å¯ç”¨ï¼Œä¸»ä»+å“¨å…µï¼Œ<strong>Redis cluster</strong>ï¼Œé¿å…å…¨ç›˜å´©æºƒã€‚</li><li>äº‹ä¸­ï¼šæœ¬åœ° <strong>ehcache</strong> ç¼“å­˜ + <strong>Hystrix</strong> é™æµ+é™çº§ï¼Œé¿å… <strong>MySQL</strong> è¢«æ‰“æ­»ã€‚</li><li>äº‹åï¼š<strong>Redis</strong> æŒä¹…åŒ– <strong>RDB</strong>+<strong>AOF</strong>ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</li><li>ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´è®¾ç½®ä¸ºéšæœºå€¼ï¼Œé¿å…åŒæ—¶å¤±æ•ˆã€‚</li></ul><p><strong>å¥½å¤„ï¼š</strong><br>æ•°æ®åº“ç»å¯¹ä¸ä¼šæ­»ï¼Œé™æµç»„ä»¶ç¡®ä¿äº†æ¯ç§’åªæœ‰å¤šå°‘ä¸ªè¯·æ±‚èƒ½é€šè¿‡ã€‚ åªè¦æ•°æ®åº“ä¸æ­»ï¼Œå°±æ˜¯è¯´ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œ3/5 çš„è¯·æ±‚éƒ½æ˜¯å¯ä»¥è¢«å¤„ç†çš„ã€‚ åªè¦æœ‰ 3/5 çš„è¯·æ±‚å¯ä»¥è¢«å¤„ç†ï¼Œå°±æ„å‘³ç€ä½ çš„ç³»ç»Ÿæ²¡æ­»ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œå¯èƒ½å°±æ˜¯ç‚¹å‡»å‡ æ¬¡åˆ·ä¸å‡ºæ¥é¡µé¢ï¼Œä½†æ˜¯å¤šç‚¹å‡ æ¬¡ï¼Œå°±å¯ä»¥åˆ·å‡ºæ¥ä¸€æ¬¡ã€‚</p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>VMwareè™šæ‹ŸæœºNatè”ç½‘è®¾ç½®</title>
    <url>/post/f9e21a7.html</url>
    <content><![CDATA[<blockquote><p>VMwareè™šæ‹ŸæœºNatè”ç½‘è®¾ç½® ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€æ‰“å¼€è™šæ‹Ÿæœºç½‘ç»œç¼–è¾‘å™¨"><a href="#ä¸€ã€æ‰“å¼€è™šæ‹Ÿæœºç½‘ç»œç¼–è¾‘å™¨" class="headerlink" title="ä¸€ã€æ‰“å¼€è™šæ‹Ÿæœºç½‘ç»œç¼–è¾‘å™¨"></a>ä¸€ã€æ‰“å¼€è™šæ‹Ÿæœºç½‘ç»œç¼–è¾‘å™¨</h3><p>æ‰“å¼€è™šæ‹Ÿæœºç½‘ç»œç¼–è¾‘å™¨å¦‚ä¸‹ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210305142903.png" alt=""></p><p>æ‰“å¼€Natè®¾ç½®ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210305142909.png" alt=""></p><p>ç„¶åæ›´æ”¹å­ç½‘IPï¼Œå†å»æ›´æ”¹NATè®¾ç½®ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210305142914.png" alt=""></p><h3 id="äºŒã€æŸ¥çœ‹windowsç¯å¢ƒçš„ä¸­VMnet8ç½‘ç»œé…ç½®"><a href="#äºŒã€æŸ¥çœ‹windowsç¯å¢ƒçš„ä¸­VMnet8ç½‘ç»œé…ç½®" class="headerlink" title="äºŒã€æŸ¥çœ‹windowsç¯å¢ƒçš„ä¸­VMnet8ç½‘ç»œé…ç½®"></a>äºŒã€æŸ¥çœ‹windowsç¯å¢ƒçš„ä¸­VMnet8ç½‘ç»œé…ç½®</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210305142917.png" alt=""></p><p>æŒ‰ç…§å›¾ç‰‡æ›´æ”¹IPåœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ï¼›</p><h3 id="ä¸‰ã€æŸ¥è¯¢å½“å‰è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘å¡"><a href="#ä¸‰ã€æŸ¥è¯¢å½“å‰è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘å¡" class="headerlink" title="ä¸‰ã€æŸ¥è¯¢å½“å‰è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘å¡"></a>ä¸‰ã€æŸ¥è¯¢å½“å‰è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘å¡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip add</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œå‘½ä»¤ä»¥åï¼Œä¸€èˆ¬æ˜¯å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç½‘å¡1.lo 2.enp0s3 æˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹enp0s3çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶çš„åç§°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯é€šå¸¸åœ¨åªå¼€ä¸€ä¸ªç½‘å¡çš„æ—¶å€™ï¼Œä¸€èˆ¬ç½‘å¡2å°±æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„ç½‘å¡ã€‚</p><p>ç„¶åè¿›å…¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/sysconfig/network-scripts</span><br></pre></td></tr></table></figure><p>é€šè¿‡lså‘½ä»¤å°±å¯ä»¥æ‰¾åˆ°ä¸ç½‘å¡2 åŒåçš„æ–‡ä»¶ ifcfg-enp0s3ï¼›</p><p>vimå‘½ä»¤ç¼–è¾‘æ”¹æ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line"><span class="meta">#</span><span class="bash"> IPçš„é…ç½®æ–¹æ³•[none|static|bootp|dhcp]ï¼ˆå¼•å¯¼æ—¶ä¸ä½¿ç”¨åè®®|é™æ€åˆ†é…IP|BOOTPåè®®|DHCPåè®®ï¼‰</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line"><span class="meta">#</span><span class="bash">IPåœ°å€</span></span><br><span class="line">IPADDR=192.168.1.101</span><br><span class="line"><span class="meta">#</span><span class="bash">å­ç½‘æ©ç </span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç½‘å…³</span></span><br><span class="line">GATEWAY=192.168.0.115</span><br><span class="line"><span class="meta">#</span><span class="bash">åŸŸåè§£æå™¨</span></span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line">DNS3=192.168.1.2</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">PEERDNS=yes</span><br><span class="line">PEERROUTES=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_PEERDNS=yes</span><br><span class="line">IPV6_PEERROUTES=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no  </span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0</span><br><span class="line"><span class="meta">#</span><span class="bash">éšæœºid</span></span><br><span class="line">UUID=972a1eb3-049f-4db2-80f5-7d8fd28ef76f</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¥å£åï¼ˆè®¾å¤‡,ç½‘å¡ï¼‰</span></span><br><span class="line">DEVICE=eth0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ç½‘ç»œæ¥å£æ˜¯å¦æœ‰æ•ˆï¼ˆyes/noï¼‰</span></span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œservice network restartï¼Œæœ€å¥½æ˜¯é‡å¯ä¸€ä¸‹è™šæ‹Ÿæœºã€‚</p><h3 id="å››ã€XShellè¿æ¥æµ‹è¯•"><a href="#å››ã€XShellè¿æ¥æµ‹è¯•" class="headerlink" title="å››ã€XShellè¿æ¥æµ‹è¯•"></a>å››ã€XShellè¿æ¥æµ‹è¯•</h3><p>ç”¨xshellè¿æ¥ç™»å½•å½“å‰è™šæ‹Ÿæœºï¼Œè¾“å…¥ipåœ°å€å’Œç™»å½•å¯†ç ã€‚æµ‹è¯•ä¸€ä¸‹ping <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> æ˜¯å¦å¯ä»¥æ­£å¸¸ã€‚å¦‚æœæˆåŠŸï¼Œé‚£å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>VMware</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootå®˜æ–¹æä¾›çš„Starter</title>
    <url>/post/ea1b33e9.html</url>
    <content><![CDATA[<blockquote><p>SpringBootå®˜æ–¹æä¾›çš„Starterä»‹ç» ~</p></blockquote><a id="more"></a><h4 id="1ã€application-startersï¼ˆåº”ç”¨çº§ï¼‰"><a href="#1ã€application-startersï¼ˆåº”ç”¨çº§ï¼‰" class="headerlink" title="1ã€application startersï¼ˆåº”ç”¨çº§ï¼‰"></a>1ã€application startersï¼ˆåº”ç”¨çº§ï¼‰</h4><table><thead><tr><th align="center">Starter åç§°</th><th align="center">Starter æè¿°</th></tr></thead><tbody><tr><td align="center">spring-boot-starter</td><td align="center">æ ¸å¿ƒ Starterï¼ŒåŒ…æ‹¬è‡ªåŠ¨é…ç½®ã€æ—¥å¿—åŠ YAML æ”¯æŒç­‰</td></tr><tr><td align="center">spring-boot-starter-activemq</td><td align="center">é›†æˆ Apache ActiveMQï¼ŒåŸºäº JMS çš„æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td align="center">spring-boot-starter-artemis</td><td align="center">é›†æˆ Apache Artemisï¼ŒåŸºäº JMS çš„æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td align="center">spring-boot-starter-amqp</td><td align="center">é›†æˆ Spring AMQP å’Œ Rabbit MQ çš„æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td align="center">spring-boot-starter-aop</td><td align="center">é›†æˆ Spring AOP å’Œ AspectJ é¢å‘åˆ‡é¢ç¼–ç¨‹</td></tr><tr><td align="center">spring-boot-starter-batch</td><td align="center">é›†æˆ Spring Batchï¼ˆæ‰¹å¤„ç†ï¼‰</td></tr><tr><td align="center">spring-boot-starter-cache</td><td align="center">é›†æˆ Spring Cacheï¼ˆç¼“å­˜ï¼‰</td></tr><tr><td align="center">spring-boot-starter-data-cassandra</td><td align="center">é›†æˆ Cassandraï¼ˆåˆ†å¸ƒå¼æ•°æ®åº“ï¼‰ å’Œ Spring Data Cassandra</td></tr><tr><td align="center">spring-boot-starter-data-cassandra-reactive</td><td align="center">é›†æˆ Cassandraï¼ˆåˆ†å¸ƒå¼æ•°æ®åº“ï¼‰ å’Œ Spring Data Cassandra Reactive</td></tr><tr><td align="center">spring-boot-starter-data-couchbase</td><td align="center">é›†æˆ Couchbaseï¼ˆæ–‡æ¡£å‹æ•°æ®åº“ï¼‰ å’Œ Spring Data Couchbase</td></tr><tr><td align="center">spring-boot-starter-data-couchbase-reactive</td><td align="center">é›†æˆ Couchbaseï¼ˆæ–‡æ¡£å‹æ•°æ®åº“ï¼‰ å’Œ Spring Data Couchbase Reactive</td></tr><tr><td align="center">spring-boot-starter-data-elasticsearch</td><td align="center">é›†æˆ Elasticsearchï¼ˆæœç´¢å¼•æ“ï¼‰å’Œ Spring Data Elasticsearch</td></tr><tr><td align="center">spring-boot-starter-data-solr</td><td align="center">é›†æˆ Apache Solrï¼ˆæœç´¢å¼•æ“ï¼‰ç»“åˆ Spring Data Solr</td></tr><tr><td align="center">spring-boot-starter-data-jdbc</td><td align="center">é›†æˆ Spring Data JDBC</td></tr><tr><td align="center">spring-boot-starter-data-jpa</td><td align="center">é›†æˆ Spring Data JPA ç»“åˆ Hibernate</td></tr><tr><td align="center">spring-boot-starter-data-ldap</td><td align="center">é›†æˆ Spring Data LDAP</td></tr><tr><td align="center">spring-boot-starter-data-mongodb</td><td align="center">é›†æˆ MongoDBï¼ˆæ–‡æ¡£å‹æ•°æ®åº“ï¼‰å’Œ Spring Data MongoDB</td></tr><tr><td align="center">spring-boot-starter-data-mongodb-reactive</td><td align="center">é›†æˆ MongoDBï¼ˆæ–‡æ¡£å‹æ•°æ®åº“ï¼‰å’Œ Spring Data MongoDB Reactive</td></tr><tr><td align="center">spring-boot-starter-data-neo4j</td><td align="center">é›†æˆ Neo4jï¼ˆå›¾å½¢æ•°æ®åº“ï¼‰å’Œ Spring Data Neo4j</td></tr><tr><td align="center">spring-boot-starter-data-r2dbc</td><td align="center">é›†æˆ Spring Data R2DBC</td></tr><tr><td align="center">spring-boot-starter-data-redis</td><td align="center">é›†æˆ Redisï¼ˆå†…å­˜æ•°æ®åº“ï¼‰ç»“åˆ Spring Data Redis å’Œ Lettuce å®¢æˆ·ç«¯</td></tr><tr><td align="center">spring-boot-starter-data-redis-reactive</td><td align="center">é›†æˆ Redisï¼ˆå†…å­˜æ•°æ®åº“ï¼‰ç»“åˆ Spring Data Redis reactive å’Œ Lettuce å®¢æˆ·ç«¯</td></tr><tr><td align="center">spring-boot-starter-data-rest</td><td align="center">é›†æˆ Spring Data REST æš´éœ² Spring Data repositories è¾“å‡º REST èµ„æº</td></tr><tr><td align="center">spring-boot-starter-thymeleaf</td><td align="center">é›†æˆ Thymeleaf è§†å›¾æ„å»º MVC web åº”ç”¨</td></tr><tr><td align="center">spring-boot-starter-freemarker</td><td align="center">é›†æˆ FreeMarker è§†å›¾æ„å»º MVC web åº”ç”¨</td></tr><tr><td align="center">spring-boot-starter-groovy-templates</td><td align="center">é›†æˆ Groovy æ¨¡æ¿è§†å›¾æ„å»º MVC web åº”ç”¨</td></tr><tr><td align="center">spring-boot-starter-hateoas</td><td align="center">é›†æˆ Spring MVC å’Œ Spring HATEOAS æ„å»ºè¶…åª’ä½“ RESTful Web åº”ç”¨ç¨‹åº</td></tr><tr><td align="center">spring-boot-starter-integration</td><td align="center">é›†æˆ Spring Integration</td></tr><tr><td align="center">spring-boot-starter-jdbc</td><td align="center">é›†æˆ JDBC ç»“åˆ HikariCP è¿æ¥æ± </td></tr><tr><td align="center">spring-boot-starter-jersey</td><td align="center">é›†æˆ JAX-RS å’Œ Jersey æ„å»º RESTful web åº”ç”¨ï¼Œæ˜¯ spring-boot-starter-web çš„ä¸€ä¸ªæ›¿ä»£ Starter</td></tr><tr><td align="center">spring-boot-starter-jooq</td><td align="center">é›†æˆ jOOQ è®¿é—® SQL æ•°æ®åº“ï¼Œæ˜¯ spring-boot-starter-data-jpa æˆ–è€… spring-boot-starter-jdbc çš„æ›¿ä»£ Starter</td></tr><tr><td align="center">spring-boot-starter-json</td><td align="center">ç”¨äºè¯»å†™ JSON</td></tr><tr><td align="center">spring-boot-starter-jta-atomikos</td><td align="center">é›†æˆ Atomikos å®ç° JTA äº‹åŠ¡</td></tr><tr><td align="center">spring-boot-starter-jta-bitronix</td><td align="center">é›†æˆ Bitronix å®ç° JTA äº‹åŠ¡ï¼ˆ ä» 2.3.0 å¼€å§‹æ ‡è¯†ä¸º <strong>Deprecated</strong>ï¼‰</td></tr><tr><td align="center">spring-boot-starter-mail</td><td align="center">é›†æˆ Java Mail å’Œ Spring æ¡†æ¶çš„é‚®ä»¶å‘é€åŠŸèƒ½</td></tr><tr><td align="center">spring-boot-starter-mustache</td><td align="center">é›†æˆ Mustache è§†å›¾æ„å»º web åº”ç”¨</td></tr><tr><td align="center">spring-boot-starter-security</td><td align="center">é›†æˆ Spring Security</td></tr><tr><td align="center">spring-boot-starter-oauth2-client</td><td align="center">é›†æˆ Spring Securityâ€™s OAuth2/OpenID è¿æ¥å®¢æˆ·ç«¯åŠŸèƒ½</td></tr><tr><td align="center">spring-boot-starter-oauth2-resource-server</td><td align="center">é›†æˆ Spring Securityâ€™s OAuth2 èµ„æºæœåŠ¡å™¨åŠŸèƒ½</td></tr><tr><td align="center">spring-boot-starter-quartz</td><td align="center">é›†æˆ Quartz ä»»åŠ¡è°ƒåº¦</td></tr><tr><td align="center">spring-boot-starter-rsocket</td><td align="center">æ„å»º RSocket å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</td></tr><tr><td align="center">spring-boot-starter-test</td><td align="center">é›†æˆ JUnit Jupiter, Hamcrest å’Œ Mockito æµ‹è¯• Spring Boot åº”ç”¨å’Œç±»åº“</td></tr><tr><td align="center">spring-boot-starter-validation</td><td align="center">é›†æˆ Java Bean Validation ç»“åˆ Hibernate Validator</td></tr><tr><td align="center">spring-boot-starter-web</td><td align="center">é›†æˆ Spring MVC æ„å»º RESTful web åº”ç”¨ï¼Œä½¿ç”¨ Tomcat ä½œä¸ºé»˜è®¤å†…åµŒå®¹å™¨</td></tr><tr><td align="center">spring-boot-starter-web-services</td><td align="center">é›†æˆ Spring Web Services</td></tr><tr><td align="center">spring-boot-starter-webflux</td><td align="center">é›†æˆ Spring Reactive Web æ„å»º WebFlux åº”ç”¨</td></tr><tr><td align="center">spring-boot-starter-websocket</td><td align="center">é›†æˆ Spring WebSocket æ„å»º WebSocket åº”ç”¨</td></tr></tbody></table><h4 id="2ã€production-startersï¼ˆç”Ÿäº§çº§ï¼‰"><a href="#2ã€production-startersï¼ˆç”Ÿäº§çº§ï¼‰" class="headerlink" title="2ã€production startersï¼ˆç”Ÿäº§çº§ï¼‰"></a>2ã€production startersï¼ˆç”Ÿäº§çº§ï¼‰</h4><p>ä¸‹é¢ç”Ÿäº§çº§ Starters èƒ½è¢«ç”¨äºçº¿ä¸Š/ç”Ÿäº§åŠŸèƒ½ï¼š</p><table><thead><tr><th align="center">Starter åç§°</th><th align="center">Starter æè¿°</th></tr></thead><tbody><tr><td align="center">spring-boot-starter-actuator</td><td align="center">é›†æˆ Spring Boot Actuatorï¼Œæä¾›ç”Ÿäº§åŠŸèƒ½ä»¥å¸®åŠ©ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åº</td></tr></tbody></table><h4 id="3ã€technical-startersï¼ˆæŠ€æœ¯çº§ï¼‰"><a href="#3ã€technical-startersï¼ˆæŠ€æœ¯çº§ï¼‰" class="headerlink" title="3ã€technical startersï¼ˆæŠ€æœ¯çº§ï¼‰"></a>3ã€technical startersï¼ˆæŠ€æœ¯çº§ï¼‰</h4><p>Spring Boot è¿˜åŒ…æ‹¬ä¸‹é¢çš„æŠ€æœ¯ç±» Startersï¼Œç”¨äºå¸®åŠ©ä½ æ’é™¤æˆ–è€…æ›¿æ¢æŒ‡å®šçš„æ¡†æ¶æˆ–æŠ€æœ¯ï¼š</p><table><thead><tr><th align="center">Starter åç§°</th><th align="center">Starter æè¿°</th></tr></thead><tbody><tr><td align="center">spring-boot-starter-jetty</td><td align="center">é›†æˆ Jetty ä½œä¸ºå†…åµŒçš„ servlet å®¹å™¨ï¼Œå¯ç”¨äºæ›¿ä»£ spring-boot-starter-tomcat</td></tr><tr><td align="center">spring-boot-starter-log4j2</td><td align="center">é›†æˆ Log4j2 æ—¥å¿—æ¡†æ¶ï¼Œå¯ç”¨äºæ›¿ä»£ spring-boot-starter-logging</td></tr><tr><td align="center">spring-boot-starter-logging</td><td align="center">é›†æˆ Logback æ—¥å¿—æ¡†æ¶ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é»˜è®¤çš„æ—¥å¿— Starter</td></tr><tr><td align="center">spring-boot-starter-reactor-netty</td><td align="center">é›†æˆ Netty ä½œä¸ºå†…åµŒçš„å“åº”å¼ HTTP æœåŠ¡å™¨</td></tr><tr><td align="center">spring-boot-starter-tomcat</td><td align="center">é›†æˆ Tomcat ä½œä¸ºå†…åµŒçš„ servlet å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„ servlet å®¹å™¨ starter è¢«é›†æˆ spring-boot-starter-web é‡Œé¢</td></tr><tr><td align="center">spring-boot-starter-undertow</td><td align="center">é›†æˆ Undertow ä½œä¸ºå†…åµŒçš„ servlet å®¹å™¨ï¼Œå¯ç”¨äºæ›¿ä»£ spring-boot-starter-tomcat</td></tr></tbody></table><p>æœ€æ–°è¯·å‚è€ƒï¼š</p><blockquote><p><a href="https://docs.spring.io/spring-boot/docs/" target="_blank" rel="noopener">ã€ŠSpringå®˜æ–¹æ–‡æ¡£æŸ¥é˜…ã€‹</a></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI3ODcxMzQzMw==&mid=2247490787&idx=1&sn=f9eb0b28ab7b29bbf77381be85c7a5b2&chksm=eb5399d5dc2410c37a7fd15b845ce53bcdb67f8308af75d7296cdc2b813aefe1723a8a888094&scene=21#wechat_redirect" target="_blank" rel="noopener">ã€Šå¹´è½»äººçš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰ Spring Boot Starterï¼ã€‹</a></p></blockquote><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å°†æ‹¦æˆªå™¨æ‰˜ç®¡ç»™IOCå®¹å™¨ï¼Ÿ</title>
    <url>/post/cb1b036e.html</url>
    <content><![CDATA[<blockquote><p>å¦‚ä½•å°†æ‹¦æˆªå™¨æ‰˜ç®¡ç»™IOCå®¹å™¨ ~</p></blockquote><a id="more"></a><h2 id="ä¸€ã€ç¬¬ä¸€ç§"><a href="#ä¸€ã€ç¬¬ä¸€ç§" class="headerlink" title="ä¸€ã€ç¬¬ä¸€ç§"></a>ä¸€ã€ç¬¬ä¸€ç§</h2><p>åœ¨æ‹¦æˆªå™¨ä¸Šä½¿ç”¨ @Component ï¼ŒåŒæ—¶åœ¨ WebConfiguration ä¸­ä½¿ç”¨ @Autowired æ³¨è§£å°†æ‹¦æˆªå™¨æ³¨å…¥ã€‚</p><p><strong>æ‹¦æˆªå™¨ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…ç½®ç±»ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginInterceptor loginInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(loginInterceptor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒã€ç¬¬äºŒç§"><a href="#äºŒã€ç¬¬äºŒç§" class="headerlink" title="äºŒã€ç¬¬äºŒç§"></a>äºŒã€ç¬¬äºŒç§</h2><p>åœ¨ WebConfiguration å°†æ‹¦æˆªå™¨æ³¨æˆbeanï¼Œæ‹¦æˆªå™¨æ— éœ€å¢åŠ  @Component æ³¨è§£ï¼Œåœ¨ WebConfiguration ç±»ä¸­ä½¿ç”¨ @Bean æ³¨è§£å°†æ‹¦æˆªå™¨æ³¨æˆbeanã€‚</p><p><strong>æ‹¦æˆªå™¨ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…ç½®ç±»ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LoginInterceptor <span class="title">loginInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor( loginInterceptor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€ç¬¬ä¸‰ç§"><a href="#ä¸‰ã€ç¬¬ä¸‰ç§" class="headerlink" title="ä¸‰ã€ç¬¬ä¸‰ç§"></a>ä¸‰ã€ç¬¬ä¸‰ç§</h2><p>é€šè¿‡æ„é€ å™¨å¤„ç†æ€è·¯æ˜¯åœ¨ WebConfiguration ç±»ä¸­æ³¨å…¥éœ€è¦çš„éªŒè¯ token çš„ä¸šåŠ¡ç±»ï¼Œç„¶ååœ¨åˆå§‹åŒ–æ‹¦æˆªå™¨çš„æ—¶å€™å°†ä¸šåŠ¡ç±»é€šè¿‡æ„é€ å™¨å¸¦å…¥æ‹¦æˆªå™¨ä¸­ï¼Œè¿™æ ·å°±ä¸ç”¨æŠŠæ‹¦æˆªå™¨æ³¨æˆSpring Beanå¯¹è±¡äº†ã€‚</p><p><strong>æ‹¦æˆªå™¨ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TokenUtil tokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginInterceptor</span><span class="params">(TokenUtil tokenUtil)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tokenUtil = tokenUtil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…ç½®ç±»ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenUtil tokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor(tokenUtil));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>ç½‘ä¸Šå…³äºæ‹¦æˆªå™¨çš„ä»£ç åŸºæœ¬éƒ½æ˜¯é€šè¿‡newä¸€ä¸ªæ‹¦æˆªå™¨è¿›è¡Œé…ç½®çš„ï¼Œè¿™æ—¶å€™å°±ä¼šå‡ºç°æ— æ³•æ³¨å…¥å…¶ä»–beançš„æƒ…å†µã€‚å¾ˆå¤šäººæƒ³å½“ç„¶åœ°ç›´æ¥åœ¨æ‹¦æˆªå™¨åŠ  @Component æ³¨è§£ä½¿å…¶æˆä¸ºä¸€ä¸ªbeanå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ç§é”™è¯¯çš„åšæ³•ã€‚</p><p>æˆ‘ä»¬éœ€è¦ä¿è¯çš„æ˜¯ åœ¨WebMvcé…ç½®ç±»ä¸­æ·»åŠ çš„æ‹¦æˆªå™¨æ˜¯Spring çš„ä¸€ä¸ªbeanå¯¹è±¡ ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å°†æ‹¦æˆªå™¨æ³¨æˆä¸€ä¸ªbeanï¼ŒåŒæ—¶å°†è¿™ä¸ªbeanæ·»åŠ çš„WebMvcé…ç½®ç±»ä¸­ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨ArrayListï¼Œè¿™å‡ ç‚¹ä¸€å®šè¦æ³¨æ„ï¼</title>
    <url>/post/25419109.html</url>
    <content><![CDATA[<blockquote><p>ArrayList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™ç‚¹å¾ˆå¤šäººéƒ½çŸ¥é“ï¼Œä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„åŸå› åŠè¡¨ç°ï¼Œæ€ä¹ˆåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä½¿ç”¨ArrayListï¼Œå¯èƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p></blockquote><a id="more"></a><h3 id="ä¸€ã€çº¿ç¨‹ä¸å®‰å…¨çš„ä¸¤ç§ä½“ç°"><a href="#ä¸€ã€çº¿ç¨‹ä¸å®‰å…¨çš„ä¸¤ç§ä½“ç°" class="headerlink" title="ä¸€ã€çº¿ç¨‹ä¸å®‰å…¨çš„ä¸¤ç§ä½“ç°"></a>ä¸€ã€çº¿ç¨‹ä¸å®‰å…¨çš„ä¸¤ç§ä½“ç°</h3><p>æŸ¥çœ‹ ArrayList çš„ add æ“ä½œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Appends the specified element to the end of this list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e element to be appended to this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;tt&gt;true&lt;/tt&gt; (as specified by &#123;<span class="doctag">@link</span> Collection#add&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­åˆ—è¡¨çš„capacityå®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œæ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">      ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">      <span class="comment">// å°†å…ƒç´ æ·»åŠ è¿›åˆ—è¡¨çš„å…ƒç´ æ•°ç»„é‡Œé¢</span></span><br><span class="line">      elementData[size++] = e;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-æ•°ç»„è¶Šç•Œå¼‚å¸¸-ArrayIndexOutOfBoundsException"><a href="#1-æ•°ç»„è¶Šç•Œå¼‚å¸¸-ArrayIndexOutOfBoundsException" class="headerlink" title="1. æ•°ç»„è¶Šç•Œå¼‚å¸¸ ArrayIndexOutOfBoundsException"></a>1. æ•°ç»„è¶Šç•Œå¼‚å¸¸ ArrayIndexOutOfBoundsException</h4><p>ç”±äºArrayListæ·»åŠ å…ƒç´ æ˜¯å¦‚ä¸Šé¢åˆ†ä¸¤æ­¥è¿›è¡Œï¼Œå¯ä»¥çœ‹å‡ºç¬¬ä¸€ä¸ªä¸å®‰å…¨çš„éšæ‚£ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹è¿›è¡Œaddæ“ä½œæ—¶å¯èƒ½ä¼šå¯¼è‡´elementDataæ•°ç»„è¶Šç•Œã€‚</p><p>å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>åˆ—è¡¨å¤§å°ä¸º9ï¼Œå³size=9</li><li>çº¿ç¨‹Aå¼€å§‹è¿›å…¥addæ–¹æ³•ï¼Œè¿™æ—¶å®ƒè·å–åˆ°sizeçš„å€¼ä¸º9ï¼Œè°ƒç”¨ensureCapacityInternalæ–¹æ³•è¿›è¡Œå®¹é‡åˆ¤æ–­ã€‚</li><li>çº¿ç¨‹Bæ­¤æ—¶ä¹Ÿè¿›å…¥addæ–¹æ³•ï¼Œå®ƒè·å–åˆ°sizeçš„å€¼ä¹Ÿä¸º9ï¼Œä¹Ÿå¼€å§‹è°ƒç”¨ensureCapacityInternalæ–¹æ³•ã€‚</li><li>çº¿ç¨‹Aå‘ç°éœ€æ±‚å¤§å°ä¸º10ï¼Œè€ŒelementDataçš„å¤§å°å°±ä¸º10ï¼Œå¯ä»¥å®¹çº³ã€‚äºæ˜¯å®ƒä¸å†æ‰©å®¹ï¼Œè¿”å›ã€‚</li><li>çº¿ç¨‹Bä¹Ÿå‘ç°éœ€æ±‚å¤§å°ä¸º10ï¼Œä¹Ÿå¯ä»¥å®¹çº³ï¼Œè¿”å›ã€‚</li><li>çº¿ç¨‹Aå¼€å§‹è¿›è¡Œè®¾ç½®å€¼æ“ä½œï¼Œ elementData[size++] = e æ“ä½œã€‚æ­¤æ—¶sizeå˜ä¸º10ã€‚</li><li>çº¿ç¨‹Bä¹Ÿå¼€å§‹è¿›è¡Œè®¾ç½®å€¼æ“ä½œï¼Œå®ƒå°è¯•è®¾ç½®elementData[10] = eï¼Œè€ŒelementDataæ²¡æœ‰è¿›è¡Œè¿‡æ‰©å®¹ï¼Œå®ƒçš„ä¸‹æ ‡æœ€å¤§ä¸º9ã€‚äºæ˜¯æ­¤æ—¶ä¼šæŠ¥å‡ºä¸€ä¸ªæ•°ç»„è¶Šç•Œçš„å¼‚å¸¸ArrayIndexOutOfBoundsException.</li></ol><h4 id="2-å…ƒç´ å€¼è¦†ç›–å’Œä¸ºç©ºé—®é¢˜"><a href="#2-å…ƒç´ å€¼è¦†ç›–å’Œä¸ºç©ºé—®é¢˜" class="headerlink" title="2. å…ƒç´ å€¼è¦†ç›–å’Œä¸ºç©ºé—®é¢˜"></a>2. å…ƒç´ å€¼è¦†ç›–å’Œä¸ºç©ºé—®é¢˜</h4><p>elementData[size++] = e è®¾ç½®å€¼çš„æ“ä½œåŒæ ·ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚ä»è¿™å„¿å¯ä»¥çœ‹å‡ºï¼Œè¿™æ­¥æ“ä½œä¹Ÿä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒç”±å¦‚ä¸‹ä¸¤æ­¥æ“ä½œæ„æˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">elementData[size] = e;</span><br><span class="line">size = size + <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>åœ¨å•çº¿ç¨‹æ‰§è¡Œè¿™ä¸¤æ¡ä»£ç æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å½“å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œæ—¶ï¼Œå¯èƒ½å°±ä¼šå‘ç”Ÿä¸€ä¸ªçº¿ç¨‹çš„å€¼è¦†ç›–å¦ä¸€ä¸ªçº¿ç¨‹æ·»åŠ çš„å€¼ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>åˆ—è¡¨å¤§å°ä¸º0ï¼Œå³size=0</li><li>çº¿ç¨‹Aå¼€å§‹æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå€¼ä¸ºAã€‚æ­¤æ—¶å®ƒæ‰§è¡Œç¬¬ä¸€æ¡æ“ä½œï¼Œå°†Aæ”¾åœ¨äº†elementDataä¸‹æ ‡ä¸º0çš„ä½ç½®ä¸Šã€‚</li><li>æ¥ç€çº¿ç¨‹Båˆšå¥½ä¹Ÿè¦å¼€å§‹æ·»åŠ ä¸€ä¸ªå€¼ä¸ºBçš„å…ƒç´ ï¼Œä¸”èµ°åˆ°äº†ç¬¬ä¸€æ­¥æ“ä½œã€‚æ­¤æ—¶çº¿ç¨‹Bè·å–åˆ°sizeçš„å€¼ä¾ç„¶ä¸º0ï¼Œäºæ˜¯å®ƒå°†Bä¹Ÿæ”¾åœ¨äº†elementDataä¸‹æ ‡ä¸º0çš„ä½ç½®ä¸Šã€‚</li><li>çº¿ç¨‹Aå¼€å§‹å°†sizeçš„å€¼å¢åŠ ä¸º1</li><li>çº¿ç¨‹Bå¼€å§‹å°†sizeçš„å€¼å¢åŠ ä¸º2</li></ol><p>è¿™æ ·çº¿ç¨‹ABæ‰§è¡Œå®Œæ¯•åï¼Œç†æƒ³ä¸­æƒ…å†µä¸ºsizeä¸º2ï¼ŒelementDataä¸‹æ ‡0çš„ä½ç½®ä¸ºAï¼Œä¸‹æ ‡1çš„ä½ç½®ä¸ºBã€‚è€Œå®é™…æƒ…å†µå˜æˆäº†sizeä¸º2ï¼ŒelementDataä¸‹æ ‡ä¸º0çš„ä½ç½®å˜æˆäº†Bï¼Œä¸‹æ ‡1çš„ä½ç½®ä¸Šä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚å¹¶ä¸”åç»­é™¤éä½¿ç”¨setæ–¹æ³•ä¿®æ”¹æ­¤ä½ç½®çš„å€¼ï¼Œå¦åˆ™å°†ä¸€ç›´ä¸ºnullï¼Œå› ä¸ºsizeä¸º2ï¼Œæ·»åŠ å…ƒç´ æ—¶ä¼šä»ä¸‹æ ‡ä¸º2çš„ä½ç½®ä¸Šå¼€å§‹ã€‚</p><h3 id="äºŒã€ä»£ç éªŒè¯ç¤ºä¾‹"><a href="#äºŒã€ä»£ç éªŒè¯ç¤ºä¾‹" class="headerlink" title="äºŒã€ä»£ç éªŒè¯ç¤ºä¾‹"></a>äºŒã€ä»£ç éªŒè¯ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * https://mp.weixin.qq.com/s/LLldnqyCQKEutwmNXXDSnA</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ArrayList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™ç‚¹å¾ˆå¤šäººéƒ½çŸ¥é“ï¼Œä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„åŸå› åŠè¡¨ç°ï¼Œæ€ä¹ˆåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä½¿ç”¨ArrayListï¼Œå¯èƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/1 16:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListSafeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// çº¿ç¨‹Aå°†1-1000æ·»åŠ åˆ°åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                list.add(i);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹Bå°†1001-2000æ·»åŠ åˆ°åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1001</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">                list.add(i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°æ‰€æœ‰ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ç¬¬"</span> + (i + <span class="number">1</span>) + <span class="string">"ä¸ªå…ƒç´ ä¸ºï¼š"</span> + list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸¤ç§æƒ…å†µå‡ºç°å¦‚ä¸‹ï¼š</p><ol><li><p>å…ƒç´ å€¼è¦†ç›–å’Œä¸ºç©ºé—®é¢˜</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210201171141.png" alt=""></p></li><li><p>æŠ¥æ•°ç»„è¶Šç•Œå¼‚å¸¸ ArrayIndexOutOfBoundsExceptioné”™è¯¯</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210201171152.png" alt=""></p></li></ol><h3 id="ä¸‰ã€ArrayListçº¿ç¨‹å®‰å…¨å¤„ç†"><a href="#ä¸‰ã€ArrayListçº¿ç¨‹å®‰å…¨å¤„ç†" class="headerlink" title="ä¸‰ã€ArrayListçº¿ç¨‹å®‰å…¨å¤„ç†"></a>ä¸‰ã€ArrayListçº¿ç¨‹å®‰å…¨å¤„ç†</h3><ol><li><p><strong>Collections.synchronizedList</strong></p><p>æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯<strong>é€šè¿‡ Collections çš„ synchronizedList æ–¹æ³•</strong>å°† ArrayList è½¬æ¢æˆçº¿ç¨‹å®‰å…¨çš„å®¹å™¨åå†ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Object&gt; list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸ºlist.add()æ–¹æ³•åŠ é”</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(list.get()) &#123;</span><br><span class="line">	  list.get().add(model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>CopyOnWriteArrayList</strong></p><p>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ CopyOnWriteArrayList ä»£æ›¿çº¿ç¨‹ä¸å®‰å…¨çš„ ArrayListã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Object&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;Object&gt;();</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ThreadLocal</strong></p><p>ä½¿ç”¨ThreadLocalå˜é‡ç¡®ä¿çº¿ç¨‹å°é—­æ€§(å°é—­çº¿ç¨‹å¾€å¾€æ˜¯æ¯”è¾ƒå®‰å…¨çš„ï¼Œ ä½†ç”±äºä½¿ç”¨ThreadLocalå°è£…å˜é‡ï¼Œç›¸å½“äºæŠŠå˜é‡ä¸¢è¿›æ‰§è¡Œçº¿ç¨‹ä¸­å»ï¼Œæ¯newä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå˜é‡ä¹Ÿä¼šnewä¸€æ¬¡ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¼šé€ æˆæ€§èƒ½[å†…å­˜]æŸè€—ï¼Œä½†å…¶æ‰§è¡Œå®Œæ¯•å°±é”€æ¯çš„æœºåˆ¶ä½¿å¾—ThreadLocalå˜æˆæ¯”è¾ƒä¼˜åŒ–çš„å¹¶å‘è§£å†³æ–¹æ¡ˆ)ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadLocal&lt;List&lt;Object&gt;&gt; threadList = <span class="keyword">new</span> ThreadLocal&lt;List&lt;Object&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">protected</span> List&lt;Object&gt; <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">         &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></li></ol><p>æœ€åå¦‚æœåœ¨ä»£ç çš„ä¾‹å­é‡Œä½¿ç”¨ä»¥ä¸Šå››ç§æ–¹æ³•çš„è¯ï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œæ­£å¸¸ä½¿ç”¨ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>MultiThread</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisç¼“å­˜å’ŒMySQLæ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆ</title>
    <url>/post/58a4e3a.html</url>
    <content><![CDATA[<blockquote><p>Redisç¼“å­˜å’ŒMySQLæ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆè¯¦è§£ ~</p></blockquote><a id="more"></a><h2 id="éœ€æ±‚èµ·å› "><a href="#éœ€æ±‚èµ·å› " class="headerlink" title="éœ€æ±‚èµ·å› "></a><strong>éœ€æ±‚èµ·å› </strong></h2><p>åœ¨é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ç”¨æˆ·å¹¶å‘è®¿é—®æœ€è–„å¼±çš„ç¯èŠ‚ã€‚æ‰€ä»¥ï¼Œå°±éœ€è¦ä½¿ç”¨redisåšä¸€ä¸ªç¼“å†²æ“ä½œï¼Œè®©è¯·æ±‚å…ˆè®¿é—®åˆ°redisï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®MySQLç­‰æ•°æ®åº“ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210203113618.jpeg" alt=""></p><p>è¿™ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œä¸»è¦æ˜¯è§£å†³è¯»æ•°æ®ä»Redisç¼“å­˜ï¼Œä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§ä¸‹å›¾çš„æµç¨‹æ¥è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210203113611.jpeg" alt=""></p><p>è¯»å–ç¼“å­˜æ­¥éª¤ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°æ•°æ®æ›´æ–°ï¼šæ•°æ®åº“å’Œç¼“å­˜æ›´æ–°ï¼Œå°±å®¹æ˜“å‡ºç° <strong>ç¼“å­˜(Redis)å’Œæ•°æ®åº“ï¼ˆMySQLï¼‰é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong>ã€‚</p><p>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><ol><li><p>å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p></li><li><p>å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</p></li></ol><p>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>å¦‚æ¥è§£å†³ï¼Ÿè¿™é‡Œç»™å‡ºä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…ˆæ˜“åéš¾ï¼Œç»“åˆä¸šåŠ¡å’ŒæŠ€æœ¯ä»£ä»·é€‰æ‹©ä½¿ç”¨ã€‚</p><h2 id="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"></a>ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ</h2><h4 id="ä¸€ã€é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥"><a href="#ä¸€ã€é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥" class="headerlink" title="ä¸€ã€é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥"></a><strong>ä¸€ã€é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥</strong></h4><p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œredis.del(key)æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚</p><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String key,Object data)</span></span>&#123;</span><br><span class="line"> 	redis.delKey(key);</span><br><span class="line"> 	db.updateData(data);</span><br><span class="line"> 	Thread.sleep(<span class="number">500</span>);</span><br><span class="line"> 	redis.delKey(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1. å…·ä½“çš„æ­¥éª¤å°±æ˜¯ï¼š</strong></p><p>1ï¼‰å…ˆåˆ é™¤ç¼“å­˜</p><p>2ï¼‰å†å†™æ•°æ®åº“</p><p>3ï¼‰ä¼‘çœ 500æ¯«ç§’</p><p>4ï¼‰å†æ¬¡åˆ é™¤ç¼“å­˜</p><p><strong>é‚£ä¹ˆï¼Œè¿™ä¸ª500æ¯«ç§’æ€ä¹ˆç¡®å®šçš„ï¼Œå…·ä½“è¯¥ä¼‘çœ å¤šä¹…å‘¢ï¼Ÿ</strong></p><p>éœ€è¦è¯„ä¼°è‡ªå·±çš„é¡¹ç›®çš„è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶ã€‚è¿™ä¹ˆåšçš„ç›®çš„ï¼Œå°±æ˜¯ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ã€‚</p><p>å½“ç„¶è¿™ç§ç­–ç•¥è¿˜è¦è€ƒè™‘rediså’Œæ•°æ®åº“ä¸»ä»åŒæ­¥çš„è€—æ—¶ã€‚æœ€åçš„çš„å†™æ•°æ®çš„ä¼‘çœ æ—¶é—´ï¼šåˆ™åœ¨è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶åŸºç¡€ä¸Šï¼ŒåŠ å‡ ç™¾mså³å¯ã€‚æ¯”å¦‚ï¼šä¼‘çœ 1ç§’ã€‚</p><p><strong>2.è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</strong></p><p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰çš„å†™æ“ä½œä»¥æ•°æ®åº“ä¸ºå‡†ï¼Œåªè¦åˆ°è¾¾ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œåˆ™åé¢çš„è¯»è¯·æ±‚è‡ªç„¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æ–°å€¼ç„¶åå›å¡«ç¼“å­˜ã€‚ç»“åˆåŒåˆ ç­–ç•¥+ç¼“å­˜è¶…æ—¶è®¾ç½®ï¼Œè¿™æ ·æœ€å·®çš„æƒ…å†µå°±æ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ï¼Œè€Œä¸”åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</p><p><strong>3.å¦‚ä½•å†™å®Œæ•°æ®åº“åï¼Œå†æ¬¡åˆ é™¤ç¼“å­˜æˆåŠŸï¼Ÿ</strong></p><p><em>ä¸Šè¿°çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ“ä½œå®Œæ•°æ®åº“åï¼Œç”±äºç§ç§åŸå› åˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œè¿™æ—¶ï¼Œå¯èƒ½å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªä¿éšœé‡è¯•çš„æ–¹æ¡ˆã€‚</em></p><p>â€‹ <strong><em>1ã€æ–¹æ¡ˆä¸€ï¼š</em></strong></p><p>å»¶è¿ŸåŒåˆ ï¼Œæ·»åŠ é‡è¯•æœºåˆ¶ã€‚<br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210203142333.jpeg" alt=""></p><p>â€‹ ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</p><p>â€‹ ï¼ˆ2ï¼‰ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥ï¼›</p><p>â€‹ ï¼ˆ3ï¼‰å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼›</p><p>â€‹ ï¼ˆ4ï¼‰è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„keyï¼›</p><p>â€‹ ï¼ˆ5ï¼‰ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸã€‚</p><p>â€‹ <font color="red"><strong>ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚äºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œåœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚</strong></font></p><p>â€‹ <strong><em>2ã€æ–¹æ¡ˆäºŒï¼š</em></strong></p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210203142328.jpeg" alt=""></p><p>â€‹ ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</p><p>â€‹ ï¼ˆ2ï¼‰æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥binlogæ—¥å¿—å½“ä¸­ï¼›</p><p>â€‹ ï¼ˆ3ï¼‰è®¢é˜…ç¨‹åºæå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠkeyï¼›</p><p>â€‹ ï¼ˆ4ï¼‰å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œè·å¾—è¯¥ä¿¡æ¯ï¼›</p><p>â€‹ ï¼ˆ5ï¼‰å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œå‘ç°åˆ é™¤å¤±è´¥ï¼›</p><p>â€‹ ï¼ˆ6ï¼‰å°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼›</p><p>â€‹ ï¼ˆ7ï¼‰é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œã€‚</p><p>ä»¥ä¸Šæ–¹æ¡ˆéƒ½æ˜¯åœ¨ä¸šåŠ¡ä¸­ç»å¸¸ä¼šç¢°åˆ°çš„åœºæ™¯ï¼Œå¯ä»¥ä¾æ®ä¸šåŠ¡åœºæ™¯çš„å¤æ‚å’Œå¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ¥é€‰æ‹©å…·ä½“çš„æ–¹æ¡ˆã€‚</p><hr><h4 id="äºŒã€å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶"><a href="#äºŒã€å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" class="headerlink" title="äºŒã€å¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)"></a><strong>äºŒã€å¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</strong></h4><p>â€‹ <strong>1.æŠ€æœ¯æ•´ä½“æ€è·¯ï¼š</strong></p><p>â€‹ MySQL binlogå¢é‡è®¢é˜…æ¶ˆè´¹+æ¶ˆæ¯é˜Ÿåˆ—+å¢é‡æ•°æ®æ›´æ–°åˆ°redis</p><p>â€‹ <strong>1ï¼‰è¯»Redis</strong>ï¼šçƒ­æ•°æ®åŸºæœ¬éƒ½åœ¨Redis</p><p>â€‹ <strong>2ï¼‰å†™MySQL</strong>:å¢åˆ æ”¹éƒ½æ˜¯æ“ä½œMySQL</p><p>â€‹ <strong>3ï¼‰æ›´æ–°Redisæ•°æ®</strong>ï¼šMySQçš„æ•°æ®æ“ä½œbinlogï¼Œæ¥æ›´æ–°åˆ°Redis</p><p>â€‹ <strong>2.Redisæ›´æ–°</strong></p><p>â€‹ <strong>1ï¼‰æ•°æ®æ“ä½œä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š</strong></p><ul><li>ä¸€ä¸ªæ˜¯å…¨é‡(å°†å…¨éƒ¨æ•°æ®ä¸€æ¬¡å†™å…¥åˆ°redis)</li><li>ä¸€ä¸ªæ˜¯å¢é‡ï¼ˆå®æ—¶æ›´æ–°ï¼‰</li></ul><p>è¿™é‡Œè¯´çš„æ˜¯å¢é‡,æŒ‡çš„æ˜¯mysqlçš„updateã€insertã€delateå˜æ›´æ•°æ®ã€‚</p><p>â€‹ <strong>2ï¼‰è¯»å–binlogååˆ†æ ï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—,æ¨é€æ›´æ–°å„å°çš„redisç¼“å­˜æ•°æ®ã€‚</strong></p><p>â€‹ è¿™æ ·ä¸€æ—¦MySQLä¸­äº§ç”Ÿäº†æ–°çš„å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå°±å¯ä»¥æŠŠbinlogç›¸å…³çš„æ¶ˆæ¯æ¨é€è‡³Redisï¼ŒRediså†æ ¹æ®binlogä¸­çš„è®°å½•ï¼Œå¯¹Redisè¿›è¡Œæ›´æ–°ã€‚</p><p>â€‹ å…¶å®è¿™ç§æœºåˆ¶ï¼Œå¾ˆç±»ä¼¼MySQLçš„ä¸»ä»å¤‡ä»½æœºåˆ¶ï¼Œå› ä¸ºMySQLçš„ä¸»å¤‡ä¹Ÿæ˜¯é€šè¿‡binlogæ¥å®ç°çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>â€‹ è¿™é‡Œå¯ä»¥ç»“åˆä½¿ç”¨ <strong>Canal ( é˜¿é‡Œçš„ä¸€æ¬¾å¼€æºæ¡†æ¶ )</strong>ï¼Œé€šè¿‡è¯¥æ¡†æ¶å¯ä»¥å¯¹MySQLçš„binlogè¿›è¡Œè®¢é˜…ï¼Œè€Œcanalæ­£æ˜¯æ¨¡ä»¿äº†mysqlçš„slaveæ•°æ®åº“çš„å¤‡ä»½è¯·æ±‚ï¼Œä½¿å¾—Redisçš„æ•°æ®æ›´æ–°è¾¾åˆ°äº†ç›¸åŒçš„æ•ˆæœã€‚</p><blockquote><p>ç›¸å…³çš„ä¸­é—´ä»¶æœ‰ï¼š</p><ol><li><strong>canal</strong>ï¼šæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼Œçº¯Javaå¼€å‘,åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ï¼Œç›®å‰ä¸»è¦æ”¯æŒäº†MySQLã€‚</li><li><strong>otter</strong>ï¼šä¹Ÿæ˜¯é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“åŒæ­¥ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯åœ¨è·¨æœºæˆ¿æ•°æ®åº“åŒæ­¥æ–¹é¢ï¼Œæœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒæ˜¯åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œå®æ—¶å°†æ•°æ®åŒæ­¥åˆ°æœ¬æœºæˆ¿æˆ–è·¨æœºæˆ¿çš„mysql/oracleæ•°æ®åº“ã€‚</li></ol><p><strong>ä»¥ä¸Šä¸¤è€…çš„åŒºåˆ«åœ¨äº</strong>ï¼š</p><p><strong>otter</strong>ç›®å‰åµŒå…¥å¼ä¾èµ–canalï¼Œéƒ¨ç½²ä¸ºåŒä¸€ä¸ªjvmï¼Œç›®å‰è®¾è®¡ä¸ºä¸äº§ç”Ÿ<code>Relay Log</code>ã€‚ <a href="https://blog.csdn.net/weixin_32639437/article/details/113333981" target="_blank" rel="noopener">MySqlçš„æ—¥å¿—æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ</a></p><p><strong>otter</strong>ç›®å‰å…è®¸è‡ªå®šä¹‰åŒæ­¥é€»è¾‘ï¼Œè§£å†³å„ç±»éœ€æ±‚ã€‚</p></blockquote><p>å½“ç„¶ï¼Œè¿™é‡Œçš„æ¶ˆæ¯æ¨é€å·¥å…·ä½ ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ«çš„ç¬¬ä¸‰æ–¹ï¼škafkaã€rabbitMQç­‰æ¥å®ç°æ¨é€æ›´æ–°Redisã€‚</p><p>â€‹ <strong>3.è¯¥æ–¹æ¡ˆä¼˜ç¼ºç‚¹</strong></p><p>â€‹ è¯¥æ–¹æ¡ˆä¼˜ç‚¹ï¼šèƒ½ä¿è¯ä¸€è‡´ï¼›è¯¥æ–¹æ¡ˆç¼ºç‚¹ï¼šæ•°æ®åº“ä¸­é—´ä»¶çš„æˆæœ¬è¾ƒé«˜</p><hr><h4 id="ä¸‰ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§ï¼Ÿ"><a href="#ä¸‰ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="ä¸‰ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§ï¼Ÿ"></a>ä¸‰ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§ï¼Ÿ</h4><p>æ²¡æœ‰åŠæ³•åšåˆ°ç»å¯¹çš„ä¸€è‡´æ€§ï¼Œè¿™æ˜¯ç”±CAPç†è®ºå†³å®šçš„ï¼Œç¼“å­˜ç³»ç»Ÿé€‚ç”¨çš„åœºæ™¯å°±æ˜¯éå¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—å§”æ›²æ±‚å…¨ï¼Œå¯ä»¥å»åšåˆ°BASEç†è®ºä¸­è¯´çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚<br>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p><p><strong>å¦‚æœæ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹æœ€å¥½æ¨èå¤§å®¶ä½¿ç”¨å¼€æºçš„ä¸­é—´ä»¶å»ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼›</strong></p><p>ä»¥ä¸Šå°±æ˜¯Rediså’ŒMySQLæ•°æ®ä¸€è‡´æ€§è¯¦è§£ï¼Œç›¸å…³çš„MySQLæ•°æ®åº“ä¸»ä»åŒæ­¥ä¸€è‡´æ€§å¯ä»¥å‚è€ƒï¼š</p><p><a href="https://www.cnblogs.com/syncnavigator/p/10189655.html" target="_blank" rel="noopener">ã€Šé«˜å¹¶å‘æ¶æ„ç³»åˆ—ï¼šæ•°æ®åº“ä¸»ä»åŒæ­¥çš„3ç§ä¸€è‡´æ€§æ–¹æ¡ˆå®ç°ï¼Œä¼˜åŠ£æ¯”è¾ƒã€‹</a></p><p><a href="https://www.cnblogs.com/rjzheng/p/9041659.html" target="_blank" rel="noopener">ã€Š<a href="https://www.cnblogs.com/rjzheng/p/9041659.html" target="_blank" rel="noopener">åˆ†å¸ƒå¼ä¹‹æ•°æ®åº“å’Œç¼“å­˜åŒå†™ä¸€è‡´æ€§æ–¹æ¡ˆè§£æã€‹</a></a></p><p><a href="https://juejin.cn/post/6965876741160042532" target="_blank" rel="noopener">ã€Šå…³äºç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œæˆ‘æ˜¯è¿™ä¹ˆå›ç­”çš„ï¼ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå†…å­˜æ¨¡å‹</title>
    <url>/post/c2d38e6e.html</url>
    <content><![CDATA[<blockquote><p>JVMçš„å†…å­˜æ¨¡å‹æ˜¯javaè¯­è¨€ç»•ä¸å¼€çš„ä¸€ä¸ªè¯é¢˜ã€‚è¦è¿›è¡Œjavaçš„æ€§èƒ½è°ƒä¼˜ï¼Œé¦–å…ˆå°±è¦äº†è§£å…¶å†…å­˜æ¨¡å‹ã€‚æœ¬ç¯‡æ–‡ç« ç®€å•ä»‹ç»JVMå†…å­˜æ¨¡å‹çš„æ¦‚å¿µï¼Œç»“æ„å’Œå¯¹åº”çš„å‚æ•°è®¾ç½® ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€JVMå†…å­˜ç»“æ„"><a href="#ä¸€ã€JVMå†…å­˜ç»“æ„" class="headerlink" title="ä¸€ã€JVMå†…å­˜ç»“æ„"></a>ä¸€ã€JVMå†…å­˜ç»“æ„</h3><p>JVMçš„å†…å­˜ç©ºé—´åˆ†ä¸º3å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯å †å†…å­˜ã€æ–¹æ³•åŒºå’Œæ ˆå†…å­˜ã€‚å…¶ä¸­æ ˆå†…å­˜å¯ä»¥å†ç»†åˆ†ä¸ºjavaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚å †å†…å­˜å¯ä»¥åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚æ–°ç”Ÿä»£ä¸­è¿˜å¯ä»¥å†æ¬¡åˆ’åˆ†ä¸ºEdenåŒºã€From SurvivoråŒºå’ŒTo SurvivoråŒºã€‚åˆ’åˆ†å‡ºæ¥çš„å„ä¸ªåŒºï¼Œåˆ†åˆ«ä¿å­˜ä¸åŒçš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¶é‡‡å–çš„å†…å­˜å›æ”¶ç­–ç•¥ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><h3 id="äºŒã€JVMå†…å­˜åŒºåŸŸåˆ’åˆ†"><a href="#äºŒã€JVMå†…å­˜åŒºåŸŸåˆ’åˆ†" class="headerlink" title="äºŒã€JVMå†…å­˜åŒºåŸŸåˆ’åˆ†"></a>äºŒã€JVMå†…å­˜åŒºåŸŸåˆ’åˆ†</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/49b9965bd1dbbeb7532bc0462cb40c22.png" alt="JVMå†…å­˜åŒºåŸŸåˆ’åˆ†"></p><h4 id="1-ç¨‹åºè®¡æ•°å™¨-Program-Counter-Register"><a href="#1-ç¨‹åºè®¡æ•°å™¨-Program-Counter-Register" class="headerlink" title="1.ç¨‹åºè®¡æ•°å™¨ (Program Counter Register)"></a><strong>1.ç¨‹åºè®¡æ•°å™¨ (Program Counter Register)</strong></h4><p>â€‹ ç¨‹åºè®¡æ•°å™¨ï¼Œä¹Ÿæœ‰ç§°ä½œä¸ºPCå¯„å­˜å™¨ï¼›</p><ol><li>æ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ã€‚çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯æ¡çº¿ç¨‹éƒ½è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ã€‚</li><li>å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰å†…å­˜æº¢å‡ºåŒºåŸŸã€‚</li><li>æ‰§è¡Œ Java æ–¹æ³•æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶ï¼Œä¸ºç©ºã€‚</li></ol><h4 id="2-è™šæ‹Ÿæœºæ ˆ-VM-Stack"><a href="#2-è™šæ‹Ÿæœºæ ˆ-VM-Stack" class="headerlink" title="2. è™šæ‹Ÿæœºæ ˆ (VM Stack)"></a><strong>2. è™šæ‹Ÿæœºæ ˆ (VM Stack)</strong></h4><p>â€‹ è™šæ‹Ÿæœºæ ˆï¼ˆJava Vitual Machine Stackï¼‰ï¼Œä¹Ÿç§°ä½œJavaæ ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸æ‰€è¯´çš„æ ˆã€‚</p><ol><li>Java è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰ï¼Œ ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œ åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™å°±ä¼š åˆ›å»ºä¸€ä¸ª java è™šæ‹Ÿæœºæ ˆ ã€‚</li><li>è™šæ‹Ÿæœºæ‰§è¡Œ java ç¨‹åºçš„æ—¶å€™ï¼Œ æ¯ä¸ªæ–¹æ³•éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œ æ ˆå¸§å­˜æ”¾åœ¨ javaè™šæ‹Ÿæœºæ ˆä¸­ï¼Œ é€šè¿‡å‹æ ˆå‡ºæ ˆçš„æ–¹å¼è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚<br>æ ˆå¸§åˆåˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªåŒºåŸŸï¼š å±€éƒ¨å˜é‡è¡¨ã€ æ“ä½œæ•°æ ˆã€ åŠ¨æ€è¿æ¥ã€ æ–¹æ³•å‡ºå£ç­‰ã€‚</li><li>æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li>æè¿° java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ã€‚</li></ol><h4 id="3-æœ¬åœ°æ–¹æ³•æ ˆ-Native-Method-Stack"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ-Native-Method-Stack" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆ (Native Method Stack)"></a><strong>3. æœ¬åœ°æ–¹æ³•æ ˆ (Native Method Stack)</strong></h4><ol><li>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå…¶åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰ æœåŠ¡ï¼Œ è€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆæ·±åº¦æº¢å‡ºæˆ–è€…æ ˆæ‰©å±•å¤±è´¥æ—¶ï¼Œä¹Ÿä¼šåˆ†åˆ«æŠ›å‡º StackOverflowError å’Œ OutOfMemoryErrorå¼‚å¸¸ã€‚</li></ol><h4 id="4-æ–¹æ³•åŒº-Method-Area"><a href="#4-æ–¹æ³•åŒº-Method-Area" class="headerlink" title="4. æ–¹æ³•åŒº(Method Area)"></a><strong>4. æ–¹æ³•åŒº(Method Area)</strong></h4><ol><li>æ–¹æ³•åŒºä¹Ÿç§°â€œæ°¸ä¹…ä»£â€ï¼Œ å®ƒç”¨äºå­˜å‚¨è¢« JVM åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œæ°¸ä¹…ä»£æ˜¯ä¸€ç‰‡è¿ç»­çš„å †ç©ºé—´ã€‚</li><li>è¿è¡Œæ—¶å¸¸é‡æ± (Runtime Constant Pool)æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ä¹Ÿåœ¨å…¶ä¸­</li><li>éšç€ JDK8 çš„åˆ°æ¥ï¼Œ æ’¤é”€æ°¸ä¹…ä»£ï¼Œå¼•å…¥å…ƒç©ºé—´ã€‚</li></ol><h4 id="5-å †-Heap"><a href="#5-å †-Heap" class="headerlink" title="5. å †(Heap)"></a>5. <strong>å †(Heap)</strong></h4><ol><li><p>Java å †ï¼ˆJava Heapï¼‰ æ˜¯ Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚</p></li><li><p>å †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œ æ˜¯åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºçš„ã€‚ å †é‡Œé¢å­˜æ”¾çš„éƒ½æ˜¯å¯¹è±¡çš„å®ä¾‹ï¼ˆnewå‡ºæ¥çš„å¯¹è±¡éƒ½å­˜åœ¨å †ä¸­ï¼‰ ã€‚</p></li><li><p>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼ˆnew çš„å¯¹è±¡ï¼‰ ï¼Œ å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„éƒ½åº”å½“ä¿å­˜åœ¨å †å†…å­˜ä¸­ã€‚</p></li><li><p>åƒåœ¾æ”¶é›†æœ€é‡è¦çš„å†…å­˜åŒºåŸŸã€‚</p></li><li><p>ä¸€èˆ¬å¤§å°å¯æ‰©å±•ï¼Œé€šè¿‡ -Xms å’Œ -Xmx è®¾å®šæœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œæ— æ³•æ‰©å±•æ—¶æŠ›å‡º OutOfMemoryError å¼‚å¸¸</p><blockquote><p><strong>é™æ€å˜é‡å­˜æ”¾åœ¨ JVM è¿è¡Œæ—¶çš„å“ªå—å†…å­˜ï¼Ÿ</strong></p><p>HotSpot VMï¼ˆç§°ä¸ºé»˜è®¤è™šæ‹Ÿæœºï¼‰ï¼Œ<u>JDK 6</u> åŠä¹‹å‰ç‰ˆæœ¬é™æ€å˜é‡å­˜æ”¾åœ¨<u>æ°¸ä¹…ä»£(Permanent Generationï¼‰</u>ï¼Œä½¿ç”¨æ°¸ä¹…ä»£å®ç°çš„æ–¹æ³•åŒº)ä¸­ï¼›<br><u>JDK 7 å¼€å§‹</u>ï¼Œ<u>é™æ€å˜é‡</u>æ”¹å­˜æ”¾åˆ° java.lang.Class å¯¹è±¡çš„æœ«å°¾ï¼Œå³<u>ï¼ˆå † Heapï¼‰</u>ä¸­ã€‚è™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œæ˜¯æŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä»¥ä¸Šçš„å·®å¼‚åªæ˜¯å®ç°ç»†èŠ‚çš„ä¸åŒã€‚</p></blockquote><p>æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„åƒåœ¾å›æ”¶ï¼Œ ä¸»è¦å›æ”¶çš„å°±æ˜¯å †åŒºã€‚ æ›´ç»†ä¸€ç‚¹åˆ’åˆ†æ–°ç”Ÿä»£åˆå¯åˆ’åˆ†ä¸º Eden åŒºå’Œ 2 ä¸ª Survivor åŒºï¼ˆFromSurvivor å’Œ To Survivorï¼‰ï¼Œç”±é¢œâ¾Šå¯ä»¥çœ‹å‡ºï¼Œ<strong>Jdk1.8ä¹‹å‰ï¼Œå †å†…å­˜è¢«åˆ†ä¸ºæ–°â½£ä»£ï¼Œâ½¼å¹´ä»£ï¼Œæ°¸ä¹…ä»£ï¼›Jdk 1.8åŠä»¥åå †å†…å­˜è¢«åˆ†æˆäº†æ–°â½£ä»£å’Œâ½¼å¹´ä»£ã€‚æ–°â½£ä»£çš„åŒºåŸŸâ¼œåˆ†ä¸ºedenåŒºï¼ŒS0åŒºï¼ŒS1åŒºï¼Œé»˜è®¤â½ä¾‹æ˜¯8:1:1ï¼Œå…ƒç©ºé—´å¯ä»¥ç†è§£ä¸ºç›´æ¥çš„ç‰©ç†å†…å­˜ã€‚</strong>å¦‚ä¸‹å›¾ ã€‚</p></li></ol><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210203174728.png" alt="ä¸åŒJDKç‰ˆæœ¬ä¸‹å †å†…å­˜åˆ’åˆ†"><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20201012235443705.jpg" alt="å †å†…å­˜æ¨¡å‹åˆ’åˆ†"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>GCåƒåœ¾å›æ”¶</title>
    <url>/post/fca96bce.html</url>
    <content><![CDATA[<blockquote><p>GCåƒåœ¾å›æ”¶å­¦ä¹ ä¸æ¢³ç† ~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯åƒåœ¾"></a>ä¸€ã€ä»€ä¹ˆæ˜¯åƒåœ¾</h3><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/img_1.png" alt=""></p><h3 id="äºŒã€åƒåœ¾å›æ”¶"><a href="#äºŒã€åƒåœ¾å›æ”¶" class="headerlink" title="äºŒã€åƒåœ¾å›æ”¶"></a>äºŒã€åƒåœ¾å›æ”¶</h3><p>åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åƒåœ¾ï¼Œæœ‰ä¸¤ç§ç®—æ³•ã€‚</p><ol><li><p>ä¸€ç§æ˜¯<strong>å¼•ç”¨è®°æ•°æ³•</strong></p><p>å¼•ç”¨è®°æ•°æ³•æ˜¯æ—©æœŸåƒåœ¾å›æ”¶å™¨ä¸­ä½¿ç”¨çš„ç®—æ³•ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªè¯¥å¯¹è±¡è¢«å¼•ç”¨çš„è®°æ•°ï¼Œæ¯å¼•ç”¨ä¸€æ¬¡ï¼Œè®°æ•°åŠ 1ï¼Œæ¯å‡å°‘å¼•ç”¨1æ¬¡ï¼Œå¼•ç”¨å‡1ï¼Œå½“å¼•ç”¨ä¸º0æ—¶ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯ä»¥ä½œä¸ºåƒåœ¾è¢«æ¸…é™¤ã€‚ä½†æ˜¯å¼•ç”¨è®°æ•°æ³•æœ‰ä¸€ä¸ªæœ€è‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p></li><li><p>ä¸€ç§æ˜¯<strong>æ ¹å¯è¾¾ç®—æ³•</strong></p><p>æ ¹å¯è¾¾ç®—æ³•æ˜¯é€šè¿‡ä»GCRootså‡ºå‘ï¼Œæ‰¾å‡ºå†…å­˜ä¸­çš„å¼•ç”¨é“¾ï¼Œé‚£ä¹ˆé“¾ä¸­çš„å¯¹è±¡è¡¨ç¤ºå¯è¾¾ï¼Œå³ä¸èƒ½ä½œä¸ºè¢«åƒåœ¾å›æ”¶çš„ã€‚å¼•ç”¨é“¾ä¹‹å¤–çš„å¯¹è±¡å³å¯ä½œä¸ºåƒåœ¾å›æ”¶ã€‚Javaä¸­ä½¿ç”¨çš„æ˜¯å¯è¾¾æ€§åˆ†ææ³•ã€‚</p></li></ol><h3 id="ä¸‰ã€GCRoots-æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸‰ã€GCRoots-æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸‰ã€GCRoots æœ‰å“ªäº›ï¼Ÿ"></a>ä¸‰ã€GCRoots æœ‰å“ªäº›ï¼Ÿ</h3><ol><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ol><ol start="2"><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ol><ol start="3"><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ol><ol start="4"><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„nativeæ–¹æ³•ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ol><blockquote><p>ä¸ºäº†è§£å†³å¼•ç”¨è®¡æ•°æ³•çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼ŒJavaä½¿ç”¨äº†å¯è¾¾æ€§åˆ†æçš„æ–¹æ³•ã€‚æ‰€è°“<code>GCroots</code>ï¼Œå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚<br>åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—åä¸ºâ€GCRootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™ä¸ªè¢«ç§°ä¸ºGC Rootsçš„å¯¹è±¡å¼€å§‹å‘ä¸‹æœç´¢ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åˆ°GCRootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯´æ˜æ­¤å¯¹è±¡ä¸å¯ç”¨ã€‚ä¹Ÿå³ç»™å®šä¸€ä¸ªé›†åˆçš„å¼•ç”¨ä½œä¸ºæ ¹å‡ºå‘ï¼Œé€šè¿‡å¼•ç”¨å…³ç³»éå†å¯¹è±¡å›¾ï¼Œèƒ½è¢«éå†åˆ°çš„ï¼ˆå¯åˆ°è¾¾çš„ï¼‰å¯¹è±¡å°±è¢«åˆ¤å®šä¸ºå­˜æ´»ï¼Œæ²¡æœ‰è¢«éå†åˆ°çš„å°±è‡ªç„¶è¢«åˆ¤å®šä¸ºæ­»äº¡ã€‚</p></blockquote><h3 id="ä¸‰ã€å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•"><a href="#ä¸‰ã€å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="ä¸‰ã€å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•"></a>ä¸‰ã€å¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•</h3><ol><li><p><strong>æ ‡è®°æ¸…é™¤</strong> - ä½ç½®ä¸è¿ç»­, äº§ç”Ÿç¢ç‰‡</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210119133912534.png" style="zoom:47%"></li><li><p><strong>æ‹·è´ç®—æ³•</strong> - æ²¡æœ‰ç¢ç‰‡ï¼Œæµªè´¹ç©ºé—´</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210119135321186.png" style="zoom:50%"></li><li><p><strong>æ ‡è®°å‹ç¼©</strong> - æ²¡æœ‰ç¢ç‰‡ï¼Œæ•ˆç‡åä½</p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210119135527995.png" style="zoom:49%"></li><li><p><strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong></p><p><strong>åˆ†ä»£æ”¶é›†ç®—æ³•å°±æ˜¯ç›®å‰è™šæ‹Ÿæœºä½¿ç”¨çš„å›æ”¶ç®—æ³•ã€‚</strong>åœ¨ä¸åŒå¹´ä»£ä½¿ç”¨ä¸åŒçš„ç®—æ³•ï¼Œä»è€Œä½¿ç”¨æœ€åˆé€‚çš„ç®—æ³•ï¼Œ<strong>æ–°ç”Ÿä»£</strong>å­˜æ´»ç‡ä½ï¼Œå¯ä»¥ä½¿ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚è€Œ<strong>è€å¹´ä»£</strong>å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œæ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨<strong>æ ‡è®°æ¸…é™¤æˆ–è€…æ ‡è®°æ•´ç†ç®—æ³•</strong>ã€‚</p></li></ol><h3 id="å››ã€å †å†…å­˜é€»è¾‘åˆ†åŒº"><a href="#å››ã€å †å†…å­˜é€»è¾‘åˆ†åŒº" class="headerlink" title="å››ã€å †å†…å­˜é€»è¾‘åˆ†åŒº"></a>å››ã€å †å†…å­˜é€»è¾‘åˆ†åŒº</h3><p>JVMå°†å †å†…å­˜åˆ†ä¸ºäº†ä¸‰éƒ¨åˆ†ï¼šæ–°ç”Ÿä»£(Young Generation)ï¼Œè€å¹´ä»£(Old Generation)ï¼Œæ°¸ä¹…ä»£(Permanent Generation)ã€‚å…¶ä¸­æ–°ç”Ÿä»£åˆåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šä¼Šç”¸å›­åŒº(Eden)ï¼Œå’Œä¸¤ä¸ªå¹¸å­˜åŒºS0å’ŒS1ã€‚</p><blockquote><p>æ³¨ï¼š<code>JDK1.8</code>ä¹‹åï¼ŒJavaå®˜æ–¹çš„<code>HotSpot JVM</code>å»æ‰äº†æ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒæ•°æ®åŒº<code>Metaspace</code>ã€‚<code>Metaspace</code>ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œè€Œä¸æ˜¯å †å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é»˜è®¤æƒ…å†µä¸‹<code>Metaspace</code>çš„å¤§å°åªä¸æœ¬åœ°å†…å­˜çš„å¤§å°æœ‰å…³ã€‚å› æ­¤<code>JDK1.8</code>ä¹‹åï¼Œå°±è§ä¸åˆ°<code>java.lang.OutOfMemoryError: PermGen space</code>è¿™ç§ç”±äºæ°¸ä¹…ä»£ç©ºé—´ä¸è¶³å¯¼è‡´çš„å†…å­˜æº¢å‡ºçš„é—®é¢˜äº†ã€‚</p></blockquote><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210507144124.png" alt="å †å†…å­˜é€»è¾‘åˆ†åŒº"></p><h3 id="äº”ã€GC-ä½•æ—¶è¢«è§¦å‘"><a href="#äº”ã€GC-ä½•æ—¶è¢«è§¦å‘" class="headerlink" title="äº”ã€GC ä½•æ—¶è¢«è§¦å‘"></a>äº”ã€GC ä½•æ—¶è¢«è§¦å‘</h3><h4 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°-Young-GCï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°-Young-GCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç° Young GCï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç° Young GCï¼Ÿ</h4><ul><li>å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­åˆ†é…ï¼Œå¦‚æœ Eden åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ Young GC ã€‚</li></ul><h4 id="ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç°-Full-GCï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç°-Full-GCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç° Full GCï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç° Full GCï¼Ÿ</h4><ul><li>åœ¨æ‰§è¡Œ Young GC ä¹‹å‰ï¼ŒJVM ä¼šè¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿â€”â€”å¦‚æœè€å¹´ä»£çš„è¿ç»­ç©ºé—´å°äºæ–°ç”Ÿä»£å¯¹è±¡çš„æ€»å¤§å°ï¼ˆæˆ–å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼‰ï¼Œåˆ™è§¦å‘ä¸€æ¬¡ Full GC ã€‚</li><li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä»å¹´è½»ä»£æ™‹å‡ä¸Šæ¥çš„è€å¯¹è±¡ï¼Œå°è¯•åœ¨è€å¹´ä»£åˆ†é…å†…å­˜æ—¶ï¼Œä½†æ˜¯è€å¹´ä»£å†…å­˜ç©ºé—´ä¸å¤Ÿã€‚</li><li>æ˜¾å¼è°ƒç”¨ <code>System.gc()</code> æ–¹æ³•æ—¶ã€‚</li></ul><h3 id="å…­ã€GC-ç›¸å…³çš„æ¦‚å¿µ"><a href="#å…­ã€GC-ç›¸å…³çš„æ¦‚å¿µ" class="headerlink" title="å…­ã€GC ç›¸å…³çš„æ¦‚å¿µ"></a>å…­ã€GC ç›¸å…³çš„æ¦‚å¿µ</h3><ul><li><p><strong>MinorGC/YoungGC/YGC</strong>ï¼šå¯¹æ–°ç”Ÿä»£å †è¿›è¡Œ<code>gc</code>ã€‚é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡çš„å­˜æ´»å¯¿å‘½è¾ƒçŸ­ï¼Œåœ¨æ–°ç”Ÿä»£é‡Œè¢«å›æ”¶ã€‚æ€§èƒ½è€—è´¹è¾ƒå°ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚</p></li><li><p><strong>MajorGC/FullGC/FGC</strong>ï¼šæŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† MajorGCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ MinorGCï¼Œå…¨å †èŒƒå›´çš„gcã€‚é»˜è®¤å †ç©ºé—´ä½¿ç”¨åˆ°è¾¾80%(å¯è°ƒæ•´)çš„æ—¶å€™ä¼šè§¦å‘fgcã€‚ä»¥æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒä¸ºä¾‹ï¼Œä¸€èˆ¬æ¯”è¾ƒå°‘ä¼šè§¦å‘<code>fgc</code>ï¼Œæœ‰æ—¶10å¤©æˆ–ä¸€å‘¨å·¦å³ä¼šæœ‰ä¸€æ¬¡ã€‚</p></li><li><p><strong>ä¸€èˆ¬åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ï¼š</strong></p><ol><li><strong>æ–°ç”Ÿæˆçš„å¯¹è±¡é¦–å…ˆæ”¾åˆ°<code>Eden</code>åŒºï¼Œå½“<code>Eden</code>åŒºæ»¡äº†ä¼šè§¦å‘<code>YGC</code></strong></li><li><strong><code>YGC</code>å›æ”¶ä¹‹åï¼Œ<code>Eden</code>ä¸­å¤§å¤šæ•°çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œæ´»ç€çš„è¿›å…¥<code>S0</code></strong></li><li><strong>å†æ¬¡<code>YGC</code>ï¼Œæ´»ç€çš„å¯¹è±¡<code>eden + S0 -&gt; S1</code></strong></li><li><strong>å†æ¬¡<code>YGC</code>ï¼Œ<code>eden + S1 -&gt; S0</code></strong>ï¼ˆ <em>ç¬¬2ã€3æ­¥ï¼Œå¯¹è±¡ä¼šåœ¨<code>S0</code>å’Œ<code>S1</code>ä¹‹é—´åå¤äº¤æ¢ï¼Œå¹´é¾„ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œå½“å¯¹è±¡è¾¾åˆ°å¹´é¾„ä¸Šé™æ—¶ï¼Œä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚è¿™ä¸ªå¹´é¾„ä¸Šé™é»˜è®¤æ˜¯15ï¼Œå¯ä»¥é€šè¿‡å‚æ•°<code>-XX:MaxTenuringThreshold</code>è®¾ç½®</em> ï¼‰</li><li><strong>å¹´é¾„è¶³å¤Ÿ -&gt; è€å¹´ä»£</strong> ï¼ˆ<em>å¹´è½»ä»£å¯¹è±¡å¹´é¾„è¾¾åˆ°äº†ä¸Šé™15ï¼Œè¢«è½¬ç§»åˆ°äº†è€å¹´ä»£</em>ï¼‰</li><li><strong>å¤§å¯¹è±¡çš„è¯ï¼Œå¹´è½»ä»£è£…ä¸ä¸‹ -&gt; è€å¹´ä»£</strong>ï¼ˆ <em>å¤§å¯¹è±¡ç›´æ¥æ™‹å‡ï¼Œå¤§å¯¹è±¡ä¼šè·¨è¿‡å¹´è½»ä»£ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚å¯ä»¥é€šè¿‡<code>-XX:PretenureSizeThreshold</code>å‚æ•°è®¾ç½®å¯¹è±¡å¤§å°ã€‚å¦‚æœå‚æ•°è¢«è®¾ç½®æˆ<code>5MB</code>ï¼Œè¶…è¿‡<code>5MB</code>çš„å¤§å¯¹è±¡ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é¿å…å¤§å¯¹è±¡åœ¨EdenåŒºåŠä¸¤ä¸ªSurvivoråŒºä¹‹é—´å¤§é‡çš„å†…å­˜å¤åˆ¶ï¼Œå¤§å¯¹è±¡çš„å†…å­˜å¤åˆ¶è€—æ—¶æ¯”æ™®é€šå¯¹è±¡è¦é«˜å¾ˆå¤š</em>ï¼‰</li><li><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong>ï¼ˆ<em>å¦‚æœåœ¨<code>Survivor</code>ç©ºé—´ä¸­ç›¸åŒå¹´é¾„å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº<code>Survivor</code>ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€Œä¸ç”¨ç­‰åˆ°<code>MaxTenuringThreshold</code>ä¸­è®¾ç½®çš„å¹´é¾„ä¸Šé™ï¼Œä¼šç›´æ¥è¿›å…¥è€å¹´ä»£</em>ï¼‰</li><li><strong>è€å¹´ä»£æ»¡äº†<code>FGC/Full GC</code></strong></li></ol></li><li><p><a href="https://www.modb.pro/db/26526" target="_blank" rel="noopener">ã€Šå°ç™½æ˜¯æ€ä¹ˆææ‡‚GCå…¨è¿‡ç¨‹ï¼Ÿã€‹</a></p></li></ul><ul><li><p><code>JVM</code>è°ƒä¼˜æŒ‡ä»€ä¹ˆ? GC Tuning (Generation)</p><ol><li>å°½é‡å‡å°‘<code>FGC</code></li></ol></li></ul><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210429170508.png" alt="å›¾è§£GCæµç¨‹" style="zoom:50%"><h3 id="ä¸ƒã€å¸¸è§çš„åƒåœ¾å›æ”¶å™¨"><a href="#ä¸ƒã€å¸¸è§çš„åƒåœ¾å›æ”¶å™¨" class="headerlink" title="ä¸ƒã€å¸¸è§çš„åƒåœ¾å›æ”¶å™¨"></a>ä¸ƒã€å¸¸è§çš„åƒåœ¾å›æ”¶å™¨</h3><blockquote><p>åƒåœ¾å›æ”¶å™¨çš„å‘å±•è·¯çº¿ï¼Œæ˜¯éšç€å†…å­˜è¶Šæ¥è¶Šå¤§çš„è¿‡ç¨‹è€Œæ¼”è¿›ï¼Œä»åˆ†ä»£ç®—æ³•æ¼”åŒ–åˆ°ä¸åˆ†ä»£ç®—æ³•ã€‚<br>1 ã€Serialç®—æ³• å‡ åå…†<br>2ã€Parallelç®—æ³• å‡ ä¸ªG<br>3ã€CMS å‡ åä¸ªG - æ‰¿ä¸Šå¯ä¸‹ï¼Œå¼€å§‹å¹¶å‘å›æ”¶ -ä¸‰è‰²æ ‡è®°ï¼›</p><p>JDKè¯ç”Ÿ Serialè¿½éš æé«˜æ•ˆç‡ï¼Œè¯ç”Ÿäº†PSï¼Œä¸ºäº†é…åˆCMSï¼Œè¯ç”Ÿäº†PNï¼ŒCMSæ˜¯1.4ç‰ˆæœ¬åæœŸå¼•å…¥ï¼ŒCMSæ˜¯é‡Œç¨‹ç¢‘å¼çš„GCï¼Œå®ƒå¼€å¯äº†å¹¶å‘å›æ”¶çš„è¿‡ç¨‹ï¼Œä½†æ˜¯CMSæ¯›ç—…è¾ƒå¤šï¼Œå› æ­¤ç›®å‰ä»»ä½•ä¸€ä¸ªJDKç‰ˆæœ¬é»˜è®¤æ˜¯CMSï¼Œå¹¶å‘åƒåœ¾å›æ”¶æ˜¯å› ä¸ºæ— æ³•å¿å—STWã€‚</p></blockquote><p>â€‹ ç›®å‰JAVAç”¨åˆ°ä»¥ä¸‹10ç§åƒåœ¾å›æ”¶å™¨ï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20210120194154785.png" alt="JAVAçš„10ç§åƒåœ¾å›æ”¶å™¨"></p><ol><li><p><strong>Serial</strong> å¹´è½»ä»£ ä¸²è¡Œå›æ”¶ï¼›</p></li><li><p><strong>ParallelScavenge</strong> å¹´è½»ä»£ å¹¶è¡Œå›æ”¶ï¼› <strong>JDK1.8</strong> é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨æ˜¯ï¼š<strong>ParallelScavenge+ParallelOld</strong></p></li><li><p><strong>ParNew</strong> å¹´è½»ä»£ é…åˆCMSçš„å¹¶è¡Œå›æ”¶ï¼›</p></li><li><p><strong>SerialOld</strong>ï¼›</p></li><li><p><strong>ParallelOld</strong>ï¼›</p></li><li><p><strong>ConcurrentMarkSweep</strong>ï¼›</p></li><li><p><strong>CMS</strong></p><p>æ˜¯è€å¹´ä»£çš„ï¼Œå¹¶å‘çš„ï¼Œ åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå¯ä»¥å’Œåº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œé™ä½STWçš„æ—¶é—´(200æ¯«ç§’)ï¼›Stop-The-Worldæœºåˆ¶ç®€ç§°STWï¼Œæ˜¯åœ¨æ‰§è¡Œåƒåœ¾æ”¶é›†ç®—æ³•æ—¶ï¼Œ<a href="http://www.jb51.net/list/list_207_1.htm" target="_blank" rel="noopener">Java</a>åº”ç”¨ç¨‹åºçš„å…¶ä»–æ‰€æœ‰çº¿ç¨‹éƒ½è¢«æŒ‚èµ·ï¼ˆé™¤äº†åƒåœ¾æ”¶é›†å¸®åŠ©å™¨ä¹‹å¤–ï¼‰ã€‚Javaä¸­ä¸€ç§å…¨å±€æš‚åœç°è±¡ï¼Œå…¨å±€åœé¡¿ï¼Œæ‰€æœ‰Javaä»£ç åœæ­¢ï¼Œnativeä»£ç å¯ä»¥æ‰§è¡Œï¼Œä½†ä¸èƒ½ä¸JVMäº¤äº’ï¼›è¿™äº›ç°è±¡å¤šåŠæ˜¯ç”±äºgcå¼•èµ·ã€‚<br>CMSé—®é¢˜æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç°åœ¨æ²¡æœ‰ä¸€ä¸ªç‰ˆæœ¬é»˜è®¤æ˜¯CMSï¼Œåªèƒ½æ‰‹å·¥æŒ‡å®š<br>CMSæ—¢ç„¶æ˜¯MarkSweepï¼Œå°±ä¸€å®šä¼šæœ‰ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œç¢ç‰‡åˆ°è¾¾ä¸€å®šç¨‹åº¦ï¼ŒCMSçš„è€å¹´ä»£åˆ†é…å¯¹è±¡åˆ†é…ä¸ä¸‹çš„æ—¶å€™ï¼Œä½¿ç”¨SerialOld è¿›è¡Œè€å¹´ä»£å›æ”¶<br>ç®—æ³•ï¼šä¸‰è‰²æ ‡è®° + Incremental Update</p></li><li><p><strong>G1</strong>ï¼›(é™ä½STWçš„æ—¶é—´10æ¯«ç§’) â€“ <code>04</code>å¹´æ­£å¼æå‡ºï¼Œ<code>12</code>å¼€å§‹æ­£å¼æ”¯æŒï¼Œåœ¨<code>17</code>å¹´ä½œä¸º<code>JDK9</code>é»˜è®¤çš„åƒåœ¾å¤„ç†å™¨ã€‚<br>ç®—æ³•ï¼šä¸‰è‰²æ ‡è®° + SATB</p></li><li><p><strong>ZGC</strong>ï¼›<em>ç›®å‰å²ä¸Šæœ€å‰å®³çš„å›æ”¶å™¨ï¼Œåœ¨<code>JDK11</code>ä¸­å¼•å…¥ï¼›</em> (é™ä½STWçš„æ—¶é—´1æ¯«ç§’) PK C++ï¼Œæ¯”C++è¿˜è¦å¼ºï¼›<br>ç®—æ³•ï¼šColoredPointers + LoadBarrier</p></li><li><p><strong>Shenandoah</strong><br>ç®—æ³•ï¼šColoredPointers + WriteBarrier</p></li><li><p><strong>Eplison</strong></p></li></ol><h3 id="å…«ã€GC-æ—¥å¿—"><a href="#å…«ã€GC-æ—¥å¿—" class="headerlink" title="å…«ã€GC  æ—¥å¿—"></a>å…«ã€GC æ—¥å¿—</h3><p><code>GC</code>æ—¥å¿—æ˜¯æ›¿æ¢çš„ä¸æ˜¯è¿½åŠ çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡ä»¥ä¸‹çš„å‘½JVMä»¤å‚æ•°æ¥è®¾ç½®GCæ—¥å¿—çš„è¾“å‡ºï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºGCæ—¥å¿—</span></span><br><span class="line">-XX:+PrintGC</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—</span></span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰</span></span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰</span></span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</span></span><br><span class="line">-XX:+PrintHeapAtGC</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</span></span><br><span class="line">-Xloggc:â€¦/logs/gc.log</span><br></pre></td></tr></table></figure><blockquote><p>GCæ—¥å¿—åˆ†æå·¥å…·ï¼š<a href="http://gceasy.io/" target="_blank" rel="noopener">GCeasy</a>ã€GCViewer</p></blockquote><h3 id="ä¹ã€ä¼˜ç§€èµ„æ–™"><a href="#ä¹ã€ä¼˜ç§€èµ„æ–™" class="headerlink" title="ä¹ã€ä¼˜ç§€èµ„æ–™"></a>ä¹ã€ä¼˜ç§€èµ„æ–™</h3><p><a href="https://mp.weixin.qq.com/s/I1fp89Ib2Na1-vjmjSpsjQ" target="_blank" rel="noopener">ã€Šçº¿ä¸ŠæœåŠ¡çš„FGCé—®é¢˜æ’æŸ¥ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼ã€‹</a><br><a href="https://www.toutiao.com/a6881508437667086856/?tt_from=weixin&utm_campaign=client_share&wxshare_count=1&timestamp=1620365664&app=news_article_social&utm_source=weixin&utm_medium=toutiao_ios&use_new_style=1&req_id=202105071334230102120351953309B306&share_token=8A4BF30E-510F-417C-9D9F-346D77EEC9E7&group_id=6881508437667086856" target="_blank" rel="noopener">ã€ŠJVMå¸¸è§çº¿ä¸Šé—®é¢˜ â†’ CPU 100%ã€å†…å­˜æ³„éœ² é—®é¢˜æ’æŸ¥ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”ŸæˆäºŒç»´ç å·¥å…·</title>
    <url>/post/aeb006ac.html</url>
    <content><![CDATA[<blockquote><p>ç”ŸæˆäºŒç»´ç ï¼Œå¦‚æ­¤ç®€å•æ˜“ç”¨ ~</p></blockquote><a id="more"></a><h5 id="ä¸€ã€mavenä»“åº“å¼•ç”¨"><a href="#ä¸€ã€mavenä»“åº“å¼•ç”¨" class="headerlink" title="ä¸€ã€mavenä»“åº“å¼•ç”¨"></a>ä¸€ã€mavenä»“åº“å¼•ç”¨</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”ŸæˆäºŒç»´ç  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.google.zxing/javase --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.zxing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javase<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="äºŒã€å·¥å…·ç±»è®°å½•"><a href="#äºŒã€å·¥å…·ç±»è®°å½•" class="headerlink" title="äºŒã€å·¥å…·ç±»è®°å½•"></a>äºŒã€å·¥å…·ç±»è®°å½•</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shuaizi.watermark.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.zxing.*;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.client.j2se.BufferedImageLuminanceSource;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.client.j2se.MatrixToImageWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.common.BitMatrix;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.common.HybridBinarizer;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.qrcode.QRCodeWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.swing.filechooser.FileSystemView;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.FileSystems;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äºŒç»´ç ã€æ¡å½¢ç å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * èµ„æ–™: https://wangmaoxiong.blog.csdn.net/article/details/83856391?utm_medium=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.control</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/25 20:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QRBarCodeUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * CODE_WIDTHï¼šäºŒç»´ç å®½åº¦ï¼Œå•ä½åƒç´ </span></span><br><span class="line"><span class="comment">     * CODE_HEIGHTï¼šäºŒç»´ç é«˜åº¦ï¼Œå•ä½åƒç´ </span></span><br><span class="line"><span class="comment">     * FRONT_COLORï¼šäºŒç»´ç å‰æ™¯è‰²ï¼Œ0x000000 è¡¨ç¤ºé»‘è‰²</span></span><br><span class="line"><span class="comment">     * BACKGROUND_COLORï¼šäºŒç»´ç èƒŒæ™¯è‰²ï¼Œ0xFFFFFF è¡¨ç¤ºç™½è‰²</span></span><br><span class="line"><span class="comment">     * æ¼”ç¤ºç”¨ 16 è¿›åˆ¶è¡¨ç¤ºï¼Œå’Œå‰ç«¯é¡µé¢ CSS çš„å–è‰²æ˜¯ä¸€æ ·çš„ï¼Œæ³¨æ„å‰åæ™¯é¢œè‰²åº”è¯¥å¯¹æ¯”æ˜æ˜¾ï¼Œå¦‚å¸¸è§çš„é»‘ç™½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CODE_WIDTH = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CODE_HEIGHT = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FRONT_COLOR = <span class="number">0x000000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKGROUND_COLOR = <span class="number">0xFFFFFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆäºŒç»´ç  å¹¶ ä¿å­˜ä¸ºå›¾ç‰‡ï¼šwrite(RenderedImage im,String formatName,File output)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> codeContent        :äºŒç»´ç å‚æ•°å†…å®¹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªç½‘é¡µåœ°å€ï¼Œå¦‚ https://www.baidu.com/ åˆ™ å¾®ä¿¡æ‰«ä¸€æ‰«ä¼šç›´æ¥è¿›å…¥æ­¤åœ°å€</span></span><br><span class="line"><span class="comment">     *                           å¦‚æœæ˜¯ä¸€äº›å‚æ•°ï¼Œå¦‚ 1541656080837ï¼Œåˆ™å¾®ä¿¡æ‰«ä¸€æ‰«ä¼šç›´æ¥å›æ˜¾è¿™äº›å‚æ•°å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> codeImgFileSaveDir :äºŒç»´ç å›¾ç‰‡ä¿å­˜çš„ç›®å½•,å¦‚ D:/codes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName           :äºŒç»´ç å›¾ç‰‡æ–‡ä»¶åç§°ï¼Œå¸¦æ ¼å¼,å¦‚ 123.png</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCodeToFile</span><span class="params">(String codeContent, File codeImgFileSaveDir, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/** å‚æ•°æ£€éªŒ*/</span></span><br><span class="line">            <span class="keyword">if</span> (codeContent == <span class="keyword">null</span> || <span class="string">""</span>.equals(codeContent.trim())) &#123;</span><br><span class="line">                System.out.println(<span class="string">"äºŒç»´ç å†…å®¹ä¸ºç©ºï¼Œä¸è¿›è¡Œæ“ä½œ..."</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            codeContent = codeContent.trim();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (codeImgFileSaveDir == <span class="keyword">null</span> || codeImgFileSaveDir.isFile()) &#123;</span><br><span class="line">                codeImgFileSaveDir = FileSystemView.getFileSystemView().getHomeDirectory();</span><br><span class="line">                System.out.println(<span class="string">"äºŒç»´ç å›¾ç‰‡å­˜åœ¨ç›®å½•ä¸ºç©ºï¼Œé»˜è®¤æ”¾åœ¨æ¡Œé¢..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!codeImgFileSaveDir.exists()) &#123;</span><br><span class="line">                codeImgFileSaveDir.mkdirs();</span><br><span class="line">                System.out.println(<span class="string">"äºŒç»´ç å›¾ç‰‡å­˜åœ¨ç›®å½•ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆ›å»º..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fileName == <span class="keyword">null</span> || <span class="string">""</span>.equals(fileName)) &#123;</span><br><span class="line">                fileName = <span class="keyword">new</span> Date().getTime() + <span class="string">".png"</span>;</span><br><span class="line">                System.out.println(<span class="string">"äºŒç»´ç å›¾ç‰‡æ–‡ä»¶åä¸ºç©ºï¼Œéšæœºç”Ÿæˆ png æ ¼å¼å›¾ç‰‡..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**com.google.zxing.EncodeHintTypeï¼šç¼–ç æç¤ºç±»å‹,æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">             * EncodeHintType.CHARACTER_SETï¼šè®¾ç½®å­—ç¬¦ç¼–ç ç±»å‹</span></span><br><span class="line"><span class="comment">             * EncodeHintType.ERROR_CORRECTIONï¼šè®¾ç½®è¯¯å·®æ ¡æ­£</span></span><br><span class="line"><span class="comment">             *      ErrorCorrectionLevelï¼šè¯¯å·®æ ¡æ­£ç­‰çº§ï¼ŒL = ~7% correctionã€M = ~15% correctionã€Q = ~25% correctionã€H = ~30% correction</span></span><br><span class="line"><span class="comment">             *      ä¸è®¾ç½®æ—¶ï¼Œé»˜è®¤ä¸º L ç­‰çº§ï¼Œç­‰çº§ä¸ä¸€æ ·ï¼Œç”Ÿæˆçš„å›¾æ¡ˆä¸åŒï¼Œä½†æ‰«æçš„ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">             * EncodeHintType.MARGINï¼šè®¾ç½®äºŒç»´ç è¾¹è·ï¼Œå•ä½åƒç´ ï¼Œå€¼è¶Šå°ï¼ŒäºŒç»´ç è·ç¦»å››å‘¨è¶Šè¿‘</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            Map&lt;EncodeHintType, Object&gt; hints = <span class="keyword">new</span> HashMap();</span><br><span class="line">            hints.put(EncodeHintType.CHARACTER_SET, <span class="string">"UTF-8"</span>);</span><br><span class="line">            hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);</span><br><span class="line">            hints.put(EncodeHintType.MARGIN, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * MultiFormatWriter:å¤šæ ¼å¼å†™å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œé‡Œé¢é‡è½½äº†ä¸¤ä¸ª encode æ–¹æ³•ï¼Œç”¨äºå†™å…¥æ¡å½¢ç æˆ–äºŒç»´ç </span></span><br><span class="line"><span class="comment">             *      encode(String contents,BarcodeFormat format,int width, int height,Map&lt;EncodeHintType,?&gt; hints)</span></span><br><span class="line"><span class="comment">             *      contents:æ¡å½¢ç /äºŒç»´ç å†…å®¹</span></span><br><span class="line"><span class="comment">             *      formatï¼šç¼–ç ç±»å‹ï¼Œå¦‚ æ¡å½¢ç ï¼ŒäºŒç»´ç  ç­‰</span></span><br><span class="line"><span class="comment">             *      widthï¼šç çš„å®½åº¦</span></span><br><span class="line"><span class="comment">             *      heightï¼šç çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">             *      hintsï¼šç å†…å®¹çš„ç¼–ç ç±»å‹</span></span><br><span class="line"><span class="comment">             * BarcodeFormatï¼šæšä¸¾è¯¥ç¨‹åºåŒ…å·²çŸ¥çš„æ¡å½¢ç æ ¼å¼ï¼Œå³åˆ›å»ºä½•ç§ç ï¼Œå¦‚ 1 ç»´çš„æ¡å½¢ç ï¼Œ2 ç»´çš„äºŒç»´ç  ç­‰</span></span><br><span class="line"><span class="comment">             * BitMatrixï¼šä½(æ¯”ç‰¹)çŸ©é˜µæˆ–å«2DçŸ©é˜µï¼Œä¹Ÿå°±æ˜¯éœ€è¦çš„äºŒç»´ç </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            MultiFormatWriter multiFormatWriter = <span class="keyword">new</span> MultiFormatWriter();</span><br><span class="line">            BitMatrix bitMatrix = multiFormatWriter.encode(codeContent, BarcodeFormat.QR_CODE, CODE_WIDTH, CODE_HEIGHT, hints);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**java.awt.image.BufferedImageï¼šå…·æœ‰å›¾åƒæ•°æ®çš„å¯è®¿é—®ç¼“å†²å›¾åƒï¼Œå®ç°äº† RenderedImage æ¥å£</span></span><br><span class="line"><span class="comment">             * BitMatrix çš„ get(int x, int y) è·å–æ¯”ç‰¹çŸ©é˜µå†…å®¹ï¼ŒæŒ‡å®šä½ç½®æœ‰å€¼ï¼Œåˆ™è¿”å›trueï¼Œå°†å…¶è®¾ç½®ä¸ºå‰æ™¯è‰²ï¼Œå¦åˆ™è®¾ç½®ä¸ºèƒŒæ™¯è‰²</span></span><br><span class="line"><span class="comment">             * BufferedImage çš„ setRGB(int x, int y, int rgb) æ–¹æ³•è®¾ç½®å›¾åƒåƒç´ </span></span><br><span class="line"><span class="comment">             *      xï¼šåƒç´ ä½ç½®çš„æ¨ªåæ ‡ï¼Œå³åˆ—</span></span><br><span class="line"><span class="comment">             *      yï¼šåƒç´ ä½ç½®çš„çºµåæ ‡ï¼Œå³è¡Œ</span></span><br><span class="line"><span class="comment">             *      rgbï¼šåƒç´ çš„å€¼ï¼Œé‡‡ç”¨ 16 è¿›åˆ¶,å¦‚ 0xFFFFFF ç™½è‰²</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImage bufferedImage = <span class="keyword">new</span> BufferedImage(CODE_WIDTH, CODE_HEIGHT, BufferedImage.TYPE_INT_BGR);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; CODE_WIDTH; x++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; CODE_HEIGHT; y++) &#123;</span><br><span class="line">                    bufferedImage.setRGB(x, y, bitMatrix.get(x, y) ? FRONT_COLOR : BACKGROUND_COLOR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**javax.imageio.ImageIO java æ‰©å±•çš„å›¾åƒIO</span></span><br><span class="line"><span class="comment">             * write(RenderedImage im,String formatName,File output)</span></span><br><span class="line"><span class="comment">             *      imï¼šå¾…å†™å…¥çš„å›¾åƒ</span></span><br><span class="line"><span class="comment">             *      formatNameï¼šå›¾åƒå†™å…¥çš„æ ¼å¼</span></span><br><span class="line"><span class="comment">             *      outputï¼šå†™å…¥çš„å›¾åƒæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * å³å°†ä¿å­˜çš„äºŒç»´ç å›¾ç‰‡æ–‡ä»¶*/</span></span><br><span class="line">            File codeImgFile = <span class="keyword">new</span> File(codeImgFileSaveDir, fileName);</span><br><span class="line">            ImageIO.write(bufferedImage, <span class="string">"png"</span>, codeImgFile);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"äºŒç»´ç å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼š"</span> + codeImgFile.getPath());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆäºŒç»´ç  å¹¶ è¾“å‡ºåˆ°è¾“å‡ºæµâ€”â€”â€”â€”é€šå¸¸ç”¨äºè¾“å‡ºåˆ°ç½‘é¡µä¸Šè¿›è¡Œæ˜¾ç¤º</span></span><br><span class="line"><span class="comment">     * è¾“å‡ºåˆ°ç½‘é¡µä¸è¾“å‡ºåˆ°ç£ç›˜ä¸Šçš„æ–‡ä»¶ä¸­ï¼ŒåŒºåˆ«åœ¨äºæœ€åä¸€å¥ ImageIO.write</span></span><br><span class="line"><span class="comment">     * write(RenderedImage im,String formatName,File output)ï¼šå†™åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">     * write(RenderedImage im,String formatName,OutputStream output)ï¼šè¾“å‡ºåˆ°è¾“å‡ºæµä¸­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> codeContent  ï¼šäºŒç»´ç å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream ï¼šè¾“å‡ºæµï¼Œæ¯”å¦‚ HttpServletResponse çš„ getOutputStream</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCodeToOutputStream</span><span class="params">(String codeContent, OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/** å‚æ•°æ£€éªŒ*/</span></span><br><span class="line">            <span class="keyword">if</span> (codeContent == <span class="keyword">null</span> || <span class="string">""</span>.equals(codeContent.trim())) &#123;</span><br><span class="line">                System.out.println(<span class="string">"äºŒç»´ç å†…å®¹ä¸ºç©ºï¼Œä¸è¿›è¡Œæ“ä½œ..."</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            codeContent = codeContent.trim();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**com.google.zxing.EncodeHintTypeï¼šç¼–ç æç¤ºç±»å‹,æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">             * EncodeHintType.CHARACTER_SETï¼šè®¾ç½®å­—ç¬¦ç¼–ç ç±»å‹</span></span><br><span class="line"><span class="comment">             * EncodeHintType.ERROR_CORRECTIONï¼šè®¾ç½®è¯¯å·®æ ¡æ­£</span></span><br><span class="line"><span class="comment">             *      ErrorCorrectionLevelï¼šè¯¯å·®æ ¡æ­£ç­‰çº§ï¼ŒL = ~7% correctionã€M = ~15% correctionã€Q = ~25% correctionã€H = ~30% correction</span></span><br><span class="line"><span class="comment">             *      ä¸è®¾ç½®æ—¶ï¼Œé»˜è®¤ä¸º L ç­‰çº§ï¼Œç­‰çº§ä¸ä¸€æ ·ï¼Œç”Ÿæˆçš„å›¾æ¡ˆä¸åŒï¼Œä½†æ‰«æçš„ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">             * EncodeHintType.MARGINï¼šè®¾ç½®äºŒç»´ç è¾¹è·ï¼Œå•ä½åƒç´ ï¼Œå€¼è¶Šå°ï¼ŒäºŒç»´ç è·ç¦»å››å‘¨è¶Šè¿‘</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            Map&lt;EncodeHintType, Object&gt; hints = <span class="keyword">new</span> HashMap();</span><br><span class="line">            hints.put(EncodeHintType.CHARACTER_SET, <span class="string">"UTF-8"</span>);</span><br><span class="line">            hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);</span><br><span class="line">            hints.put(EncodeHintType.MARGIN, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * MultiFormatWriter:å¤šæ ¼å¼å†™å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œé‡Œé¢é‡è½½äº†ä¸¤ä¸ª encode æ–¹æ³•ï¼Œç”¨äºå†™å…¥æ¡å½¢ç æˆ–äºŒç»´ç </span></span><br><span class="line"><span class="comment">             *      encode(String contents,BarcodeFormat format,int width, int height,Map&lt;EncodeHintType,?&gt; hints)</span></span><br><span class="line"><span class="comment">             *      contents:æ¡å½¢ç /äºŒç»´ç å†…å®¹</span></span><br><span class="line"><span class="comment">             *      formatï¼šç¼–ç ç±»å‹ï¼Œå¦‚ æ¡å½¢ç ï¼ŒäºŒç»´ç  ç­‰</span></span><br><span class="line"><span class="comment">             *      widthï¼šç çš„å®½åº¦</span></span><br><span class="line"><span class="comment">             *      heightï¼šç çš„é«˜åº¦</span></span><br><span class="line"><span class="comment">             *      hintsï¼šç å†…å®¹çš„ç¼–ç ç±»å‹</span></span><br><span class="line"><span class="comment">             * BarcodeFormatï¼šæšä¸¾è¯¥ç¨‹åºåŒ…å·²çŸ¥çš„æ¡å½¢ç æ ¼å¼ï¼Œå³åˆ›å»ºä½•ç§ç ï¼Œå¦‚ 1 ç»´çš„æ¡å½¢ç ï¼Œ2 ç»´çš„äºŒç»´ç  ç­‰</span></span><br><span class="line"><span class="comment">             * BitMatrixï¼šä½(æ¯”ç‰¹)çŸ©é˜µæˆ–å«2DçŸ©é˜µï¼Œä¹Ÿå°±æ˜¯éœ€è¦çš„äºŒç»´ç </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            MultiFormatWriter multiFormatWriter = <span class="keyword">new</span> MultiFormatWriter();</span><br><span class="line">            BitMatrix bitMatrix = multiFormatWriter.encode(codeContent, BarcodeFormat.QR_CODE, CODE_WIDTH, CODE_HEIGHT, hints);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**java.awt.image.BufferedImageï¼šå…·æœ‰å›¾åƒæ•°æ®çš„å¯è®¿é—®ç¼“å†²å›¾åƒï¼Œå®ç°äº† RenderedImage æ¥å£</span></span><br><span class="line"><span class="comment">             * BitMatrix çš„ get(int x, int y) è·å–æ¯”ç‰¹çŸ©é˜µå†…å®¹ï¼ŒæŒ‡å®šä½ç½®æœ‰å€¼ï¼Œåˆ™è¿”å›trueï¼Œå°†å…¶è®¾ç½®ä¸ºå‰æ™¯è‰²ï¼Œå¦åˆ™è®¾ç½®ä¸ºèƒŒæ™¯è‰²</span></span><br><span class="line"><span class="comment">             * BufferedImage çš„ setRGB(int x, int y, int rgb) æ–¹æ³•è®¾ç½®å›¾åƒåƒç´ </span></span><br><span class="line"><span class="comment">             *      xï¼šåƒç´ ä½ç½®çš„æ¨ªåæ ‡ï¼Œå³åˆ—</span></span><br><span class="line"><span class="comment">             *      yï¼šåƒç´ ä½ç½®çš„çºµåæ ‡ï¼Œå³è¡Œ</span></span><br><span class="line"><span class="comment">             *      rgbï¼šåƒç´ çš„å€¼ï¼Œé‡‡ç”¨ 16 è¿›åˆ¶,å¦‚ 0xFFFFFF ç™½è‰²</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImage bufferedImage = <span class="keyword">new</span> BufferedImage(CODE_WIDTH, CODE_HEIGHT, BufferedImage.TYPE_INT_BGR);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; CODE_WIDTH; x++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; CODE_HEIGHT; y++) &#123;</span><br><span class="line">                    bufferedImage.setRGB(x, y, bitMatrix.get(x, y) ? FRONT_COLOR : BACKGROUND_COLOR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * åŒºåˆ«å°±æ˜¯ä»¥ä¸€å¥ï¼Œè¾“å‡ºåˆ°è¾“å‡ºæµä¸­ï¼Œå¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ Fileï¼Œåˆ™è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            ImageIO.write(bufferedImage, <span class="string">"png"</span>, outputStream);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"äºŒç»´ç å›¾ç‰‡ç”Ÿæˆåˆ°è¾“å‡ºæµæˆåŠŸ..."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æœ¬åœ°äºŒç»´ç å›¾ç‰‡â€”â€”â€”â€”â€”â€”â€”â€”è§£æäºŒç»´ç å†…å®¹</span></span><br><span class="line"><span class="comment">     * ï¼ˆæ³¨ï¼šå›¾ç‰‡å¿…é¡»æ˜¯äºŒç»´ç å›¾ç‰‡ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å¾®ä¿¡ç”¨æˆ·äºŒç»´ç åç‰‡ï¼Œä¸Šé¢æœ‰åç§°ã€å¤´åƒä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file æœ¬åœ°äºŒç»´ç å›¾ç‰‡æ–‡ä»¶,å¦‚ E:\\logs\\2.jpg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parseQRCodeByFile</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        String resultStr = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span> || file.isDirectory() || !file.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> resultStr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/**ImageIO çš„ BufferedImage read(URL input) æ–¹æ³•ç”¨äºè¯»å–ç½‘ç»œå›¾ç‰‡æ–‡ä»¶è½¬ä¸ºå†…å­˜ç¼“å†²å›¾åƒ</span></span><br><span class="line"><span class="comment">             * åŒç†è¿˜æœ‰ï¼šread(File input)ã€read(InputStream input)ã€ã€read(ImageInputStream stream)</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImage bufferedImage = ImageIO.read(file);</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * com.google.zxing.client.j2se.BufferedImageLuminanceSourceï¼šç¼“å†²å›¾åƒäº®åº¦æº</span></span><br><span class="line"><span class="comment">             * å°† java.awt.image.BufferedImage è½¬ä¸º zxing çš„ ç¼“å†²å›¾åƒäº®åº¦æº</span></span><br><span class="line"><span class="comment">             * å…³é”®å°±æ˜¯ä¸‹é¢è¿™å‡ å¥ï¼šHybridBinarizer ç”¨äºè¯»å–äºŒç»´ç å›¾åƒæ•°æ®ï¼ŒBinaryBitmap äºŒè¿›åˆ¶ä½å›¾</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImageLuminanceSource source = <span class="keyword">new</span> BufferedImageLuminanceSource(bufferedImage);</span><br><span class="line">            BinaryBitmap bitmap = <span class="keyword">new</span> BinaryBitmap(<span class="keyword">new</span> HybridBinarizer(source));</span><br><span class="line">            Hashtable hints = <span class="keyword">new</span> Hashtable();</span><br><span class="line">            hints.put(DecodeHintType.CHARACTER_SET, <span class="string">"UTF-8"</span>);</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å¦‚æœå›¾ç‰‡ä¸æ˜¯äºŒç»´ç å›¾ç‰‡ï¼Œåˆ™ decode æŠ›å¼‚å¸¸ï¼šcom.google.zxing.NotFoundException</span></span><br><span class="line"><span class="comment">             * MultiFormatWriter çš„ encode ç”¨äºå¯¹å†…å®¹è¿›è¡Œç¼–ç æˆ 2D çŸ©é˜µ</span></span><br><span class="line"><span class="comment">             * MultiFormatReader çš„ decode ç”¨äºè¯»å–äºŒè¿›åˆ¶ä½å›¾æ•°æ®</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Result result = <span class="keyword">new</span> MultiFormatReader().decode(bitmap, hints);</span><br><span class="line">            resultStr = result.getText();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"-----å›¾ç‰‡éäºŒç»´ç å›¾ç‰‡ï¼š"</span> + file.getPath());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç½‘ç»œäºŒç»´ç å›¾ç‰‡â€”â€”â€”â€”â€”â€”â€”â€”è§£æäºŒç»´ç å†…å®¹</span></span><br><span class="line"><span class="comment">     * ï¼ˆåŒºåˆ«ä»…ä»…åœ¨äº ImageIO.read(url); è¿™ä¸€ä¸ªé‡è½½çš„æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url äºŒç»´ç å›¾ç‰‡ç½‘ç»œåœ°å€ï¼Œå¦‚ https://res.wx.qq.com/mpres/htmledition/images/mp_qrcode3a7b38.gif</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parseQRCodeByUrl</span><span class="params">(URL url)</span> </span>&#123;</span><br><span class="line">        String resultStr = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (url == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> resultStr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/**ImageIO çš„ BufferedImage read(URL input) æ–¹æ³•ç”¨äºè¯»å–ç½‘ç»œå›¾ç‰‡æ–‡ä»¶è½¬ä¸ºå†…å­˜ç¼“å†²å›¾åƒ</span></span><br><span class="line"><span class="comment">             * åŒç†è¿˜æœ‰ï¼šread(File input)ã€read(InputStream input)ã€ã€read(ImageInputStream stream)</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * å¦‚æœå›¾ç‰‡ç½‘ç»œåœ°å€é”™è¯¯ï¼Œæ¯”å¦‚ä¸èƒ½è®¿é—®ï¼Œåˆ™ read æŠ›å¼‚å¸¸ï¼šjavax.imageio.IIOException: Can't get input stream from URL!</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImage bufferedImage = ImageIO.read(url);</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * com.google.zxing.client.j2se.BufferedImageLuminanceSourceï¼šç¼“å†²å›¾åƒäº®åº¦æº</span></span><br><span class="line"><span class="comment">             * å°† java.awt.image.BufferedImage è½¬ä¸º zxing çš„ ç¼“å†²å›¾åƒäº®åº¦æº</span></span><br><span class="line"><span class="comment">             * å…³é”®å°±æ˜¯ä¸‹é¢è¿™å‡ å¥ï¼šHybridBinarizer ç”¨äºè¯»å–äºŒç»´ç å›¾åƒæ•°æ®ï¼ŒBinaryBitmap äºŒè¿›åˆ¶ä½å›¾</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            BufferedImageLuminanceSource source = <span class="keyword">new</span> BufferedImageLuminanceSource(bufferedImage);</span><br><span class="line">            BinaryBitmap bitmap = <span class="keyword">new</span> BinaryBitmap(<span class="keyword">new</span> HybridBinarizer(source));</span><br><span class="line">            Hashtable hints = <span class="keyword">new</span> Hashtable();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å¦‚æœå†…å®¹åŒ…å«ä¸­æ–‡ï¼Œåˆ™è§£ç çš„å­—ç¬¦é›†æ ¼å¼åº”è¯¥å’Œç¼–ç æ—¶ä¸€è‡´</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            hints.put(DecodeHintType.CHARACTER_SET, <span class="string">"UTF-8"</span>);</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å¦‚æœå›¾ç‰‡ä¸æ˜¯äºŒç»´ç å›¾ç‰‡ï¼Œåˆ™ decode æŠ›å¼‚å¸¸ï¼šcom.google.zxing.NotFoundException</span></span><br><span class="line"><span class="comment">             * MultiFormatWriter çš„ encode ç”¨äºå¯¹å†…å®¹è¿›è¡Œç¼–ç æˆ 2D çŸ©é˜µ</span></span><br><span class="line"><span class="comment">             * MultiFormatReader çš„ decode ç”¨äºè¯»å–äºŒè¿›åˆ¶ä½å›¾æ•°æ®</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Result result = <span class="keyword">new</span> MultiFormatReader().decode(bitmap, hints);</span><br><span class="line">            resultStr = result.getText();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"-----äºŒç»´ç å›¾ç‰‡åœ°å€é”™è¯¯ï¼š"</span> + url);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"-----å›¾ç‰‡éäºŒç»´ç å›¾ç‰‡ï¼š"</span> + url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆäºŒç»´ç å·¥å…·</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text     æ–‡æœ¬</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width    å®½åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height   é«˜åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2020/12/25 20:30</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateQRCodeImage</span><span class="params">(String text, <span class="keyword">int</span> width, <span class="keyword">int</span> height, String filePath)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> WriterException, IOException </span>&#123;</span><br><span class="line">        QRCodeWriter qrCodeWriter = <span class="keyword">new</span> QRCodeWriter();</span><br><span class="line">        BitMatrix bitMatrix = qrCodeWriter.encode(text, BarcodeFormat.QR_CODE, width, height);</span><br><span class="line">        Path path = FileSystems.getDefault().getPath(filePath);</span><br><span class="line">        MatrixToImageWriter.writeToPath(bitMatrix, <span class="string">"PNG"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        File localFile = <span class="keyword">new</span> File(<span class="string">"E:\\logs\\1.png"</span>);</span><br><span class="line">        String file = parseQRCodeByFile(localFile);</span><br><span class="line">        System.out.println(localFile + <span class="string">" äºŒç»´ç å†…å®¹ï¼š"</span> + file);</span><br><span class="line"></span><br><span class="line">        URL url = <span class="keyword">new</span> URL(<span class="string">"https://res.wx.qq.com/mpres/htmledition/images/mp_qrcode3a7b38.gif"</span>);</span><br><span class="line">        String code = parseQRCodeByUrl(url);</span><br><span class="line">        System.out.println(url + <span class="string">" äºŒç»´ç å†…å®¹ï¼š"</span> + code);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            generateQRCodeImage(<span class="string">"Hello World"</span>, <span class="number">350</span>, <span class="number">350</span>, <span class="string">"C:\\Users\\Desktop\\QRTest.png"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WriterException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Utils</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“</title>
    <url>/post/1d063ae7.html</url>
    <content><![CDATA[<blockquote><p>å·¥ä½œä¸­linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“ï¼Œç¥æ„¿æ¯ä¸€ä¸ªç¨‹åºå‘˜å¤©å¤©æ— bug ~ ~</p></blockquote><a id="more"></a><ol><li><p>æ ¹æ® å…³é”®è¯ æŸ¥çœ‹æ—¥å¿— å¹¶è¿”å›å…³é”®è¯æ‰€åœ¨è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat  log.log | grep "train"ã€€ã€€# è¿”å›log.logä¸­åŒ…å«trainçš„æ‰€æœ‰è¡Œ</span><br><span class="line">grep -i "train" log.log  æˆ–è€… grep -a  "train" log.log  ã€€# è¿”å›log.logä¸­åŒ…å«trainçš„æ‰€æœ‰è¡Œï¼›ä½¿ç”¨ -i å…³é—­å¤§å°å†™æ•æ„Ÿ</span><br><span class="line">grep 'XXX' service.log -C2  # ä½¿ç”¨ -C2 æ¥å¤šå±•ç¤ºæ—¥å¿—ä¸‹é¢çš„ä¸¤è¡Œï¼Œè¿™é‡Œçš„ C æ˜¯å¤§å†™çš„ï¼›ä½¿ç”¨ -v æœç´¢ä¸åŒ…å«æŸä¸ªå†…å®¹çš„æ•°æ®ï¼ˆå–åï¼‰</span><br></pre></td></tr></table></figure></li><li><p>å…³é”®è¯å‰åè¡Œä¿¡æ¯æ‰“å°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat xx.log | grep -C 5 'å…³é”®å­—' æ˜¾ç¤ºfileæ–‡ä»¶é‡ŒåŒ¹é…â€œå…³é”®å­—â€å­—ä¸²é‚£è¡Œä»¥åŠä¸Šä¸‹5è¡Œ</span><br><span class="line">cat xx.log | grep -B 5 'å…³é”®å­—' æ˜¾ç¤ºâ€œå…³é”®å­—â€åŠå‰5è¡Œ</span><br><span class="line">cat xx.log | grep -A 5 'å…³é”®å­—' æ˜¾ç¤ºâ€œå…³é”®å­—â€åŠå5è¡Œ</span><br></pre></td></tr></table></figure></li><li><p>å®æ—¶è¿‡æ»¤æ‰“å°çš„å‚æ•°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -f  æ–‡ä»¶å | grep -i "å…³é”®è¯"</span><br></pre></td></tr></table></figure></li><li><p>Sed å‘½ä»¤æ‰“å°æ¨¡ç³ŠæŸ¥è¯¢</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -n "/å…³é”®è¯/p" æ–‡ä»¶å</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç«¯å£å·è¿›ç¨‹ PID</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsof -i:ç«¯å£å·</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å•ä¸ªé…ç½®æ–‡ä»¶: nohup java -jar vTest.jar  --spring.config.location=/opt/vTest-conf/application.yml &gt;  /opt/home/nohup.out 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">å¤šä¸ªé…ç½®æ–‡ä»¶: nohup java -jar vTest.jar --spring.config.location=/home/jar/config/application.yml,/home/jar/config/application-dev.yml &gt;  /home/jar/api-nohup.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥Jarè¿›ç¨‹çš„ PID</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -ef | grep member.root.weChat.jar</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡ŒJarå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup java -jar service-qq-app.jar &amp;</span><br><span class="line">nohup java -jar service-qq-app.jar &gt;  /home/jar/api-nohup.out 2&gt;&amp;1 &amp; #æŒ‡å®šæ‰“å°æ—¥å¿—æ–‡ä»¶</span><br></pre></td></tr></table></figure></li><li><p>Linuxä¸‹æµ‹è¯•IPç«¯å£å·è¿é€šæ€§</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å‘½ä»¤wgetï¼ˆæ¨èä½¿ç”¨ï¼‰</span></span><br><span class="line">wget 192.168.10.253:9000</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„æ—¥å¿—</p><p>æœ‰æ—¶ï¼Œéœ€è¦æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„æ—¥å¿—ï¼Œæ¯”å¦‚å‡Œæ™¨2ç‚¹15åˆ†ç³»ç»Ÿå‡ºç°æŠ¥è­¦ï¼Œä¸Šç­åæˆ‘ä»¬æƒ³çœ‹çœ‹è¿™æ®µæ—¶é—´çš„æ—¥å¿—ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ç‚¹çº¿ç´¢ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º02:14åˆ°02:16åˆ†çš„æ—¥å¿—</span></span><br><span class="line">awk '/2022-06-24T02:14/,/2022-06-24T02:1[6-9]/' app.log &gt; app0215.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨sedä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line">sed -n '/2022-06-24T02:14/,/2022-06-24T02:1[6-9]/p' app.log &gt; app0215.log</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šawkä¸sedå®é™…å¹¶ä¸è§£ææ—¶é—´ï¼Œå®ƒä»¬åªæ˜¯æŒ‰æ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…åˆ°ç¬¬ä¸€ä¸ªæ­£åˆ™æ—¶ï¼Œå¼€å§‹è¾“å‡ºè¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬äºŒä¸ªæ­£åˆ™å…³é—­ï¼Œæ‰€ä»¥å¦‚æœä½ çš„æ—¥å¿—ä¸­æ²¡æœ‰èƒ½åŒ¹é…ç¬¬äºŒä¸ªæ­£åˆ™çš„è¡Œï¼Œå°†å¯¼è‡´ä¸€ç›´è¾“å‡ºåˆ°å°¾è¡Œï¼æ‰€ä»¥ä¸€èˆ¬éœ€è¦å°†ç¬¬äºŒä¸ªæ­£åˆ™å˜å®½æ¾ç‚¹ï¼Œå¦‚ä¸Šé¢çš„/2022-06-24T02:1[6-9]/ï¼Œä»¥é¿å…å‡ºç°è¿™ç§æƒ…å†µ</p></li><li><p>æŸ¥çœ‹æœ€å10æ¡é”™è¯¯</p><p>æ›´å¤šæƒ…å†µæ˜¯ï¼Œä¸Šç­æ—¶å‘ç°ç³»ç»Ÿæœ‰æŠ¥è­¦ï¼Œäºæ˜¯æƒ³ç«‹é©¬çœ‹çœ‹åˆšåˆšå‘ç”Ÿäº†ä»€ä¹ˆï¼Œå³æŸ¥æ‰¾æœ€è¿‘çš„å¼‚å¸¸æ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æœ€å®¹æ˜“æƒ³åˆ°çš„æ˜¯tailï¼Œä½†æœ‰å¯èƒ½æœ€å1000è¡Œæ—¥å¿—å…¨æ˜¯æ­£å¸¸æ—¥å¿—</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tail -n 1000 app.log | less</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ€å10æ¡å¼‚å¸¸, tacä¼šåå‘è¯»å–æ—¥å¿—è¡Œï¼Œç„¶åç”¨grepæ‰¾åˆ°10ä¸ªå¼‚å¸¸æ—¥å¿—ï¼Œå†ç”¨tacåˆåå‘ä¸€æ¬¡å°±æ­£å‘äº†  </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tac app.log | grep -n -m10 ERROR | tac</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://segmentfault.com/a/1190000042033198" target="_blank" rel="noopener">ã€Šæ‹’ç»è›®åŠ›ï¼Œé«˜æ•ˆæŸ¥çœ‹Linuxæ—¥å¿—æ–‡ä»¶ï¼ã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Linux OS</category>
      </categories>
      <tags>
        <tag>Linux OS</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®ç°PDFé¦–é¡µè½¬ç¼©ç•¥å›¾</title>
    <url>/post/9be4f81b.html</url>
    <content><![CDATA[<blockquote><p>PDFé¦–é¡µè½¬ç¼©ç•¥å›¾ ~ è¯·å¼€å§‹æ‚¨çš„è¡¨æ¼”~</p></blockquote><a id="more"></a><h3 id="ä¸€ã€mavenå®‰è£…"><a href="#ä¸€ã€mavenå®‰è£…" class="headerlink" title="ä¸€ã€mavenå®‰è£…"></a>ä¸€ã€mavenå®‰è£…</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.icepdf.os&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;icepdf-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;6.2.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€Javaä»£ç å®ç°"><a href="#äºŒã€Javaä»£ç å®ç°" class="headerlink" title="äºŒã€Javaä»£ç å®ç°"></a>äºŒã€Javaä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.icepdf.core.pobjects.Document;</span><br><span class="line"><span class="keyword">import</span> org.icepdf.core.pobjects.Page;</span><br><span class="line"><span class="keyword">import</span> org.icepdf.core.util.GraphicsRenderingHints;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.IIOImage;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageWriter;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.stream.ImageOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CapturePdfFirstPageUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆä¸€æœ¬ä¹¦çš„ç¼©ç•¥å›¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputFile  éœ€è¦ç”Ÿæˆç¼©ç•¥å›¾çš„ä¹¦ç±çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile ç”Ÿæˆç¼©ç•¥å›¾çš„æ”¾ç½®è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateBookIamge</span><span class="params">(String inputFile, String outputFile)</span> </span>&#123;</span><br><span class="line">        Document document = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">float</span> rotation = <span class="number">0f</span>;</span><br><span class="line">            <span class="comment">// ç¼©ç•¥å›¾æ˜¾ç¤ºå€æ•°ï¼Œ1è¡¨ç¤ºä¸ç¼©æ”¾ï¼Œ0.5è¡¨ç¤ºç¼©å°åˆ°50%</span></span><br><span class="line">            <span class="keyword">float</span> zoom = <span class="number">0.8f</span>;</span><br><span class="line"></span><br><span class="line">            document = <span class="keyword">new</span> Document();</span><br><span class="line">            document.setFile(inputFile);</span><br><span class="line">            <span class="comment">// maxPages = document.getPageTree().getNumberOfPages();</span></span><br><span class="line"></span><br><span class="line">            BufferedImage p_w_picpath = (BufferedImage) document.getPageImage(<span class="number">0</span>, GraphicsRenderingHints.SCREEN,</span><br><span class="line">                    Page.BOUNDARY_CROPBOX, rotation, zoom);</span><br><span class="line"></span><br><span class="line">            Iterator iter = ImageIO.getImageWritersBySuffix(<span class="string">"jpg"</span>);</span><br><span class="line">            ImageWriter writer = (ImageWriter) iter.next();</span><br><span class="line"></span><br><span class="line">            FileOutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(outputFile));</span><br><span class="line">            ImageOutputStream outImage = ImageIO.createImageOutputStream(out);</span><br><span class="line"></span><br><span class="line">            writer.setOutput(outImage);</span><br><span class="line">            writer.write(<span class="keyword">new</span> IIOImage(p_w_picpath, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"ç”Ÿæˆä¹¦çš„ç¼©ç•¥å›¾å¤±è´¥ : "</span> + inputFile);</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CapturePdfFirstPageUtil.generateBookIamge(<span class="string">"C:\\Users\\Downloads\\æˆ‘æ˜¯å¸…å­ç”·ä¸€å·.pdf"</span>, <span class="string">"C:\\Users\\Desktop\\å¸…å­ç”·ä¸€å·.jpg"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>PDF</category>
      </categories>
      <tags>
        <tag>PDF</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ‰“åŒ…è§£å†³xx.jarä¸­æ²¡æœ‰ä¸»æ¸…å•å±æ€§é—®é¢˜</title>
    <url>/post/a4e7c890.html</url>
    <content><![CDATA[<blockquote><p>SpringBooté¡¹ç›®æ‰“jaråŒ…éƒ¨ç½²çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œxxx.jaråŒ…ä¸­æ²¡æœ‰ä¸»æ¸…å•å±æ€§é—®é¢˜è§£å†³è®°å½•ã€‚</p></blockquote><a id="more"></a><h4 id="ä¸€ã€é—®é¢˜è§£æ"><a href="#ä¸€ã€é—®é¢˜è§£æ" class="headerlink" title="ä¸€ã€é—®é¢˜è§£æ"></a>ä¸€ã€é—®é¢˜è§£æ</h4><p>â€‹ æœ‰é—®é¢˜çš„jaråŒ…æ–‡ä»¶ä¸­å°‘äº†Spring-Boot-Versionã€Main-Classã€Start-Classã€Spring-Boot-Classesã€Spring-Boot-Libäº”ä¸ªSpringbootç›¸å…³çš„å±æ€§ã€‚</p><ol><li>â€‹ Main-Classï¼šå±æ€§å€¼ä»£è¡¨äº†Spring Bootä¸­å¯åŠ¨jaråŒ…çš„ç¨‹åºï¼Œå€¼ä¸º org.springframework.boot.loader.JarLauncherï¼Œè¿™ä¸ªå°±æ˜¯Springbootå¯åŠ¨é¡¹ç›®çš„ç±»</li><li>Start-Classï¼šå±æ€§å€¼ä»£è¡¨äº†Spring Bootç¨‹åºçš„å…¥å£ç±»ï¼Œå³XXXApplicationç±»</li><li>Spring-Boot-Classesï¼šå±æ€§å€¼ä»£è¡¨äº†ç±»è·¯å¾„ï¼Œæ‰€æœ‰ç¼–è¯‘åçš„classæ–‡ä»¶ï¼Œä»¥åŠé…ç½®æ–‡ä»¶ï¼Œéƒ½å­˜å‚¨åœ¨è¯¥è·¯å¾„ä¸‹</li><li>Spring-Boot-Libï¼šå±æ€§å€¼ä»£è¡¨äº†è¡¨ç¤ºä¾èµ–çš„jaråŒ…å­˜å‚¨çš„ä½ç½®</li></ol><p>ä»¥ä¸Šè¿™äº›å±æ€§æ˜¯Springbootæ‰“åŒ…æ’ä»¶é»˜è®¤ç”Ÿæˆï¼Œç¼ºå°‘è¿™äº›å±æ€§é¡¹ç›®æ— æ³•è¿è¡Œã€‚</p><h4 id="äºŒã€æ·»åŠ mavenæ‰“åŒ…æ’ä»¶"><a href="#äºŒã€æ·»åŠ mavenæ‰“åŒ…æ’ä»¶" class="headerlink" title="äºŒã€æ·»åŠ mavenæ‰“åŒ…æ’ä»¶"></a>äºŒã€æ·»åŠ mavenæ‰“åŒ…æ’ä»¶</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- å¯åŠ¨ç±»åŒ…å --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.shuaizi.DockerApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- åœ¨mvn package ä¹‹åï¼Œå†æ¬¡æ‰“åŒ…æˆä¸ºä¸€ä¸ª å¯æ‰§è¡Œçš„jar/warï¼ŒåŒæ—¶ä¿ç•™mvn packageç”Ÿæˆçš„jar/warä¸º.origin åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨å¯æ‰§è¡Œçš„jaræˆ–waræ–‡ä»¶ã€‚å®ƒå¯ä»¥æ›¿æ¢å¸¸è§„çš„artifactï¼Œæˆ–è€…ç”¨ä¸€ä¸ªå•ç‹¬çš„classifieré™„å±åœ¨mavenæ„å»ºçš„ç”Ÿå‘½å‘¨æœŸä¸­ã€‚--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>Maven</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxä¸‹dockerå®‰è£…ã€Portainerå›¾å½¢åŒ–éƒ¨ç½²ä»‹ç»</title>
    <url>/post/40d21fb3.html</url>
    <content><![CDATA[<blockquote><p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­,ç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæœºå™¨æˆ–Windows æœºå™¨ä¸Š,ä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–,å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶,ç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚</p></blockquote><a id="more"></a><h3 id="ä¸€ã€Dockerå®‰è£…"><a href="#ä¸€ã€Dockerå®‰è£…" class="headerlink" title="ä¸€ã€Dockerå®‰è£…"></a>ä¸€ã€Dockerå®‰è£…</h3><p>â€‹ 1. æ›´æ–°yumæº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure><p>â€‹ 2. å®‰è£…epelæº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y epel-release </span><br><span class="line">â€‹```shell</span><br><span class="line">â€‹	3. æ¸…é™¤ç¼“å­˜</span><br><span class="line">â€‹```shell</span><br><span class="line">yum clean all</span><br></pre></td></tr></table></figure><p>â€‹ 4. å®‰è£…Docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-io -y</span><br></pre></td></tr></table></figure><p>â€‹ 5. è¿è¡ŒDocker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>â€‹ 6. æ£€æŸ¥å®‰è£…ç»“æœ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure><h3 id="äºŒã€Portainer-UI-å®‰è£…"><a href="#äºŒã€Portainer-UI-å®‰è£…" class="headerlink" title="äºŒã€Portainer  UI  å®‰è£…"></a>äºŒã€Portainer UI å®‰è£…</h3><p>â€‹ 1. ä¸‹è½½é•œåƒ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull docker.io/portainer/portainer</span><br></pre></td></tr></table></figure><p>â€‹ 2. è¿è¡Œå¯åŠ¨Portainer UI</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 9000:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --name portainer  docker.io/portainer/portainer</span><br></pre></td></tr></table></figure><p>å¦‚æœ9000ç«¯å£åˆ«å ç”¨çš„è¯ï¼Œå¯ä»¥æ¢æˆå…¶ä»–ç«¯å£ã€‚</p><h3 id="ä¸‰ã€å¼€å¯Dockerè¿œç¨‹è®¿é—®"><a href="#ä¸‰ã€å¼€å¯Dockerè¿œç¨‹è®¿é—®" class="headerlink" title="ä¸‰ã€å¼€å¯Dockerè¿œç¨‹è®¿é—®"></a>ä¸‰ã€å¼€å¯Dockerè¿œç¨‹è®¿é—®</h3><pre><code>1.  é»˜è®¤çš„Dockeræ˜¯ä¸æ”¯æŒè¿œç¨‹è®¿é—®çš„ï¼Œéœ€è¦åŠ ç‚¹é…ç½®ï¼Œå¼€å¯Dockerçš„è¿œç¨‹è®¿é—®ï¼Œä¿®æ”¹æœåŠ¡å™¨çš„docker.serviceæ–‡ä»¶
  ä¿®æ”¹ä»¥ExecStartå¼€å¤´çš„è¡Œï¼ˆcentos 7ï¼‰ï¼š</code></pre><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹DockeræœåŠ¡æ–‡ä»¶ï¼Œéœ€è¦å…ˆåˆ‡æ¢åˆ°rootç”¨æˆ·</span></span><br><span class="line">vim /lib/systemd/system/docker.service</span><br><span class="line"><span class="meta">#</span><span class="bash">æ³¨é‡Šæ‰<span class="string">"ExecStart"</span>è¿™ä¸€è¡Œï¼Œå¹¶æ·»åŠ ä¸‹é¢è¿™ä¸€è¡Œä¿¡æ¯</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H tcp://0.0.0.0:2375</span><br></pre></td></tr></table></figure><p>â€‹ 2. é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ä»¥åŠé‡å¯docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash">é‡å¯æœåŠ¡</span></span><br><span class="line">systemctl restart docker.service</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹é…ç½®çš„ç«¯å£å·ï¼ˆ2375ï¼‰æ˜¯å¦å¼€å¯ï¼ˆé˜²ç«å¢™å¿…é¡»æ”¾å¼€dockerè¿œç¨‹ç«¯å£ï¼Œå¦‚æœæ‰¾ä¸åˆ°netstatå‘½ä»¤ï¼Œå¯ä»¥å…ˆå®‰è£…ä¸€ä¸‹è¿™ä¸ªå·¥å…·ï¼Œå…·ä½“ç™¾åº¦ã€‚</span></span><br><span class="line">netstat -ntulp |grep 2375</span><br></pre></td></tr></table></figure><p>â€‹ 3. æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸è¿”å›</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl http://localhost:2375/version</span><br></pre></td></tr></table></figure><p>â€‹ 4. è®¿é—® <strong><a href="http://IPåœ°å€:9000/" target="_blank" rel="noopener">http://IPåœ°å€:9000/</a></strong> å³å¯çœ‹åˆ°Portainer UIç•Œé¢</p><h3 id="å››ã€Ideaè¿æ¥Docker"><a href="#å››ã€Ideaè¿æ¥Docker" class="headerlink" title="å››ã€Ideaè¿æ¥Docker"></a>å››ã€Ideaè¿æ¥Docker</h3><h4 id="1ã€ä½¿ç”¨ideaçš„dockeræ’ä»¶è¿æ¥dockerï¼Œä¸‹è½½è¿‡dockeræ’ä»¶äº†ã€‚"><a href="#1ã€ä½¿ç”¨ideaçš„dockeræ’ä»¶è¿æ¥dockerï¼Œä¸‹è½½è¿‡dockeræ’ä»¶äº†ã€‚" class="headerlink" title="1ã€ä½¿ç”¨ideaçš„dockeræ’ä»¶è¿æ¥dockerï¼Œä¸‹è½½è¿‡dockeræ’ä»¶äº†ã€‚"></a>1ã€ä½¿ç”¨ideaçš„dockeræ’ä»¶è¿æ¥dockerï¼Œä¸‹è½½è¿‡dockeræ’ä»¶äº†ã€‚</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311111835.png" alt=""></p><h4 id="2ã€ç‚¹å‡»ideaçš„è®¾ç½®é€‰é¡¹ï¼ˆfile-â€“-gt-setting-gt-dockerï¼‰-æ–°å»ºè¿æ¥"><a href="#2ã€ç‚¹å‡»ideaçš„è®¾ç½®é€‰é¡¹ï¼ˆfile-â€“-gt-setting-gt-dockerï¼‰-æ–°å»ºè¿æ¥" class="headerlink" title="2ã€ç‚¹å‡»ideaçš„è®¾ç½®é€‰é¡¹ï¼ˆfile â€“&gt; setting -&gt; dockerï¼‰,æ–°å»ºè¿æ¥"></a>2ã€ç‚¹å‡»ideaçš„è®¾ç½®é€‰é¡¹ï¼ˆfile â€“&gt; setting -&gt; dockerï¼‰,æ–°å»ºè¿æ¥</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112013.png" alt=""></p><h4 id="3ã€é•œåƒçš„æ‹‰å–"><a href="#3ã€é•œåƒçš„æ‹‰å–" class="headerlink" title="3ã€é•œåƒçš„æ‹‰å–"></a>3ã€é•œåƒçš„æ‹‰å–</h4><p>ideaå¯ä»¥é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ‹‰å–é•œåƒï¼Œä¸ç”¨è‡ªå·±å»æ•²å‘½ä»¤<br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112211.png" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112025.png" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112033.png" alt=""><br>æœ‰æ—¶å€™ä¼šå‡ºç°æ‹‰å–çš„æ—¶é—´è¶…æ—¶çš„æƒ…å†µï¼Œå¯ä»¥é…ç½®ä¸€ä¸‹å›½å†…çš„é•œåƒè·å–é˜¿é‡Œäº‘çš„åŠ é€Ÿå™¨<br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112118.png" alt=""></p><h4 id="4ã€å®¹å™¨çš„åˆ›å»ºä¸è¿è¡Œ"><a href="#4ã€å®¹å™¨çš„åˆ›å»ºä¸è¿è¡Œ" class="headerlink" title="4ã€å®¹å™¨çš„åˆ›å»ºä¸è¿è¡Œ"></a>4ã€å®¹å™¨çš„åˆ›å»ºä¸è¿è¡Œ</h4><h5 id="a-åˆ›å»ºå¹¶ä¸”è¿è¡Œdockerå®¹å™¨"><a href="#a-åˆ›å»ºå¹¶ä¸”è¿è¡Œdockerå®¹å™¨" class="headerlink" title="a.åˆ›å»ºå¹¶ä¸”è¿è¡Œdockerå®¹å™¨"></a>a.åˆ›å»ºå¹¶ä¸”è¿è¡Œdockerå®¹å™¨</h5><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112121.png" alt=""><br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112123.png" alt=""></p><h5 id="b-åˆ›å»ºæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨-è™šæ‹Ÿæœº-ä¸Šç”¨dockerå‘½ä»¤æŸ¥çœ‹"><a href="#b-åˆ›å»ºæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨-è™šæ‹Ÿæœº-ä¸Šç”¨dockerå‘½ä»¤æŸ¥çœ‹" class="headerlink" title="b.åˆ›å»ºæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨(è™šæ‹Ÿæœº)ä¸Šç”¨dockerå‘½ä»¤æŸ¥çœ‹"></a>b.åˆ›å»ºæˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨(è™šæ‹Ÿæœº)ä¸Šç”¨dockerå‘½ä»¤æŸ¥çœ‹</h5><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112207.png" alt=""></p><h5 id="c-é‡å¯å®¹å™¨ã€åœæ­¢å®¹å™¨å’Œåˆ é™¤å®¹å™¨ç­‰æ“ä½œ"><a href="#c-é‡å¯å®¹å™¨ã€åœæ­¢å®¹å™¨å’Œåˆ é™¤å®¹å™¨ç­‰æ“ä½œ" class="headerlink" title="c.é‡å¯å®¹å™¨ã€åœæ­¢å®¹å™¨å’Œåˆ é™¤å®¹å™¨ç­‰æ“ä½œ"></a>c.é‡å¯å®¹å™¨ã€åœæ­¢å®¹å™¨å’Œåˆ é™¤å®¹å™¨ç­‰æ“ä½œ</h5><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210311112145.png" alt=""></p><h3 id="äº”ã€DockeråŸºæœ¬å‘½ä»¤"><a href="#äº”ã€DockeråŸºæœ¬å‘½ä»¤" class="headerlink" title="äº”ã€DockeråŸºæœ¬å‘½ä»¤"></a>äº”ã€DockeråŸºæœ¬å‘½ä»¤</h3><ol><li><p>å¯åŠ¨docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>å¼€æœºå¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å·²ç»è¿è¡Œçš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></li><li><p>å½»åº•å¸è½½å¹²å‡€dockerå¹¶ä¸”å®‰è£…docker æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-selinux \</span><br><span class="line">docker-engine-selinux \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line">rm -rf /etc/systemd/system/docker.service.d</span><br><span class="line"></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"></span><br><span class="line">rm -rf /var/run/docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è¿‡æ»¤ä¸€ä¸‹è¿˜æœ‰æ²¡æœ‰æ²¡å¸è½½æ‰çš„docker</span></span><br><span class="line">rpm -qa|grep docker</span><br></pre></td></tr></table></figure><h3 id="å…­ã€å®¹å™¨ç®¡ç†å·¥å…·"><a href="#å…­ã€å®¹å™¨ç®¡ç†å·¥å…·" class="headerlink" title="å…­ã€å®¹å™¨ç®¡ç†å·¥å…·"></a>å…­ã€å®¹å™¨ç®¡ç†å·¥å…·</h3><p><a href="https://www.cnblogs.com/zhangxingeng/p/11753959.html#toc_6" target="_blank" rel="noopener">ã€ŠRancher 2.xã€‹</a><br><a href="https://gitee.com/rancher/rancher" target="_blank" rel="noopener">ã€ŠRancherç äº‘å­˜å‚¨åº“ã€‹</a><br><a href="https://docs.rancher.cn/rancher2/" target="_blank" rel="noopener">ã€ŠRancherå®˜æ–¹ç½‘ç«™ã€‹</a></p></li></ol><blockquote><ol><li>Rancherä¸ä»…èƒ½å¤Ÿç®¡ç†åº”ç”¨å®¹å™¨ï¼Œæ›´é‡è¦çš„ä¸€ç‚¹æ˜¯èƒ½å¤Ÿç®¡ç†K8sé›†ç¾¤ã€‚</li><li>Rancher2.xåº•å±‚åŸºäºk8sè°ƒåº¦å¼•æ“ï¼Œé€šè¿‡Rancherçš„å°è£…ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ç†Ÿæ‚‰k8sæ¦‚å¿µçš„æƒ…å†µä¸‹è½»æ¾çš„é€šè¿‡Rancheræ¥éƒ¨ç½²å®¹å™¨åˆ°k8sé›†ç¾¤å½“ä¸­ã€‚</li></ol></blockquote><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210318103536.png" alt="Rancherå’ŒK8sçš„åˆæ­¥å¯¹æ¯”"></p><h3 id="ä¸ƒã€å®‰è£…-redis"><a href="#ä¸ƒã€å®‰è£…-redis" class="headerlink" title="ä¸ƒã€å®‰è£… redis"></a>ä¸ƒã€å®‰è£… redis</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull redis:latest</span><br><span class="line">docker run -itd --name redis-6379 -p 6379:6379 redis</span><br></pre></td></tr></table></figure><h3 id="å…«ã€å¢åŠ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#å…«ã€å¢åŠ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="å…«ã€å¢åŠ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>å…«ã€å¢åŠ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h3><p>â€œregistry-mirrorsâ€:[<br>â€œ<a href="https://ig73arpt.mirror.aliyuncs.com&quot;" target="_blank" rel="noopener">https://ig73arpt.mirror.aliyuncs.com&quot;</a><br>]</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/image-20220712172017023.png" alt="image-20220712172017023"></p><h3 id="ä¹ã€å®‰è£…-mysql"><a href="#ä¹ã€å®‰è£…-mysql" class="headerlink" title="ä¹ã€å®‰è£… mysql"></a>ä¹ã€å®‰è£… mysql</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line">docker run -itd -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=root mysql</span><br></pre></td></tr></table></figure><h3 id="åã€å®‰è£…-zk"><a href="#åã€å®‰è£…-zk" class="headerlink" title="åã€å®‰è£… zk"></a>åã€å®‰è£… zk</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull docker.io/zookeeper</span><br><span class="line"></span><br><span class="line">docker run --privileged=true -d --name zookeeper --publish 2181:2181  -d zookeeper:latest</span><br></pre></td></tr></table></figure><h3 id="åä¸€ã€å®‰è£…-kafka"><a href="#åä¸€ã€å®‰è£…-kafka" class="headerlink" title="åä¸€ã€å®‰è£… kafka"></a>åä¸€ã€å®‰è£… kafka</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull wurstmeister/kafka</span><br><span class="line"></span><br><span class="line">docker run -d --name kafka --publish 9092:9092 --link zookeeper --env KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181 --env KAFKA_ADVERTISED_HOST_NAME=localhost --env KAFKA_ADVERTISED_PORT=9092  wurstmeister/kafka</span><br></pre></td></tr></table></figure><h3 id="åäºŒã€å®‰è£…-mongodb"><a href="#åäºŒã€å®‰è£…-mongodb" class="headerlink" title="åäºŒã€å®‰è£… mongodb"></a>åäºŒã€å®‰è£… mongodb</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name mongodb -v ~/docker/mongo:/data/db -p 27017:27017 -d mongo</span><br></pre></td></tr></table></figure><h3 id="åä¸‰ã€å‚è€ƒæ¨è"><a href="#åä¸‰ã€å‚è€ƒæ¨è" class="headerlink" title="åä¸‰ã€å‚è€ƒæ¨è"></a>åä¸‰ã€å‚è€ƒæ¨è</h3><p><a href="https://blog.csdn.net/caidingnu/article/details/109279904" target="_blank" rel="noopener">ã€ŠIDEAä½¿ç”¨Dockeræ’ä»¶æ„å»ºé•œåƒã€‹</a></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Portainer</tag>
      </tags>
  </entry>
  <entry>
    <title>ideaæ’ä»¶åˆ†äº«è®°å½•</title>
    <url>/post/a8bfc85a.html</url>
    <content><![CDATA[<blockquote><p>IDEAæ’ä»¶åˆ†äº«ä¸è®°å½•</p></blockquote><a id="more"></a><ol><li><p>CamelCase â€“ å¿«é€Ÿè½¬æˆé©¼å³°æ ¼å¼ï¼Œå®‰è£…å¥½åï¼Œé€‰ä¸­è¦ä¿®æ”¹çš„åç§°ï¼ŒæŒ‰å¿«æ·é”®shift+alt+u æ’ä»¶ï¼›</p></li><li><p>generate all setter â€“ Alt+Enterå°±ä¼šå‡ºæ¥ generate all setteré€‰é¡¹,è‡ªåŠ¨ç”Ÿæˆsetæ–¹æ³•ï¼›</p></li><li><p>Auto filling java call arguments â€“ è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ Alt+Enter ç»„åˆé”®ï¼Œè°ƒå‡º â€œAuto fill call parametersâ€ è‡ªåŠ¨ä½¿ç”¨è¯¥å‡½æ•°å®šä¹‰çš„å‚æ•°åå¡«å……ï¼›</p></li><li><p>string-manipulation â€“ æ’ä»¶ä½¿ç”¨ Alt+m è¿›è¡Œä½¿ç”¨ï¼›</p></li><li><p>SequenceDiagram â€“ æ–¹æ³•è°ƒç”¨æ—¶åºå›¾ï¼›</p></li><li><p>better-mybatis-generatorã€Easy Code â€“ ä»£ç ç”Ÿæˆå·¥å…·ï¼›</p></li><li><p>MybatisLogFormat â€“ æå–SQLå¹¶å°†å‚æ•°å¡«å……åˆ°SQLä¸­åˆ°æ§åˆ¶å°ï¼›</p></li><li><p>extra-icons â€“ å„ç§æ–‡ä»¶å›¾æ ‡ï¼›</p></li><li><p>atom-material-icons â€“ æ–‡ä»¶å›¾æ ‡(ç°åœ¨ä½¿ç”¨)ï¼›</p></li><li><p>dark-purple-theme â€“ æ·±ç´«è‰²ä¸»é¢˜(ç°åœ¨ä½¿ç”¨)ï¼›</p></li><li><p>Ideaæ±‰åŒ–æ’ä»¶ â€“ Chinese (Simplified) Language Packï¼›</p></li><li><p>Ideaä»£ç æ ¼å¼åŒ–æ’ä»¶(é˜¿é‡Œå·´å·´è§„èŒƒæ’ä»¶) â€“ Eclipse Code Formatter, <a href="https://github.com/alibaba/p3c/tree/master/p3c-formatter" target="_blank" rel="noopener">æ ·å¼xmlæ–‡ä»¶åœ°å€</a> ï¼›</p></li><li><p>æœç´¢æ¥å£å·¥å…·: Restfultool\Restfultoolkit(Ideaæ›´æ–°åˆ°2020å,Restfultoolkitæ— æ³•æ˜¾ç¤ºæ¥å£ä¿¡æ¯) ç›®å‰ä½¿ç”¨ Restfultool å°±å¯ä»¥ï¼›</p></li><li><p>Cloud Toolkit: ä¸€é”®éƒ¨ç½²ç¥å™¨-é˜¿é‡Œäº‘å‡ºå“ï¼›</p></li><li><p>jd-gui åç¼–è¯‘å·¥å…·ï¼šideaå…¨å±€æ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€ç§ï¼š/.  ?[<span class="number">1</span><span class="number">-9</span>]\d* ./</span><br><span class="line">ç¬¬äºŒç§ï¼š/.  -?[<span class="number">1</span><span class="number">-9</span>]\d* ./</span><br></pre></td></tr></table></figure></li></ol><h4 id="Ideaæ’ä»¶"><a href="#Ideaæ’ä»¶" class="headerlink" title="Ideaæ’ä»¶"></a>Ideaæ’ä»¶</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/%E5%85%A8%E9%83%A8%E7%9A%84%E6%8F%92%E4%BB%B6%E5%A4%87%E4%BB%BD.png" alt="Ideaæ’ä»¶è®°å½•"></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>Fiddleræ‹¦æˆªé‡å®šå‘åˆ°æœ¬åœ°æœåŠ¡</title>
    <url>/post/cf54cb02.html</url>
    <content><![CDATA[<blockquote><p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•çº¿ä¸ŠPCçš„webç³»ç»Ÿé¡µé¢çš„æœ‰æ—¶å€™éœ€è¦æŠŠçº¿ä¸Šçš„æ¥å£è½¬å‘åˆ°æœ¬åœ°å¯åŠ¨çš„æœåŠ¡ä¸­çš„æ—¶å€™ï¼Œå¯ä»¥å€ŸåŠ©Fiddlerçš„è½¬å‘åŠŸèƒ½æ¥æ‹¦æˆªè¯·æ±‚åˆ°æœ¬åœ°æœåŠ¡ã€‚</p></blockquote><a id="more"></a><h4 id="ä¸€ã€æ‰“å¼€Fiddleré…ç½®è§„åˆ™"><a href="#ä¸€ã€æ‰“å¼€Fiddleré…ç½®è§„åˆ™" class="headerlink" title="ä¸€ã€æ‰“å¼€Fiddleré…ç½®è§„åˆ™"></a>ä¸€ã€æ‰“å¼€Fiddleré…ç½®è§„åˆ™</h4><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20200821094443.png" alt="Fiddler"></p><h4 id="äºŒã€ç¼–è¾‘è‡ªåŠ¨å“åº”ä¸­çš„è§„åˆ™ç¼–è¾‘å™¨"><a href="#äºŒã€ç¼–è¾‘è‡ªåŠ¨å“åº”ä¸­çš„è§„åˆ™ç¼–è¾‘å™¨" class="headerlink" title="äºŒã€ç¼–è¾‘è‡ªåŠ¨å“åº”ä¸­çš„è§„åˆ™ç¼–è¾‘å™¨"></a>äºŒã€ç¼–è¾‘è‡ªåŠ¨å“åº”ä¸­çš„è§„åˆ™ç¼–è¾‘å™¨</h4><p>æ·»åŠ è§„åˆ™ï¼š</p><ol><li>åŸè¯·æ±‚ï¼ˆçº¿ä¸Šåœ°å€ï¼‰è¡¨è¾¾å¼ï¼šregex:<a href="http://112.118.31.213:2191/(.*)" target="_blank" rel="noopener">http://112.118.31.213:2191/(.*)</a></li><li>å“åº”åˆ°ï¼ˆæœ¬åœ°åœ°å€ï¼‰ï¼š<a href="http://127.0.0.1:8081/$1" target="_blank" rel="noopener">http://127.0.0.1:8081/$1</a></li><li>æœ€åå¯ç”¨è§„åˆ™ï¼Œé‡æ–°åˆ·æ–°é¡µé¢ï¼Œå‘ç°è¯·æ±‚å·²ç»è½¬å‘åˆ°æœ¬åœ°é¡¹ç›®ä¸­</li></ol><h4 id="ä¸‰ã€æ‹¦æˆªJavaç¨‹åºå†…çš„è¯·æ±‚"><a href="#ä¸‰ã€æ‹¦æˆªJavaç¨‹åºå†…çš„è¯·æ±‚" class="headerlink" title="ä¸‰ã€æ‹¦æˆªJavaç¨‹åºå†…çš„è¯·æ±‚"></a>ä¸‰ã€æ‹¦æˆªJavaç¨‹åºå†…çš„è¯·æ±‚</h4><p>åœ¨IDEAå¯åŠ¨æœåŠ¡çš„ç¼–è¾‘æ ç›®ä¸­ï¼Œæ·»åŠ JVMå‚æ•°æ¥æŠŠè¯·æ±‚ä»£ç†åˆ°Fiddlerå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-DproxySet=<span class="keyword">true</span> -DproxyHost=ä»£ç†IP -DproxyPort=ä»£ç†ç«¯å£</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Fiddler</category>
      </categories>
      <tags>
        <tag>Fiddler</tag>
      </tags>
  </entry>
  <entry>
    <title>JmockDataæ¨¡æ‹Ÿmockæ•°æ®</title>
    <url>/post/cf673b93.html</url>
    <content><![CDATA[<blockquote><p>å¼€å‘é¢å¯¹å¤æ‚çš„æ¥å£æ•°æ®ï¼Œæ¯æ¬¡å¼€å‘å®Œæˆä¸€æ¬¡æ¥å£æœ€éš¾æçš„å°±æ˜¯å†™ä¸€å †çš„å‡æ•°æ®æ¥æµ‹è¯•æ¥å£æ˜¯å¦æ­£å¸¸ä½¿ç”¨ï¼Œç„¶åè‡ªå·±å»å†™ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„æ•°æ®å»æµ‹è¯•æ¥å£ã€‚æˆ‘è§‰å¾—æ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œä¸Šæ¬¡é€›æŸæŠ€æœ¯å¹³å°çš„æ—¶å€™ï¼Œå¶å°”å‘ç°ä¸€ä¸ªç‰¹åˆ«å¥½ç”¨çš„å·¥å…·ã€‚</p></blockquote><a id="more"></a><h4 id="ä¸€ã€Jmockdataå®˜ç½‘"><a href="#ä¸€ã€Jmockdataå®˜ç½‘" class="headerlink" title="ä¸€ã€Jmockdataå®˜ç½‘"></a>ä¸€ã€Jmockdataå®˜ç½‘</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®˜ç½‘ : https:&#x2F;&#x2F;github.com&#x2F;jsonzou&#x2F;jmockdata</span><br></pre></td></tr></table></figure><h4 id="äºŒã€POMä¾èµ–"><a href="#äºŒã€POMä¾èµ–" class="headerlink" title="äºŒã€POMä¾èµ–"></a>äºŒã€POMä¾èµ–</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--  Jmockdtaæ˜¯ä¸€æ¬¾å®ç°æ¨¡æ‹ŸJAVAç±»å‹æˆ–å¯¹è±¡çš„å®ä¾‹åŒ–å¹¶éšæœºåˆå§‹åŒ–å¯¹è±¡çš„æ•°æ®çš„å·¥å…·æ¡†æ¶ã€‚å•å…ƒæµ‹è¯•çš„åˆ©å™¨ã€‚ --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.jsonzou&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jmockdata&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.1.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h4 id="ä¸‰ã€åˆ›å»ºæµ‹è¯•ç±»"><a href="#ä¸‰ã€åˆ›å»ºæµ‹è¯•ç±»" class="headerlink" title="ä¸‰ã€åˆ›å»ºæµ‹è¯•ç±»"></a>ä¸‰ã€åˆ›å»ºæµ‹è¯•ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfRefData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> Integer integerId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å››ã€è¿è¡Œ"><a href="#å››ã€è¿è¡Œ" class="headerlink" title="å››ã€è¿è¡Œ"></a>å››ã€è¿è¡Œ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>ï¼š éšæœºæ¨¡æ‹Ÿå‡æ•°æ®æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>ï¼š Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>ï¼š 2020/8/17 11:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JMockDataTest</span> </span>&#123;</span><br><span class="line"> 	<span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MockConfig mockConfig = <span class="keyword">new</span> MockConfig().setEnabledCircle(<span class="keyword">true</span>);</span><br><span class="line">        SelfRefData selfRefData = JMockData.mock(SelfRefData<span class="class">.<span class="keyword">class</span>, <span class="title">mockConfig</span>)</span>;</span><br><span class="line">        System.out.println(JSON.toJSONString(selfRefData));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº”ã€ç»“æœ"><a href="#äº”ã€ç»“æœ" class="headerlink" title="äº”ã€ç»“æœ"></a>äº”ã€ç»“æœ</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:<span class="string">"59zf8i"</span>,<span class="attr">"integerId"</span>:<span class="number">9891</span>,<span class="attr">"string"</span>:<span class="string">"Z"</span>&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Utils</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸¢å¼ƒæ‰é‚£äº›BeanUtilså·¥å…·ç±»å§ï¼ŒMapStructçœŸé¦™ï¼ï¼ï¼</title>
    <url>/post/827efc3c.html</url>
    <content><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨å‰å‡ å¤©çš„æ–‡ç« ã€Šä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´ç¦æ­¢ä½¿ç”¨Apache Beanutilsè¿›è¡Œå±æ€§çš„copyï¼Ÿã€‹ä¸­ï¼Œæˆ‘æ›¾ç»å¯¹å‡ æ¬¾å±æ€§æ‹·è´çš„å·¥å…·ç±»è¿›è¡Œäº†å¯¹æ¯”ã€‚ç„¶ååœ¨è¯„è®ºåŒºæœ‰äº›è¯»è€…åé¦ˆè¯´MapStructæ‰æ˜¯çœŸçš„é¦™ï¼Œäºæ˜¯æˆ‘å°±æŠ½æ—¶é—´äº†è§£äº†ä¸€ä¸‹MapStructã€‚ç»“æœæˆ‘å‘ç°ï¼Œè¿™çœŸçš„æ˜¯ä¸€ä¸ªç¥ä»™æ¡†æ¶ï¼Œç‚’é¸¡é¦™ã€‚<br>è¿™ä¸€ç¯‡æ–‡ç« å°±æ¥ç®€å•ä»‹ç»ä¸‹MapStructçš„ç”¨æ³•ï¼Œå¹¶ä¸”å†å’Œå…¶ä»–å‡ ä¸ªå·¥å…·ç±»è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ã€‚</p><a id="more"></a><h5 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦MapStruct-ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦MapStruct-ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦MapStruct ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦MapStruct ï¼Ÿ</h5><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹MapStructè¿™ç±»æ¡†æ¶é€‚ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯ï¼Œä¸ºä»€ä¹ˆå¸‚é¢ä¸Šä¼šæœ‰è¿™ä¹ˆå¤šçš„ç±»ä¼¼çš„æ¡†æ¶ã€‚<br>åœ¨è½¯ä»¶ä½“ç³»æ¶æ„è®¾è®¡ä¸­ï¼Œåˆ†å±‚å¼ç»“æ„æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç§ç»“æ„ã€‚å¾ˆå¤šäººéƒ½å¯¹ä¸‰å±‚æ¶æ„ã€å››å±‚æ¶æ„ç­‰å¹¶ä¸é™Œç”Ÿã€‚<br>ç”šè‡³æœ‰äººè¯´ï¼š<strong>â€œè®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥çš„ä¸­é—´å±‚æ¥è§£å†³ï¼Œå¦‚æœä¸è¡Œï¼Œé‚£å°±åŠ ä¸¤å±‚ã€‚â€</strong><br>ä½†æ˜¯ï¼Œéšç€è½¯ä»¶æ¶æ„åˆ†å±‚è¶Šæ¥è¶Šå¤šï¼Œé‚£ä¹ˆå„ä¸ªå±‚æ¬¡ä¹‹é—´çš„æ•°æ®æ¨¡å‹å°±è¦é¢ä¸´ç€ç›¸äº’è½¬æ¢çš„é—®é¢˜ï¼Œå…¸å‹çš„å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­è§åˆ°å„ç§Oï¼Œå¦‚DOã€DTOã€VOç­‰ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŒæ ·ä¸€ä¸ªæ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬åœ¨ä¸åŒçš„å±‚æ¬¡è¦ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹ã€‚<strong>å¦‚åœ¨æ•°æ®å­˜å‚¨å±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨DOæ¥æŠ½è±¡ä¸€ä¸ªä¸šåŠ¡å®ä½“ï¼›åœ¨ä¸šåŠ¡é€»è¾‘å±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨DTOæ¥è¡¨ç¤ºæ•°æ®ä¼ è¾“å¯¹è±¡ï¼›åˆ°äº†å±•ç¤ºå±‚ï¼Œæˆ‘ä»¬åˆæŠŠå¯¹è±¡å°è£…æˆVOæ¥ä¸å‰ç«¯è¿›è¡Œäº¤äº’ã€‚</strong></p><p>é‚£ä¹ˆï¼Œæ•°æ®çš„ä»å‰ç«¯é€ä¼ åˆ°æ•°æ®æŒä¹…åŒ–å±‚ï¼ˆä»æŒä¹…å±‚é€ä¼ åˆ°å‰ç«¯ï¼‰ï¼Œå°±éœ€è¦è¿›è¡Œå¯¹è±¡ä¹‹é—´çš„äº’ç›¸è½¬åŒ–ï¼Œå³åœ¨ä¸åŒçš„å¯¹è±¡æ¨¡å‹ä¹‹é—´è¿›è¡Œæ˜ å°„ã€‚</p><p>é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨get/setç­‰æ–¹å¼é€ä¸€è¿›è¡Œå­—æ®µæ˜ å°„æ“ä½œï¼Œå¾ˆæ˜¯éº»çƒ¦ï¼Œæ‰€ä»¥å°±æ˜¯å¯ä»¥ä½¿ç”¨å¯¹è±¡çš„æ‹·è´å·¥å…·ç±»æ¥ä»£æ›¿è¿™ä¸ªç¹ççš„ä»£ç ã€‚</p><h5 id="äºŒã€MapStructçš„ä½¿ç”¨"><a href="#äºŒã€MapStructçš„ä½¿ç”¨" class="headerlink" title="äºŒã€MapStructçš„ä½¿ç”¨"></a>äºŒã€MapStructçš„ä½¿ç”¨</h5><p>MapStructï¼ˆ<a href="https://mapstruct.org/" target="_blank" rel="noopener">https://mapstruct.org/</a> ï¼‰æ˜¯ä¸€ç§ä»£ç ç”Ÿæˆå™¨ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†åŸºäºâ€çº¦å®šä¼˜äºé…ç½®â€æ–¹æ³•çš„Java beanç±»å‹ä¹‹é—´æ˜ å°„çš„å®ç°ã€‚ç”Ÿæˆçš„æ˜ å°„ä»£ç ä½¿ç”¨çº¯æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤å¿«é€Ÿã€ç±»å‹å®‰å…¨ä¸”æ˜“äºç†è§£ã€‚</p><blockquote><p>çº¦å®šä¼˜äºé…ç½®ï¼Œä¹Ÿç§°ä½œæŒ‰çº¦å®šç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡èŒƒå¼ï¼Œæ—¨åœ¨å‡å°‘è½¯ä»¶å¼€å‘äººå‘˜éœ€åšå†³å®šçš„æ•°é‡ï¼Œè·å¾—ç®€å•çš„å¥½å¤„ï¼Œè€Œåˆä¸å¤±çµæ´»æ€§ã€‚</p></blockquote><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»éœ€è¦è¿›è¡Œäº’ç›¸è½¬æ¢ï¼Œåˆ†åˆ«æ˜¯PersonDOå’ŒPersonDTOï¼Œç±»å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> Gender gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨MapStructè¿›è¡Œbeanæ˜ å°„ã€‚</p><p>æƒ³è¦ä½¿ç”¨MapStructï¼Œé¦–å…ˆéœ€è¦ä¾èµ–ä»–çš„ç›¸å…³çš„jaråŒ…ï¼Œä½¿ç”¨mavenä¾èµ–æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.1.Final&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.1.Final&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåšæ˜ å°„çš„æ¥å£ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> éœ€è¦å®šä¹‰ä¸€ä¸ªåšæ˜ å°„çš„æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/17 16:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonConverter</span> </span>&#123;</span><br><span class="line">    PersonConverter INSTANCE = Mappers.getMapper(PersonConverter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mappings</span>(<span class="meta">@Mapping</span>(source = <span class="string">"name"</span>, target = <span class="string">"userName"</span>))</span><br><span class="line">    <span class="function">PersonDTO <span class="title">do2dto</span><span class="params">(PersonDO person)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ³¨è§£@Mapperå®šä¹‰ä¸€ä¸ªConverteræ¥å£ï¼Œåœ¨å…¶ä¸­å®šä¹‰ä¸€ä¸ªdo2dtoæ–¹æ³•ï¼Œæ–¹æ³•çš„å…¥å‚ç±»å‹æ˜¯PersonDOï¼Œå‡ºå‚ç±»å‹æ˜¯PersonDTOï¼Œè¿™ä¸ªæ–¹æ³•å°±ç”¨äºå°†PersonDOè½¬æˆPersonDTOã€‚</p><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>ï¼š æµ‹è¯•è½¬æ¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>ï¼š Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>ï¼š 2020/8/17 16:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        PersonDO personDO = <span class="keyword">new</span> PersonDO();</span><br><span class="line">        personDO.setName(<span class="string">"JIA"</span>);</span><br><span class="line">        personDO.setAge(<span class="number">21</span>);</span><br><span class="line">        personDO.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        personDO.setId(<span class="number">8</span>);</span><br><span class="line">        PersonDTO personDTO = PersonConverter.INSTANCE.do2dto(personDO);</span><br><span class="line">        System.out.println(personDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PersonDTO(userName=JIA, age=<span class="number">21</span>, birthday=Mon Aug <span class="number">17</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">58</span> CST <span class="number">2020</span>, gender=<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨MapStructå®Œç¾çš„å°†PersonDOè½¬æˆäº†PersonDTOã€‚ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒMapStructçš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œä¸»è¦ä¾èµ–@Mapperæ³¨è§£ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦äº’ç›¸è½¬æ¢çš„ä¸¤ä¸ªç±»ä¹‹é—´çš„å±æ€§åç§°ã€ç±»å‹ç­‰å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œè¿˜æœ‰äº›æƒ…å†µæˆ‘ä»¬å¹¶ä¸æƒ³ç›´æ¥åšæ˜ å°„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå…¶å®MapStructåœ¨è¿™æ–¹é¢ä¹Ÿæ˜¯åšçš„å¾ˆå¥½çš„ã€‚</p><h5 id="ä¸‰ã€MapStructå¤„ç†å­—æ®µæ˜ å°„"><a href="#ä¸‰ã€MapStructå¤„ç†å­—æ®µæ˜ å°„" class="headerlink" title="ä¸‰ã€MapStructå¤„ç†å­—æ®µæ˜ å°„"></a>ä¸‰ã€MapStructå¤„ç†å­—æ®µæ˜ å°„</h5><p>é¦–å…ˆï¼Œå¯ä»¥æ˜ç¡®çš„å‘Šè¯‰å¤§å®¶ï¼Œå¦‚æœè¦è½¬æ¢çš„ä¸¤ä¸ªç±»ä¸­æºå¯¹è±¡å±æ€§ä¸ç›®æ ‡å¯¹è±¡å±æ€§çš„ç±»å‹å’Œåå­—ä¸€è‡´çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ˜ å°„å¯¹åº”å±æ€§ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœé‡åˆ°ç‰¹æ®Šæƒ…å†µå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><ol><li><h6 id="åå­—ä¸ä¸€è‡´å¦‚ä½•æ˜ å°„"><a href="#åå­—ä¸ä¸€è‡´å¦‚ä½•æ˜ å°„" class="headerlink" title="åå­—ä¸ä¸€è‡´å¦‚ä½•æ˜ å°„"></a>åå­—ä¸ä¸€è‡´å¦‚ä½•æ˜ å°„</h6><p>å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨PersonDOä¸­ç”¨nameè¡¨ç¤ºç”¨æˆ·åç§°ï¼Œè€Œåœ¨PersonDTOä¸­ä½¿ç”¨userNameè¡¨ç¤ºç”¨æˆ·åï¼Œé‚£ä¹ˆå¦‚ä½•è¿›è¡Œå‚æ•°æ˜ å°„å‘¢ã€‚è¿™æ—¶å€™å°±è¦ä½¿ç”¨@Mappingæ³¨è§£äº†ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ç­¾åä¸Šï¼Œä½¿ç”¨è¯¥æ³¨è§£ï¼Œå¹¶æŒ‡æ˜éœ€è¦è½¬æ¢çš„æºå¯¹è±¡çš„åå­—å’Œç›®æ ‡å¯¹è±¡çš„åå­—å°±å¯ä»¥äº†ï¼Œå¦‚å°†nameçš„å€¼æ˜ å°„ç»™userNameï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapping</span>(source = <span class="string">"name"</span>, target = <span class="string">"userName"</span>)</span><br></pre></td></tr></table></figure></li><li><h6 id="å¯ä»¥è‡ªåŠ¨æ˜ å°„çš„ç±»å‹"><a href="#å¯ä»¥è‡ªåŠ¨æ˜ å°„çš„ç±»å‹" class="headerlink" title="å¯ä»¥è‡ªåŠ¨æ˜ å°„çš„ç±»å‹"></a>å¯ä»¥è‡ªåŠ¨æ˜ å°„çš„ç±»å‹</h6><p>é™¤äº†åå­—ä¸ä¸€è‡´ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯ç±»å‹ä¸ä¸€è‡´ï¼Œå¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨PersonDOä¸­ç”¨Stringç±»å‹è¡¨ç¤ºç”¨æˆ·æ€§åˆ«ï¼Œè€Œåœ¨PersonDTOä¸­ä½¿ç”¨ä¸€ä¸ªGenterçš„æšä¸¾è¡¨ç¤ºç”¨æˆ·æ€§åˆ«ã€‚</p><p>è¿™æ—¶å€™ç±»å‹ä¸ä¸€è‡´ï¼Œå°±éœ€è¦æ¶‰åŠåˆ°äº’ç›¸è½¬æ¢çš„é—®é¢˜</p><p>å…¶å®ï¼ŒMapStructä¼šå¯¹éƒ¨åˆ†ç±»å‹è‡ªåŠ¨åšæ˜ å°„ï¼Œä¸éœ€è¦æˆ‘ä»¬åšé¢å¤–é…ç½®ï¼Œå¦‚ä¾‹å­ä¸­æˆ‘ä»¬å°†Stringç±»å‹è‡ªåŠ¨è½¬æˆäº†æšä¸¾ç±»å‹ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä»¥ä¸‹æƒ…å†µå¯ä»¥åšè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š</p><ul><li>åŸºæœ¬ç±»å‹åŠå…¶ä»–ä»¬å¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚</li><li>åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å‹å’ŒStringç±»å‹ä¹‹é—´</li><li>Stringç±»å‹å’Œæšä¸¾ç±»å‹ä¹‹é—´</li></ul></li><li><h6 id="è‡ªå®šä¹‰å¸¸é‡"><a href="#è‡ªå®šä¹‰å¸¸é‡" class="headerlink" title="è‡ªå®šä¹‰å¸¸é‡"></a>è‡ªå®šä¹‰å¸¸é‡</h6><p>å¦‚æœæˆ‘ä»¬åœ¨è½¬æ¢æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ç»™ä¸€äº›å±æ€§å®šä¹‰ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ constant</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapping</span>(source = <span class="string">"name"</span>, constant = <span class="string">"JIA"</span>)</span><br></pre></td></tr></table></figure></li><li><h6 id="ç±»å‹ä¸ä¸€è‡´çš„å¦‚ä½•æ˜ å°„"><a href="#ç±»å‹ä¸ä¸€è‡´çš„å¦‚ä½•æ˜ å°„" class="headerlink" title="ç±»å‹ä¸ä¸€è‡´çš„å¦‚ä½•æ˜ å°„"></a>ç±»å‹ä¸ä¸€è‡´çš„å¦‚ä½•æ˜ å°„</h6><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Personè¿™ä¸ªå¯¹è±¡ä¸­å¢åŠ å®¶åº­ä½å€è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€èˆ¬åœ¨PersonoDTOä¸­ä¼šå•ç‹¬å®šä¹‰ä¸€ä¸ªHomeAddressç±»æ¥è¡¨ç¤ºå®¶åº­ä½å€ï¼Œè€Œåœ¨Personç±»ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨Stringç±»å‹è¡¨ç¤ºå®¶åº­ä½å€ã€‚è¿™å°±éœ€è¦åœ¨HomeAddresså’ŒStringä¹‹é—´ä½¿ç”¨JSONè¿›è¡Œäº’ç›¸è½¬åŒ–ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒMapStructä¹Ÿæ˜¯å¯ä»¥æ”¯æŒçš„ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> HomeAddress address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonConverter</span> </span>&#123;</span><br><span class="line">    PersonConverter INSTANCE = Mappers.getMapper(PersonConverter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping</span>(source = <span class="string">"userName"</span>, target = <span class="string">"name"</span>)</span><br><span class="line">    <span class="meta">@Mapping</span>(target = <span class="string">"address"</span>,expression = <span class="string">"java(homeAddressToString(dto2do.getAddress()))"</span>)</span><br><span class="line">    <span class="function">PersonDO <span class="title">dto2do</span><span class="params">(PersonDTO dto2do)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> String <span class="title">homeAddressToString</span><span class="params">(HomeAddress address)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(address);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦åœ¨PersonConverterä¸­åœ¨å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼ˆå› ä¸ºPersonConverteræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥åœ¨JDK 1.8ä»¥åçš„ç‰ˆæœ¬ä¸­å¯ä»¥å®šä¹‰ä¸€ä¸ªdefaultæ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†HomeAddressè½¬æ¢æˆStringç±»å‹ã€‚</p><blockquote><p>defaultæ–¹æ³•ï¼šJava 8 å¼•å…¥çš„æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œç”¨å…³é”®å­—defaultæ¥æ ‡æ³¨ï¼Œè¢«defaultæ‰€æ ‡æ³¨çš„æ–¹æ³•ï¼Œéœ€è¦æä¾›å®ç°ï¼Œè€Œå­ç±»å¯ä»¥é€‰æ‹©å®ç°æˆ–è€…ä¸å®ç°è¯¥æ–¹æ³•</p></blockquote><p>ç„¶ååœ¨dto2doæ–¹æ³•ä¸Šï¼Œé€šè¿‡ä»¥ä¸‹æ³¨è§£æ–¹å¼å³å¯å®ç°ç±»å‹çš„è½¬æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapping</span>(target = <span class="string">"address"</span>,expression = <span class="string">"java(homeAddressToString(dto2do.getAddress()))"</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§æ˜¯è‡ªå®šä¹‰çš„ç±»å‹è½¬æ¢ï¼Œè¿˜æœ‰ä¸€äº›ç±»å‹çš„è½¬æ¢æ˜¯MapStructæœ¬èº«å°±æ”¯æŒçš„ï¼Œå¦‚Stringå’ŒDateä¹‹é—´çš„è½¬æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapping</span>(target = <span class="string">"birthday"</span>,dateFormat = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œç®€å•ä»‹ç»äº†ä¸€äº›å¸¸ç”¨çš„å­—æ®µæ˜ å°„çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘è‡ªå·±åœ¨å·¥ä½œä¸­ç»å¸¸é‡åˆ°çš„å‡ ä¸ªåœºæ™¯ï¼Œæ›´å¤šçš„æƒ…å†µå¤§å®¶å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„ç¤ºä¾‹ï¼ˆ<a href="https://github.com/mapstruct/mapstruct-examplesï¼‰ã€‚" target="_blank" rel="noopener">https://github.com/mapstruct/mapstruct-examplesï¼‰ã€‚</a></p></li></ol><h5 id="å››ã€MapStructçš„æ€§èƒ½"><a href="#å››ã€MapStructçš„æ€§èƒ½" class="headerlink" title="å››ã€MapStructçš„æ€§èƒ½"></a>å››ã€MapStructçš„æ€§èƒ½</h5><p>å‰é¢è¯´äº†è¿™ä¹ˆå¤šMapStructçš„ç”¨æ³•ï¼Œå¯ä»¥çœ‹å‡ºMapStructçš„ä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¹¶ä¸”å­—æ®µæ˜ å°„ä¸Šé¢çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œé‚£ä¹ˆä»–çš„æ€§èƒ½åˆ°åº•æ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>å‚è€ƒã€Š<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&mid=2650137356&idx=1&sn=c1d3f57eb9ae9b535ed41560939a13b7&chksm=f36bfe2dc41c773b9086fa01735581616c438dba1619c0e8e26d429612739155d65c6b9ca120&scene=21#wechat_redirect" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´ç¦æ­¢ä½¿ç”¨Apache Beanutilsè¿›è¡Œå±æ€§çš„copyï¼Ÿ</a>ã€‹ä¸­çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯¹MapStructè¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚</p><p>åˆ†åˆ«æ‰§è¡Œ1000ã€10000ã€100000ã€1000000æ¬¡æ˜ å°„çš„è€—æ—¶åˆ†åˆ«ä¸ºï¼š0msã€1msã€3msã€6msã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>MapStructçš„è€—æ—¶ç›¸æ¯”è¾ƒäºå…¶ä»–å‡ æ¬¾å·¥å…·æ¥è¯´æ˜¯éå¸¸çŸ­çš„</strong>ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆMapStructçš„æ€§èƒ½å¯ä»¥è¿™ä¹ˆå¥½å‘¢ï¼Ÿ</p><p>å…¶å®ï¼ŒMapStructå’Œå…¶ä»–å‡ ç±»æ¡†æ¶æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼š<strong>ä¸å…¶ä»–æ˜ å°„æ¡†æ¶ç›¸æ¯”ï¼ŒMapStructåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆbeanæ˜ å°„ï¼Œè¿™ç¡®ä¿äº†é«˜æ€§èƒ½ï¼Œå¯ä»¥æå‰å°†é—®é¢˜åé¦ˆå‡ºæ¥ï¼Œä¹Ÿä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥å½»åº•çš„é”™è¯¯æ£€æŸ¥ã€‚</strong></p><p>å¼•å…¥MapStructçš„ä¾èµ–çš„æ—¶å€™ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å¾ˆå¤šMapStructæä¾›çš„æ³¨è§£ï¼Œè¿™ä½¿å¾—åœ¨ç¼–è¯‘æœŸï¼ŒMapStructå°±å¯ä»¥ç›´æ¥ç”Ÿæˆbeanæ˜ å°„çš„ä»£ç ï¼Œç›¸å½“äºä»£æ›¿æˆ‘ä»¬å†™äº†å¾ˆå¤šsetterå’Œgetterã€‚</p><p>å¦‚æˆ‘ä»¬åœ¨ä»£ç ä¸­å®šä¹‰äº†ä»¥ä¸‹ä¸€ä¸ªMapperï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonConverter</span> </span>&#123;</span><br><span class="line">    PersonConverter INSTANCE = Mappers.getMapper(PersonConverter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="meta">@Mapping</span>(source = <span class="string">"userName"</span>, target = <span class="string">"name"</span>)</span><br><span class="line">    <span class="meta">@Mapping</span>(target = <span class="string">"address"</span>,expression = <span class="string">"java(homeAddressToString(dto2do.getAddress()))"</span>)</span><br><span class="line">    <span class="meta">@Mapping</span>(target = <span class="string">"birthday"</span>,dateFormat = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">    <span class="function">PersonDO <span class="title">dto2do</span><span class="params">(PersonDTO dto2do)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> String <span class="title">homeAddressToString</span><span class="params">(HomeAddress address)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(address);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä»£ç ç¼–è¯‘åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªPersonConverterImplï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">package</span> com.mapstruct;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonConverterImpl</span> <span class="keyword">implements</span> <span class="title">PersonConverter</span> </span>&#123;</span><br><span class="line">    PersonConverterImpl() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PersonDTO <span class="title">do2dto</span><span class="params">(PersonDO person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (person == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            PersonDTO personDTO = <span class="keyword">new</span> PersonDTO();</span><br><span class="line">            personDTO.setUserName(person.getName());</span><br><span class="line">            personDTO.setAge(person.getAge());</span><br><span class="line">            personDTO.setBirthday(person.getBirthday());</span><br><span class="line">            personDTO.setGender(person.getGender());</span><br><span class="line">            <span class="keyword">return</span> personDTO;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡ŒæœŸï¼Œå¯¹äºbeanè¿›è¡Œæ˜ å°„çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥è°ƒç”¨PersonConverterImplçš„dto2doæ–¹æ³•ï¼Œè¿™æ ·å°±æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„äº‹æƒ…è¦åšäº†ï¼Œåªæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œsetå’Œgetå°±å¯ä»¥äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æœŸåšäº†å¾ˆå¤šäº‹æƒ…ï¼Œæ‰€ä»¥MapStructåœ¨è¿è¡ŒæœŸçš„æ€§èƒ½ä¼šå¾ˆå¥½ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯å¯ä»¥æŠŠé—®é¢˜çš„æš´éœ²æå‰åˆ°ç¼–è¯‘æœŸã€‚</p><p>ä½¿å¾—å¦‚æœä»£ç ä¸­å­—æ®µæ˜ å°„æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆåº”ç”¨å°±ä¼šæ— æ³•ç¼–è¯‘ï¼Œå¼ºåˆ¶å¼€å‘è€…è¦è§£å†³è¿™ä¸ªé—®é¢˜æ‰è¡Œã€‚</p><h5 id="äº”ã€å…¶ä»–æ‹·è´å·¥å…·ç±»"><a href="#äº”ã€å…¶ä»–æ‹·è´å·¥å…·ç±»" class="headerlink" title="äº”ã€å…¶ä»–æ‹·è´å·¥å…·ç±»"></a>äº”ã€å…¶ä»–æ‹·è´å·¥å…·ç±»</h5><ul><li>DozerBeanMapper</li><li>Orika</li><li>BeanCopier</li><li>ModelMapper(Model Mapper æ˜¯é€šè¿‡åå°„çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½çš„ï¼Œåªæ˜¯å‡å°‘äº†ä»£ç set geté‡ã€‚æ€§èƒ½å´ä¸‹é™äº†,ä¸å»ºè®®ä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒ)ã€‚</li><li><a href="https://blog.csdn.net/weixin_36142042/article/details/84931600?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-4" target="_blank" rel="noopener">Beanæ‹·è´å·¥å…·ç±»æ¯”è¾ƒ</a></li></ul><h5 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h5><p>æœ¬æ–‡ä»‹ç»äº†ä¸€æ¬¾Javaä¸­çš„å­—æ®µæ˜ å°„å·¥å…·ç±»ï¼ŒMapStructï¼Œä»–çš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”åŠŸèƒ½éå¸¸å®Œå–„ï¼Œå¯ä»¥åº”ä»˜å„ç§æƒ…å†µçš„å­—æ®µæ˜ å°„ã€‚å¹¶ä¸”å› ä¸ºä»–æ˜¯ç¼–è¯‘æœŸå°±ä¼šç”ŸæˆçœŸæ­£çš„æ˜ å°„ä»£ç ï¼Œä½¿å¾—è¿è¡ŒæœŸçš„æ€§èƒ½å¾—åˆ°äº†å¤§å¤§çš„æå‡ã€‚</p><p>å¼ºçƒˆæ¨èï¼ŒçœŸçš„å¾ˆé¦™ï¼ï¼ï¼</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Utils</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆæˆ‘ä»¬åšåˆ†å¸ƒå¼ä½¿ç”¨Redis</title>
    <url>/post/f7431ca1.html</url>
    <content><![CDATA[<p>ç»å¤§éƒ¨åˆ†å†™ä¸šåŠ¡çš„ç¨‹åºå‘˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨ Redis çš„æ—¶å€™ï¼Œåªä¼š Set Value å’Œ Get Value ä¸¤ä¸ªæ“ä½œï¼Œå¯¹ Redis æ•´ä½“ç¼ºä¹ä¸€ä¸ªè®¤çŸ¥ã€‚è¿™é‡Œå¯¹ Redis å¸¸è§é—®é¢˜åšä¸€ä¸ªæ€»ç»“ï¼Œè§£å†³å¤§å®¶çš„çŸ¥è¯†ç›²ç‚¹ã€‚</p><h2 id="1ã€ä¸ºä»€ä¹ˆä½¿ç”¨-Redis"><a href="#1ã€ä¸ºä»€ä¹ˆä½¿ç”¨-Redis" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Redis"></a>1ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Redis</h2><p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Redisï¼Œä¸»è¦è€ƒè™‘ä¸¤ä¸ªè§’åº¦ï¼šæ€§èƒ½å’Œå¹¶å‘ã€‚å¦‚æœåªæ˜¯ä¸ºäº†åˆ†å¸ƒå¼é”è¿™äº›å…¶ä»–åŠŸèƒ½ï¼Œè¿˜æœ‰å…¶ä»–ä¸­é—´ä»¶ Zookpeer ç­‰ä»£æ›¿ï¼Œå¹¶éä¸€å®šè¦ä½¿ç”¨ Redisã€‚</p><a id="more"></a><h3 id="æ€§èƒ½ï¼š"><a href="#æ€§èƒ½ï¼š" class="headerlink" title="æ€§èƒ½ï¼š"></a>æ€§èƒ½ï¼š</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ç¢°åˆ°éœ€è¦æ‰§è¡Œè€—æ—¶ç‰¹åˆ«ä¹…ï¼Œä¸”ç»“æœä¸é¢‘ç¹å˜åŠ¨çš„ SQLï¼Œå°±ç‰¹åˆ«é€‚åˆå°†è¿è¡Œç»“æœæ”¾å…¥ç¼“å­˜ã€‚è¿™æ ·ï¼Œåé¢çš„è¯·æ±‚å°±å»ç¼“å­˜ä¸­è¯»å–ï¼Œä½¿å¾—è¯·æ±‚èƒ½å¤Ÿè¿…é€Ÿå“åº”ã€‚</p><p>ç‰¹åˆ«æ˜¯åœ¨ç§’æ€ç³»ç»Ÿï¼Œåœ¨åŒä¸€æ—¶é—´ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½åœ¨ç‚¹ï¼Œéƒ½åœ¨ä¸‹å•ã€‚ã€‚ã€‚æ‰§è¡Œçš„æ˜¯åŒä¸€æ“ä½œâ€”â€”â€”å‘æ•°æ®åº“æŸ¥æ•°æ®ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20200814112433.png" alt=""></p><p>æ ¹æ®äº¤äº’æ•ˆæœçš„ä¸åŒï¼Œå“åº”æ—¶é—´æ²¡æœ‰å›ºå®šæ ‡å‡†ã€‚åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬çš„é¡µé¢è·³è½¬éœ€è¦åœ¨ç¬é—´è§£å†³ï¼Œå¯¹äºé¡µå†…æ“ä½œåˆ™éœ€è¦åœ¨åˆ¹é‚£é—´è§£å†³ã€‚</p><h3 id="å¹¶å‘ï¼š"><a href="#å¹¶å‘ï¼š" class="headerlink" title="å¹¶å‘ï¼š"></a>å¹¶å‘ï¼š</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å¤§å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šå‡ºç°è¿æ¥å¼‚å¸¸ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ Redis åšä¸€ä¸ªç¼“å†²æ“ä½œï¼Œè®©è¯·æ±‚å…ˆè®¿é—®åˆ° Redisï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®æ•°æ®åº“ã€‚</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20200814112445.png" alt=""></p><h3 id="ä½¿ç”¨-Redis-çš„å¸¸è§é—®é¢˜"><a href="#ä½¿ç”¨-Redis-çš„å¸¸è§é—®é¢˜" class="headerlink" title="ä½¿ç”¨ Redis çš„å¸¸è§é—®é¢˜"></a>ä½¿ç”¨ Redis çš„å¸¸è§é—®é¢˜</h3><ul><li><p>ç¼“å­˜å’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜</p></li><li><p>ç¼“å­˜é›ªå´©é—®é¢˜</p></li><li><p>ç¼“å­˜å‡»ç©¿é—®é¢˜</p></li><li><p>ç¼“å­˜çš„å¹¶å‘ç«äº‰é—®é¢˜</p></li></ul><h2 id="2ã€å•çº¿ç¨‹çš„-Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#2ã€å•çº¿ç¨‹çš„-Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="2ã€å•çº¿ç¨‹çš„ Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>2ã€å•çº¿ç¨‹çš„ Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h2><p>è¿™ä¸ªé—®é¢˜æ˜¯å¯¹ Redis å†…éƒ¨æœºåˆ¶çš„ä¸€ä¸ªè€ƒå¯Ÿã€‚å¾ˆå¤šäººéƒ½ä¸çŸ¥é“ Redis æ˜¯å•çº¿ç¨‹å·¥ä½œæ¨¡å‹ã€‚</p><h3 id="åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š"><a href="#åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š" class="headerlink" title="åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š"></a>åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š</h3><p>çº¯å†…å­˜æ“ä½œ</p><p>å•çº¿ç¨‹æ“ä½œï¼Œé¿å…äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>é‡‡ç”¨äº†éé˜»å¡ I/O å¤šè·¯å¤ç”¨æœºåˆ¶</p><p>ä»”ç»†è¯´ä¸€è¯´ I/O å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ‰“ä¸€ä¸ªæ¯”æ–¹ï¼šå°ååœ¨ A åŸå¼€äº†ä¸€å®¶å¿«é¤åº—åº—ï¼Œè´Ÿè´£åŒåŸå¿«é¤æœåŠ¡ã€‚å°æ˜å› ä¸ºèµ„é‡‘é™åˆ¶ï¼Œé›‡ä½£äº†ä¸€æ‰¹é…é€å‘˜ï¼Œç„¶åå°æ›²å‘ç°èµ„é‡‘ä¸å¤Ÿäº†ï¼Œåªå¤Ÿä¹°ä¸€è¾†è½¦é€å¿«é€’ã€‚</p><h3 id="ç»è¥æ–¹å¼ä¸€"><a href="#ç»è¥æ–¹å¼ä¸€" class="headerlink" title="ç»è¥æ–¹å¼ä¸€"></a>ç»è¥æ–¹å¼ä¸€</h3><p>å®¢æˆ·æ¯ä¸‹ä¸€ä»½è®¢å•ï¼Œå°æ˜å°±è®©ä¸€ä¸ªé…é€å‘˜ç›¯ç€ï¼Œç„¶åè®©äººå¼€è½¦å»é€ã€‚æ…¢æ…¢çš„å°æ›²å°±å‘ç°äº†è¿™ç§ç»è¥æ–¹å¼å­˜åœ¨ä¸‹è¿°é—®é¢˜ï¼š</p><p>æ—¶é—´éƒ½èŠ±åœ¨äº†æŠ¢è½¦ä¸Šäº†ï¼Œå¤§éƒ¨åˆ†é…é€å‘˜éƒ½å¤„åœ¨é—²ç½®çŠ¶æ€ï¼ŒæŠ¢åˆ°è½¦æ‰èƒ½å»é€ã€‚</p><p>éšç€ä¸‹å•çš„å¢å¤šï¼Œé…é€å‘˜ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå°æ˜å‘ç°å¿«é€’åº—é‡Œè¶Šæ¥è¶ŠæŒ¤ï¼Œæ²¡åŠæ³•é›‡ä½£æ–°çš„é…é€å‘˜äº†ã€‚</p><p>é…é€å‘˜ä¹‹é—´çš„åè°ƒå¾ˆèŠ±æ—¶é—´ã€‚</p><p>ç»¼åˆä¸Šè¿°ç¼ºç‚¹ï¼Œå°æ˜ç—›å®šæ€ç—›ï¼Œæå‡ºäº†ç»è¥æ–¹å¼äºŒã€‚</p><h3 id="ç»è¥æ–¹å¼äºŒ"><a href="#ç»è¥æ–¹å¼äºŒ" class="headerlink" title="ç»è¥æ–¹å¼äºŒ"></a>ç»è¥æ–¹å¼äºŒ</h3><p>å°æ˜åªé›‡ä½£ä¸€ä¸ªé…é€å‘˜ã€‚å½“å®¢æˆ·ä¸‹å•ï¼Œå°æ˜æŒ‰é€è¾¾åœ°ç‚¹æ ‡æ³¨å¥½ï¼Œä¾æ¬¡æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚æœ€åï¼Œè®©é…é€å‘˜ä¾æ¬¡å¼€ç€è½¦å»é€ï¼Œé€å¥½äº†å°±å›æ¥æ‹¿ä¸‹ä¸€ä¸ªã€‚ä¸Šè¿°ä¸¤ç§ç»è¥æ–¹å¼å¯¹æ¯”ï¼Œå¾ˆæ˜æ˜¾ç¬¬äºŒç§æ•ˆç‡æ›´é«˜ã€‚</p><p>åœ¨ä¸Šè¿°æ¯”å–»ä¸­ï¼š</p><p>æ¯ä¸ªé…é€å‘˜â†’æ¯ä¸ªçº¿ç¨‹</p><p>æ¯ä¸ªè®¢å•â†’æ¯ä¸ª Socket(I/O æµ)</p><p>è®¢å•çš„é€è¾¾åœ°ç‚¹â†’Socket çš„ä¸åŒçŠ¶æ€</p><p>å®¢æˆ·é€é¤è¯·æ±‚â†’æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚</p><p>å°æ˜çš„ç»è¥æ–¹å¼â†’æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç </p><p>ä¸€è¾†è½¦â†’CPU çš„æ ¸æ•°</p><p>äºæ˜¯æœ‰äº†å¦‚ä¸‹ç»“è®ºï¼š</p><p>ç»è¥æ–¹å¼ä¸€å°±æ˜¯ä¼ ç»Ÿçš„å¹¶å‘æ¨¡å‹ï¼Œæ¯ä¸ª I/O æµ(è®¢å•)éƒ½æœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹(é…é€å‘˜)ç®¡ç†ã€‚</p><p>ç»è¥æ–¹å¼äºŒå°±æ˜¯ I/O å¤šè·¯å¤ç”¨ã€‚åªæœ‰å•ä¸ªçº¿ç¨‹(ä¸€ä¸ªé…é€å‘˜)ï¼Œé€šè¿‡è·Ÿè¸ªæ¯ä¸ª I/O æµçš„çŠ¶æ€(æ¯ä¸ªé…é€å‘˜çš„é€è¾¾åœ°ç‚¹)ï¼Œæ¥ç®¡ç†å¤šä¸ª I/O æµã€‚</p><p>ä¸‹é¢ç±»æ¯”åˆ°çœŸå®çš„ Redis çº¿ç¨‹æ¨¡å‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20200814112453.png" alt=""></p><p>Redis-client åœ¨æ“ä½œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå…·æœ‰ä¸åŒäº‹ä»¶ç±»å‹çš„ Socketã€‚åœ¨æœåŠ¡ç«¯ï¼Œæœ‰ä¸€æ®µ I/O å¤šè·¯å¤ç”¨ç¨‹åºï¼Œå°†å…¶ç½®å…¥é˜Ÿåˆ—ä¹‹ä¸­ã€‚ç„¶åï¼Œæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œä¾æ¬¡å»é˜Ÿåˆ—ä¸­å–ï¼Œè½¬å‘åˆ°ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚</p><h2 id="3ã€Redis-çš„æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯"><a href="#3ã€Redis-çš„æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯" class="headerlink" title="3ã€Redis çš„æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯"></a>3ã€Redis çš„æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯</h2><p>ä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜ï¼Œè¿™äº”ç§ç±»å‹éƒ½ä¼šç”¨åˆ°ã€‚</p><p>String</p><p>æœ€å¸¸è§„çš„ set/get æ“ä½œï¼ŒValue å¯ä»¥æ˜¯ String ä¹Ÿå¯ä»¥æ˜¯æ•°å­—ã€‚ä¸€èˆ¬åšä¸€äº›å¤æ‚çš„è®¡æ•°åŠŸèƒ½çš„ç¼“å­˜ã€‚</p><p>Hash</p><p>è¿™é‡Œ Value å­˜æ”¾çš„æ˜¯ç»“æ„åŒ–çš„å¯¹è±¡ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„å°±æ˜¯æ“ä½œå…¶ä¸­çš„æŸä¸ªå­—æ®µã€‚æˆ‘åœ¨åšå•ç‚¹ç™»å½•çš„æ—¶å€™ï¼Œå°±æ˜¯ç”¨è¿™ç§æ•°æ®ç»“æ„å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ CookieId ä½œä¸º Keyï¼Œè®¾ç½® 30 åˆ†é’Ÿä¸ºç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œèƒ½å¾ˆå¥½çš„æ¨¡æ‹Ÿå‡ºç±»ä¼¼ Session çš„æ•ˆæœã€‚</p><p>List</p><p>ä½¿ç”¨ List çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åšç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œå¯ä»¥åˆ©ç”¨ lrange å‘½ä»¤ï¼ŒåšåŸºäº Redis çš„åˆ†é¡µåŠŸèƒ½ï¼Œæ€§èƒ½æä½³ï¼Œç”¨æˆ·ä½“éªŒå¥½ã€‚</p><p>Set</p><p>å› ä¸º Set å †æ”¾çš„æ˜¯ä¸€å †ä¸é‡å¤å€¼çš„é›†åˆã€‚æ‰€ä»¥å¯ä»¥åšå…¨å±€å»é‡çš„åŠŸèƒ½ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œä½¿ç”¨ JVM è‡ªå¸¦çš„ Set æ¯”è¾ƒéº»çƒ¦ã€‚å¦å¤–ï¼Œå°±æ˜¯åˆ©ç”¨äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰æ“ä½œï¼Œå¯ä»¥è®¡ç®—å…±åŒå–œå¥½ï¼Œå…¨éƒ¨çš„å–œå¥½ï¼Œè‡ªå·±ç‹¬æœ‰çš„å–œå¥½ç­‰åŠŸèƒ½ã€‚</p><p>Sorted Set</p><p>Sorted Set å¤šäº†ä¸€ä¸ªæƒé‡å‚æ•° Scoreï¼Œé›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ Score è¿›è¡Œæ’åˆ—ã€‚å¯ä»¥åšæ’è¡Œæ¦œåº”ç”¨ï¼Œå– TOP N æ“ä½œã€‚Sorted Set å¯ä»¥ç”¨æ¥åšå»¶æ—¶ä»»åŠ¡ã€‚</p><h2 id="4ã€å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜"><a href="#4ã€å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜" class="headerlink" title="4ã€å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜"></a>4ã€å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜</h2><p>è¿™ä¸ªé—®é¢˜å¤§è‡´å°±æ˜¯ï¼ŒåŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»Ÿå» Set ä¸€ä¸ª Keyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶åŸºæœ¬éƒ½æ˜¯æ¨èç”¨ Redis äº‹åŠ¡æœºåˆ¶ã€‚</p><p>ä½†æ˜¯æˆ‘å¹¶ä¸æ¨èä½¿ç”¨ Redis çš„äº‹åŠ¡æœºåˆ¶ã€‚å› ä¸ºæˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼ŒåŸºæœ¬éƒ½æ˜¯ Redis é›†ç¾¤ç¯å¢ƒï¼Œåšäº†æ•°æ®åˆ†ç‰‡æ“ä½œã€‚ä½ ä¸€ä¸ªäº‹åŠ¡ä¸­æœ‰æ¶‰åŠåˆ°å¤šä¸ª Key æ“ä½œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ª Key ä¸ä¸€å®šéƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª redis-server ä¸Šã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æœºåˆ¶ï¼Œååˆ†é¸¡è‚‹ã€‚</p><h3 id="å¦‚æœå¯¹è¿™ä¸ª-Key-æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº"><a href="#å¦‚æœå¯¹è¿™ä¸ª-Key-æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº" class="headerlink" title="å¦‚æœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº"></a>å¦‚æœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº</h3><p>è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå¤§å®¶å»æŠ¢é”ï¼ŒæŠ¢åˆ°é”å°±åš set æ“ä½œå³å¯ï¼Œæ¯”è¾ƒç®€å•ã€‚</p><h3 id="å¦‚æœå¯¹è¿™ä¸ª-Key-æ“ä½œï¼Œè¦æ±‚é¡ºåº"><a href="#å¦‚æœå¯¹è¿™ä¸ª-Key-æ“ä½œï¼Œè¦æ±‚é¡ºåº" class="headerlink" title="å¦‚æœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œè¦æ±‚é¡ºåº"></a>å¦‚æœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œè¦æ±‚é¡ºåº</h3><p>å‡è®¾æœ‰ä¸€ä¸ª key1ï¼Œç³»ç»Ÿ A éœ€è¦å°† key1 è®¾ç½®ä¸º valueAï¼Œç³»ç»Ÿ B éœ€è¦å°† key1 è®¾ç½®ä¸º valueBï¼Œç³»ç»Ÿ C éœ€è¦å°† key1 è®¾ç½®ä¸º valueCã€‚</p><p>æœŸæœ›æŒ‰ç…§ key1 çš„ value å€¼æŒ‰ç…§ valueA &gt; valueB &gt; valueC çš„é¡ºåºå˜åŒ–ã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬åœ¨æ•°æ®å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ã€‚</p><h3 id="å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š"><a href="#å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š" class="headerlink" title="å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š"></a>å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š</h3><p>ç³»ç»Ÿ A key 1 {valueA 3:00}<br>ç³»ç»Ÿ B key 1 {valueB 3:05}<br>ç³»ç»Ÿ C key 1 {valueC 3:10}</p><p>é‚£ä¹ˆï¼Œå‡è®¾ç³»ç»Ÿ B å…ˆæŠ¢åˆ°é”ï¼Œå°† key1 è®¾ç½®ä¸º{valueB 3:05}ã€‚æ¥ä¸‹æ¥ç³»ç»Ÿ A æŠ¢åˆ°é”ï¼Œå‘ç°è‡ªå·±çš„ valueA çš„æ—¶é—´æˆ³æ—©äºç¼“å­˜ä¸­çš„æ—¶é—´æˆ³ï¼Œé‚£å°±ä¸åš set æ“ä½œäº†ï¼Œä»¥æ­¤ç±»æ¨ã€‚å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚åˆ©ç”¨é˜Ÿåˆ—ï¼Œå°† set æ–¹æ³•å˜æˆä¸²è¡Œè®¿é—®ä¹Ÿå¯ä»¥ã€‚</p><h2 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h2><p>Redis åœ¨å›½å†…å„å¤§å…¬å¸éƒ½èƒ½çœ‹åˆ°å…¶èº«å½±ï¼Œæ¯”å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„æ–°æµªï¼Œé˜¿é‡Œï¼Œè…¾è®¯ï¼Œç™¾åº¦ï¼Œç¾å›¢ï¼Œå°ç±³ç­‰ã€‚å­¦ä¹  Redisï¼Œè¿™å‡ æ–¹é¢å°¤å…¶é‡è¦ï¼šRedis å®¢æˆ·ç«¯ã€Redis é«˜çº§åŠŸèƒ½ã€Redis æŒä¹…åŒ–å’Œå¼€å‘è¿ç»´å¸¸ç”¨é—®é¢˜æ¢è®¨ã€Redis å¤åˆ¶çš„åŸç†å’Œä¼˜åŒ–ç­–ç•¥ã€Redis åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆç­‰ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>mavenæœ¬åœ°JARåŒ…å®‰è£…</title>
    <url>/post/2221463e.html</url>
    <content><![CDATA[<h3 id="ä¸€ã€mavenå®‰è£…"><a href="#ä¸€ã€mavenå®‰è£…" class="headerlink" title="ä¸€ã€mavenå®‰è£…"></a>ä¸€ã€mavenå®‰è£…</h3><p>åœ¨éœ€è¦jarçš„é¡¹ç›®çš„æ ¹ç›®å½•æ‰§è¡Œä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn install:install-file -DgroupId&#x3D;com.baidu.boot -DartifactId&#x3D;net-base-utils -Dversion&#x3D;2.6.8 -Dfile&#x3D;C:\Users\Desktop\net-base-utils-2.6.8-SNAPSHOT.jar -Dpackaging&#x3D;jar -DgeneratePom&#x3D;true</span><br></pre></td></tr></table></figure><a id="more"></a><ol><li><p>DgroupIdï¼šæ˜¯é¡¹ç›®ç»„ç»‡å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œè‡ªå·±éšä¾¿èµ·å</p></li><li><p>DartifactIdï¼šé¡¹ç›®çš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œè‡ªå·±å¯ä»¥éšä¾¿èµ·</p></li><li><p>Dversionï¼šé¡¹ç›®ç‰ˆæœ¬</p></li><li><p>Dfileï¼šjaråŒ…è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰</p></li><li><p>DgeneratePomï¼šæ˜¯å¦ç”Ÿæˆpomæ–‡ä»¶ï¼Œture:ç”Ÿæˆï¼Œfalseï¼šä¸ç”Ÿæˆï¼›</p><p>æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨æœ¬åœ°mavençš„ä»“åº“æŒ‰ç…§DgroupIdè·¯å¾„æŸ¥æ‰¾å°±å¯ä»¥äº†ã€‚</p></li></ol><h3 id="äºŒã€æœ¬åœ°é¡¹ç›®ä¸­å¼•å…¥"><a href="#äºŒã€æœ¬åœ°é¡¹ç›®ä¸­å¼•å…¥" class="headerlink" title="äºŒã€æœ¬åœ°é¡¹ç›®ä¸­å¼•å…¥"></a>äºŒã€æœ¬åœ°é¡¹ç›®ä¸­å¼•å…¥</h3><p>1ã€åœ¨é¡¹ç›®çš„resourceç›®å½•ä¸‹æ–°å»ºlibæ–‡ä»¶å¤¹ï¼Œç„¶åå°†ä½ æœ¬åœ°çš„jaråŒ…copyåˆ°é‡Œé¢ï¼›</p><p>2ã€åœ¨mavençš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.baidu.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;net-base-utils&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.6.8&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;system&lt;&#x2F;scope&gt;</span><br><span class="line">			&lt;systemPath&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;resources&#x2F;lib&#x2F;net-base-utils-2.6.8.jar&lt;&#x2F;systemPath&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure><p>3ã€<scope>system</scope>é—®é¢˜</p><p>maven çš„<scope>çš„scopeå±æ€§å¯ä»¥ä¸ºsystemï¼Œç„¶åé€šè¿‡systemæ¥å¼•ç”¨ï¼Œä¸è¿‡ä¸æ¨èä½¿ç”¨systemï¼Œå› ä¸ºä¸€ä¸ªé¡¹ç›®çš„pom.xmlå¦‚æœä½¿ç”¨äº†scopeä¸ºsystemçš„dependåï¼Œä¼šå¯¼è‡´ä¼ é€’ä¾èµ–ä¸­æ–­ï¼Œå³æ‰€æœ‰å…¶ä»–ä¾èµ–æœ¬é¡¹ç›®çš„é¡¹ç›®éƒ½æ— æ³•ä¼ é€’ä¾èµ–äº†ã€‚</scope></p><p>æ¯”å¦‚ï¼šå‡è®¾Aé¡¹ç›®ä¾èµ–äº†m.jar, n.jar, x.jar, ç„¶åæˆ‘ä»¬æŠŠAé¡¹ç›®æ‰“åŒ…æˆäº†a.jar, å¦‚æœæ­¤æ—¶Bé¡¹ç›®ä¾èµ–äº†Aé¡¹ç›®ï¼Œåˆ™Bé¡¹ç›®é€šå¸¸è‡ªç„¶å°±å·²ç»é»˜è®¤ä¼ é€’ä¾èµ–äº†m.jar, n.jar, x.jarã€‚</p><p>ä½†æ˜¯å¦‚æœAé¡¹ç›®çš„pom.xmlæ–‡ä»¶å‡ºç°äº†scopeä¸ºsystemçš„depend,åˆ™Bé¡¹ç›®å°±åªèƒ½ä¾èµ–a.jar, å°†æ— æ³•ä¼ é€’ä¾èµ–m.jar, n.jar, x.jarï¼›</p><h3 id="ä¸‰ã€æœ€ç»ˆæ¨èä½¿ç”¨"><a href="#ä¸‰ã€æœ€ç»ˆæ¨èä½¿ç”¨" class="headerlink" title="ä¸‰ã€æœ€ç»ˆæ¨èä½¿ç”¨"></a>ä¸‰ã€æœ€ç»ˆæ¨èä½¿ç”¨</h3><p>æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•æ¥å¼•ç”¨å¤–éƒ¨çš„jaråŒ…ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå®ç°6ç§è´Ÿè½½å‡è¡¡ç®—æ³•</title>
    <url>/post/31519438.html</url>
    <content><![CDATA[<h3 id="1ã€å®Œå…¨éšæœºç®—æ³•"><a href="#1ã€å®Œå…¨éšæœºç®—æ³•" class="headerlink" title="1ã€å®Œå…¨éšæœºç®—æ³•"></a>1ã€å®Œå…¨éšæœºç®—æ³•</h3><p>ç¼ºç‚¹: æ‰€æœ‰æœåŠ¡å™¨çš„è®¿é—®æ¦‚ç‡éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><a id="more"></a><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.random;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line"><span class="comment"> * å®Œå…¨éšæœºç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; list = Arrays.asList(<span class="string">"10.180.11.126:8888"</span>,<span class="string">"10.180.11.128:8888"</span>,<span class="string">"10.180.11.130:8888"</span>);</span><br><span class="line">    <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> number = random.nextInt(list.size());</span><br><span class="line">        <span class="keyword">return</span> list.get(number);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åŠ æƒéšæœºç®—æ³•"><a href="#2ã€åŠ æƒéšæœºç®—æ³•" class="headerlink" title="2ã€åŠ æƒéšæœºç®—æ³•"></a>2ã€åŠ æƒéšæœºç®—æ³•</h3><p>åœºæ™¯ï¼šæœ‰çš„æœåŠ¡å™¨æ€§èƒ½é«˜ï¼Œå¯ä»¥è®©éšæœºåˆ°æ­¤æœåŠ¡å™¨çš„å¯èƒ½æ€§å¢å¤§</p><p>ç¼ºç‚¹ï¼šæƒé‡ä½çš„æœåŠ¡å™¨å¯èƒ½å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½è®¿é—®ä¸åˆ°3</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.random;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¦‚æœæŸä¸€å°æœåŠ¡å™¨æ€§èƒ½æ¯”è¾ƒé«˜ï¼Œè®¾ç½®è®¿é—®çš„æƒé‡é«˜ä¸€ç‚¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åŠ æƒéšæœºç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeightRandomServer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        map.put(<span class="string">"10.180.11.126:8888"</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">"10.180.11.128:8888"</span>,<span class="number">7</span>);</span><br><span class="line">        map.put(<span class="string">"10.180.11.130:8888"</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“æƒé‡è®¾ç½®è¿‡å¤§æ—¶ï¼Œlistå®¹æ˜“è¢«æ’‘çˆ†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,Integer&gt; entry: map.entrySet()) &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//æ ¹æ®æƒé‡ï¼Œå†³å®šå‘listä¸­æ·»åŠ å‡ æ¬¡</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; entry.getValue(); i++) &#123;</span><br><span class="line"> </span><br><span class="line">                list.add(entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//listçš„å¤§å°</span></span><br><span class="line">        <span class="keyword">int</span> weight = map.values().stream().mapToInt(p -&gt; p).sum();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> number = random.nextInt(weight);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> list.get(number);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜åŒ–å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¡ç®—æ€»æƒå€¼</span></span><br><span class="line">        <span class="keyword">int</span> weight = map.values().stream().mapToInt(p -&gt; p).sum();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//éšæœºä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line">        <span class="keyword">int</span> index = random.nextInt(weight);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//éå†  æœåŠ¡  map</span></span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæƒé‡å¤§äº  ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">if</span>(entry.getValue() &gt;= index) &#123;</span><br><span class="line">                <span class="comment">// è¿”å›è¿™ä¸ªæœåŠ¡</span></span><br><span class="line">                <span class="keyword">return</span> entry.getKey();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦åˆ™ï¼Œç´¢å¼• = å½“å‰ç´¢å¼• - å½“å‰æœåŠ¡çš„æƒé‡</span></span><br><span class="line">            index = index - entry.getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//System.out.println(getServer());</span></span><br><span class="line">            System.out.println(getServer1());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€å®Œå…¨è½®è¯¢ç®—æ³•"><a href="#3ã€å®Œå…¨è½®è¯¢ç®—æ³•" class="headerlink" title="3ã€å®Œå…¨è½®è¯¢ç®—æ³•"></a>3ã€å®Œå…¨è½®è¯¢ç®—æ³•</h3><p>ç¼ºç‚¹ï¼šä»å¤´åˆ°å°¾è½®è¯¢ä¸€éï¼Œä¸èƒ½æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è®¾ç½®æƒé‡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.poll;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œå…¨è½®è¯¢ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PollServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; list = Arrays.asList(<span class="string">"10.180.11.126:8888"</span>,<span class="string">"10.180.11.128:8888"</span>,<span class="string">"10.180.11.130:8888"</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> index;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index == list.size()) &#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.get(index++);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line"> </span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€åŠ æƒè½®è¯¢ç®—æ³•"><a href="#4ã€åŠ æƒè½®è¯¢ç®—æ³•" class="headerlink" title="4ã€åŠ æƒè½®è¯¢ç®—æ³•"></a>4ã€åŠ æƒè½®è¯¢ç®—æ³•</h3><p>ä¼˜ç‚¹ï¼šå¯ä»¥æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è®¾ç½®è®¿é—®æƒé‡</p><p>ç¼ºç‚¹ï¼šå¯èƒ½æŸä¸ªæœåŠ¡å™¨æƒé‡å¤§ï¼Œé•¿æ—¶é—´æ‰§è¡Œï¼Œé‡åˆ°è€—æ—¶å¤§çš„è¯·æ±‚ï¼Œå‹åŠ›ä¼šå¾ˆå¤§</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.poll;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ æƒè½®è¯¢ç®—æ³•</span></span><br><span class="line"><span class="comment"> * å®é™…ä¸­å¯èƒ½é‡åˆ°æŸä¸ªæœåŠ¡å™¨å‹åŠ›è¾ƒå¤§ï¼Œé•¿æ—¶é—´æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeightPollServer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        map.put(<span class="string">"10.180.11.126:8888"</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">"10.180.11.128:8888"</span>,<span class="number">7</span>);</span><br><span class="line">        map.put(<span class="string">"10.180.11.130:8888"</span>,<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> index;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> weight = map.values().stream().mapToInt( p -&gt; p).sum();</span><br><span class="line">        <span class="keyword">int</span> number = (index++) % weight;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.getValue() &gt;= number) &#123;</span><br><span class="line">                <span class="keyword">return</span> entry.getKey();</span><br><span class="line">            &#125;</span><br><span class="line">            number = number - entry.getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•"><a href="#5ã€å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•" class="headerlink" title="5ã€å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•"></a>5ã€å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•</h3><p>ä¼˜ç‚¹ï¼šæ ¹æ®æƒé‡åˆ†é…æœåŠ¡ï¼ŒåŒæ—¶åˆä¿è¯æƒé‡ä½çš„æœåŠ¡å¯ä»¥è¢«è®¿é—®åˆ°</p><p>ç¼ºç‚¹ï¼šé›†ç¾¤ç¯å¢ƒä¸‹ï¼ŒåŒä¸€ä¸ªç”¨æˆ·è®¿é—®æ— æ³•åˆ†æµåˆ°å›ºå®šä¸€å°æœºå™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.smooth;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¹³æ»‘åŠ æƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothWeight</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> weight;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentWeight;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWeight</span><span class="params">(<span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentWeight;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentWeight</span><span class="params">(<span class="keyword">int</span> currentWeight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentWeight = currentWeight;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SmoothWeight</span><span class="params">(<span class="keyword">int</span> weight, <span class="keyword">int</span> currentWeight, String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">        <span class="keyword">this</span>.currentWeight = currentWeight;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.smooth;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmoothWeightPollServer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,SmoothWeight&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        map.put(<span class="string">"10.180.11.126:8888"</span>,<span class="keyword">new</span> SmoothWeight(<span class="number">5</span>,<span class="number">5</span>,<span class="string">"10.180.11.126:8888"</span>));</span><br><span class="line">        map.put(<span class="string">"10.180.11.128:8888"</span>,<span class="keyword">new</span> SmoothWeight(<span class="number">2</span>,<span class="number">2</span>,<span class="string">"10.180.11.128:8888"</span>));</span><br><span class="line">        map.put(<span class="string">"10.180.11.130:8888"</span>,<span class="keyword">new</span> SmoothWeight(<span class="number">4</span>,<span class="number">4</span>,<span class="string">"10.180.11.130:8888"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        SmoothWeight maxSmoothWeight = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> weight = map.values().stream().mapToInt(SmoothWeight :: getWeight).sum();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,SmoothWeight&gt; entry : map.entrySet()) &#123;</span><br><span class="line"> </span><br><span class="line">            SmoothWeight currentSmoothWeight = entry.getValue();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(maxSmoothWeight == <span class="keyword">null</span> || currentSmoothWeight.getCurrentWeight() &gt; maxSmoothWeight.getCurrentWeight()) &#123;</span><br><span class="line">                maxSmoothWeight = currentSmoothWeight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">assert</span> maxSmoothWeight != <span class="keyword">null</span>;</span><br><span class="line">        maxSmoothWeight.setCurrentWeight(maxSmoothWeight.getCurrentWeight() - weight);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,SmoothWeight&gt; entry : map.entrySet()) &#123;</span><br><span class="line"> </span><br><span class="line">            SmoothWeight currentSmoothWeight = entry.getValue();</span><br><span class="line"> </span><br><span class="line">            currentSmoothWeight.setCurrentWeight(currentSmoothWeight.getCurrentWeight() + currentSmoothWeight.getWeight());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> maxSmoothWeight.getAddress();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€å“ˆå¸Œè´Ÿè½½ç®—æ³•"><a href="#6ã€å“ˆå¸Œè´Ÿè½½ç®—æ³•" class="headerlink" title="6ã€å“ˆå¸Œè´Ÿè½½ç®—æ³•"></a>6ã€å“ˆå¸Œè´Ÿè½½ç®—æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.core.hash;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.SortedMap;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hashè´Ÿè½½ç®—æ³•</span></span><br><span class="line"><span class="comment"> * åœ¨ä¸€ä¸ªé›†ç¾¤ç¯å¢ƒä¸‹ï¼Œè®©åŒä¸€ä¸ªç”¨æˆ·çš„è®¿é—®ï¼Œåˆ†æµåˆ°å›ºå®šçš„ä¸€å°æœºå™¨ä¸Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashServer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; list = Arrays.asList(<span class="string">"10.180.11.126:8888"</span>,<span class="string">"10.180.11.128:8888"</span>,<span class="string">"10.180.11.130:8888"</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">(String client)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> nodeCount = <span class="number">40</span>;</span><br><span class="line"> </span><br><span class="line">        TreeMap&lt;Integer,String&gt; treeMap = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(String s : list) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeCount; i++) &#123;</span><br><span class="line">                treeMap.put((s + <span class="string">"address:"</span> + i).hashCode(), s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        SortedMap&lt;Integer,String&gt; sortedMap = treeMap.tailMap(client.hashCode());</span><br><span class="line"> </span><br><span class="line">        Integer firstHash = (sortedMap.size() &gt; <span class="number">0</span>) ? sortedMap.firstKey() : treeMap.firstKey();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> treeMap.get(firstHash);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer(<span class="string">"ç”¨æˆ·ï¼š"</span> + i + <span class="string">"è®¿é—®"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>EasyPoIè‡ªå®šä¹‰æ ·å¼</title>
    <url>/post/ee4afaf1.html</url>
    <content><![CDATA[<h3 id="ä¸€ã€ä¾èµ–"><a href="#ä¸€ã€ä¾èµ–" class="headerlink" title="ä¸€ã€ä¾èµ–"></a>ä¸€ã€ä¾èµ–</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">              &lt;groupId&gt;cn.afterturn&lt;&#x2F;groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;easypoi-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">              &lt;version&gt;4.2.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="äºŒã€æ·»åŠ æ ·å¼å®ç°ç±»"><a href="#äºŒã€æ·»åŠ æ ·å¼å®ç°ç±»" class="headerlink" title="äºŒã€æ·»åŠ æ ·å¼å®ç°ç±»"></a>äºŒã€æ·»åŠ æ ·å¼å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.params.ExcelExportEntity;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.params.ExcelForEachParams;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.export.styler.IExcelExportStyler;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Jia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> è‡ªå®šä¹‰è¡¨å¤´æ ·å¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/8/4 11:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppExcelExportStylerImpl</span> <span class="keyword">implements</span> <span class="title">IExcelExportStyler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> STRING_FORMAT = (<span class="keyword">short</span>) BuiltinFormats.getBuiltinFormat(<span class="string">"TEXT"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> FONT_SIZE_TEN = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> FONT_SIZE_ELEVEN = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">short</span> FONT_SIZE_TWELVE = <span class="number">12</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤§æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> CellStyle headerStyle;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯åˆ—æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> CellStyle titleStyle;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è¡Œæ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> CellStyle styles;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AppExcelExportStylerImpl</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.init(workbook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.headerStyle = initHeaderStyle(workbook);</span><br><span class="line">        <span class="keyword">this</span>.titleStyle = initTitleStyle(workbook);</span><br><span class="line">        <span class="keyword">this</span>.styles = initStyles(workbook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤§æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellStyle <span class="title">getHeaderStyle</span><span class="params">(<span class="keyword">short</span> color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> headerStyle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯åˆ—æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellStyle <span class="title">getTitleStyle</span><span class="params">(<span class="keyword">short</span> color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> titleStyle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è¡Œæ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parity å¯ä»¥ç”¨æ¥è¡¨ç¤ºå¥‡å¶è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entity æ•°æ®å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ ·å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellStyle <span class="title">getStyles</span><span class="params">(<span class="keyword">boolean</span> parity, ExcelExportEntity entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> styles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ ·å¼æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataRow æ•°æ®è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj     å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data    æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellStyle <span class="title">getStyles</span><span class="params">(Cell cell, <span class="keyword">int</span> dataRow, ExcelExportEntity entity, Object obj, Object    data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getStyles(<span class="keyword">true</span>, entity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ¿ä½¿ç”¨çš„æ ·å¼è®¾ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CellStyle <span class="title">getTemplateStyles</span><span class="params">(<span class="keyword">boolean</span> isSingle, ExcelForEachParams excelForEachParams)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–--å¤§æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> CellStyle <span class="title">initHeaderStyle</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        CellStyle style = getBaseCellStyle(workbook);</span><br><span class="line">        style.setFont(getFont(workbook, FONT_SIZE_TWELVE, <span class="keyword">true</span>));</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–--æ¯åˆ—æ ‡é¢˜æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> CellStyle <span class="title">initTitleStyle</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        CellStyle style = getBaseCellStyle(workbook);</span><br><span class="line">        style.setFont(getFont(workbook, FONT_SIZE_ELEVEN, <span class="keyword">false</span>));</span><br><span class="line">        <span class="comment">//èƒŒæ™¯è‰²</span></span><br><span class="line">        style.setFillForegroundColor(IndexedColors.YELLOW.getIndex());</span><br><span class="line">        style.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–--æ•°æ®è¡Œæ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> CellStyle <span class="title">initStyles</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        CellStyle style = getBaseCellStyle(workbook);</span><br><span class="line">        style.setFont(getFont(workbook, FONT_SIZE_TEN, <span class="keyword">false</span>));</span><br><span class="line">        style.setDataFormat(STRING_FORMAT);</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºç¡€æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> CellStyle <span class="title">getBaseCellStyle</span><span class="params">(Workbook workbook)</span> </span>&#123;</span><br><span class="line">        CellStyle style = workbook.createCellStyle();</span><br><span class="line">        <span class="comment">//ä¸‹è¾¹æ¡†</span></span><br><span class="line">        style.setBorderBottom(BorderStyle.THIN);</span><br><span class="line">        <span class="comment">//å·¦è¾¹æ¡†</span></span><br><span class="line">        style.setBorderLeft(BorderStyle.THIN);</span><br><span class="line">        <span class="comment">//ä¸Šè¾¹æ¡†</span></span><br><span class="line">        style.setBorderTop(BorderStyle.THIN);</span><br><span class="line">        <span class="comment">//å³è¾¹æ¡†</span></span><br><span class="line">        style.setBorderRight(BorderStyle.THIN);</span><br><span class="line">        <span class="comment">//æ°´å¹³å±…ä¸­</span></span><br><span class="line">        style.setAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">        <span class="comment">//ä¸Šä¸‹å±…ä¸­</span></span><br><span class="line">        style.setVerticalAlignment(VerticalAlignment.CENTER);</span><br><span class="line">        <span class="comment">//è®¾ç½®è‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">        style.setWrapText(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—ä½“æ ·å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size   å­—ä½“å¤§å°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isBold æ˜¯å¦åŠ ç²—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Font <span class="title">getFont</span><span class="params">(Workbook workbook, <span class="keyword">short</span> size, <span class="keyword">boolean</span> isBold)</span> </span>&#123;</span><br><span class="line">        Font font = workbook.createFont();</span><br><span class="line">        <span class="comment">//å­—ä½“æ ·å¼</span></span><br><span class="line">        font.setFontName(<span class="string">"å®‹ä½“"</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦åŠ ç²—</span></span><br><span class="line">        font.setBold(isBold);</span><br><span class="line">        <span class="comment">//å­—ä½“å¤§å°</span></span><br><span class="line">        font.setFontHeightInPoints(size);</span><br><span class="line">        <span class="keyword">return</span> font;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€EasyPoiå¯¼å‡ºè®¾ç½®è‡ªå®šä¹‰æ ·å¼"><a href="#ä¸‰ã€EasyPoiå¯¼å‡ºè®¾ç½®è‡ªå®šä¹‰æ ·å¼" class="headerlink" title="ä¸‰ã€EasyPoiå¯¼å‡ºè®¾ç½®è‡ªå®šä¹‰æ ·å¼"></a>ä¸‰ã€EasyPoiå¯¼å‡ºè®¾ç½®è‡ªå®šä¹‰æ ·å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å‡º</span></span><br><span class="line"> ExportParams exportParams = <span class="keyword">new</span> ExportParams(<span class="string">"è¡¨å¤´åç§°"</span>, <span class="string">"sheeté¡µåç§°"</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è‡ªå®šä¹‰æ ·å¼ç±»</span></span><br><span class="line">exportParams.setStyle(AppExcelExportStylerImpl<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Workbook workbook = ExcelExportUtil.exportExcel(</span><br><span class="line">                 exportParams,</span><br><span class="line">                 ExclHQContractVO<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">                <span class="title">exclHQContractVOList</span>)</span>;</span><br><span class="line"> <span class="comment">// ä¸‹è½½</span></span><br><span class="line"> EasyPoiUtils.browserDownload(response, request, workbook);</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>EasyPoI</tag>
      </tags>
  </entry>
  <entry>
    <title>IDEAè¿œç¨‹è°ƒè¯•</title>
    <url>/post/159c8b21.html</url>
    <content><![CDATA[<h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><p>åœ¨å¼€å‘ä¸­æ¯æ¬¡é‡åˆ°å¾ˆæ£˜æ‰‹çš„çº¿ä¸Šç¯å¢ƒé—®é¢˜ï¼Œä½†æ˜¯åˆä¸èƒ½debugè°ƒè¯•çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨IDEAè¿œç¨‹è°ƒè¯•çš„æ–¹æ³•æ¥è¿›è¡Œè°ƒè¯•ã€‚</p><p>è¯·å¼€å§‹æ‚¨çš„è¡¨æ¼”~</p><a id="more"></a><h3 id="ï¼ˆä¸€ï¼‰IDEAé…ç½®"><a href="#ï¼ˆä¸€ï¼‰IDEAé…ç½®" class="headerlink" title="ï¼ˆä¸€ï¼‰IDEAé…ç½®"></a>ï¼ˆä¸€ï¼‰IDEAé…ç½®</h3><p>åœ¨ideaå¯åŠ¨æ ä¸­é€‰æ‹©Edit Configurations,æ·»åŠ Remoteè¿œç¨‹è¿æ¥ã€‚<br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210309134206.png" alt=""></p><h3 id="ï¼ˆäºŒï¼‰è¿œç¨‹æœåŠ¡å™¨é…ç½®"><a href="#ï¼ˆäºŒï¼‰è¿œç¨‹æœåŠ¡å™¨é…ç½®" class="headerlink" title="ï¼ˆäºŒï¼‰è¿œç¨‹æœåŠ¡å™¨é…ç½®"></a>ï¼ˆäºŒï¼‰è¿œç¨‹æœåŠ¡å™¨é…ç½®</h3><p>è®¾ç½®åç§°ä¸ºï¼šworkerDebugï¼Œ<br>Hostï¼šä¸ºè¿œç¨‹è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ï¼ŒPortï¼šä¸ºdebugæ—¶çš„ç«¯å£å·<br>åœ¨ideaä¸­é…ç½®å®Œè¿œç¨‹è¿æ¥åï¼Œå¤åˆ¶ï¼š<br>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8088<br>ç²˜è´´åˆ°ideaçš„JVMä¿¡æ¯æ ç›®ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210309134215.jpg" alt=""></p><h3 id="ï¼ˆä¸‰ï¼‰è¿œç¨‹æœåŠ¡å™¨å¼€å¯è°ƒè¯•æ¨¡å¼"><a href="#ï¼ˆä¸‰ï¼‰è¿œç¨‹æœåŠ¡å™¨å¼€å¯è°ƒè¯•æ¨¡å¼" class="headerlink" title="ï¼ˆä¸‰ï¼‰è¿œç¨‹æœåŠ¡å™¨å¼€å¯è°ƒè¯•æ¨¡å¼"></a>ï¼ˆä¸‰ï¼‰è¿œç¨‹æœåŠ¡å™¨å¼€å¯è°ƒè¯•æ¨¡å¼</h3><p>å¢åŠ JVMå¯åŠ¨å‚æ•°ï¼Œä»¥æ”¯æŒè¿œç¨‹è°ƒè¯•ï¼Œé‡æ–°åœæ­¢å¹¶å¯åŠ¨å‘½ä»¤:<br>java -jar -Xrunjdwp:transport=dt_socket,address=8088,suspend=y,server=y test.jar &amp;</p><h3 id="ï¼ˆå››ï¼‰å¦‚ä½•éªŒè¯æ˜¯å¦è¿œç¨‹è°ƒè¯•è¿æ¥æˆåŠŸ"><a href="#ï¼ˆå››ï¼‰å¦‚ä½•éªŒè¯æ˜¯å¦è¿œç¨‹è°ƒè¯•è¿æ¥æˆåŠŸ" class="headerlink" title="ï¼ˆå››ï¼‰å¦‚ä½•éªŒè¯æ˜¯å¦è¿œç¨‹è°ƒè¯•è¿æ¥æˆåŠŸ"></a>ï¼ˆå››ï¼‰å¦‚ä½•éªŒè¯æ˜¯å¦è¿œç¨‹è°ƒè¯•è¿æ¥æˆåŠŸ</h3><p>æ§åˆ¶å°å¦‚æœå‡ºç°Connected to the target VM, address: â€˜10.37.141.252:8899â€™,transport:â€™socketâ€™ï¼Œ<br>å³è¯´æ˜è¿œç¨‹è¿æ¥æˆåŠŸå¯ä»¥æ‰“æ–­ç‚¹ï¼Œè°ƒç”¨æ¥å£è¿›è¡Œè°ƒè¯•ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>ESä¼˜åŒ–çŸ¥è¯†ç‚¹æ€»ç»“</title>
    <url>/post/320ab92e.html</url>
    <content><![CDATA[<h3 id="ï¼ˆä¸€ï¼‰åˆ†ç‰‡ç­–ç•¥"><a href="#ï¼ˆä¸€ï¼‰åˆ†ç‰‡ç­–ç•¥" class="headerlink" title="ï¼ˆä¸€ï¼‰åˆ†ç‰‡ç­–ç•¥"></a>ï¼ˆä¸€ï¼‰åˆ†ç‰‡ç­–ç•¥</h3><h4 id="1-é€‰æ‹©åˆé€‚çš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°ã€‚"><a href="#1-é€‰æ‹©åˆé€‚çš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°ã€‚" class="headerlink" title="1.é€‰æ‹©åˆé€‚çš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°ã€‚"></a>1.é€‰æ‹©åˆé€‚çš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°ã€‚</h4><p>ESçš„åˆ†ç‰‡åˆ†ä¸ºä¸¤ç§ï¼Œä¸»åˆ†ç‰‡ï¼ˆPrimary Shardï¼‰å’Œå‰¯æœ¬ï¼ˆReplicasï¼‰ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒESä¼šä¸ºæ¯ä¸ªç´¢å¼•åˆ›å»º5ä¸ªåˆ†ç‰‡ï¼Œå³ä½¿æ˜¯åœ¨å•æœºç¯å¢ƒä¸‹ï¼Œè¿™ç§å†—ä½™è¢«ç§°ä½œè¿‡åº¦åˆ†é…ï¼ˆOver Allocationï¼‰ï¼Œç›®å‰çœ‹æ¥è¿™ä¹ˆåšå®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œä»…åœ¨æ•£å¸ƒæ–‡æ¡£åˆ°åˆ†ç‰‡å’Œå¤„ç†æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­å°±å¢åŠ äº†æ›´å¤šçš„å¤æ‚æ€§ï¼Œå¥½åœ¨ESçš„ä¼˜ç§€æ€§èƒ½æ©ç›–äº†è¿™ä¸€ç‚¹ã€‚å‡è®¾ä¸€ä¸ªç´¢å¼•ç”±ä¸€ä¸ªåˆ†ç‰‡æ„æˆï¼Œé‚£ä¹ˆå½“ç´¢å¼•çš„å¤§å°è¶…è¿‡å•ä¸ªèŠ‚ç‚¹çš„å®¹é‡çš„æ—¶å€™ï¼ŒESä¸èƒ½å°†ç´¢å¼•åˆ†å‰²æˆå¤šä»½ï¼Œå› æ­¤å¿…é¡»åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±æŒ‡å®šå¥½éœ€è¦çš„åˆ†ç‰‡æ•°é‡ã€‚æ­¤æ—¶æˆ‘ä»¬æ‰€èƒ½åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œå¹¶åœ¨åˆå§‹è®¾å®šä¹‹ä¸­æŒ‡å®šè¿™ä¸ªç´¢å¼•æ‹¥æœ‰æ›´å¤šçš„åˆ†ç‰‡ã€‚<a id="more"></a> åä¹‹å¦‚æœè¿‡åº¦åˆ†é…ï¼Œå°±å¢å¤§äº†Luceneåœ¨åˆå¹¶åˆ†ç‰‡æŸ¥è¯¢ç»“æœæ—¶çš„å¤æ‚åº¦ï¼Œä»è€Œå¢å¤§äº†è€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ä»¥ä¸‹ç»“è®ºï¼šæˆ‘ä»¬åº”è¯¥ä½¿ç”¨æœ€å°‘çš„åˆ†ç‰‡ï¼ä¸»åˆ†ç‰‡ï¼Œå‰¯æœ¬å’ŒèŠ‚ç‚¹æœ€å¤§æ•°ä¹‹é—´æ•°é‡å­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼š<br>èŠ‚ç‚¹æ•°&lt;=ä¸»åˆ†ç‰‡æ•°*ï¼ˆå‰¯æœ¬æ•°+1ï¼‰</p><h4 id="2-æ§åˆ¶åˆ†ç‰‡åˆ†é…è¡Œä¸ºã€‚"><a href="#2-æ§åˆ¶åˆ†ç‰‡åˆ†é…è¡Œä¸ºã€‚" class="headerlink" title="2.æ§åˆ¶åˆ†ç‰‡åˆ†é…è¡Œä¸ºã€‚"></a>2.æ§åˆ¶åˆ†ç‰‡åˆ†é…è¡Œä¸ºã€‚</h4><p>ä»¥ä¸Šæ˜¯åœ¨åˆ›å»ºæ¯ä¸ªç´¢å¼•çš„æ—¶å€™éœ€è¦è€ƒè™‘çš„ä¼˜åŒ–æ–¹æ³•ï¼Œç„¶è€Œåœ¨ç´¢å¼•å·²åˆ›å»ºå¥½çš„å‰æä¸‹ï¼Œæ˜¯å¦å°±æ˜¯æ²¡æœ‰åŠæ³•ä»åˆ†ç‰‡çš„è§’åº¦æé«˜äº†æ€§èƒ½äº†å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œé¦–å…ˆèƒ½åšçš„æ˜¯è°ƒæ•´åˆ†ç‰‡åˆ†é…å™¨çš„ç±»å‹ï¼Œå…·ä½“æ˜¯åœ¨elasticsearch.ymlä¸­è®¾ç½®cluster.routing.allocation.typeå±æ€§ï¼Œå…±æœ‰ä¸¤ç§åˆ†ç‰‡å™¨even_shard , balancedï¼ˆé»˜è®¤ï¼‰ã€‚even_shardæ˜¯å°½é‡ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å…·æœ‰ç›¸åŒæ•°é‡çš„åˆ†ç‰‡ï¼Œbalancedæ˜¯åŸºäºå¯æ§åˆ¶çš„æƒé‡è¿›è¡Œåˆ†é…ï¼Œç›¸å¯¹äºå‰ä¸€ä¸ªåˆ†é…å™¨ï¼Œå®ƒæ›´æš´æ¼äº†ä¸€äº›å‚æ•°è€Œå¼•å…¥è°ƒæ•´åˆ†é…è¿‡ç¨‹çš„èƒ½åŠ›ã€‚æ¯æ¬¡ESçš„åˆ†ç‰‡è°ƒæ•´éƒ½æ˜¯åœ¨ESä¸Šçš„æ•°æ®åˆ†å¸ƒå‘ç”Ÿäº†å˜åŒ–çš„æ—¶å€™è¿›è¡Œçš„ï¼Œæœ€æœ‰ä»£è¡¨æ€§çš„å°±æ˜¯æœ‰æ–°çš„æ•°æ®èŠ‚ç‚¹åŠ å…¥äº†é›†ç¾¤çš„æ—¶å€™ã€‚å½“ç„¶è°ƒæ•´åˆ†ç‰‡çš„æ—¶æœºå¹¶ä¸æ˜¯ç”±æŸä¸ªé˜ˆå€¼è§¦å‘çš„ï¼ŒESå†…ç½®åä¸€ä¸ªè£å†³è€…æ¥å†³å®šæ˜¯å¦è§¦å‘åˆ†ç‰‡è°ƒæ•´ï¼Œè¿™é‡Œæš‚ä¸èµ˜è¿°ã€‚å¦å¤–ï¼Œè¿™äº›åˆ†é…éƒ¨ç½²ç­–ç•¥éƒ½æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ–°çš„ã€‚</p><h3 id="ï¼ˆäºŒï¼‰è·¯ç”±ä¼˜åŒ–"><a href="#ï¼ˆäºŒï¼‰è·¯ç”±ä¼˜åŒ–" class="headerlink" title="ï¼ˆäºŒï¼‰è·¯ç”±ä¼˜åŒ–"></a>ï¼ˆäºŒï¼‰è·¯ç”±ä¼˜åŒ–</h3><p>ESä¸­æ‰€è°“çš„è·¯ç”±å’ŒIPç½‘ç»œä¸åŒï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼äºTagçš„ä¸œè¥¿ã€‚åœ¨åˆ›å»ºæ–‡æ¡£çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å­—æ®µä¸ºæ–‡æ¡£å¢åŠ ä¸€ä¸ªè·¯ç”±å±æ€§çš„Tagã€‚ESå†…åœ¨æœºåˆ¶å†³å®šäº†æ‹¥æœ‰ç›¸åŒè·¯ç”±å±æ€§çš„æ–‡æ¡£ï¼Œä¸€å®šä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªåˆ†ç‰‡ä¸Šï¼Œæ— è®ºæ˜¯ä¸»åˆ†ç‰‡è¿˜æ˜¯å‰¯æœ¬ã€‚é‚£ä¹ˆï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦æŒ‡å®šäº†æ„Ÿå…´è¶£çš„è·¯ç”±å±æ€§ï¼ŒESå°±å¯ä»¥ç›´æ¥åˆ°ç›¸åº”çš„åˆ†ç‰‡æ‰€åœ¨çš„æœºå™¨ä¸Šè¿›è¡Œæœç´¢ï¼Œè€Œé¿å…äº†å¤æ‚çš„åˆ†å¸ƒå¼ååŒçš„ä¸€äº›å·¥ä½œï¼Œä»è€Œæå‡äº†ESçš„æ€§èƒ½ã€‚äºæ­¤åŒæ—¶ï¼Œå‡è®¾æœºå™¨1ä¸Šå­˜æœ‰è·¯ç”±å±æ€§Açš„æ–‡æ¡£ï¼Œæœºå™¨2ä¸Šå­˜æœ‰è·¯ç”±å±æ€§ä¸ºBçš„æ–‡æ¡£ï¼Œé‚£ä¹ˆæˆ‘åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¸€æ—¦æŒ‡å®šç›®æ ‡è·¯ç”±å±æ€§ä¸ºAï¼Œå³ä½¿æœºå™¨2æ•…éšœç˜«ç—ªï¼Œå¯¹æœºå™¨1æ„ä¸æˆå¾ˆå¤§å½±å“ï¼Œæ‰€ä»¥è¿™ä¹ˆåšå¯¹ç¾å†µä¸‹çš„æŸ¥è¯¢ä¹Ÿæå‡ºäº†è§£å†³æ–¹æ¡ˆã€‚æ‰€è°“çš„è·¯ç”±ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†æ¡¶ï¼ˆBucketingï¼‰æ“ä½œã€‚å½“ç„¶ï¼ŒæŸ¥è¯¢ä¸­ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªè·¯ç”±å±æ€§ï¼Œæœºåˆ¶å¤§åŒå°å¼‚ã€‚</p><h3 id="ï¼ˆä¸‰ï¼‰ESä¸Šçš„GCè°ƒä¼˜"><a href="#ï¼ˆä¸‰ï¼‰ESä¸Šçš„GCè°ƒä¼˜" class="headerlink" title="ï¼ˆä¸‰ï¼‰ESä¸Šçš„GCè°ƒä¼˜"></a>ï¼ˆä¸‰ï¼‰ESä¸Šçš„GCè°ƒä¼˜</h3><p>ElasticSearchæœ¬è´¨ä¸Šæ˜¯ä¸ªJavaç¨‹åºï¼Œæ‰€ä»¥é…ç½®JVMåƒåœ¾å›æ”¶å™¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„ä¹‰çš„å·¥ä½œã€‚æˆ‘ä»¬ä½¿ç”¨JVMçš„Xmså’ŒXmxå‚æ•°æ¥æä¾›æŒ‡å®šå†…å­˜å¤§å°ï¼Œæœ¬è´¨ä¸Šæä¾›çš„æ˜¯JVMçš„å †ç©ºé—´å¤§å°ï¼Œå½“JVMçš„å †ç©ºé—´ä¸è¶³çš„æ—¶å€™å°±ä¼šè§¦å‘è‡´å‘½çš„OutOfMemoryExceptionã€‚è¿™æ„å‘³ç€è¦ä¹ˆå†…å­˜ä¸è¶³ï¼Œè¦ä¹ˆå‡ºç°äº†å†…å­˜æ³„éœ²ã€‚å¤„ç†GCé—®é¢˜ï¼Œé¦–å…ˆè¦ç¡®å®šé—®é¢˜çš„æºå¤´ï¼Œä¸€èˆ¬æœ‰ä¸‰ç§æ–¹æ¡ˆï¼š</p><ul><li>å¼€å¯ElasticSearchä¸Šçš„GCæ—¥å¿—</li><li>ä½¿ç”¨jstatå‘½ä»¤</li><li>ç”Ÿæˆå†…å­˜Dump</li></ul><p>ç¬¬ä¸€æ¡ï¼Œåœ¨ESçš„é…ç½®æ–‡ä»¶elasticsearch.ymlä¸­æœ‰ç›¸å…³çš„å±æ€§å¯ä»¥é…ç½®ã€‚<br>ç¬¬äºŒæ¡ï¼Œjstatå‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹JVMå †ä¸­å„ä¸ªåŒºçš„ä½¿ç”¨æƒ…å†µå’ŒGCçš„è€—æ—¶æƒ…å†µã€‚<br>ç¬¬ä¸‰æ¡ï¼Œæœ€åçš„åŠæ³•å°±æ˜¯å°†JVMçš„å †ç©ºé—´è½¬å‚¨åˆ°æ–‡ä»¶ä¸­å»ï¼Œå®è´¨ä¸Šæ˜¯å¯¹JVMå †ç©ºé—´çš„ä¸€ä¸ªå¿«ç…§ã€‚<br>å¦å¤–ï¼Œé€šè¿‡ä¿®æ”¹ESèŠ‚ç‚¹çš„å¯åŠ¨å‚æ•°ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´GCçš„æ–¹å¼ï¼Œä½†æ˜¯å®è´¨ä¸Šå’Œä¸Šè¿°æ–¹æ³•æ˜¯ç­‰åŒçš„ã€‚</p><h3 id="ï¼ˆå››ï¼‰é¿å…å†…å­˜äº¤æ¢"><a href="#ï¼ˆå››ï¼‰é¿å…å†…å­˜äº¤æ¢" class="headerlink" title="ï¼ˆå››ï¼‰é¿å…å†…å­˜äº¤æ¢"></a>ï¼ˆå››ï¼‰é¿å…å†…å­˜äº¤æ¢</h3><p>è¿™ä¸€ç‚¹å¾ˆç®€å•ï¼Œç”±äºæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜é¡µäº¤æ¢æœºåˆ¶ï¼Œä¼šç»™æ€§èƒ½å¸¦æ¥éšœç¢ï¼Œå¦‚æ•°æ®å†™æ»¡å†…å­˜ä¼šå†™å…¥Linuxä¸­çš„Swapåˆ†åŒºã€‚å¯ä»¥é€šè¿‡åœ¨elasticsearch.ymlæ–‡ä»¶ä¸­çš„bootstrap.mlockallè®¾ç½®ä¸ºtrueæ¥å®ç°ï¼Œä½†æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œéœ€è¦ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„ç›¸å…³é…ç½®æ–‡ä»¶ã€‚</p><h3 id="ï¼ˆäº”ï¼‰æ§åˆ¶ç´¢å¼•åˆå¹¶"><a href="#ï¼ˆäº”ï¼‰æ§åˆ¶ç´¢å¼•åˆå¹¶" class="headerlink" title="ï¼ˆäº”ï¼‰æ§åˆ¶ç´¢å¼•åˆå¹¶"></a>ï¼ˆäº”ï¼‰æ§åˆ¶ç´¢å¼•åˆå¹¶</h3><p>ESä¸­çš„åˆ†ç‰‡å’Œå‰¯æœ¬æœ¬è´¨ä¸Šéƒ½æ˜¯Luceneç´¢å¼•ï¼Œè€ŒLuceneç´¢å¼•åˆåŸºäºå¤šä¸ªç´¢å¼•æ®µæ„å»ºï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ï¼Œç´¢å¼•æ–‡ä»¶ä¸­çš„ç»å¤§å¤šæ•°éƒ½æ˜¯åªè¢«å†™ä¸€æ¬¡ï¼Œè¯»å¤šæ¬¡ï¼Œåœ¨Luceneå†…åœ¨æœºåˆ¶æ§åˆ¶ä¸‹ï¼Œå½“æ»¡è¶³æŸç§æ¡ä»¶çš„æ—¶å€™å¤šä¸ªç´¢å¼•æ®µä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªæ›´å¤§çš„ç´¢å¼•æ®µï¼Œè€Œé‚£äº›æ—§çš„ç´¢å¼•æ®µä¼šè¢«æŠ›å¼ƒå¹¶ç§»é™¤ç£ç›˜ï¼Œè¿™ä¸ªæ“ä½œå«åšæ®µåˆå¹¶ã€‚<br>Luceneè¦æ‰§è¡Œæ®µåˆå¹¶çš„ç†ç”±å¾ˆç®€å•å……åˆ†ï¼šç´¢å¼•æ®µç²’åº¦è¶Šå°ï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šä½ä¸”è€—è´¹çš„å†…å­˜è¶Šå¤šã€‚é¢‘ç¹çš„æ–‡æ¡£æ›´æ”¹æ“ä½œä¼šå¯¼è‡´å¤§é‡çš„å°ç´¢å¼•æ®µï¼Œä»è€Œå¯¼è‡´æ–‡ä»¶å¥æŸ„æ‰“å¼€è¿‡å¤šçš„é—®é¢˜ï¼Œå¦‚ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œå¢å¤§ç³»ç»Ÿå…è®¸çš„æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°ã€‚æ€»çš„æ¥è®²ï¼Œå½“ç´¢å¼•æ®µç”±å¤šä¸€ä¸ªåˆå¹¶ä¸ºä¸€ä¸ªçš„æ—¶å€™ï¼Œä¼šå‡å°‘ç´¢å¼•æ®µçš„æ•°é‡ä»è€Œæé«˜ESæ€§èƒ½ã€‚å¯¹äºç ”å‘è€…æ¥è®²ï¼Œæˆ‘ä»¬æ‰€èƒ½åšçš„å°±æ˜¯é€‰æ‹©åˆé€‚çš„åˆå¹¶ç­–ç•¥ï¼Œå°½ç®¡æ®µåˆå¹¶å®Œå…¨æ˜¯Luceneçš„ä»»åŠ¡ï¼Œä½†éšç€Luceneå¼€æ”¾æ›´å¤šé…ç½®å€Ÿå£ï¼Œæ–°ç‰ˆæœ¬çš„ESè¿˜æ˜¯æä¾›äº†ä¸‰ç§åˆå¹¶çš„ç­–ç•¥tieredï¼Œlog_byte_sizeï¼Œlog_docã€‚å¦å¤–ï¼ŒESä¹Ÿæä¾›äº†ä¸¤ç§Luceneç´¢å¼•æ®µåˆå¹¶çš„è°ƒåº¦å™¨ï¼šconcurrentå’Œserialã€‚å…¶ä¸­å„è€…å…·ä½“åŒºåˆ«ï¼Œè¿™é‡Œæš‚ä¸èµ˜è¿°ï¼Œåªæ˜¯æŠ›ç –å¼•ç‰ã€‚</p><h3 id="ï¼ˆå…­ï¼‰å‚è€ƒæ–‡çŒ®"><a href="#ï¼ˆå…­ï¼‰å‚è€ƒæ–‡çŒ®" class="headerlink" title="ï¼ˆå…­ï¼‰å‚è€ƒæ–‡çŒ®"></a>ï¼ˆå…­ï¼‰å‚è€ƒæ–‡çŒ®</h3><ol><li>â€‹ <a href="https://my.oschina.net/yjwxh/blog/706305" target="_blank" rel="noopener">https://my.oschina.net/yjwxh/blog/706305</a></li><li>â€‹ <a href="https://dy.163.com/article/EUI3N6EN0511Q1AF.html" target="_blank" rel="noopener">https://dy.163.com/article/EUI3N6EN0511Q1AF.html</a></li><li>â€‹ <a href="https://my.oschina.net/u/4296857/blog/3605645" target="_blank" rel="noopener">https://my.oschina.net/u/4296857/blog/3605645</a></li></ol><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>ES</tag>
      </tags>
  </entry>
  <entry>
    <title>MQæ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ç»¼åˆå¯¹æ¯”ä»‹ç»</title>
    <url>/post/8f1d9eba.html</url>
    <content><![CDATA[<p>1.ActiveMQï¼Œæ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå› æ­¤åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œç›´æ¥è¢«passæ‰äº†ã€‚å®ƒçš„Apiå¾ˆå®Œå–„ï¼Œåœ¨ä¸­å°å‹äº’è”ç½‘å…¬å¸å¯ä»¥å»ä½¿ç”¨ã€‚<br>2.kafkaï¼Œä¸»è¦å¼ºè°ƒé«˜æ€§èƒ½ï¼Œå¦‚æœå¯¹ä¸šåŠ¡éœ€è¦å¯é æ€§æ¶ˆæ¯çš„æŠ•é€’çš„æ—¶å€™ã€‚é‚£ä¹ˆå°±ä¸èƒ½å¤Ÿé€‰æ‹©kafkaäº†ã€‚ä½†æ˜¯å¦‚æœåšä¸€äº›æ—¥å¿—æ”¶é›†å‘¢ï¼Œkafkaè¿˜æ˜¯å¾ˆå¥½çš„ã€‚å› ä¸ºkafkaçš„æ€§èƒ½æ˜¯ååˆ†å¥½çš„ã€‚</p><a id="more"></a><p>3.RocketMQï¼Œå®ƒçš„ç‰¹ç‚¹éå¸¸å¥½ã€‚å®ƒé«˜æ€§èƒ½ã€æ»¡è¶³å¯é æ€§ã€åˆ†å¸ƒå¼äº‹ç‰©ã€æ”¯æŒæ°´å¹³æ‰©å±•ã€ä¸Šäº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯ã€ä¸»ä»ä¹‹é—´çš„åˆ‡æ¢ç­‰ç­‰ã€‚MQçš„æ‰€æœ‰ä¼˜ç‚¹å®ƒåŸºæœ¬éƒ½æ»¡è¶³ã€‚ä½†æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹ï¼šå•†ä¸šç‰ˆæ”¶è´¹ã€‚å› æ­¤å®ƒæœ‰è®¸å¤šåŠŸèƒ½æ˜¯ä¸å¯¹å¤–æä¾›çš„ã€‚</p><p>å…·ä½“è¯¦ç»†å¦‚ä¸‹å›¾:</p><p><img data-src="https://shuaizinanyihao.github.io/shuaizi-image/blogImg/20210309134939.png" alt=""></p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>MQ</category>
      </categories>
      <tags>
        <tag>MQ</tag>
      </tags>
  </entry>
</search>
